eb08b38a7b23909c690e7cfd00c75d55
"use strict";

/* istanbul ignore next */
function cov_puwdst8ni() {
  var path = "/Users/sachin/Documents/md-sports-/src/app/api/receipts/route.ts";
  var hash = "74dd9b193c5f1bc70c3148c207b1a7661412da92";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/sachin/Documents/md-sports-/src/app/api/receipts/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "2": {
        start: {
          line: 6,
          column: 24
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "3": {
        start: {
          line: 11,
          column: 0
        },
        end: {
          line: 18,
          column: 3
        }
      },
      "4": {
        start: {
          line: 13,
          column: 8
        },
        end: {
          line: 13,
          column: 19
        }
      },
      "5": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 20
        }
      },
      "6": {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 38
        }
      },
      "7": {
        start: {
          line: 20,
          column: 16
        },
        end: {
          line: 20,
          column: 46
        }
      },
      "8": {
        start: {
          line: 21,
          column: 16
        },
        end: {
          line: 21,
          column: 41
        }
      },
      "9": {
        start: {
          line: 23,
          column: 4
        },
        end: {
          line: 97,
          column: 5
        }
      },
      "10": {
        start: {
          line: 24,
          column: 33
        },
        end: {
          line: 24,
          column: 53
        }
      },
      "11": {
        start: {
          line: 25,
          column: 21
        },
        end: {
          line: 25,
          column: 58
        }
      },
      "12": {
        start: {
          line: 26,
          column: 22
        },
        end: {
          line: 26,
          column: 61
        }
      },
      "13": {
        start: {
          line: 27,
          column: 23
        },
        end: {
          line: 27,
          column: 55
        }
      },
      "14": {
        start: {
          line: 28,
          column: 21
        },
        end: {
          line: 28,
          column: 39
        }
      },
      "15": {
        start: {
          line: 30,
          column: 22
        },
        end: {
          line: 57,
          column: 14
        }
      },
      "16": {
        start: {
          line: 59,
          column: 25
        },
        end: {
          line: 75,
          column: 10
        }
      },
      "17": {
        start: {
          line: 77,
          column: 30
        },
        end: {
          line: 79,
          column: 10
        }
      },
      "18": {
        start: {
          line: 80,
          column: 27
        },
        end: {
          line: 80,
          column: 59
        }
      },
      "19": {
        start: {
          line: 81,
          column: 8
        },
        end: {
          line: 89,
          column: 11
        }
      },
      "20": {
        start: {
          line: 91,
          column: 8
        },
        end: {
          line: 91,
          column: 57
        }
      },
      "21": {
        start: {
          line: 92,
          column: 8
        },
        end: {
          line: 96,
          column: 11
        }
      },
      "22": {
        start: {
          line: 100,
          column: 4
        },
        end: {
          line: 277,
          column: 5
        }
      },
      "23": {
        start: {
          line: 101,
          column: 28
        },
        end: {
          line: 101,
          column: 48
        }
      },
      "24": {
        start: {
          line: 103,
          column: 8
        },
        end: {
          line: 109,
          column: 9
        }
      },
      "25": {
        start: {
          line: 104,
          column: 12
        },
        end: {
          line: 108,
          column: 15
        }
      },
      "26": {
        start: {
          line: 111,
          column: 32
        },
        end: {
          line: 118,
          column: 10
        }
      },
      "27": {
        start: {
          line: 119,
          column: 8
        },
        end: {
          line: 125,
          column: 9
        }
      },
      "28": {
        start: {
          line: 120,
          column: 12
        },
        end: {
          line: 124,
          column: 15
        }
      },
      "29": {
        start: {
          line: 126,
          column: 8
        },
        end: {
          line: 132,
          column: 9
        }
      },
      "30": {
        start: {
          line: 127,
          column: 12
        },
        end: {
          line: 131,
          column: 15
        }
      },
      "31": {
        start: {
          line: 134,
          column: 30
        },
        end: {
          line: 134,
          column: 85
        }
      },
      "32": {
        start: {
          line: 136,
          column: 23
        },
        end: {
          line: 266,
          column: 10
        }
      },
      "33": {
        start: {
          line: 138,
          column: 28
        },
        end: {
          line: 159,
          column: 14
        }
      },
      "34": {
        start: {
          line: 162,
          column: 34
        },
        end: {
          line: 172,
          column: 14
        }
      },
      "35": {
        start: {
          line: 173,
          column: 28
        },
        end: {
          line: 180,
          column: 14
        }
      },
      "36": {
        start: {
          line: 181,
          column: 30
        },
        end: {
          line: 181,
          column: 60
        }
      },
      "37": {
        start: {
          line: 182,
          column: 33
        },
        end: {
          line: 182,
          column: 52
        }
      },
      "38": {
        start: {
          line: 184,
          column: 28
        },
        end: {
          line: 184,
          column: 37
        }
      },
      "39": {
        start: {
          line: 185,
          column: 12
        },
        end: {
          line: 189,
          column: 13
        }
      },
      "40": {
        start: {
          line: 186,
          column: 16
        },
        end: {
          line: 186,
          column: 35
        }
      },
      "41": {
        start: {
          line: 187,
          column: 19
        },
        end: {
          line: 189,
          column: 13
        }
      },
      "42": {
        start: {
          line: 188,
          column: 16
        },
        end: {
          line: 188,
          column: 38
        }
      },
      "43": {
        start: {
          line: 191,
          column: 12
        },
        end: {
          line: 198,
          column: 15
        }
      },
      "44": {
        start: {
          line: 201,
          column: 12
        },
        end: {
          line: 241,
          column: 13
        }
      },
      "45": {
        start: {
          line: 203,
          column: 16
        },
        end: {
          line: 207,
          column: 19
        }
      },
      "46": {
        start: {
          line: 208,
          column: 16
        },
        end: {
          line: 210,
          column: 17
        }
      },
      "47": {
        start: {
          line: 209,
          column: 20
        },
        end: {
          line: 209,
          column: 74
        }
      },
      "48": {
        start: {
          line: 213,
          column: 38
        },
        end: {
          line: 213,
          column: 81
        }
      },
      "49": {
        start: {
          line: 214,
          column: 34
        },
        end: {
          line: 214,
          column: 36
        }
      },
      "50": {
        start: {
          line: 215,
          column: 34
        },
        end: {
          line: 215,
          column: 41
        }
      },
      "51": {
        start: {
          line: 216,
          column: 16
        },
        end: {
          line: 221,
          column: 17
        }
      },
      "52": {
        start: {
          line: 217,
          column: 20
        },
        end: {
          line: 217,
          column: 49
        }
      },
      "53": {
        start: {
          line: 220,
          column: 20
        },
        end: {
          line: 220,
          column: 49
        }
      },
      "54": {
        start: {
          line: 223,
          column: 16
        },
        end: {
          line: 228,
          column: 19
        }
      },
      "55": {
        start: {
          line: 229,
          column: 16
        },
        end: {
          line: 240,
          column: 17
        }
      },
      "56": {
        start: {
          line: 231,
          column: 20
        },
        end: {
          line: 239,
          column: 23
        }
      },
      "57": {
        start: {
          line: 243,
          column: 12
        },
        end: {
          line: 253,
          column: 15
        }
      },
      "58": {
        start: {
          line: 255,
          column: 12
        },
        end: {
          line: 264,
          column: 15
        }
      },
      "59": {
        start: {
          line: 265,
          column: 12
        },
        end: {
          line: 265,
          column: 27
        }
      },
      "60": {
        start: {
          line: 267,
          column: 8
        },
        end: {
          line: 269,
          column: 11
        }
      },
      "61": {
        start: {
          line: 271,
          column: 8
        },
        end: {
          line: 271,
          column: 56
        }
      },
      "62": {
        start: {
          line: 272,
          column: 8
        },
        end: {
          line: 276,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 16
          }
        },
        loc: {
          start: {
            line: 5,
            column: 30
          },
          end: {
            line: 10,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 9
          },
          end: {
            line: 12,
            column: 10
          }
        },
        loc: {
          start: {
            line: 12,
            column: 20
          },
          end: {
            line: 14,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 10
          },
          end: {
            line: 15,
            column: 11
          }
        },
        loc: {
          start: {
            line: 15,
            column: 21
          },
          end: {
            line: 17,
            column: 5
          }
        },
        line: 15
      },
      "3": {
        name: "GET",
        decl: {
          start: {
            line: 22,
            column: 15
          },
          end: {
            line: 22,
            column: 18
          }
        },
        loc: {
          start: {
            line: 22,
            column: 28
          },
          end: {
            line: 98,
            column: 1
          }
        },
        line: 22
      },
      "4": {
        name: "POST",
        decl: {
          start: {
            line: 99,
            column: 15
          },
          end: {
            line: 99,
            column: 19
          }
        },
        loc: {
          start: {
            line: 99,
            column: 29
          },
          end: {
            line: 278,
            column: 1
          }
        },
        line: 99
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 136,
            column: 57
          },
          end: {
            line: 136,
            column: 58
          }
        },
        loc: {
          start: {
            line: 136,
            column: 69
          },
          end: {
            line: 266,
            column: 9
          }
        },
        line: 136
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 25,
            column: 21
          },
          end: {
            line: 25,
            column: 58
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 25,
            column: 21
          },
          end: {
            line: 25,
            column: 53
          }
        }, {
          start: {
            line: 25,
            column: 57
          },
          end: {
            line: 25,
            column: 58
          }
        }],
        line: 25
      },
      "1": {
        loc: {
          start: {
            line: 26,
            column: 22
          },
          end: {
            line: 26,
            column: 61
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 26,
            column: 22
          },
          end: {
            line: 26,
            column: 55
          }
        }, {
          start: {
            line: 26,
            column: 59
          },
          end: {
            line: 26,
            column: 61
          }
        }],
        line: 26
      },
      "2": {
        loc: {
          start: {
            line: 27,
            column: 23
          },
          end: {
            line: 27,
            column: 55
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 27,
            column: 23
          },
          end: {
            line: 27,
            column: 49
          }
        }, {
          start: {
            line: 27,
            column: 53
          },
          end: {
            line: 27,
            column: 55
          }
        }],
        line: 27
      },
      "3": {
        loc: {
          start: {
            line: 30,
            column: 22
          },
          end: {
            line: 57,
            column: 14
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 30,
            column: 31
          },
          end: {
            line: 57,
            column: 9
          }
        }, {
          start: {
            line: 57,
            column: 12
          },
          end: {
            line: 57,
            column: 14
          }
        }],
        line: 30
      },
      "4": {
        loc: {
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 109,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 109,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 103
      },
      "5": {
        loc: {
          start: {
            line: 119,
            column: 8
          },
          end: {
            line: 125,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 119,
            column: 8
          },
          end: {
            line: 125,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 119
      },
      "6": {
        loc: {
          start: {
            line: 126,
            column: 8
          },
          end: {
            line: 132,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 126,
            column: 8
          },
          end: {
            line: 132,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 126
      },
      "7": {
        loc: {
          start: {
            line: 142,
            column: 33
          },
          end: {
            line: 142,
            column: 105
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 142,
            column: 59
          },
          end: {
            line: 142,
            column: 92
          }
        }, {
          start: {
            line: 142,
            column: 95
          },
          end: {
            line: 142,
            column: 105
          }
        }],
        line: 142
      },
      "8": {
        loc: {
          start: {
            line: 143,
            column: 30
          },
          end: {
            line: 143,
            column: 58
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 143,
            column: 30
          },
          end: {
            line: 143,
            column: 50
          }
        }, {
          start: {
            line: 143,
            column: 54
          },
          end: {
            line: 143,
            column: 58
          }
        }],
        line: 143
      },
      "9": {
        loc: {
          start: {
            line: 144,
            column: 35
          },
          end: {
            line: 144,
            column: 68
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 144,
            column: 35
          },
          end: {
            line: 144,
            column: 60
          }
        }, {
          start: {
            line: 144,
            column: 64
          },
          end: {
            line: 144,
            column: 68
          }
        }],
        line: 144
      },
      "10": {
        loc: {
          start: {
            line: 145,
            column: 34
          },
          end: {
            line: 145,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 145,
            column: 34
          },
          end: {
            line: 145,
            column: 58
          }
        }, {
          start: {
            line: 145,
            column: 62
          },
          end: {
            line: 145,
            column: 66
          }
        }],
        line: 145
      },
      "11": {
        loc: {
          start: {
            line: 146,
            column: 35
          },
          end: {
            line: 146,
            column: 68
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 146,
            column: 35
          },
          end: {
            line: 146,
            column: 60
          }
        }, {
          start: {
            line: 146,
            column: 64
          },
          end: {
            line: 146,
            column: 68
          }
        }],
        line: 146
      },
      "12": {
        loc: {
          start: {
            line: 147,
            column: 27
          },
          end: {
            line: 147,
            column: 52
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 147,
            column: 27
          },
          end: {
            line: 147,
            column: 44
          }
        }, {
          start: {
            line: 147,
            column: 48
          },
          end: {
            line: 147,
            column: 52
          }
        }],
        line: 147
      },
      "13": {
        loc: {
          start: {
            line: 148,
            column: 33
          },
          end: {
            line: 148,
            column: 64
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 148,
            column: 33
          },
          end: {
            line: 148,
            column: 56
          }
        }, {
          start: {
            line: 148,
            column: 60
          },
          end: {
            line: 148,
            column: 64
          }
        }],
        line: 148
      },
      "14": {
        loc: {
          start: {
            line: 181,
            column: 30
          },
          end: {
            line: 181,
            column: 60
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 181,
            column: 30
          },
          end: {
            line: 181,
            column: 55
          }
        }, {
          start: {
            line: 181,
            column: 59
          },
          end: {
            line: 181,
            column: 60
          }
        }],
        line: 181
      },
      "15": {
        loc: {
          start: {
            line: 182,
            column: 33
          },
          end: {
            line: 182,
            column: 52
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 182,
            column: 33
          },
          end: {
            line: 182,
            column: 47
          }
        }, {
          start: {
            line: 182,
            column: 51
          },
          end: {
            line: 182,
            column: 52
          }
        }],
        line: 182
      },
      "16": {
        loc: {
          start: {
            line: 185,
            column: 12
          },
          end: {
            line: 189,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 185,
            column: 12
          },
          end: {
            line: 189,
            column: 13
          }
        }, {
          start: {
            line: 187,
            column: 19
          },
          end: {
            line: 189,
            column: 13
          }
        }],
        line: 185
      },
      "17": {
        loc: {
          start: {
            line: 187,
            column: 19
          },
          end: {
            line: 189,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 187,
            column: 19
          },
          end: {
            line: 189,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 187
      },
      "18": {
        loc: {
          start: {
            line: 201,
            column: 12
          },
          end: {
            line: 241,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 201,
            column: 12
          },
          end: {
            line: 241,
            column: 13
          }
        }, {
          start: {
            line: 211,
            column: 19
          },
          end: {
            line: 241,
            column: 13
          }
        }],
        line: 201
      },
      "19": {
        loc: {
          start: {
            line: 208,
            column: 16
          },
          end: {
            line: 210,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 208,
            column: 16
          },
          end: {
            line: 210,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 208
      },
      "20": {
        loc: {
          start: {
            line: 216,
            column: 16
          },
          end: {
            line: 221,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 216,
            column: 16
          },
          end: {
            line: 221,
            column: 17
          }
        }, {
          start: {
            line: 218,
            column: 23
          },
          end: {
            line: 221,
            column: 17
          }
        }],
        line: 216
      },
      "21": {
        loc: {
          start: {
            line: 229,
            column: 16
          },
          end: {
            line: 240,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 229,
            column: 16
          },
          end: {
            line: 240,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 229
      },
      "22": {
        loc: {
          start: {
            line: 245,
            column: 26
          },
          end: {
            line: 245,
            column: 98
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 245,
            column: 52
          },
          end: {
            line: 245,
            column: 85
          }
        }, {
          start: {
            line: 245,
            column: 88
          },
          end: {
            line: 245,
            column: 98
          }
        }],
        line: 245
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0],
      "16": [0, 0],
      "17": [0, 0],
      "18": [0, 0],
      "19": [0, 0],
      "20": [0, 0],
      "21": [0, 0],
      "22": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/sachin/Documents/md-sports-/src/app/api/receipts/route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { verifyToken, extractToken } from '@/lib/auth';\nimport { Prisma } from '@prisma/client';\n\n// Get all receipts with pagination and optional filtering\nexport async function GET(request: Request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const page = Number(searchParams.get('page')) || 1;\n        const limit = Number(searchParams.get('limit')) || 10;\n        const search = searchParams.get('search') || '';\n\n        const skip = (page - 1) * limit;\n\n        // Build the where condition for search\n        const where: Prisma.ReceiptWhereInput = search ? {\n            OR: [\n                { receiptNumber: { contains: search, mode: Prisma.QueryMode.insensitive } },\n                { payment: { referenceNumber: { contains: search, mode: Prisma.QueryMode.insensitive } } },\n                { payment: { customer: { name: { contains: search, mode: Prisma.QueryMode.insensitive } } } }\n            ]\n        } : {};\n\n        // Get receipts with pagination\n        const receipts = await prisma.receipt.findMany({\n            where,\n            include: {\n                payment: {\n                    include: {\n                        customer: true,\n                        invoice: true\n                    }\n                },\n                confirmedByUser: true\n            },\n            orderBy: { createdAt: 'desc' },\n            skip,\n            take: limit\n        });\n\n        // Get total count for pagination\n        const totalReceipts = await prisma.receipt.count({ where });\n        const totalPages = Math.ceil(totalReceipts / limit);\n\n        return NextResponse.json({\n            receipts,\n            pagination: {\n                totalReceipts,\n                totalPages,\n                currentPage: page,\n                perPage: limit\n            }\n        });\n    } catch (error) {\n        console.error('Error fetching receipts:', error);\n        return NextResponse.json(\n            { error: 'Failed to fetch receipts' },\n            { status: 500 }\n        );\n    }\n}\n\n// Create a new receipt\nexport async function POST(request: Request) {\n    try {\n        const receiptData = await request.json();\n\n        // Validate receipt data\n        if (!receiptData.paymentId) {\n            return NextResponse.json(\n                { error: 'Payment ID is required' },\n                { status: 400 }\n            );\n        }\n\n        // Check if payment exists and doesn't already have a receipt\n        const existingPayment = await prisma.payment.findUnique({\n            where: { id: receiptData.paymentId },\n            include: { receipt: true }\n        });\n\n        if (!existingPayment) {\n            return NextResponse.json(\n                { error: 'Payment not found' },\n                { status: 404 }\n            );\n        }\n\n        if (existingPayment.receipt) {\n            return NextResponse.json(\n                { error: 'A receipt already exists for this payment' },\n                { status: 409 }\n            );\n        }\n\n        // Generate a unique receipt number\n        const receiptNumber = `REC-${Date.now()}-${Math.floor(Math.random() * 1000)}`;\n\n        // Use a transaction to ensure data consistency\n        const result = await prisma.$transaction(async (tx) => {\n            // Create receipt\n            const receipt = await tx.receipt.create({\n                data: {\n                    paymentId: receiptData.paymentId,\n                    receiptNumber,\n                    receiptDate: receiptData.receiptDate ? new Date(receiptData.receiptDate) : new Date(),\n                    bankName: receiptData.bankName || null,\n                    accountNumber: receiptData.accountNumber || null,\n                    chequeNumber: receiptData.chequeNumber || null,\n                    transactionId: receiptData.transactionId || null,\n                    notes: receiptData.notes || null,\n                    confirmedBy: receiptData.confirmedBy || null\n                },\n                include: {\n                    payment: {\n                        include: {\n                            customer: true,\n                            invoice: true\n                        }\n                    },\n                    confirmedByUser: true\n                }\n            });\n\n            // Calculate total payments with receipts for the invoice to determine correct status\n            // Only count payments that have receipts (confirmed payments)\n            const totalPayments = await tx.payment.aggregate({\n                where: { \n                    invoiceId: existingPayment.invoiceId,\n                    receipt: {\n                        isNot: null\n                    }\n                },\n                _sum: { amount: true }\n            });\n\n            const invoice = await tx.invoice.findUnique({\n                where: { id: existingPayment.invoiceId },\n                select: { total: true }\n            });\n\n            const totalPaid = totalPayments._sum.amount || 0;\n            const invoiceTotal = invoice?.total || 0;\n\n            // Determine the correct status based on payment amount\n            let newStatus = 'pending';\n            if (totalPaid >= invoiceTotal) {\n                newStatus = 'paid';\n            } else if (totalPaid > 0) {\n                newStatus = 'partial';\n            }\n\n            // Update invoice status based on actual payment amount\n            await tx.invoice.update({\n                where: { id: existingPayment.invoiceId },\n                data: { status: newStatus }\n            });\n\n            // Use the selected account from the payment, or fallback to payment method logic\n            let account;\n            \n            if (existingPayment.accountId) {\n                // Use the account selected during payment creation\n                account = await tx.account.findUnique({\n                    where: { id: existingPayment.accountId }\n                });\n                \n                if (!account) {\n                    throw new Error('Selected payment account not found');\n                }\n            } else {\n                // Fallback to old logic for payments without selected accounts\n                const paymentMethod = existingPayment.paymentMethod.toLowerCase();\n                let accountName = '';\n                let accountType = 'asset';\n\n                if (paymentMethod.includes('cash')) {\n                    accountName = 'Cash in Hand';\n                } else {\n                    // For all non-cash payments, default to Cash in Bank\n                    accountName = 'Cash in Bank';\n                }\n\n                // Find or create the appropriate account\n                account = await tx.account.findFirst({\n                    where: {\n                        name: accountName,\n                        type: accountType\n                    }\n                });\n\n                if (!account) {\n                    // Create the account if it doesn't exist\n                    account = await tx.account.create({\n                        data: {\n                            name: accountName,\n                            type: accountType,\n                            balance: 0,\n                            description: `Auto-created account for ${paymentMethod} payments`,\n                            isActive: true\n                        }\n                    });\n                }\n            }\n\n            // Create accounting transaction for the income\n            await tx.transaction.create({\n                data: {\n                    date: receiptData.receiptDate ? new Date(receiptData.receiptDate) : new Date(),\n                    description: `Payment received from ${receipt.payment.customer.name} - Invoice ${receipt.payment.invoice.invoiceNumber}`,\n                    accountId: account.id,\n                    type: 'income',\n                    amount: existingPayment.amount,\n                    reference: receiptNumber,\n                    category: 'Sales Revenue'\n                }\n            });\n\n            // Update account balance\n            await tx.account.update({\n                where: { id: account.id },\n                data: {\n                    balance: {\n                        increment: existingPayment.amount\n                    }\n                }\n            });\n\n            return receipt;\n        });\n\n        return NextResponse.json(result, { status: 201 });\n    } catch (error) {\n        console.error('Error creating receipt:', error);\n        return NextResponse.json(\n            { error: 'Failed to create receipt' },\n            { status: 500 }\n        );\n    }\n}"],
      names: ["GET", "POST", "request", "searchParams", "URL", "url", "page", "Number", "get", "limit", "search", "skip", "where", "OR", "receiptNumber", "contains", "mode", "Prisma", "QueryMode", "insensitive", "payment", "referenceNumber", "customer", "name", "receipts", "prisma", "receipt", "findMany", "include", "invoice", "confirmedByUser", "orderBy", "createdAt", "take", "totalReceipts", "count", "totalPages", "Math", "ceil", "NextResponse", "json", "pagination", "currentPage", "perPage", "error", "console", "status", "receiptData", "paymentId", "existingPayment", "findUnique", "id", "Date", "now", "floor", "random", "result", "$transaction", "tx", "create", "data", "receiptDate", "bankName", "accountNumber", "chequeNumber", "transactionId", "notes", "confirmedBy", "totalPayments", "aggregate", "invoiceId", "isNot", "_sum", "amount", "select", "total", "totalPaid", "invoiceTotal", "newStatus", "update", "account", "accountId", "Error", "paymentMethod", "toLowerCase", "accountName", "accountType", "includes", "findFirst", "type", "balance", "description", "isActive", "transaction", "date", "invoiceNumber", "reference", "category", "increment"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "74dd9b193c5f1bc70c3148c207b1a7661412da92"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_puwdst8ni = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_puwdst8ni();
cov_puwdst8ni().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_puwdst8ni().f[0]++;
  cov_puwdst8ni().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_puwdst8ni().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: all[name]
    });
  }
}
/* istanbul ignore next */
cov_puwdst8ni().s[3]++;
_export(exports, {
  GET: function () {
    /* istanbul ignore next */
    cov_puwdst8ni().f[1]++;
    cov_puwdst8ni().s[4]++;
    return GET;
  },
  POST: function () {
    /* istanbul ignore next */
    cov_puwdst8ni().f[2]++;
    cov_puwdst8ni().s[5]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_puwdst8ni().s[6]++, require("next/server"));
const _prisma =
/* istanbul ignore next */
(cov_puwdst8ni().s[7]++, require("../../../lib/prisma"));
const _client =
/* istanbul ignore next */
(cov_puwdst8ni().s[8]++, require("@prisma/client"));
async function GET(request) {
  /* istanbul ignore next */
  cov_puwdst8ni().f[3]++;
  cov_puwdst8ni().s[9]++;
  try {
    const {
      searchParams
    } =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[10]++, new URL(request.url));
    const page =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[11]++,
    /* istanbul ignore next */
    (cov_puwdst8ni().b[0][0]++, Number(searchParams.get("page"))) ||
    /* istanbul ignore next */
    (cov_puwdst8ni().b[0][1]++, 1));
    const limit =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[12]++,
    /* istanbul ignore next */
    (cov_puwdst8ni().b[1][0]++, Number(searchParams.get("limit"))) ||
    /* istanbul ignore next */
    (cov_puwdst8ni().b[1][1]++, 10));
    const search =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[13]++,
    /* istanbul ignore next */
    (cov_puwdst8ni().b[2][0]++, searchParams.get("search")) ||
    /* istanbul ignore next */
    (cov_puwdst8ni().b[2][1]++, ""));
    const skip =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[14]++, (page - 1) * limit);
    // Build the where condition for search
    const where =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[15]++, search ?
    /* istanbul ignore next */
    (cov_puwdst8ni().b[3][0]++, {
      OR: [{
        receiptNumber: {
          contains: search,
          mode: _client.Prisma.QueryMode.insensitive
        }
      }, {
        payment: {
          referenceNumber: {
            contains: search,
            mode: _client.Prisma.QueryMode.insensitive
          }
        }
      }, {
        payment: {
          customer: {
            name: {
              contains: search,
              mode: _client.Prisma.QueryMode.insensitive
            }
          }
        }
      }]
    }) :
    /* istanbul ignore next */
    (cov_puwdst8ni().b[3][1]++, {}));
    // Get receipts with pagination
    const receipts =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[16]++, await _prisma.prisma.receipt.findMany({
      where,
      include: {
        payment: {
          include: {
            customer: true,
            invoice: true
          }
        },
        confirmedByUser: true
      },
      orderBy: {
        createdAt: "desc"
      },
      skip,
      take: limit
    }));
    // Get total count for pagination
    const totalReceipts =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[17]++, await _prisma.prisma.receipt.count({
      where
    }));
    const totalPages =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[18]++, Math.ceil(totalReceipts / limit));
    /* istanbul ignore next */
    cov_puwdst8ni().s[19]++;
    return _server.NextResponse.json({
      receipts,
      pagination: {
        totalReceipts,
        totalPages,
        currentPage: page,
        perPage: limit
      }
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_puwdst8ni().s[20]++;
    console.error("Error fetching receipts:", error);
    /* istanbul ignore next */
    cov_puwdst8ni().s[21]++;
    return _server.NextResponse.json({
      error: "Failed to fetch receipts"
    }, {
      status: 500
    });
  }
}
async function POST(request) {
  /* istanbul ignore next */
  cov_puwdst8ni().f[4]++;
  cov_puwdst8ni().s[22]++;
  try {
    const receiptData =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[23]++, await request.json());
    // Validate receipt data
    /* istanbul ignore next */
    cov_puwdst8ni().s[24]++;
    if (!receiptData.paymentId) {
      /* istanbul ignore next */
      cov_puwdst8ni().b[4][0]++;
      cov_puwdst8ni().s[25]++;
      return _server.NextResponse.json({
        error: "Payment ID is required"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_puwdst8ni().b[4][1]++;
    }
    // Check if payment exists and doesn't already have a receipt
    const existingPayment =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[26]++, await _prisma.prisma.payment.findUnique({
      where: {
        id: receiptData.paymentId
      },
      include: {
        receipt: true
      }
    }));
    /* istanbul ignore next */
    cov_puwdst8ni().s[27]++;
    if (!existingPayment) {
      /* istanbul ignore next */
      cov_puwdst8ni().b[5][0]++;
      cov_puwdst8ni().s[28]++;
      return _server.NextResponse.json({
        error: "Payment not found"
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_puwdst8ni().b[5][1]++;
    }
    cov_puwdst8ni().s[29]++;
    if (existingPayment.receipt) {
      /* istanbul ignore next */
      cov_puwdst8ni().b[6][0]++;
      cov_puwdst8ni().s[30]++;
      return _server.NextResponse.json({
        error: "A receipt already exists for this payment"
      }, {
        status: 409
      });
    } else
    /* istanbul ignore next */
    {
      cov_puwdst8ni().b[6][1]++;
    }
    // Generate a unique receipt number
    const receiptNumber =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[31]++, `REC-${Date.now()}-${Math.floor(Math.random() * 1000)}`);
    // Use a transaction to ensure data consistency
    const result =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[32]++, await _prisma.prisma.$transaction(async tx => {
      /* istanbul ignore next */
      cov_puwdst8ni().f[5]++;
      // Create receipt
      const receipt =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[33]++, await tx.receipt.create({
        data: {
          paymentId: receiptData.paymentId,
          receiptNumber,
          receiptDate: receiptData.receiptDate ?
          /* istanbul ignore next */
          (cov_puwdst8ni().b[7][0]++, new Date(receiptData.receiptDate)) :
          /* istanbul ignore next */
          (cov_puwdst8ni().b[7][1]++, new Date()),
          bankName:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[8][0]++, receiptData.bankName) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[8][1]++, null),
          accountNumber:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[9][0]++, receiptData.accountNumber) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[9][1]++, null),
          chequeNumber:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[10][0]++, receiptData.chequeNumber) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[10][1]++, null),
          transactionId:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[11][0]++, receiptData.transactionId) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[11][1]++, null),
          notes:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[12][0]++, receiptData.notes) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[12][1]++, null),
          confirmedBy:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[13][0]++, receiptData.confirmedBy) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[13][1]++, null)
        },
        include: {
          payment: {
            include: {
              customer: true,
              invoice: true
            }
          },
          confirmedByUser: true
        }
      }));
      // Calculate total payments with receipts for the invoice to determine correct status
      // Only count payments that have receipts (confirmed payments)
      const totalPayments =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[34]++, await tx.payment.aggregate({
        where: {
          invoiceId: existingPayment.invoiceId,
          receipt: {
            isNot: null
          }
        },
        _sum: {
          amount: true
        }
      }));
      const invoice =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[35]++, await tx.invoice.findUnique({
        where: {
          id: existingPayment.invoiceId
        },
        select: {
          total: true
        }
      }));
      const totalPaid =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[36]++,
      /* istanbul ignore next */
      (cov_puwdst8ni().b[14][0]++, totalPayments._sum.amount) ||
      /* istanbul ignore next */
      (cov_puwdst8ni().b[14][1]++, 0));
      const invoiceTotal =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[37]++,
      /* istanbul ignore next */
      (cov_puwdst8ni().b[15][0]++, invoice?.total) ||
      /* istanbul ignore next */
      (cov_puwdst8ni().b[15][1]++, 0));
      // Determine the correct status based on payment amount
      let newStatus =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[38]++, "pending");
      /* istanbul ignore next */
      cov_puwdst8ni().s[39]++;
      if (totalPaid >= invoiceTotal) {
        /* istanbul ignore next */
        cov_puwdst8ni().b[16][0]++;
        cov_puwdst8ni().s[40]++;
        newStatus = "paid";
      } else {
        /* istanbul ignore next */
        cov_puwdst8ni().b[16][1]++;
        cov_puwdst8ni().s[41]++;
        if (totalPaid > 0) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[17][0]++;
          cov_puwdst8ni().s[42]++;
          newStatus = "partial";
        } else
        /* istanbul ignore next */
        {
          cov_puwdst8ni().b[17][1]++;
        }
      }
      // Update invoice status based on actual payment amount
      /* istanbul ignore next */
      cov_puwdst8ni().s[43]++;
      await tx.invoice.update({
        where: {
          id: existingPayment.invoiceId
        },
        data: {
          status: newStatus
        }
      });
      // Use the selected account from the payment, or fallback to payment method logic
      let account;
      /* istanbul ignore next */
      cov_puwdst8ni().s[44]++;
      if (existingPayment.accountId) {
        /* istanbul ignore next */
        cov_puwdst8ni().b[18][0]++;
        cov_puwdst8ni().s[45]++;
        // Use the account selected during payment creation
        account = await tx.account.findUnique({
          where: {
            id: existingPayment.accountId
          }
        });
        /* istanbul ignore next */
        cov_puwdst8ni().s[46]++;
        if (!account) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[19][0]++;
          cov_puwdst8ni().s[47]++;
          throw new Error("Selected payment account not found");
        } else
        /* istanbul ignore next */
        {
          cov_puwdst8ni().b[19][1]++;
        }
      } else {
        /* istanbul ignore next */
        cov_puwdst8ni().b[18][1]++;
        // Fallback to old logic for payments without selected accounts
        const paymentMethod =
        /* istanbul ignore next */
        (cov_puwdst8ni().s[48]++, existingPayment.paymentMethod.toLowerCase());
        let accountName =
        /* istanbul ignore next */
        (cov_puwdst8ni().s[49]++, "");
        let accountType =
        /* istanbul ignore next */
        (cov_puwdst8ni().s[50]++, "asset");
        /* istanbul ignore next */
        cov_puwdst8ni().s[51]++;
        if (paymentMethod.includes("cash")) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[20][0]++;
          cov_puwdst8ni().s[52]++;
          accountName = "Cash in Hand";
        } else {
          /* istanbul ignore next */
          cov_puwdst8ni().b[20][1]++;
          cov_puwdst8ni().s[53]++;
          // For all non-cash payments, default to Cash in Bank
          accountName = "Cash in Bank";
        }
        // Find or create the appropriate account
        /* istanbul ignore next */
        cov_puwdst8ni().s[54]++;
        account = await tx.account.findFirst({
          where: {
            name: accountName,
            type: accountType
          }
        });
        /* istanbul ignore next */
        cov_puwdst8ni().s[55]++;
        if (!account) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[21][0]++;
          cov_puwdst8ni().s[56]++;
          // Create the account if it doesn't exist
          account = await tx.account.create({
            data: {
              name: accountName,
              type: accountType,
              balance: 0,
              description: `Auto-created account for ${paymentMethod} payments`,
              isActive: true
            }
          });
        } else
        /* istanbul ignore next */
        {
          cov_puwdst8ni().b[21][1]++;
        }
      }
      // Create accounting transaction for the income
      /* istanbul ignore next */
      cov_puwdst8ni().s[57]++;
      await tx.transaction.create({
        data: {
          date: receiptData.receiptDate ?
          /* istanbul ignore next */
          (cov_puwdst8ni().b[22][0]++, new Date(receiptData.receiptDate)) :
          /* istanbul ignore next */
          (cov_puwdst8ni().b[22][1]++, new Date()),
          description: `Payment received from ${receipt.payment.customer.name} - Invoice ${receipt.payment.invoice.invoiceNumber}`,
          accountId: account.id,
          type: "income",
          amount: existingPayment.amount,
          reference: receiptNumber,
          category: "Sales Revenue"
        }
      });
      // Update account balance
      /* istanbul ignore next */
      cov_puwdst8ni().s[58]++;
      await tx.account.update({
        where: {
          id: account.id
        },
        data: {
          balance: {
            increment: existingPayment.amount
          }
        }
      });
      /* istanbul ignore next */
      cov_puwdst8ni().s[59]++;
      return receipt;
    }));
    /* istanbul ignore next */
    cov_puwdst8ni().s[60]++;
    return _server.NextResponse.json(result, {
      status: 201
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_puwdst8ni().s[61]++;
    console.error("Error creating receipt:", error);
    /* istanbul ignore next */
    cov_puwdst8ni().s[62]++;
    return _server.NextResponse.json({
      error: "Failed to create receipt"
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJjb3ZfcHV3ZHN0OG5pIiwiZiIsInMiLCJQT1NUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInBhZ2UiLCJiIiwiTnVtYmVyIiwiZ2V0IiwibGltaXQiLCJzZWFyY2giLCJza2lwIiwid2hlcmUiLCJPUiIsInJlY2VpcHROdW1iZXIiLCJjb250YWlucyIsIm1vZGUiLCJfY2xpZW50IiwiUHJpc21hIiwiUXVlcnlNb2RlIiwiaW5zZW5zaXRpdmUiLCJwYXltZW50IiwicmVmZXJlbmNlTnVtYmVyIiwiY3VzdG9tZXIiLCJuYW1lIiwicmVjZWlwdHMiLCJfcHJpc21hIiwicHJpc21hIiwicmVjZWlwdCIsImZpbmRNYW55IiwiaW5jbHVkZSIsImludm9pY2UiLCJjb25maXJtZWRCeVVzZXIiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidGFrZSIsInRvdGFsUmVjZWlwdHMiLCJjb3VudCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsIl9zZXJ2ZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwicGFnaW5hdGlvbiIsImN1cnJlbnRQYWdlIiwicGVyUGFnZSIsImVycm9yIiwiY29uc29sZSIsInN0YXR1cyIsInJlY2VpcHREYXRhIiwicGF5bWVudElkIiwiZXhpc3RpbmdQYXltZW50IiwiZmluZFVuaXF1ZSIsImlkIiwiRGF0ZSIsIm5vdyIsImZsb29yIiwicmFuZG9tIiwicmVzdWx0IiwiJHRyYW5zYWN0aW9uIiwidHgiLCJjcmVhdGUiLCJkYXRhIiwicmVjZWlwdERhdGUiLCJiYW5rTmFtZSIsImFjY291bnROdW1iZXIiLCJjaGVxdWVOdW1iZXIiLCJ0cmFuc2FjdGlvbklkIiwibm90ZXMiLCJjb25maXJtZWRCeSIsInRvdGFsUGF5bWVudHMiLCJhZ2dyZWdhdGUiLCJpbnZvaWNlSWQiLCJpc05vdCIsIl9zdW0iLCJhbW91bnQiLCJzZWxlY3QiLCJ0b3RhbCIsInRvdGFsUGFpZCIsImludm9pY2VUb3RhbCIsIm5ld1N0YXR1cyIsInVwZGF0ZSIsImFjY291bnQiLCJhY2NvdW50SWQiLCJFcnJvciIsInBheW1lbnRNZXRob2QiLCJ0b0xvd2VyQ2FzZSIsImFjY291bnROYW1lIiwiYWNjb3VudFR5cGUiLCJpbmNsdWRlcyIsImZpbmRGaXJzdCIsInR5cGUiLCJiYWxhbmNlIiwiZGVzY3JpcHRpb24iLCJpc0FjdGl2ZSIsInRyYW5zYWN0aW9uIiwiZGF0ZSIsImludm9pY2VOdW1iZXIiLCJyZWZlcmVuY2UiLCJjYXRlZ29yeSIsImluY3JlbWVudCJdLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL2FwcC9hcGkvcmVjZWlwdHMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XG5pbXBvcnQgeyB2ZXJpZnlUb2tlbiwgZXh0cmFjdFRva2VuIH0gZnJvbSAnQC9saWIvYXV0aCc7XG5pbXBvcnQgeyBQcmlzbWEgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbi8vIEdldCBhbGwgcmVjZWlwdHMgd2l0aCBwYWdpbmF0aW9uIGFuZCBvcHRpb25hbCBmaWx0ZXJpbmdcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogUmVxdWVzdCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICAgICAgY29uc3QgcGFnZSA9IE51bWJlcihzZWFyY2hQYXJhbXMuZ2V0KCdwYWdlJykpIHx8IDE7XG4gICAgICAgIGNvbnN0IGxpbWl0ID0gTnVtYmVyKHNlYXJjaFBhcmFtcy5nZXQoJ2xpbWl0JykpIHx8IDEwO1xuICAgICAgICBjb25zdCBzZWFyY2ggPSBzZWFyY2hQYXJhbXMuZ2V0KCdzZWFyY2gnKSB8fCAnJztcblxuICAgICAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gICAgICAgIC8vIEJ1aWxkIHRoZSB3aGVyZSBjb25kaXRpb24gZm9yIHNlYXJjaFxuICAgICAgICBjb25zdCB3aGVyZTogUHJpc21hLlJlY2VpcHRXaGVyZUlucHV0ID0gc2VhcmNoID8ge1xuICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICB7IHJlY2VpcHROdW1iZXI6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogUHJpc21hLlF1ZXJ5TW9kZS5pbnNlbnNpdGl2ZSB9IH0sXG4gICAgICAgICAgICAgICAgeyBwYXltZW50OiB7IHJlZmVyZW5jZU51bWJlcjogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBQcmlzbWEuUXVlcnlNb2RlLmluc2Vuc2l0aXZlIH0gfSB9LFxuICAgICAgICAgICAgICAgIHsgcGF5bWVudDogeyBjdXN0b21lcjogeyBuYW1lOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFByaXNtYS5RdWVyeU1vZGUuaW5zZW5zaXRpdmUgfSB9IH0gfVxuICAgICAgICAgICAgXVxuICAgICAgICB9IDoge307XG5cbiAgICAgICAgLy8gR2V0IHJlY2VpcHRzIHdpdGggcGFnaW5hdGlvblxuICAgICAgICBjb25zdCByZWNlaXB0cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmZpbmRNYW55KHtcbiAgICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHBheW1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXI6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnZvaWNlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbmZpcm1lZEJ5VXNlcjogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICAgICAgICAgIHNraXAsXG4gICAgICAgICAgICB0YWtlOiBsaW1pdFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBHZXQgdG90YWwgY291bnQgZm9yIHBhZ2luYXRpb25cbiAgICAgICAgY29uc3QgdG90YWxSZWNlaXB0cyA9IGF3YWl0IHByaXNtYS5yZWNlaXB0LmNvdW50KHsgd2hlcmUgfSk7XG4gICAgICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWxSZWNlaXB0cyAvIGxpbWl0KTtcblxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgICAgcmVjZWlwdHMsXG4gICAgICAgICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgdG90YWxSZWNlaXB0cyxcbiAgICAgICAgICAgICAgICB0b3RhbFBhZ2VzLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlOiBwYWdlLFxuICAgICAgICAgICAgICAgIHBlclBhZ2U6IGxpbWl0XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHJlY2VpcHRzOicsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCByZWNlaXB0cycgfSxcbiAgICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgICApO1xuICAgIH1cbn1cblxuLy8gQ3JlYXRlIGEgbmV3IHJlY2VpcHRcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZWNlaXB0RGF0YSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgICAgIC8vIFZhbGlkYXRlIHJlY2VpcHQgZGF0YVxuICAgICAgICBpZiAoIXJlY2VpcHREYXRhLnBheW1lbnRJZCkge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgZXJyb3I6ICdQYXltZW50IElEIGlzIHJlcXVpcmVkJyB9LFxuICAgICAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHBheW1lbnQgZXhpc3RzIGFuZCBkb2Vzbid0IGFscmVhZHkgaGF2ZSBhIHJlY2VpcHRcbiAgICAgICAgY29uc3QgZXhpc3RpbmdQYXltZW50ID0gYXdhaXQgcHJpc21hLnBheW1lbnQuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZTogeyBpZDogcmVjZWlwdERhdGEucGF5bWVudElkIH0sXG4gICAgICAgICAgICBpbmNsdWRlOiB7IHJlY2VpcHQ6IHRydWUgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoIWV4aXN0aW5nUGF5bWVudCkge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgZXJyb3I6ICdQYXltZW50IG5vdCBmb3VuZCcgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZXhpc3RpbmdQYXltZW50LnJlY2VpcHQpIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgICAgICB7IGVycm9yOiAnQSByZWNlaXB0IGFscmVhZHkgZXhpc3RzIGZvciB0aGlzIHBheW1lbnQnIH0sXG4gICAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwOSB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgcmVjZWlwdCBudW1iZXJcbiAgICAgICAgY29uc3QgcmVjZWlwdE51bWJlciA9IGBSRUMtJHtEYXRlLm5vdygpfS0ke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDApfWA7XG5cbiAgICAgICAgLy8gVXNlIGEgdHJhbnNhY3Rpb24gdG8gZW5zdXJlIGRhdGEgY29uc2lzdGVuY3lcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSByZWNlaXB0XG4gICAgICAgICAgICBjb25zdCByZWNlaXB0ID0gYXdhaXQgdHgucmVjZWlwdC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgcGF5bWVudElkOiByZWNlaXB0RGF0YS5wYXltZW50SWQsXG4gICAgICAgICAgICAgICAgICAgIHJlY2VpcHROdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHJlY2VpcHREYXRlOiByZWNlaXB0RGF0YS5yZWNlaXB0RGF0ZSA/IG5ldyBEYXRlKHJlY2VpcHREYXRhLnJlY2VpcHREYXRlKSA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgICAgIGJhbmtOYW1lOiByZWNlaXB0RGF0YS5iYW5rTmFtZSB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICBhY2NvdW50TnVtYmVyOiByZWNlaXB0RGF0YS5hY2NvdW50TnVtYmVyIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNoZXF1ZU51bWJlcjogcmVjZWlwdERhdGEuY2hlcXVlTnVtYmVyIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uSWQ6IHJlY2VpcHREYXRhLnRyYW5zYWN0aW9uSWQgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgbm90ZXM6IHJlY2VpcHREYXRhLm5vdGVzIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1lZEJ5OiByZWNlaXB0RGF0YS5jb25maXJtZWRCeSB8fCBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgIHBheW1lbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21lcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnZvaWNlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpcm1lZEJ5VXNlcjogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdG90YWwgcGF5bWVudHMgd2l0aCByZWNlaXB0cyBmb3IgdGhlIGludm9pY2UgdG8gZGV0ZXJtaW5lIGNvcnJlY3Qgc3RhdHVzXG4gICAgICAgICAgICAvLyBPbmx5IGNvdW50IHBheW1lbnRzIHRoYXQgaGF2ZSByZWNlaXB0cyAoY29uZmlybWVkIHBheW1lbnRzKVxuICAgICAgICAgICAgY29uc3QgdG90YWxQYXltZW50cyA9IGF3YWl0IHR4LnBheW1lbnQuYWdncmVnYXRlKHtcbiAgICAgICAgICAgICAgICB3aGVyZTogeyBcbiAgICAgICAgICAgICAgICAgICAgaW52b2ljZUlkOiBleGlzdGluZ1BheW1lbnQuaW52b2ljZUlkLFxuICAgICAgICAgICAgICAgICAgICByZWNlaXB0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpc05vdDogbnVsbFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBfc3VtOiB7IGFtb3VudDogdHJ1ZSB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgaW52b2ljZSA9IGF3YWl0IHR4Lmludm9pY2UuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGV4aXN0aW5nUGF5bWVudC5pbnZvaWNlSWQgfSxcbiAgICAgICAgICAgICAgICBzZWxlY3Q6IHsgdG90YWw6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNvbnN0IHRvdGFsUGFpZCA9IHRvdGFsUGF5bWVudHMuX3N1bS5hbW91bnQgfHwgMDtcbiAgICAgICAgICAgIGNvbnN0IGludm9pY2VUb3RhbCA9IGludm9pY2U/LnRvdGFsIHx8IDA7XG5cbiAgICAgICAgICAgIC8vIERldGVybWluZSB0aGUgY29ycmVjdCBzdGF0dXMgYmFzZWQgb24gcGF5bWVudCBhbW91bnRcbiAgICAgICAgICAgIGxldCBuZXdTdGF0dXMgPSAncGVuZGluZyc7XG4gICAgICAgICAgICBpZiAodG90YWxQYWlkID49IGludm9pY2VUb3RhbCkge1xuICAgICAgICAgICAgICAgIG5ld1N0YXR1cyA9ICdwYWlkJztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodG90YWxQYWlkID4gMCkge1xuICAgICAgICAgICAgICAgIG5ld1N0YXR1cyA9ICdwYXJ0aWFsJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVXBkYXRlIGludm9pY2Ugc3RhdHVzIGJhc2VkIG9uIGFjdHVhbCBwYXltZW50IGFtb3VudFxuICAgICAgICAgICAgYXdhaXQgdHguaW52b2ljZS51cGRhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBleGlzdGluZ1BheW1lbnQuaW52b2ljZUlkIH0sXG4gICAgICAgICAgICAgICAgZGF0YTogeyBzdGF0dXM6IG5ld1N0YXR1cyB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXNlIHRoZSBzZWxlY3RlZCBhY2NvdW50IGZyb20gdGhlIHBheW1lbnQsIG9yIGZhbGxiYWNrIHRvIHBheW1lbnQgbWV0aG9kIGxvZ2ljXG4gICAgICAgICAgICBsZXQgYWNjb3VudDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGV4aXN0aW5nUGF5bWVudC5hY2NvdW50SWQpIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgdGhlIGFjY291bnQgc2VsZWN0ZWQgZHVyaW5nIHBheW1lbnQgY3JlYXRpb25cbiAgICAgICAgICAgICAgICBhY2NvdW50ID0gYXdhaXQgdHguYWNjb3VudC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGV4aXN0aW5nUGF5bWVudC5hY2NvdW50SWQgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICghYWNjb3VudCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NlbGVjdGVkIHBheW1lbnQgYWNjb3VudCBub3QgZm91bmQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIG9sZCBsb2dpYyBmb3IgcGF5bWVudHMgd2l0aG91dCBzZWxlY3RlZCBhY2NvdW50c1xuICAgICAgICAgICAgICAgIGNvbnN0IHBheW1lbnRNZXRob2QgPSBleGlzdGluZ1BheW1lbnQucGF5bWVudE1ldGhvZC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIGxldCBhY2NvdW50TmFtZSA9ICcnO1xuICAgICAgICAgICAgICAgIGxldCBhY2NvdW50VHlwZSA9ICdhc3NldCc7XG5cbiAgICAgICAgICAgICAgICBpZiAocGF5bWVudE1ldGhvZC5pbmNsdWRlcygnY2FzaCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFjY291bnROYW1lID0gJ0Nhc2ggaW4gSGFuZCc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIGFsbCBub24tY2FzaCBwYXltZW50cywgZGVmYXVsdCB0byBDYXNoIGluIEJhbmtcbiAgICAgICAgICAgICAgICAgICAgYWNjb3VudE5hbWUgPSAnQ2FzaCBpbiBCYW5rJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBGaW5kIG9yIGNyZWF0ZSB0aGUgYXBwcm9wcmlhdGUgYWNjb3VudFxuICAgICAgICAgICAgICAgIGFjY291bnQgPSBhd2FpdCB0eC5hY2NvdW50LmZpbmRGaXJzdCh7XG4gICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBhY2NvdW50TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGFjY291bnRUeXBlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmICghYWNjb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGFjY291bnQgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgICAgICAgICAgICAgICBhY2NvdW50ID0gYXdhaXQgdHguYWNjb3VudC5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGFjY291bnROYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGFjY291bnRUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGFuY2U6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGBBdXRvLWNyZWF0ZWQgYWNjb3VudCBmb3IgJHtwYXltZW50TWV0aG9kfSBwYXltZW50c2AsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNBY3RpdmU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDcmVhdGUgYWNjb3VudGluZyB0cmFuc2FjdGlvbiBmb3IgdGhlIGluY29tZVxuICAgICAgICAgICAgYXdhaXQgdHgudHJhbnNhY3Rpb24uY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGU6IHJlY2VpcHREYXRhLnJlY2VpcHREYXRlID8gbmV3IERhdGUocmVjZWlwdERhdGEucmVjZWlwdERhdGUpIDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IGBQYXltZW50IHJlY2VpdmVkIGZyb20gJHtyZWNlaXB0LnBheW1lbnQuY3VzdG9tZXIubmFtZX0gLSBJbnZvaWNlICR7cmVjZWlwdC5wYXltZW50Lmludm9pY2UuaW52b2ljZU51bWJlcn1gLFxuICAgICAgICAgICAgICAgICAgICBhY2NvdW50SWQ6IGFjY291bnQuaWQsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpbmNvbWUnLFxuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGV4aXN0aW5nUGF5bWVudC5hbW91bnQsXG4gICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogcmVjZWlwdE51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdTYWxlcyBSZXZlbnVlJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgYWNjb3VudCBiYWxhbmNlXG4gICAgICAgICAgICBhd2FpdCB0eC5hY2NvdW50LnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGFjY291bnQuaWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGJhbGFuY2U6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluY3JlbWVudDogZXhpc3RpbmdQYXltZW50LmFtb3VudFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiByZWNlaXB0O1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzdWx0LCB7IHN0YXR1czogMjAxIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHJlY2VpcHQ6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSByZWNlaXB0JyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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