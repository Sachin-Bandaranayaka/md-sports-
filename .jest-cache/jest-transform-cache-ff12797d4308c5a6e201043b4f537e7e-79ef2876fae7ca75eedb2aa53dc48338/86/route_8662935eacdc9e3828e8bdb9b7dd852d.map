{"version":3,"sources":["/Users/sachin/Documents/md-sports-/src/app/api/audit-trail/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verifyToken } from '@/lib/auth';\nimport { auditService } from '@/services/auditService';\nimport { revalidateTag } from 'next/cache';\n\n// GET /api/audit-trail - Get audit trail entries\nexport async function GET(request: NextRequest) {\n  try {\n    const authHeader = request.headers.get('Authorization');\n    \n    const token = authHeader?.replace('Bearer ', '');\n    if (!token) {\n      return NextResponse.json({ error: 'No token provided' }, { status: 401 });\n    }\n\n    const decoded = await verifyToken(token);\n    \n    if (!decoded || !decoded.sub) {\n      return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\n    }\n\n    const { searchParams } = new URL(request.url);\n    const entity = searchParams.get('entity') || undefined;\n    const entityId = searchParams.get('entityId');\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const offset = parseInt(searchParams.get('offset') || '0');\n    const type = searchParams.get('type') || 'all'; // 'all', 'deleted', 'history'\n    const dateFrom = searchParams.get('dateFrom');\n    const dateTo = searchParams.get('dateTo');\n\n    if (type === 'deleted') {\n      // Get recycle bin items\n      const result = await auditService.getRecycleBinItems(\n        entity,\n        limit,\n        offset,\n        dateFrom,\n        dateTo\n      );\n      return NextResponse.json(result);\n    } else if (type === 'history' && entity && entityId) {\n        // Get entity history\n        const history = await auditService.getEntityHistory(\n          entity,\n          parseInt(entityId),\n          limit,\n          dateFrom,\n          dateTo\n        );\n        return NextResponse.json({ items: history, total: history.length });\n    } else {\n        // Get all audit entries\n        const result = await auditService.getAuditEntries(\n          entity,\n          limit,\n          offset,\n          dateFrom,\n          dateTo\n        );\n      return NextResponse.json(result);\n    }\n  } catch (error) {\n    console.error('Error fetching audit trail:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch audit trail' },\n      { status: 500 }\n    );\n  }\n}"],"names":["GET","request","authHeader","headers","get","token","replace","NextResponse","json","error","status","decoded","verifyToken","sub","searchParams","URL","url","entity","undefined","entityId","limit","parseInt","offset","type","dateFrom","dateTo","result","auditService","getRecycleBinItems","history","getEntityHistory","items","total","length","getAuditEntries","console"],"mappings":";;;;+BAMsBA;;;eAAAA;;;wBANoB;sBACd;8BACC;AAItB,eAAeA,IAAIC,OAAoB;IAC5C,IAAI;QACF,MAAMC,aAAaD,QAAQE,OAAO,CAACC,GAAG,CAAC;QAEvC,MAAMC,QAAQH,YAAYI,QAAQ,WAAW;QAC7C,IAAI,CAACD,OAAO;YACV,OAAOE,oBAAY,CAACC,IAAI,CAAC;gBAAEC,OAAO;YAAoB,GAAG;gBAAEC,QAAQ;YAAI;QACzE;QAEA,MAAMC,UAAU,MAAMC,IAAAA,iBAAW,EAACP;QAElC,IAAI,CAACM,WAAW,CAACA,QAAQE,GAAG,EAAE;YAC5B,OAAON,oBAAY,CAACC,IAAI,CAAC;gBAAEC,OAAO;YAAgB,GAAG;gBAAEC,QAAQ;YAAI;QACrE;QAEA,MAAM,EAAEI,YAAY,EAAE,GAAG,IAAIC,IAAId,QAAQe,GAAG;QAC5C,MAAMC,SAASH,aAAaV,GAAG,CAAC,aAAac;QAC7C,MAAMC,WAAWL,aAAaV,GAAG,CAAC;QAClC,MAAMgB,QAAQC,SAASP,aAAaV,GAAG,CAAC,YAAY;QACpD,MAAMkB,SAASD,SAASP,aAAaV,GAAG,CAAC,aAAa;QACtD,MAAMmB,OAAOT,aAAaV,GAAG,CAAC,WAAW,OAAO,8BAA8B;QAC9E,MAAMoB,WAAWV,aAAaV,GAAG,CAAC;QAClC,MAAMqB,SAASX,aAAaV,GAAG,CAAC;QAEhC,IAAImB,SAAS,WAAW;YACtB,wBAAwB;YACxB,MAAMG,SAAS,MAAMC,0BAAY,CAACC,kBAAkB,CAClDX,QACAG,OACAE,QACAE,UACAC;YAEF,OAAOlB,oBAAY,CAACC,IAAI,CAACkB;QAC3B,OAAO,IAAIH,SAAS,aAAaN,UAAUE,UAAU;YACjD,qBAAqB;YACrB,MAAMU,UAAU,MAAMF,0BAAY,CAACG,gBAAgB,CACjDb,QACAI,SAASF,WACTC,OACAI,UACAC;YAEF,OAAOlB,oBAAY,CAACC,IAAI,CAAC;gBAAEuB,OAAOF;gBAASG,OAAOH,QAAQI,MAAM;YAAC;QACrE,OAAO;YACH,wBAAwB;YACxB,MAAMP,SAAS,MAAMC,0BAAY,CAACO,eAAe,CAC/CjB,QACAG,OACAE,QACAE,UACAC;YAEJ,OAAOlB,oBAAY,CAACC,IAAI,CAACkB;QAC3B;IACF,EAAE,OAAOjB,OAAO;QACd0B,QAAQ1B,KAAK,CAAC,+BAA+BA;QAC7C,OAAOF,oBAAY,CAACC,IAAI,CACtB;YAAEC,OAAO;QAA8B,GACvC;YAAEC,QAAQ;QAAI;IAElB;AACF"}