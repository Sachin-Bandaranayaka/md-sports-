fb97d217c6d07ac246e80a8b5a15de5b
"use strict";

/* istanbul ignore next */
function cov_puwdst8ni() {
  var path = "/Users/sachin/Documents/md-sports-/src/app/api/receipts/route.ts";
  var hash = "afa09734569e10e4d52fc597ee3a4f6f8de74711";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/sachin/Documents/md-sports-/src/app/api/receipts/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "2": {
        start: {
          line: 6,
          column: 24
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "3": {
        start: {
          line: 11,
          column: 0
        },
        end: {
          line: 18,
          column: 3
        }
      },
      "4": {
        start: {
          line: 13,
          column: 8
        },
        end: {
          line: 13,
          column: 19
        }
      },
      "5": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 20
        }
      },
      "6": {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 38
        }
      },
      "7": {
        start: {
          line: 20,
          column: 16
        },
        end: {
          line: 20,
          column: 46
        }
      },
      "8": {
        start: {
          line: 21,
          column: 16
        },
        end: {
          line: 21,
          column: 41
        }
      },
      "9": {
        start: {
          line: 23,
          column: 4
        },
        end: {
          line: 97,
          column: 5
        }
      },
      "10": {
        start: {
          line: 24,
          column: 33
        },
        end: {
          line: 24,
          column: 53
        }
      },
      "11": {
        start: {
          line: 25,
          column: 21
        },
        end: {
          line: 25,
          column: 58
        }
      },
      "12": {
        start: {
          line: 26,
          column: 22
        },
        end: {
          line: 26,
          column: 61
        }
      },
      "13": {
        start: {
          line: 27,
          column: 23
        },
        end: {
          line: 27,
          column: 55
        }
      },
      "14": {
        start: {
          line: 28,
          column: 21
        },
        end: {
          line: 28,
          column: 39
        }
      },
      "15": {
        start: {
          line: 30,
          column: 22
        },
        end: {
          line: 57,
          column: 14
        }
      },
      "16": {
        start: {
          line: 59,
          column: 25
        },
        end: {
          line: 75,
          column: 10
        }
      },
      "17": {
        start: {
          line: 77,
          column: 30
        },
        end: {
          line: 79,
          column: 10
        }
      },
      "18": {
        start: {
          line: 80,
          column: 27
        },
        end: {
          line: 80,
          column: 59
        }
      },
      "19": {
        start: {
          line: 81,
          column: 8
        },
        end: {
          line: 89,
          column: 11
        }
      },
      "20": {
        start: {
          line: 91,
          column: 8
        },
        end: {
          line: 91,
          column: 57
        }
      },
      "21": {
        start: {
          line: 92,
          column: 8
        },
        end: {
          line: 96,
          column: 11
        }
      },
      "22": {
        start: {
          line: 100,
          column: 4
        },
        end: {
          line: 277,
          column: 5
        }
      },
      "23": {
        start: {
          line: 101,
          column: 28
        },
        end: {
          line: 101,
          column: 48
        }
      },
      "24": {
        start: {
          line: 103,
          column: 8
        },
        end: {
          line: 109,
          column: 9
        }
      },
      "25": {
        start: {
          line: 104,
          column: 12
        },
        end: {
          line: 108,
          column: 15
        }
      },
      "26": {
        start: {
          line: 111,
          column: 32
        },
        end: {
          line: 118,
          column: 10
        }
      },
      "27": {
        start: {
          line: 119,
          column: 8
        },
        end: {
          line: 125,
          column: 9
        }
      },
      "28": {
        start: {
          line: 120,
          column: 12
        },
        end: {
          line: 124,
          column: 15
        }
      },
      "29": {
        start: {
          line: 126,
          column: 8
        },
        end: {
          line: 132,
          column: 9
        }
      },
      "30": {
        start: {
          line: 127,
          column: 12
        },
        end: {
          line: 131,
          column: 15
        }
      },
      "31": {
        start: {
          line: 134,
          column: 30
        },
        end: {
          line: 134,
          column: 85
        }
      },
      "32": {
        start: {
          line: 136,
          column: 23
        },
        end: {
          line: 266,
          column: 10
        }
      },
      "33": {
        start: {
          line: 138,
          column: 28
        },
        end: {
          line: 159,
          column: 14
        }
      },
      "34": {
        start: {
          line: 162,
          column: 34
        },
        end: {
          line: 172,
          column: 14
        }
      },
      "35": {
        start: {
          line: 173,
          column: 28
        },
        end: {
          line: 180,
          column: 14
        }
      },
      "36": {
        start: {
          line: 181,
          column: 30
        },
        end: {
          line: 181,
          column: 60
        }
      },
      "37": {
        start: {
          line: 182,
          column: 33
        },
        end: {
          line: 182,
          column: 52
        }
      },
      "38": {
        start: {
          line: 184,
          column: 28
        },
        end: {
          line: 184,
          column: 37
        }
      },
      "39": {
        start: {
          line: 185,
          column: 12
        },
        end: {
          line: 189,
          column: 13
        }
      },
      "40": {
        start: {
          line: 186,
          column: 16
        },
        end: {
          line: 186,
          column: 35
        }
      },
      "41": {
        start: {
          line: 187,
          column: 19
        },
        end: {
          line: 189,
          column: 13
        }
      },
      "42": {
        start: {
          line: 188,
          column: 16
        },
        end: {
          line: 188,
          column: 38
        }
      },
      "43": {
        start: {
          line: 191,
          column: 12
        },
        end: {
          line: 198,
          column: 15
        }
      },
      "44": {
        start: {
          line: 201,
          column: 12
        },
        end: {
          line: 241,
          column: 13
        }
      },
      "45": {
        start: {
          line: 203,
          column: 16
        },
        end: {
          line: 207,
          column: 19
        }
      },
      "46": {
        start: {
          line: 208,
          column: 16
        },
        end: {
          line: 210,
          column: 17
        }
      },
      "47": {
        start: {
          line: 209,
          column: 20
        },
        end: {
          line: 209,
          column: 74
        }
      },
      "48": {
        start: {
          line: 213,
          column: 38
        },
        end: {
          line: 213,
          column: 81
        }
      },
      "49": {
        start: {
          line: 214,
          column: 34
        },
        end: {
          line: 214,
          column: 36
        }
      },
      "50": {
        start: {
          line: 215,
          column: 34
        },
        end: {
          line: 215,
          column: 41
        }
      },
      "51": {
        start: {
          line: 216,
          column: 16
        },
        end: {
          line: 221,
          column: 17
        }
      },
      "52": {
        start: {
          line: 217,
          column: 20
        },
        end: {
          line: 217,
          column: 49
        }
      },
      "53": {
        start: {
          line: 220,
          column: 20
        },
        end: {
          line: 220,
          column: 49
        }
      },
      "54": {
        start: {
          line: 223,
          column: 16
        },
        end: {
          line: 228,
          column: 19
        }
      },
      "55": {
        start: {
          line: 229,
          column: 16
        },
        end: {
          line: 240,
          column: 17
        }
      },
      "56": {
        start: {
          line: 231,
          column: 20
        },
        end: {
          line: 239,
          column: 23
        }
      },
      "57": {
        start: {
          line: 243,
          column: 12
        },
        end: {
          line: 253,
          column: 15
        }
      },
      "58": {
        start: {
          line: 255,
          column: 12
        },
        end: {
          line: 264,
          column: 15
        }
      },
      "59": {
        start: {
          line: 265,
          column: 12
        },
        end: {
          line: 265,
          column: 27
        }
      },
      "60": {
        start: {
          line: 267,
          column: 8
        },
        end: {
          line: 269,
          column: 11
        }
      },
      "61": {
        start: {
          line: 271,
          column: 8
        },
        end: {
          line: 271,
          column: 56
        }
      },
      "62": {
        start: {
          line: 272,
          column: 8
        },
        end: {
          line: 276,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 16
          }
        },
        loc: {
          start: {
            line: 5,
            column: 30
          },
          end: {
            line: 10,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 9
          },
          end: {
            line: 12,
            column: 10
          }
        },
        loc: {
          start: {
            line: 12,
            column: 20
          },
          end: {
            line: 14,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 10
          },
          end: {
            line: 15,
            column: 11
          }
        },
        loc: {
          start: {
            line: 15,
            column: 21
          },
          end: {
            line: 17,
            column: 5
          }
        },
        line: 15
      },
      "3": {
        name: "GET",
        decl: {
          start: {
            line: 22,
            column: 15
          },
          end: {
            line: 22,
            column: 18
          }
        },
        loc: {
          start: {
            line: 22,
            column: 28
          },
          end: {
            line: 98,
            column: 1
          }
        },
        line: 22
      },
      "4": {
        name: "POST",
        decl: {
          start: {
            line: 99,
            column: 15
          },
          end: {
            line: 99,
            column: 19
          }
        },
        loc: {
          start: {
            line: 99,
            column: 29
          },
          end: {
            line: 278,
            column: 1
          }
        },
        line: 99
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 136,
            column: 57
          },
          end: {
            line: 136,
            column: 58
          }
        },
        loc: {
          start: {
            line: 136,
            column: 69
          },
          end: {
            line: 266,
            column: 9
          }
        },
        line: 136
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 25,
            column: 21
          },
          end: {
            line: 25,
            column: 58
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 25,
            column: 21
          },
          end: {
            line: 25,
            column: 53
          }
        }, {
          start: {
            line: 25,
            column: 57
          },
          end: {
            line: 25,
            column: 58
          }
        }],
        line: 25
      },
      "1": {
        loc: {
          start: {
            line: 26,
            column: 22
          },
          end: {
            line: 26,
            column: 61
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 26,
            column: 22
          },
          end: {
            line: 26,
            column: 55
          }
        }, {
          start: {
            line: 26,
            column: 59
          },
          end: {
            line: 26,
            column: 61
          }
        }],
        line: 26
      },
      "2": {
        loc: {
          start: {
            line: 27,
            column: 23
          },
          end: {
            line: 27,
            column: 55
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 27,
            column: 23
          },
          end: {
            line: 27,
            column: 49
          }
        }, {
          start: {
            line: 27,
            column: 53
          },
          end: {
            line: 27,
            column: 55
          }
        }],
        line: 27
      },
      "3": {
        loc: {
          start: {
            line: 30,
            column: 22
          },
          end: {
            line: 57,
            column: 14
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 30,
            column: 31
          },
          end: {
            line: 57,
            column: 9
          }
        }, {
          start: {
            line: 57,
            column: 12
          },
          end: {
            line: 57,
            column: 14
          }
        }],
        line: 30
      },
      "4": {
        loc: {
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 109,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 103,
            column: 8
          },
          end: {
            line: 109,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 103
      },
      "5": {
        loc: {
          start: {
            line: 119,
            column: 8
          },
          end: {
            line: 125,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 119,
            column: 8
          },
          end: {
            line: 125,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 119
      },
      "6": {
        loc: {
          start: {
            line: 126,
            column: 8
          },
          end: {
            line: 132,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 126,
            column: 8
          },
          end: {
            line: 132,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 126
      },
      "7": {
        loc: {
          start: {
            line: 142,
            column: 33
          },
          end: {
            line: 142,
            column: 105
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 142,
            column: 59
          },
          end: {
            line: 142,
            column: 92
          }
        }, {
          start: {
            line: 142,
            column: 95
          },
          end: {
            line: 142,
            column: 105
          }
        }],
        line: 142
      },
      "8": {
        loc: {
          start: {
            line: 143,
            column: 30
          },
          end: {
            line: 143,
            column: 58
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 143,
            column: 30
          },
          end: {
            line: 143,
            column: 50
          }
        }, {
          start: {
            line: 143,
            column: 54
          },
          end: {
            line: 143,
            column: 58
          }
        }],
        line: 143
      },
      "9": {
        loc: {
          start: {
            line: 144,
            column: 35
          },
          end: {
            line: 144,
            column: 68
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 144,
            column: 35
          },
          end: {
            line: 144,
            column: 60
          }
        }, {
          start: {
            line: 144,
            column: 64
          },
          end: {
            line: 144,
            column: 68
          }
        }],
        line: 144
      },
      "10": {
        loc: {
          start: {
            line: 145,
            column: 34
          },
          end: {
            line: 145,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 145,
            column: 34
          },
          end: {
            line: 145,
            column: 58
          }
        }, {
          start: {
            line: 145,
            column: 62
          },
          end: {
            line: 145,
            column: 66
          }
        }],
        line: 145
      },
      "11": {
        loc: {
          start: {
            line: 146,
            column: 35
          },
          end: {
            line: 146,
            column: 68
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 146,
            column: 35
          },
          end: {
            line: 146,
            column: 60
          }
        }, {
          start: {
            line: 146,
            column: 64
          },
          end: {
            line: 146,
            column: 68
          }
        }],
        line: 146
      },
      "12": {
        loc: {
          start: {
            line: 147,
            column: 27
          },
          end: {
            line: 147,
            column: 52
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 147,
            column: 27
          },
          end: {
            line: 147,
            column: 44
          }
        }, {
          start: {
            line: 147,
            column: 48
          },
          end: {
            line: 147,
            column: 52
          }
        }],
        line: 147
      },
      "13": {
        loc: {
          start: {
            line: 148,
            column: 33
          },
          end: {
            line: 148,
            column: 64
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 148,
            column: 33
          },
          end: {
            line: 148,
            column: 56
          }
        }, {
          start: {
            line: 148,
            column: 60
          },
          end: {
            line: 148,
            column: 64
          }
        }],
        line: 148
      },
      "14": {
        loc: {
          start: {
            line: 181,
            column: 30
          },
          end: {
            line: 181,
            column: 60
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 181,
            column: 30
          },
          end: {
            line: 181,
            column: 55
          }
        }, {
          start: {
            line: 181,
            column: 59
          },
          end: {
            line: 181,
            column: 60
          }
        }],
        line: 181
      },
      "15": {
        loc: {
          start: {
            line: 182,
            column: 33
          },
          end: {
            line: 182,
            column: 52
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 182,
            column: 33
          },
          end: {
            line: 182,
            column: 47
          }
        }, {
          start: {
            line: 182,
            column: 51
          },
          end: {
            line: 182,
            column: 52
          }
        }],
        line: 182
      },
      "16": {
        loc: {
          start: {
            line: 185,
            column: 12
          },
          end: {
            line: 189,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 185,
            column: 12
          },
          end: {
            line: 189,
            column: 13
          }
        }, {
          start: {
            line: 187,
            column: 19
          },
          end: {
            line: 189,
            column: 13
          }
        }],
        line: 185
      },
      "17": {
        loc: {
          start: {
            line: 187,
            column: 19
          },
          end: {
            line: 189,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 187,
            column: 19
          },
          end: {
            line: 189,
            column: 13
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 187
      },
      "18": {
        loc: {
          start: {
            line: 201,
            column: 12
          },
          end: {
            line: 241,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 201,
            column: 12
          },
          end: {
            line: 241,
            column: 13
          }
        }, {
          start: {
            line: 211,
            column: 19
          },
          end: {
            line: 241,
            column: 13
          }
        }],
        line: 201
      },
      "19": {
        loc: {
          start: {
            line: 208,
            column: 16
          },
          end: {
            line: 210,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 208,
            column: 16
          },
          end: {
            line: 210,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 208
      },
      "20": {
        loc: {
          start: {
            line: 216,
            column: 16
          },
          end: {
            line: 221,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 216,
            column: 16
          },
          end: {
            line: 221,
            column: 17
          }
        }, {
          start: {
            line: 218,
            column: 23
          },
          end: {
            line: 221,
            column: 17
          }
        }],
        line: 216
      },
      "21": {
        loc: {
          start: {
            line: 229,
            column: 16
          },
          end: {
            line: 240,
            column: 17
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 229,
            column: 16
          },
          end: {
            line: 240,
            column: 17
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 229
      },
      "22": {
        loc: {
          start: {
            line: 245,
            column: 26
          },
          end: {
            line: 245,
            column: 98
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 245,
            column: 52
          },
          end: {
            line: 245,
            column: 85
          }
        }, {
          start: {
            line: 245,
            column: 88
          },
          end: {
            line: 245,
            column: 98
          }
        }],
        line: 245
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0,
      "57": 0,
      "58": 0,
      "59": 0,
      "60": 0,
      "61": 0,
      "62": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0],
      "16": [0, 0],
      "17": [0, 0],
      "18": [0, 0],
      "19": [0, 0],
      "20": [0, 0],
      "21": [0, 0],
      "22": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/sachin/Documents/md-sports-/src/app/api/receipts/route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma } from '@/lib/prisma';\nimport { getServerSession } from 'next-auth/next';\nimport { authOptions } from '@/lib/auth';\nimport { Prisma } from '@prisma/client';\n\n// Get all receipts with pagination and optional filtering\nexport async function GET(request: Request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const page = Number(searchParams.get('page')) || 1;\n        const limit = Number(searchParams.get('limit')) || 10;\n        const search = searchParams.get('search') || '';\n\n        const skip = (page - 1) * limit;\n\n        // Build the where condition for search\n        const where: Prisma.ReceiptWhereInput = search ? {\n            OR: [\n                { receiptNumber: { contains: search, mode: Prisma.QueryMode.insensitive } },\n                { payment: { referenceNumber: { contains: search, mode: Prisma.QueryMode.insensitive } } },\n                { payment: { customer: { name: { contains: search, mode: Prisma.QueryMode.insensitive } } } }\n            ]\n        } : {};\n\n        // Get receipts with pagination\n        const receipts = await prisma.receipt.findMany({\n            where,\n            include: {\n                payment: {\n                    include: {\n                        customer: true,\n                        invoice: true\n                    }\n                },\n                confirmedByUser: true\n            },\n            orderBy: { createdAt: 'desc' },\n            skip,\n            take: limit\n        });\n\n        // Get total count for pagination\n        const totalReceipts = await prisma.receipt.count({ where });\n        const totalPages = Math.ceil(totalReceipts / limit);\n\n        return NextResponse.json({\n            receipts,\n            pagination: {\n                totalReceipts,\n                totalPages,\n                currentPage: page,\n                perPage: limit\n            }\n        });\n    } catch (error) {\n        console.error('Error fetching receipts:', error);\n        return NextResponse.json(\n            { error: 'Failed to fetch receipts' },\n            { status: 500 }\n        );\n    }\n}\n\n// Create a new receipt\nexport async function POST(request: Request) {\n    try {\n        const receiptData = await request.json();\n\n        // Validate receipt data\n        if (!receiptData.paymentId) {\n            return NextResponse.json(\n                { error: 'Payment ID is required' },\n                { status: 400 }\n            );\n        }\n\n        // Check if payment exists and doesn't already have a receipt\n        const existingPayment = await prisma.payment.findUnique({\n            where: { id: receiptData.paymentId },\n            include: { receipt: true }\n        });\n\n        if (!existingPayment) {\n            return NextResponse.json(\n                { error: 'Payment not found' },\n                { status: 404 }\n            );\n        }\n\n        if (existingPayment.receipt) {\n            return NextResponse.json(\n                { error: 'A receipt already exists for this payment' },\n                { status: 409 }\n            );\n        }\n\n        // Generate a unique receipt number\n        const receiptNumber = `REC-${Date.now()}-${Math.floor(Math.random() * 1000)}`;\n\n        // Use a transaction to ensure data consistency\n        const result = await prisma.$transaction(async (tx) => {\n            // Create receipt\n            const receipt = await tx.receipt.create({\n                data: {\n                    paymentId: receiptData.paymentId,\n                    receiptNumber,\n                    receiptDate: receiptData.receiptDate ? new Date(receiptData.receiptDate) : new Date(),\n                    bankName: receiptData.bankName || null,\n                    accountNumber: receiptData.accountNumber || null,\n                    chequeNumber: receiptData.chequeNumber || null,\n                    transactionId: receiptData.transactionId || null,\n                    notes: receiptData.notes || null,\n                    confirmedBy: receiptData.confirmedBy || null\n                },\n                include: {\n                    payment: {\n                        include: {\n                            customer: true,\n                            invoice: true\n                        }\n                    },\n                    confirmedByUser: true\n                }\n            });\n\n            // Calculate total payments with receipts for the invoice to determine correct status\n            // Only count payments that have receipts (confirmed payments)\n            const totalPayments = await tx.payment.aggregate({\n                where: { \n                    invoiceId: existingPayment.invoiceId,\n                    receipt: {\n                        isNot: null\n                    }\n                },\n                _sum: { amount: true }\n            });\n\n            const invoice = await tx.invoice.findUnique({\n                where: { id: existingPayment.invoiceId },\n                select: { total: true }\n            });\n\n            const totalPaid = totalPayments._sum.amount || 0;\n            const invoiceTotal = invoice?.total || 0;\n\n            // Determine the correct status based on payment amount\n            let newStatus = 'pending';\n            if (totalPaid >= invoiceTotal) {\n                newStatus = 'paid';\n            } else if (totalPaid > 0) {\n                newStatus = 'partial';\n            }\n\n            // Update invoice status based on actual payment amount\n            await tx.invoice.update({\n                where: { id: existingPayment.invoiceId },\n                data: { status: newStatus }\n            });\n\n            // Use the selected account from the payment, or fallback to payment method logic\n            let account;\n            \n            if (existingPayment.accountId) {\n                // Use the account selected during payment creation\n                account = await tx.account.findUnique({\n                    where: { id: existingPayment.accountId }\n                });\n                \n                if (!account) {\n                    throw new Error('Selected payment account not found');\n                }\n            } else {\n                // Fallback to old logic for payments without selected accounts\n                const paymentMethod = existingPayment.paymentMethod.toLowerCase();\n                let accountName = '';\n                let accountType = 'asset';\n\n                if (paymentMethod.includes('cash')) {\n                    accountName = 'Cash in Hand';\n                } else {\n                    // For all non-cash payments, default to Cash in Bank\n                    accountName = 'Cash in Bank';\n                }\n\n                // Find or create the appropriate account\n                account = await tx.account.findFirst({\n                    where: {\n                        name: accountName,\n                        type: accountType\n                    }\n                });\n\n                if (!account) {\n                    // Create the account if it doesn't exist\n                    account = await tx.account.create({\n                        data: {\n                            name: accountName,\n                            type: accountType,\n                            balance: 0,\n                            description: `Auto-created account for ${paymentMethod} payments`,\n                            isActive: true\n                        }\n                    });\n                }\n            }\n\n            // Create accounting transaction for the income\n            await tx.transaction.create({\n                data: {\n                    date: receiptData.receiptDate ? new Date(receiptData.receiptDate) : new Date(),\n                    description: `Payment received from ${receipt.payment.customer.name} - Invoice ${receipt.payment.invoice.invoiceNumber}`,\n                    accountId: account.id,\n                    type: 'income',\n                    amount: existingPayment.amount,\n                    reference: receiptNumber,\n                    category: 'Sales Revenue'\n                }\n            });\n\n            // Update account balance\n            await tx.account.update({\n                where: { id: account.id },\n                data: {\n                    balance: {\n                        increment: existingPayment.amount\n                    }\n                }\n            });\n\n            return receipt;\n        });\n\n        return NextResponse.json(result, { status: 201 });\n    } catch (error) {\n        console.error('Error creating receipt:', error);\n        return NextResponse.json(\n            { error: 'Failed to create receipt' },\n            { status: 500 }\n        );\n    }\n}"],
      names: ["GET", "POST", "request", "searchParams", "URL", "url", "page", "Number", "get", "limit", "search", "skip", "where", "OR", "receiptNumber", "contains", "mode", "Prisma", "QueryMode", "insensitive", "payment", "referenceNumber", "customer", "name", "receipts", "prisma", "receipt", "findMany", "include", "invoice", "confirmedByUser", "orderBy", "createdAt", "take", "totalReceipts", "count", "totalPages", "Math", "ceil", "NextResponse", "json", "pagination", "currentPage", "perPage", "error", "console", "status", "receiptData", "paymentId", "existingPayment", "findUnique", "id", "Date", "now", "floor", "random", "result", "$transaction", "tx", "create", "data", "receiptDate", "bankName", "accountNumber", "chequeNumber", "transactionId", "notes", "confirmedBy", "totalPayments", "aggregate", "invoiceId", "isNot", "_sum", "amount", "select", "total", "totalPaid", "invoiceTotal", "newStatus", "update", "account", "accountId", "Error", "paymentMethod", "toLowerCase", "accountName", "accountType", "includes", "findFirst", "type", "balance", "description", "isActive", "transaction", "date", "invoiceNumber", "reference", "category", "increment"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "afa09734569e10e4d52fc597ee3a4f6f8de74711"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_puwdst8ni = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_puwdst8ni();
cov_puwdst8ni().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_puwdst8ni().f[0]++;
  cov_puwdst8ni().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_puwdst8ni().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: all[name]
    });
  }
}
/* istanbul ignore next */
cov_puwdst8ni().s[3]++;
_export(exports, {
  GET: function () {
    /* istanbul ignore next */
    cov_puwdst8ni().f[1]++;
    cov_puwdst8ni().s[4]++;
    return GET;
  },
  POST: function () {
    /* istanbul ignore next */
    cov_puwdst8ni().f[2]++;
    cov_puwdst8ni().s[5]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_puwdst8ni().s[6]++, require("next/server"));
const _prisma =
/* istanbul ignore next */
(cov_puwdst8ni().s[7]++, require("../../../lib/prisma"));
const _client =
/* istanbul ignore next */
(cov_puwdst8ni().s[8]++, require("@prisma/client"));
async function GET(request) {
  /* istanbul ignore next */
  cov_puwdst8ni().f[3]++;
  cov_puwdst8ni().s[9]++;
  try {
    const {
      searchParams
    } =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[10]++, new URL(request.url));
    const page =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[11]++,
    /* istanbul ignore next */
    (cov_puwdst8ni().b[0][0]++, Number(searchParams.get("page"))) ||
    /* istanbul ignore next */
    (cov_puwdst8ni().b[0][1]++, 1));
    const limit =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[12]++,
    /* istanbul ignore next */
    (cov_puwdst8ni().b[1][0]++, Number(searchParams.get("limit"))) ||
    /* istanbul ignore next */
    (cov_puwdst8ni().b[1][1]++, 10));
    const search =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[13]++,
    /* istanbul ignore next */
    (cov_puwdst8ni().b[2][0]++, searchParams.get("search")) ||
    /* istanbul ignore next */
    (cov_puwdst8ni().b[2][1]++, ""));
    const skip =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[14]++, (page - 1) * limit);
    // Build the where condition for search
    const where =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[15]++, search ?
    /* istanbul ignore next */
    (cov_puwdst8ni().b[3][0]++, {
      OR: [{
        receiptNumber: {
          contains: search,
          mode: _client.Prisma.QueryMode.insensitive
        }
      }, {
        payment: {
          referenceNumber: {
            contains: search,
            mode: _client.Prisma.QueryMode.insensitive
          }
        }
      }, {
        payment: {
          customer: {
            name: {
              contains: search,
              mode: _client.Prisma.QueryMode.insensitive
            }
          }
        }
      }]
    }) :
    /* istanbul ignore next */
    (cov_puwdst8ni().b[3][1]++, {}));
    // Get receipts with pagination
    const receipts =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[16]++, await _prisma.prisma.receipt.findMany({
      where,
      include: {
        payment: {
          include: {
            customer: true,
            invoice: true
          }
        },
        confirmedByUser: true
      },
      orderBy: {
        createdAt: "desc"
      },
      skip,
      take: limit
    }));
    // Get total count for pagination
    const totalReceipts =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[17]++, await _prisma.prisma.receipt.count({
      where
    }));
    const totalPages =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[18]++, Math.ceil(totalReceipts / limit));
    /* istanbul ignore next */
    cov_puwdst8ni().s[19]++;
    return _server.NextResponse.json({
      receipts,
      pagination: {
        totalReceipts,
        totalPages,
        currentPage: page,
        perPage: limit
      }
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_puwdst8ni().s[20]++;
    console.error("Error fetching receipts:", error);
    /* istanbul ignore next */
    cov_puwdst8ni().s[21]++;
    return _server.NextResponse.json({
      error: "Failed to fetch receipts"
    }, {
      status: 500
    });
  }
}
async function POST(request) {
  /* istanbul ignore next */
  cov_puwdst8ni().f[4]++;
  cov_puwdst8ni().s[22]++;
  try {
    const receiptData =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[23]++, await request.json());
    // Validate receipt data
    /* istanbul ignore next */
    cov_puwdst8ni().s[24]++;
    if (!receiptData.paymentId) {
      /* istanbul ignore next */
      cov_puwdst8ni().b[4][0]++;
      cov_puwdst8ni().s[25]++;
      return _server.NextResponse.json({
        error: "Payment ID is required"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_puwdst8ni().b[4][1]++;
    }
    // Check if payment exists and doesn't already have a receipt
    const existingPayment =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[26]++, await _prisma.prisma.payment.findUnique({
      where: {
        id: receiptData.paymentId
      },
      include: {
        receipt: true
      }
    }));
    /* istanbul ignore next */
    cov_puwdst8ni().s[27]++;
    if (!existingPayment) {
      /* istanbul ignore next */
      cov_puwdst8ni().b[5][0]++;
      cov_puwdst8ni().s[28]++;
      return _server.NextResponse.json({
        error: "Payment not found"
      }, {
        status: 404
      });
    } else
    /* istanbul ignore next */
    {
      cov_puwdst8ni().b[5][1]++;
    }
    cov_puwdst8ni().s[29]++;
    if (existingPayment.receipt) {
      /* istanbul ignore next */
      cov_puwdst8ni().b[6][0]++;
      cov_puwdst8ni().s[30]++;
      return _server.NextResponse.json({
        error: "A receipt already exists for this payment"
      }, {
        status: 409
      });
    } else
    /* istanbul ignore next */
    {
      cov_puwdst8ni().b[6][1]++;
    }
    // Generate a unique receipt number
    const receiptNumber =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[31]++, `REC-${Date.now()}-${Math.floor(Math.random() * 1000)}`);
    // Use a transaction to ensure data consistency
    const result =
    /* istanbul ignore next */
    (cov_puwdst8ni().s[32]++, await _prisma.prisma.$transaction(async tx => {
      /* istanbul ignore next */
      cov_puwdst8ni().f[5]++;
      // Create receipt
      const receipt =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[33]++, await tx.receipt.create({
        data: {
          paymentId: receiptData.paymentId,
          receiptNumber,
          receiptDate: receiptData.receiptDate ?
          /* istanbul ignore next */
          (cov_puwdst8ni().b[7][0]++, new Date(receiptData.receiptDate)) :
          /* istanbul ignore next */
          (cov_puwdst8ni().b[7][1]++, new Date()),
          bankName:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[8][0]++, receiptData.bankName) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[8][1]++, null),
          accountNumber:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[9][0]++, receiptData.accountNumber) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[9][1]++, null),
          chequeNumber:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[10][0]++, receiptData.chequeNumber) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[10][1]++, null),
          transactionId:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[11][0]++, receiptData.transactionId) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[11][1]++, null),
          notes:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[12][0]++, receiptData.notes) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[12][1]++, null),
          confirmedBy:
          /* istanbul ignore next */
          (cov_puwdst8ni().b[13][0]++, receiptData.confirmedBy) ||
          /* istanbul ignore next */
          (cov_puwdst8ni().b[13][1]++, null)
        },
        include: {
          payment: {
            include: {
              customer: true,
              invoice: true
            }
          },
          confirmedByUser: true
        }
      }));
      // Calculate total payments with receipts for the invoice to determine correct status
      // Only count payments that have receipts (confirmed payments)
      const totalPayments =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[34]++, await tx.payment.aggregate({
        where: {
          invoiceId: existingPayment.invoiceId,
          receipt: {
            isNot: null
          }
        },
        _sum: {
          amount: true
        }
      }));
      const invoice =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[35]++, await tx.invoice.findUnique({
        where: {
          id: existingPayment.invoiceId
        },
        select: {
          total: true
        }
      }));
      const totalPaid =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[36]++,
      /* istanbul ignore next */
      (cov_puwdst8ni().b[14][0]++, totalPayments._sum.amount) ||
      /* istanbul ignore next */
      (cov_puwdst8ni().b[14][1]++, 0));
      const invoiceTotal =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[37]++,
      /* istanbul ignore next */
      (cov_puwdst8ni().b[15][0]++, invoice?.total) ||
      /* istanbul ignore next */
      (cov_puwdst8ni().b[15][1]++, 0));
      // Determine the correct status based on payment amount
      let newStatus =
      /* istanbul ignore next */
      (cov_puwdst8ni().s[38]++, "pending");
      /* istanbul ignore next */
      cov_puwdst8ni().s[39]++;
      if (totalPaid >= invoiceTotal) {
        /* istanbul ignore next */
        cov_puwdst8ni().b[16][0]++;
        cov_puwdst8ni().s[40]++;
        newStatus = "paid";
      } else {
        /* istanbul ignore next */
        cov_puwdst8ni().b[16][1]++;
        cov_puwdst8ni().s[41]++;
        if (totalPaid > 0) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[17][0]++;
          cov_puwdst8ni().s[42]++;
          newStatus = "partial";
        } else
        /* istanbul ignore next */
        {
          cov_puwdst8ni().b[17][1]++;
        }
      }
      // Update invoice status based on actual payment amount
      /* istanbul ignore next */
      cov_puwdst8ni().s[43]++;
      await tx.invoice.update({
        where: {
          id: existingPayment.invoiceId
        },
        data: {
          status: newStatus
        }
      });
      // Use the selected account from the payment, or fallback to payment method logic
      let account;
      /* istanbul ignore next */
      cov_puwdst8ni().s[44]++;
      if (existingPayment.accountId) {
        /* istanbul ignore next */
        cov_puwdst8ni().b[18][0]++;
        cov_puwdst8ni().s[45]++;
        // Use the account selected during payment creation
        account = await tx.account.findUnique({
          where: {
            id: existingPayment.accountId
          }
        });
        /* istanbul ignore next */
        cov_puwdst8ni().s[46]++;
        if (!account) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[19][0]++;
          cov_puwdst8ni().s[47]++;
          throw new Error("Selected payment account not found");
        } else
        /* istanbul ignore next */
        {
          cov_puwdst8ni().b[19][1]++;
        }
      } else {
        /* istanbul ignore next */
        cov_puwdst8ni().b[18][1]++;
        // Fallback to old logic for payments without selected accounts
        const paymentMethod =
        /* istanbul ignore next */
        (cov_puwdst8ni().s[48]++, existingPayment.paymentMethod.toLowerCase());
        let accountName =
        /* istanbul ignore next */
        (cov_puwdst8ni().s[49]++, "");
        let accountType =
        /* istanbul ignore next */
        (cov_puwdst8ni().s[50]++, "asset");
        /* istanbul ignore next */
        cov_puwdst8ni().s[51]++;
        if (paymentMethod.includes("cash")) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[20][0]++;
          cov_puwdst8ni().s[52]++;
          accountName = "Cash in Hand";
        } else {
          /* istanbul ignore next */
          cov_puwdst8ni().b[20][1]++;
          cov_puwdst8ni().s[53]++;
          // For all non-cash payments, default to Cash in Bank
          accountName = "Cash in Bank";
        }
        // Find or create the appropriate account
        /* istanbul ignore next */
        cov_puwdst8ni().s[54]++;
        account = await tx.account.findFirst({
          where: {
            name: accountName,
            type: accountType
          }
        });
        /* istanbul ignore next */
        cov_puwdst8ni().s[55]++;
        if (!account) {
          /* istanbul ignore next */
          cov_puwdst8ni().b[21][0]++;
          cov_puwdst8ni().s[56]++;
          // Create the account if it doesn't exist
          account = await tx.account.create({
            data: {
              name: accountName,
              type: accountType,
              balance: 0,
              description: `Auto-created account for ${paymentMethod} payments`,
              isActive: true
            }
          });
        } else
        /* istanbul ignore next */
        {
          cov_puwdst8ni().b[21][1]++;
        }
      }
      // Create accounting transaction for the income
      /* istanbul ignore next */
      cov_puwdst8ni().s[57]++;
      await tx.transaction.create({
        data: {
          date: receiptData.receiptDate ?
          /* istanbul ignore next */
          (cov_puwdst8ni().b[22][0]++, new Date(receiptData.receiptDate)) :
          /* istanbul ignore next */
          (cov_puwdst8ni().b[22][1]++, new Date()),
          description: `Payment received from ${receipt.payment.customer.name} - Invoice ${receipt.payment.invoice.invoiceNumber}`,
          accountId: account.id,
          type: "income",
          amount: existingPayment.amount,
          reference: receiptNumber,
          category: "Sales Revenue"
        }
      });
      // Update account balance
      /* istanbul ignore next */
      cov_puwdst8ni().s[58]++;
      await tx.account.update({
        where: {
          id: account.id
        },
        data: {
          balance: {
            increment: existingPayment.amount
          }
        }
      });
      /* istanbul ignore next */
      cov_puwdst8ni().s[59]++;
      return receipt;
    }));
    /* istanbul ignore next */
    cov_puwdst8ni().s[60]++;
    return _server.NextResponse.json(result, {
      status: 201
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_puwdst8ni().s[61]++;
    console.error("Error creating receipt:", error);
    /* istanbul ignore next */
    cov_puwdst8ni().s[62]++;
    return _server.NextResponse.json({
      error: "Failed to create receipt"
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJjb3ZfcHV3ZHN0OG5pIiwiZiIsInMiLCJQT1NUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInBhZ2UiLCJiIiwiTnVtYmVyIiwiZ2V0IiwibGltaXQiLCJzZWFyY2giLCJza2lwIiwid2hlcmUiLCJPUiIsInJlY2VpcHROdW1iZXIiLCJjb250YWlucyIsIm1vZGUiLCJfY2xpZW50IiwiUHJpc21hIiwiUXVlcnlNb2RlIiwiaW5zZW5zaXRpdmUiLCJwYXltZW50IiwicmVmZXJlbmNlTnVtYmVyIiwiY3VzdG9tZXIiLCJuYW1lIiwicmVjZWlwdHMiLCJfcHJpc21hIiwicHJpc21hIiwicmVjZWlwdCIsImZpbmRNYW55IiwiaW5jbHVkZSIsImludm9pY2UiLCJjb25maXJtZWRCeVVzZXIiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidGFrZSIsInRvdGFsUmVjZWlwdHMiLCJjb3VudCIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsIl9zZXJ2ZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwicGFnaW5hdGlvbiIsImN1cnJlbnRQYWdlIiwicGVyUGFnZSIsImVycm9yIiwiY29uc29sZSIsInN0YXR1cyIsInJlY2VpcHREYXRhIiwicGF5bWVudElkIiwiZXhpc3RpbmdQYXltZW50IiwiZmluZFVuaXF1ZSIsImlkIiwiRGF0ZSIsIm5vdyIsImZsb29yIiwicmFuZG9tIiwicmVzdWx0IiwiJHRyYW5zYWN0aW9uIiwidHgiLCJjcmVhdGUiLCJkYXRhIiwicmVjZWlwdERhdGUiLCJiYW5rTmFtZSIsImFjY291bnROdW1iZXIiLCJjaGVxdWVOdW1iZXIiLCJ0cmFuc2FjdGlvbklkIiwibm90ZXMiLCJjb25maXJtZWRCeSIsInRvdGFsUGF5bWVudHMiLCJhZ2dyZWdhdGUiLCJpbnZvaWNlSWQiLCJpc05vdCIsIl9zdW0iLCJhbW91bnQiLCJzZWxlY3QiLCJ0b3RhbCIsInRvdGFsUGFpZCIsImludm9pY2VUb3RhbCIsIm5ld1N0YXR1cyIsInVwZGF0ZSIsImFjY291bnQiLCJhY2NvdW50SWQiLCJFcnJvciIsInBheW1lbnRNZXRob2QiLCJ0b0xvd2VyQ2FzZSIsImFjY291bnROYW1lIiwiYWNjb3VudFR5cGUiLCJpbmNsdWRlcyIsImZpbmRGaXJzdCIsInR5cGUiLCJiYWxhbmNlIiwiZGVzY3JpcHRpb24iLCJpc0FjdGl2ZSIsInRyYW5zYWN0aW9uIiwiZGF0ZSIsImludm9pY2VOdW1iZXIiLCJyZWZlcmVuY2UiLCJjYXRlZ29yeSIsImluY3JlbWVudCJdLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL2FwcC9hcGkvcmVjZWlwdHMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSc7XG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL25leHQnO1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICdAL2xpYi9hdXRoJztcbmltcG9ydCB7IFByaXNtYSB9IGZyb20gJ0BwcmlzbWEvY2xpZW50JztcblxuLy8gR2V0IGFsbCByZWNlaXB0cyB3aXRoIHBhZ2luYXRpb24gYW5kIG9wdGlvbmFsIGZpbHRlcmluZ1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICAgICAgICBjb25zdCBwYWdlID0gTnVtYmVyKHNlYXJjaFBhcmFtcy5nZXQoJ3BhZ2UnKSkgfHwgMTtcbiAgICAgICAgY29uc3QgbGltaXQgPSBOdW1iZXIoc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSkgfHwgMTA7XG4gICAgICAgIGNvbnN0IHNlYXJjaCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3NlYXJjaCcpIHx8ICcnO1xuXG4gICAgICAgIGNvbnN0IHNraXAgPSAocGFnZSAtIDEpICogbGltaXQ7XG5cbiAgICAgICAgLy8gQnVpbGQgdGhlIHdoZXJlIGNvbmRpdGlvbiBmb3Igc2VhcmNoXG4gICAgICAgIGNvbnN0IHdoZXJlOiBQcmlzbWEuUmVjZWlwdFdoZXJlSW5wdXQgPSBzZWFyY2ggPyB7XG4gICAgICAgICAgICBPUjogW1xuICAgICAgICAgICAgICAgIHsgcmVjZWlwdE51bWJlcjogeyBjb250YWluczogc2VhcmNoLCBtb2RlOiBQcmlzbWEuUXVlcnlNb2RlLmluc2Vuc2l0aXZlIH0gfSxcbiAgICAgICAgICAgICAgICB7IHBheW1lbnQ6IHsgcmVmZXJlbmNlTnVtYmVyOiB7IGNvbnRhaW5zOiBzZWFyY2gsIG1vZGU6IFByaXNtYS5RdWVyeU1vZGUuaW5zZW5zaXRpdmUgfSB9IH0sXG4gICAgICAgICAgICAgICAgeyBwYXltZW50OiB7IGN1c3RvbWVyOiB7IG5hbWU6IHsgY29udGFpbnM6IHNlYXJjaCwgbW9kZTogUHJpc21hLlF1ZXJ5TW9kZS5pbnNlbnNpdGl2ZSB9IH0gfSB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0gOiB7fTtcblxuICAgICAgICAvLyBHZXQgcmVjZWlwdHMgd2l0aCBwYWdpbmF0aW9uXG4gICAgICAgIGNvbnN0IHJlY2VpcHRzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuZmluZE1hbnkoe1xuICAgICAgICAgICAgd2hlcmUsXG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgcGF5bWVudDoge1xuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21lcjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGludm9pY2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29uZmlybWVkQnlVc2VyOiB0cnVlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICAgICAgICAgICAgc2tpcCxcbiAgICAgICAgICAgIHRha2U6IGxpbWl0XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEdldCB0b3RhbCBjb3VudCBmb3IgcGFnaW5hdGlvblxuICAgICAgICBjb25zdCB0b3RhbFJlY2VpcHRzID0gYXdhaXQgcHJpc21hLnJlY2VpcHQuY291bnQoeyB3aGVyZSB9KTtcbiAgICAgICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbCh0b3RhbFJlY2VpcHRzIC8gbGltaXQpO1xuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICByZWNlaXB0cyxcbiAgICAgICAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgICAgICAgICB0b3RhbFJlY2VpcHRzLFxuICAgICAgICAgICAgICAgIHRvdGFsUGFnZXMsXG4gICAgICAgICAgICAgICAgY3VycmVudFBhZ2U6IHBhZ2UsXG4gICAgICAgICAgICAgICAgcGVyUGFnZTogbGltaXRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcmVjZWlwdHM6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHJlY2VpcHRzJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgfVxufVxuXG4vLyBDcmVhdGUgYSBuZXcgcmVjZWlwdFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlY2VpcHREYXRhID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgcmVjZWlwdCBkYXRhXG4gICAgICAgIGlmICghcmVjZWlwdERhdGEucGF5bWVudElkKSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgeyBlcnJvcjogJ1BheW1lbnQgSUQgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgcGF5bWVudCBleGlzdHMgYW5kIGRvZXNuJ3QgYWxyZWFkeSBoYXZlIGEgcmVjZWlwdFxuICAgICAgICBjb25zdCBleGlzdGluZ1BheW1lbnQgPSBhd2FpdCBwcmlzbWEucGF5bWVudC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiByZWNlaXB0RGF0YS5wYXltZW50SWQgfSxcbiAgICAgICAgICAgIGluY2x1ZGU6IHsgcmVjZWlwdDogdHJ1ZSB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghZXhpc3RpbmdQYXltZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgeyBlcnJvcjogJ1BheW1lbnQgbm90IGZvdW5kJyB9LFxuICAgICAgICAgICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChleGlzdGluZ1BheW1lbnQucmVjZWlwdCkge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgZXJyb3I6ICdBIHJlY2VpcHQgYWxyZWFkeSBleGlzdHMgZm9yIHRoaXMgcGF5bWVudCcgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDA5IH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZW5lcmF0ZSBhIHVuaXF1ZSByZWNlaXB0IG51bWJlclxuICAgICAgICBjb25zdCByZWNlaXB0TnVtYmVyID0gYFJFQy0ke0RhdGUubm93KCl9LSR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCl9YDtcblxuICAgICAgICAvLyBVc2UgYSB0cmFuc2FjdGlvbiB0byBlbnN1cmUgZGF0YSBjb25zaXN0ZW5jeVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcmlzbWEuJHRyYW5zYWN0aW9uKGFzeW5jICh0eCkgPT4ge1xuICAgICAgICAgICAgLy8gQ3JlYXRlIHJlY2VpcHRcbiAgICAgICAgICAgIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCB0eC5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICBwYXltZW50SWQ6IHJlY2VpcHREYXRhLnBheW1lbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgcmVjZWlwdE51bWJlcixcbiAgICAgICAgICAgICAgICAgICAgcmVjZWlwdERhdGU6IHJlY2VpcHREYXRhLnJlY2VpcHREYXRlID8gbmV3IERhdGUocmVjZWlwdERhdGEucmVjZWlwdERhdGUpIDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgICAgICAgICAgYmFua05hbWU6IHJlY2VpcHREYXRhLmJhbmtOYW1lIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGFjY291bnROdW1iZXI6IHJlY2VpcHREYXRhLmFjY291bnROdW1iZXIgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgY2hlcXVlTnVtYmVyOiByZWNlaXB0RGF0YS5jaGVxdWVOdW1iZXIgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb25JZDogcmVjZWlwdERhdGEudHJhbnNhY3Rpb25JZCB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICBub3RlczogcmVjZWlwdERhdGEubm90ZXMgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybWVkQnk6IHJlY2VpcHREYXRhLmNvbmZpcm1lZEJ5IHx8IG51bGxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICAgICAgcGF5bWVudDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbWVyOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludm9pY2U6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybWVkQnlVc2VyOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBwYXltZW50cyB3aXRoIHJlY2VpcHRzIGZvciB0aGUgaW52b2ljZSB0byBkZXRlcm1pbmUgY29ycmVjdCBzdGF0dXNcbiAgICAgICAgICAgIC8vIE9ubHkgY291bnQgcGF5bWVudHMgdGhhdCBoYXZlIHJlY2VpcHRzIChjb25maXJtZWQgcGF5bWVudHMpXG4gICAgICAgICAgICBjb25zdCB0b3RhbFBheW1lbnRzID0gYXdhaXQgdHgucGF5bWVudC5hZ2dyZWdhdGUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IFxuICAgICAgICAgICAgICAgICAgICBpbnZvaWNlSWQ6IGV4aXN0aW5nUGF5bWVudC5pbnZvaWNlSWQsXG4gICAgICAgICAgICAgICAgICAgIHJlY2VpcHQ6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTm90OiBudWxsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF9zdW06IHsgYW1vdW50OiB0cnVlIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBpbnZvaWNlID0gYXdhaXQgdHguaW52b2ljZS5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZXhpc3RpbmdQYXltZW50Lmludm9pY2VJZCB9LFxuICAgICAgICAgICAgICAgIHNlbGVjdDogeyB0b3RhbDogdHJ1ZSB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgdG90YWxQYWlkID0gdG90YWxQYXltZW50cy5fc3VtLmFtb3VudCB8fCAwO1xuICAgICAgICAgICAgY29uc3QgaW52b2ljZVRvdGFsID0gaW52b2ljZT8udG90YWwgfHwgMDtcblxuICAgICAgICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBjb3JyZWN0IHN0YXR1cyBiYXNlZCBvbiBwYXltZW50IGFtb3VudFxuICAgICAgICAgICAgbGV0IG5ld1N0YXR1cyA9ICdwZW5kaW5nJztcbiAgICAgICAgICAgIGlmICh0b3RhbFBhaWQgPj0gaW52b2ljZVRvdGFsKSB7XG4gICAgICAgICAgICAgICAgbmV3U3RhdHVzID0gJ3BhaWQnO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0b3RhbFBhaWQgPiAwKSB7XG4gICAgICAgICAgICAgICAgbmV3U3RhdHVzID0gJ3BhcnRpYWwnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVcGRhdGUgaW52b2ljZSBzdGF0dXMgYmFzZWQgb24gYWN0dWFsIHBheW1lbnQgYW1vdW50XG4gICAgICAgICAgICBhd2FpdCB0eC5pbnZvaWNlLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaWQ6IGV4aXN0aW5nUGF5bWVudC5pbnZvaWNlSWQgfSxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IHN0YXR1czogbmV3U3RhdHVzIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVc2UgdGhlIHNlbGVjdGVkIGFjY291bnQgZnJvbSB0aGUgcGF5bWVudCwgb3IgZmFsbGJhY2sgdG8gcGF5bWVudCBtZXRob2QgbG9naWNcbiAgICAgICAgICAgIGxldCBhY2NvdW50O1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdQYXltZW50LmFjY291bnRJZCkge1xuICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgYWNjb3VudCBzZWxlY3RlZCBkdXJpbmcgcGF5bWVudCBjcmVhdGlvblxuICAgICAgICAgICAgICAgIGFjY291bnQgPSBhd2FpdCB0eC5hY2NvdW50LmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogZXhpc3RpbmdQYXltZW50LmFjY291bnRJZCB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2VsZWN0ZWQgcGF5bWVudCBhY2NvdW50IG5vdCBmb3VuZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gb2xkIGxvZ2ljIGZvciBwYXltZW50cyB3aXRob3V0IHNlbGVjdGVkIGFjY291bnRzXG4gICAgICAgICAgICAgICAgY29uc3QgcGF5bWVudE1ldGhvZCA9IGV4aXN0aW5nUGF5bWVudC5wYXltZW50TWV0aG9kLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgbGV0IGFjY291bnROYW1lID0gJyc7XG4gICAgICAgICAgICAgICAgbGV0IGFjY291bnRUeXBlID0gJ2Fzc2V0JztcblxuICAgICAgICAgICAgICAgIGlmIChwYXltZW50TWV0aG9kLmluY2x1ZGVzKCdjYXNoJykpIHtcbiAgICAgICAgICAgICAgICAgICAgYWNjb3VudE5hbWUgPSAnQ2FzaCBpbiBIYW5kJztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBGb3IgYWxsIG5vbi1jYXNoIHBheW1lbnRzLCBkZWZhdWx0IHRvIENhc2ggaW4gQmFua1xuICAgICAgICAgICAgICAgICAgICBhY2NvdW50TmFtZSA9ICdDYXNoIGluIEJhbmsnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEZpbmQgb3IgY3JlYXRlIHRoZSBhcHByb3ByaWF0ZSBhY2NvdW50XG4gICAgICAgICAgICAgICAgYWNjb3VudCA9IGF3YWl0IHR4LmFjY291bnQuZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGFjY291bnROYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogYWNjb3VudFR5cGVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgYWNjb3VudCBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgICAgICAgICAgICAgICAgIGFjY291bnQgPSBhd2FpdCB0eC5hY2NvdW50LmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogYWNjb3VudE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogYWNjb3VudFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFsYW5jZTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYEF1dG8tY3JlYXRlZCBhY2NvdW50IGZvciAke3BheW1lbnRNZXRob2R9IHBheW1lbnRzYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBhY2NvdW50aW5nIHRyYW5zYWN0aW9uIGZvciB0aGUgaW5jb21lXG4gICAgICAgICAgICBhd2FpdCB0eC50cmFuc2FjdGlvbi5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogcmVjZWlwdERhdGEucmVjZWlwdERhdGUgPyBuZXcgRGF0ZShyZWNlaXB0RGF0YS5yZWNlaXB0RGF0ZSkgOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogYFBheW1lbnQgcmVjZWl2ZWQgZnJvbSAke3JlY2VpcHQucGF5bWVudC5jdXN0b21lci5uYW1lfSAtIEludm9pY2UgJHtyZWNlaXB0LnBheW1lbnQuaW52b2ljZS5pbnZvaWNlTnVtYmVyfWAsXG4gICAgICAgICAgICAgICAgICAgIGFjY291bnRJZDogYWNjb3VudC5pZCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2luY29tZScsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogZXhpc3RpbmdQYXltZW50LmFtb3VudCxcbiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlOiByZWNlaXB0TnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ1NhbGVzIFJldmVudWUnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBhY2NvdW50IGJhbGFuY2VcbiAgICAgICAgICAgIGF3YWl0IHR4LmFjY291bnQudXBkYXRlKHtcbiAgICAgICAgICAgICAgICB3aGVyZTogeyBpZDogYWNjb3VudC5pZCB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgYmFsYW5jZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5jcmVtZW50OiBleGlzdGluZ1BheW1lbnQuYW1vdW50XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHJlY2VpcHQ7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXN1bHQsIHsgc3RhdHVzOiAyMDEgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY3JlYXRpbmcgcmVjZWlwdDonLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIHJlY2VpcHQnIH0sXG4gICAgICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICAgKTtcbiAgICB9XG59Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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