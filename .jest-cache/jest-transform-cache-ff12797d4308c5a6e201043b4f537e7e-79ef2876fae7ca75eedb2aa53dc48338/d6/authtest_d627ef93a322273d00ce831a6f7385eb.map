{"version":3,"sources":["/Users/sachin/Documents/md-sports-/tests/unit/auth.test.ts"],"sourcesContent":["import { describe, it, expect, jest, beforeEach, afterEach } from '@jest/globals';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport { PrismaClient } from '@prisma/client';\n\n// Mock dependencies\njest.mock('bcryptjs');\njest.mock('jsonwebtoken', () => ({\n  sign: jest.fn(),\n  verify: jest.fn(),\n}));\njest.mock('@prisma/client');\n\nconst mockBcrypt = bcrypt as jest.Mocked<typeof bcrypt>;\nconst mockJwt = jwt as jest.Mocked<typeof jwt>;\nconst mockPrisma = {\n  user: {\n    findUnique: jest.fn(),\n    create: jest.fn(),\n    update: jest.fn(),\n  },\n  refreshToken: {\n    create: jest.fn(),\n    findUnique: jest.fn(),\n    delete: jest.fn(),\n    deleteMany: jest.fn(),\n  },\n  $disconnect: jest.fn(),\n} as any;\n\n// Mock the auth service (we'll test the actual implementation)\nclass AuthService {\n  private prisma: PrismaClient;\n  \n  constructor() {\n    this.prisma = mockPrisma;\n  }\n\n  async login(email: string, password: string) {\n    // Find user by email\n    const user = await this.prisma.user.findUnique({\n      where: { email },\n      select: {\n        id: true,\n        email: true,\n        password: true,\n        name: true,\n        permissions: true,\n        isActive: true,\n        shopId: true,\n      },\n    });\n\n    if (!user) {\n      throw new Error('Invalid credentials');\n    }\n\n    if (!user.isActive) {\n      throw new Error('Account is deactivated');\n    }\n\n    // Verify password\n    const isValidPassword = await bcrypt.compare(password, user.password);\n    if (!isValidPassword) {\n      throw new Error('Invalid credentials');\n    }\n\n    // Generate tokens\n    const accessToken = this.generateAccessToken(user);\n    const refreshToken = await this.generateRefreshToken(user.id);\n\n    return {\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        permissions: user.permissions,\n        shopId: user.shopId,\n      },\n      accessToken,\n      refreshToken,\n    };\n  }\n\n  private generateAccessToken(user: any) {\n    return jwt.sign(\n      {\n        userId: user.id,\n        email: user.email,\n        permissions: user.permissions,\n        shopId: user.shopId,\n      },\n      process.env.JWT_SECRET || 'test-secret',\n      { expiresIn: '15m' }\n    );\n  }\n\n  private async generateRefreshToken(userId: number) {\n    const token = jwt.sign(\n      { userId },\n      process.env.JWT_REFRESH_SECRET || 'test-refresh-secret',\n      { expiresIn: '7d' }\n    );\n\n    // Store refresh token in database\n    await this.prisma.refreshToken.create({\n      data: {\n        userId,\n        token,\n        expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days\n      },\n    });\n\n    return token;\n  }\n\n  async verifyToken(token: string) {\n    try {\n      const decoded = jwt.verify(token, process.env.JWT_SECRET || 'test-secret');\n      return decoded;\n    } catch (error) {\n      throw new Error('Invalid token');\n    }\n  }\n\n  async refreshAccessToken(refreshToken: string) {\n    // Verify refresh token\n    const decoded = jwt.verify(\n      refreshToken,\n      process.env.JWT_REFRESH_SECRET || 'test-refresh-secret'\n    ) as any;\n\n    // Check if refresh token exists in database\n    const storedToken = await this.prisma.refreshToken.findUnique({\n      where: { token: refreshToken },\n      include: { user: true },\n    });\n\n    if (!storedToken || storedToken.isRevoked) {\n      throw new Error('Invalid refresh token');\n    }\n\n    if (new Date() > storedToken.expiresAt) {\n      throw new Error('Refresh token expired');\n    }\n\n    // Generate new access token\n    const newAccessToken = this.generateAccessToken(storedToken.user);\n\n    return {\n      accessToken: newAccessToken,\n      user: {\n        id: storedToken.user.id,\n        email: storedToken.user.email,\n        name: storedToken.user.name,\n        permissions: storedToken.user.permissions,\n        shopId: storedToken.user.shopId,\n      },\n    };\n  }\n\n  async logout(refreshToken: string) {\n    // Revoke refresh token\n    await this.prisma.refreshToken.deleteMany({\n      where: { token: refreshToken },\n    });\n  }\n\n  async logoutAllDevices(userId: number) {\n    // Revoke all refresh tokens for user\n    await this.prisma.refreshToken.deleteMany({\n      where: { userId },\n    });\n  }\n}\n\ndescribe('AuthService', () => {\n  let authService: AuthService;\n\n  beforeEach(() => {\n    authService = new AuthService();\n    jest.clearAllMocks();\n    \n    // Set up environment variables\n    process.env.JWT_SECRET = 'test-secret';\n    process.env.JWT_REFRESH_SECRET = 'test-refresh-secret';\n    \n    // Mock JWT methods\n    mockJwt.sign.mockReturnValue('mock-token');\n    mockJwt.verify.mockReturnValue({ userId: 1, email: 'test@example.com' });\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('login', () => {\n    const mockUser = {\n      id: 1,\n      email: 'test@example.com',\n      password: 'hashedPassword',\n      name: 'Test User',\n      permissions: ['inventory:read', 'sales:create'],\n      isActive: true,\n      shopId: 'shop-1',\n    };\n\n    it('should successfully login with valid credentials', async () => {\n      // Arrange\n      mockPrisma.user.findUnique.mockResolvedValue(mockUser);\n      mockBcrypt.compare.mockResolvedValue(true as never);\n      mockJwt.sign.mockReturnValue('mock-access-token' as never);\n      mockPrisma.refreshToken.create.mockResolvedValue({ token: 'mock-refresh-token' });\n\n      // Act\n      const result = await authService.login('test@example.com', 'password123');\n\n      // Assert\n      expect(mockPrisma.user.findUnique).toHaveBeenCalledWith({\n        where: { email: 'test@example.com' },\n        select: {\n          id: true,\n          email: true,\n          password: true,\n          name: true,\n          permissions: true,\n          isActive: true,\n          shopId: true,\n        },\n      });\n      expect(mockBcrypt.compare).toHaveBeenCalledWith('password123', 'hashedPassword');\n      expect(result).toEqual({\n        user: {\n          id: 1,\n          email: 'test@example.com',\n          name: 'Test User',\n          permissions: ['inventory:read', 'sales:create'],\n          shopId: 'shop-1',\n        },\n        accessToken: 'mock-access-token',\n        refreshToken: 'mock-access-token', // This would be the refresh token in real implementation\n      });\n    });\n\n    it('should throw error for non-existent user', async () => {\n      // Arrange\n      mockPrisma.user.findUnique.mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(authService.login('nonexistent@example.com', 'password123'))\n        .rejects.toThrow('Invalid credentials');\n      \n      expect(mockBcrypt.compare).not.toHaveBeenCalled();\n    });\n\n    it('should throw error for inactive user', async () => {\n      // Arrange\n      const inactiveUser = { ...mockUser, isActive: false };\n      mockPrisma.user.findUnique.mockResolvedValue(inactiveUser);\n\n      // Act & Assert\n      await expect(authService.login('test@example.com', 'password123'))\n        .rejects.toThrow('Account is deactivated');\n      \n      expect(mockBcrypt.compare).not.toHaveBeenCalled();\n    });\n\n    it('should throw error for invalid password', async () => {\n      // Arrange\n      mockPrisma.user.findUnique.mockResolvedValue(mockUser);\n      mockBcrypt.compare.mockResolvedValue(false as never);\n\n      // Act & Assert\n      await expect(authService.login('test@example.com', 'wrongpassword'))\n        .rejects.toThrow('Invalid credentials');\n      \n      expect(mockBcrypt.compare).toHaveBeenCalledWith('wrongpassword', 'hashedPassword');\n    });\n\n    it('should handle database errors gracefully', async () => {\n      // Arrange\n      mockPrisma.user.findUnique.mockRejectedValue(new Error('Database connection failed'));\n\n      // Act & Assert\n      await expect(authService.login('test@example.com', 'password123'))\n        .rejects.toThrow('Database connection failed');\n    });\n  });\n\n  describe('verifyToken', () => {\n    it('should successfully verify valid token', async () => {\n      // Arrange\n      const mockDecoded = { userId: 1, email: 'test@example.com' };\n      mockJwt.verify.mockReturnValue(mockDecoded as never);\n\n      // Act\n      const result = await authService.verifyToken('valid-token');\n\n      // Assert\n      expect(mockJwt.verify).toHaveBeenCalledWith('valid-token', 'test-secret');\n      expect(result).toEqual(mockDecoded);\n    });\n\n    it('should throw error for invalid token', async () => {\n      // Arrange\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('jwt malformed');\n      });\n\n      // Act & Assert\n      await expect(authService.verifyToken('invalid-token'))\n        .rejects.toThrow('Invalid token');\n    });\n\n    it('should throw error for expired token', async () => {\n      // Arrange\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('jwt expired');\n      });\n\n      // Act & Assert\n      await expect(authService.verifyToken('expired-token'))\n        .rejects.toThrow('Invalid token');\n    });\n  });\n\n  describe('refreshAccessToken', () => {\n    const mockRefreshToken = {\n      token: 'valid-refresh-token',\n      userId: 1,\n      expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000), // 1 day from now\n      isRevoked: false,\n      user: {\n        id: 1,\n        email: 'test@example.com',\n        name: 'Test User',\n        permissions: ['inventory:read'],\n        shopId: 'shop-1',\n      },\n    };\n\n    it('should successfully refresh access token', async () => {\n      // Arrange\n      mockJwt.verify.mockReturnValue({ userId: 1 } as never);\n      mockPrisma.refreshToken.findUnique.mockResolvedValue(mockRefreshToken);\n      mockJwt.sign.mockReturnValue('new-access-token' as never);\n\n      // Act\n      const result = await authService.refreshAccessToken('valid-refresh-token');\n\n      // Assert\n      expect(mockJwt.verify).toHaveBeenCalledWith('valid-refresh-token', 'test-refresh-secret');\n      expect(mockPrisma.refreshToken.findUnique).toHaveBeenCalledWith({\n        where: { token: 'valid-refresh-token' },\n        include: { user: true },\n      });\n      expect(result).toEqual({\n        accessToken: 'new-access-token',\n        user: {\n          id: 1,\n          email: 'test@example.com',\n          name: 'Test User',\n          permissions: ['inventory:read'],\n          shopId: 'shop-1',\n        },\n      });\n    });\n\n    it('should throw error for revoked refresh token', async () => {\n      // Arrange\n      const revokedToken = { ...mockRefreshToken, isRevoked: true };\n      mockJwt.verify.mockReturnValue({ userId: 1 } as never);\n      mockPrisma.refreshToken.findUnique.mockResolvedValue(revokedToken);\n\n      // Act & Assert\n      await expect(authService.refreshAccessToken('revoked-token'))\n        .rejects.toThrow('Invalid refresh token');\n    });\n\n    it('should throw error for expired refresh token', async () => {\n      // Arrange\n      const expiredToken = {\n        ...mockRefreshToken,\n        expiresAt: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1 day ago\n      };\n      mockJwt.verify.mockReturnValue({ userId: 1 } as never);\n      mockPrisma.refreshToken.findUnique.mockResolvedValue(expiredToken);\n\n      // Act & Assert\n      await expect(authService.refreshAccessToken('expired-token'))\n        .rejects.toThrow('Refresh token expired');\n    });\n\n    it('should throw error for non-existent refresh token', async () => {\n      // Arrange\n      mockJwt.verify.mockReturnValue({ userId: 1 } as never);\n      mockPrisma.refreshToken.findUnique.mockResolvedValue(null);\n\n      // Act & Assert\n      await expect(authService.refreshAccessToken('non-existent-token'))\n        .rejects.toThrow('Invalid refresh token');\n    });\n  });\n\n  describe('logout', () => {\n    it('should successfully logout user', async () => {\n      // Arrange\n      mockPrisma.refreshToken.deleteMany.mockResolvedValue({ count: 1 });\n\n      // Act\n      await authService.logout('refresh-token');\n\n      // Assert\n      expect(mockPrisma.refreshToken.deleteMany).toHaveBeenCalledWith({\n        where: { token: 'refresh-token' },\n      });\n    });\n\n    it('should handle logout even if token does not exist', async () => {\n      // Arrange\n      mockPrisma.refreshToken.deleteMany.mockResolvedValue({ count: 0 });\n\n      // Act & Assert\n      await expect(authService.logout('non-existent-token')).resolves.not.toThrow();\n    });\n  });\n\n  describe('logoutAllDevices', () => {\n    it('should successfully logout from all devices', async () => {\n      // Arrange\n      mockPrisma.refreshToken.deleteMany.mockResolvedValue({ count: 3 });\n\n      // Act\n      await authService.logoutAllDevices(1);\n\n      // Assert\n      expect(mockPrisma.refreshToken.deleteMany).toHaveBeenCalledWith({\n        where: { userId: 1 },\n      });\n    });\n\n    it('should handle logout all devices even if no tokens exist', async () => {\n      // Arrange\n      mockPrisma.refreshToken.deleteMany.mockResolvedValue({ count: 0 });\n\n      // Act & Assert\n      await expect(authService.logoutAllDevices(1)).resolves.not.toThrow();\n    });\n  });\n\n  describe('security considerations', () => {\n    it('should use secure JWT configuration', () => {\n      // Arrange\n      const mockUser = { id: 1, email: 'test@example.com', permissions: [], shopId: 'shop-1' };\n      \n      // Act\n      authService['generateAccessToken'](mockUser);\n      \n      // Assert\n      expect(mockJwt.sign).toHaveBeenCalledWith(\n        expect.objectContaining({\n          userId: 1,\n          email: 'test@example.com',\n          permissions: [],\n          shopId: 'shop-1',\n        }),\n        'test-secret',\n        { expiresIn: '15m' }\n      );\n    });\n\n    it('should not expose sensitive user data in tokens', () => {\n      // Arrange\n      const mockUser = {\n        id: 1,\n        email: 'test@example.com',\n        password: 'hashedPassword',\n        permissions: [],\n        shopId: 'shop-1',\n      };\n      \n      // Act\n      authService['generateAccessToken'](mockUser);\n      \n      // Assert\n      const tokenPayload = (mockJwt.sign as jest.Mock).mock.calls[0][0];\n      expect(tokenPayload).not.toHaveProperty('password');\n    });\n\n    it('should use different secrets for access and refresh tokens', async () => {\n      // This test ensures we're using different secrets for different token types\n      const mockUser = { id: 1, email: 'test@example.com', permissions: [], shopId: 'shop-1' };\n      \n      // Mock the database call for refresh token creation\n      mockPrisma.refreshToken.create.mockResolvedValue({\n        id: 1,\n        userId: 1,\n        token: 'mock-refresh-token',\n        expiresAt: new Date(),\n        createdAt: new Date(),\n      });\n      \n      // Generate access token\n      authService['generateAccessToken'](mockUser);\n      \n      // Generate refresh token\n      await authService['generateRefreshToken'](1);\n      \n      // Assert different secrets are used\n      const calls = (mockJwt.sign as jest.Mock).mock.calls;\n      expect(calls).toHaveLength(2);\n      \n      const accessTokenCall = calls[0];\n      const refreshTokenCall = calls[1];\n      \n      expect(accessTokenCall[1]).toBe('test-secret');\n      expect(refreshTokenCall[1]).toBe('test-refresh-secret');\n      expect(accessTokenCall[1]).not.toBe(refreshTokenCall[1]);\n    });\n  });\n});"],"names":["jest","mock","sign","fn","verify","mockBcrypt","bcrypt","mockJwt","jwt","mockPrisma","user","findUnique","create","update","refreshToken","delete","deleteMany","$disconnect","AuthService","constructor","prisma","login","email","password","where","select","id","name","permissions","isActive","shopId","Error","isValidPassword","compare","accessToken","generateAccessToken","generateRefreshToken","userId","process","env","JWT_SECRET","expiresIn","token","JWT_REFRESH_SECRET","data","expiresAt","Date","now","verifyToken","decoded","error","refreshAccessToken","storedToken","include","isRevoked","newAccessToken","logout","logoutAllDevices","describe","authService","beforeEach","clearAllMocks","mockReturnValue","afterEach","resetAllMocks","mockUser","it","mockResolvedValue","result","expect","toHaveBeenCalledWith","toEqual","rejects","toThrow","not","toHaveBeenCalled","inactiveUser","mockRejectedValue","mockDecoded","mockImplementation","mockRefreshToken","revokedToken","expiredToken","count","resolves","objectContaining","tokenPayload","calls","toHaveProperty","createdAt","toHaveLength","accessTokenCall","refreshTokenCall","toBe"],"mappings":"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"}