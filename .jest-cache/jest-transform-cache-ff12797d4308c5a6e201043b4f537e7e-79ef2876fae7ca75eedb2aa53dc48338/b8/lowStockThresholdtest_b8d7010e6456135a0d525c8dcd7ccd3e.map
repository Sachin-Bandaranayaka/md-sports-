{"version":3,"sources":["/Users/sachin/Documents/md-sports-/tests/unit/lowStockThreshold.test.ts"],"sourcesContent":["// Unit tests for Low Stock Threshold feature\n// Tests the API endpoint and business logic for updating minStockLevel\n\nimport { NextRequest, NextResponse } from 'next/server';\nimport { PUT } from '@/app/api/products/[id]/route';\nimport { PrismaClient } from '@prisma/client';\nimport { verifyToken } from '@/lib/auth';\nimport { extractToken } from '@/lib/auth';\n\n// Mock dependencies\njest.mock('@/lib/prisma', () => ({\n  prisma: {\n    product: {\n      findUnique: jest.fn(),\n      update: jest.fn(),\n    },\n    auditLog: {\n      create: jest.fn(),\n    },\n  },\n}));\n\n// Mock audit service\njest.mock('@/services/auditService', () => ({\n  auditService: {\n    logAction: jest.fn(),\n  },\n}));\n\njest.mock('@/lib/auth', () => ({\n  verifyToken: jest.fn().mockReturnValue({ userId: 1 }),\n  extractToken: jest.fn().mockReturnValue('valid-token'),\n}));\n\n// Mock cache service\njest.mock('@/lib/cache', () => ({\n  cacheService: {\n    invalidateInventory: jest.fn(),\n  },\n}));\n\n// Mock Next.js revalidation functions\njest.mock('next/cache', () => ({\n  revalidateTag: jest.fn(),\n  revalidatePath: jest.fn(),\n}));\n\nconst mockPrisma = require('@/lib/prisma').prisma;\nconst mockVerifyToken = verifyToken as jest.MockedFunction<typeof verifyToken>;\nconst mockExtractToken = extractToken as jest.MockedFunction<typeof extractToken>;\n\ndescribe('Low Stock Threshold API Tests', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('PUT /api/products/[id] - minStockLevel updates', () => {\n    const mockExistingProduct = {\n      id: 1,\n      name: 'Test Product',\n      sku: 'TEST-001',\n      barcode: '1234567890',\n      description: 'Test product description',\n      price: 100,\n      weightedAverageCost: 80,\n      minStockLevel: 10,\n      categoryId: 1,\n    };\n\n    const mockUpdatedProduct = {\n      ...mockExistingProduct,\n      minStockLevel: 25,\n    };\n\n    beforeEach(() => {\n      mockPrisma.product.findUnique.mockResolvedValue(mockExistingProduct);\n      mockPrisma.product.update.mockResolvedValue(mockUpdatedProduct);\n      mockPrisma.auditLog.create.mockResolvedValue({});\n      mockExtractToken.mockReturnValue('mock-token');\n      mockVerifyToken.mockReturnValue({ userId: 1 });\n    });\n\n    test('should successfully update minStockLevel', async () => {\n      const requestBody = {\n        minStockLevel: 25,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/1', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '1' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(mockPrisma.product.update).toHaveBeenCalledWith({\n        where: { id: 1 },\n        data: {\n          minStockLevel: 25,\n        },\n      });\n    });\n\n    test('should update minStockLevel along with other fields', async () => {\n      const requestBody = {\n        name: 'Updated Product Name',\n        minStockLevel: 15,\n        retailPrice: 120,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/1', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '1' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(mockPrisma.product.update).toHaveBeenCalledWith({\n        where: { id: 1 },\n        data: {\n          name: 'Updated Product Name',\n          minStockLevel: 15,\n          price: 120,\n        },\n      });\n    });\n\n    test('should handle zero minStockLevel', async () => {\n      const requestBody = {\n        minStockLevel: 0,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/1', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '1' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(mockPrisma.product.update).toHaveBeenCalledWith({\n        where: { id: 1 },\n        data: {\n          minStockLevel: 0,\n        },\n      });\n    });\n\n    test('should handle negative minStockLevel', async () => {\n      const requestBody = {\n        minStockLevel: -5,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/1', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '1' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      expect(mockPrisma.product.update).toHaveBeenCalledWith({\n        where: { id: 1 },\n        data: {\n          minStockLevel: -5,\n        },\n      });\n    });\n\n    test('should return 404 for non-existent product', async () => {\n      mockPrisma.product.findUnique.mockResolvedValue(null);\n\n      const requestBody = {\n        minStockLevel: 25,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/999', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '999' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(404);\n      expect(responseData.success).toBe(false);\n      expect(responseData.message).toBe('Product with ID 999 not found');\n    });\n\n    test('should return 400 for invalid product ID', async () => {\n      const requestBody = {\n        minStockLevel: 25,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/invalid', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: 'invalid' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(400);\n      expect(responseData.success).toBe(false);\n      expect(responseData.message).toBe('Invalid product ID');\n    });\n\n    test('should create audit log for minStockLevel changes', async () => {\n      const requestBody = {\n        minStockLevel: 30,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/1', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '1' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(200);\n      expect(responseData.success).toBe(true);\n      \n      // Verify audit log was created\n      expect(mockPrisma.auditLog.create).toHaveBeenCalledWith({\n        data: {\n          action: 'UPDATE',\n          entityType: 'Product',\n          entityId: '1',\n          userId: 1,\n          changes: {\n            minStockLevel: {\n              old: 10,\n              new: 30,\n            },\n          },\n          timestamp: expect.any(Date),\n        },\n      });\n    });\n\n    test('should handle database errors gracefully', async () => {\n      mockPrisma.product.update.mockRejectedValue(new Error('Database connection failed'));\n\n      const requestBody = {\n        minStockLevel: 25,\n      };\n\n      const request = new Request('http://localhost:3000/api/products/1', {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': 'Bearer mock-token',\n        },\n        body: JSON.stringify(requestBody),\n      }) as NextRequest;\n\n      const response = await PUT(request, { params: { id: '1' } });\n      const responseData = await response.json();\n\n      expect(response.status).toBe(500);\n      expect(responseData.success).toBe(false);\n      expect(responseData.message).toBe('Error updating product');\n    });\n  });\n\n  describe('minStockLevel validation', () => {\n    test('should accept valid minStockLevel values', () => {\n      const validValues = [0, 1, 5, 10, 100, 1000];\n      \n      validValues.forEach(value => {\n        expect(typeof value).toBe('number');\n        expect(Number.isInteger(value)).toBe(true);\n      });\n    });\n\n    test('should handle string numbers correctly', () => {\n      const stringNumbers = ['0', '5', '10', '25'];\n      \n      stringNumbers.forEach(value => {\n        const parsed = parseInt(value);\n        expect(Number.isInteger(parsed)).toBe(true);\n        expect(parsed >= 0).toBe(true);\n      });\n    });\n  });\n});\n\n// Business logic tests for low stock detection\ndescribe('Low Stock Detection Logic', () => {\n  test('should correctly identify low stock products', () => {\n    const products = [\n      { id: 1, name: 'Product A', currentStock: 5, minStockLevel: 10 },\n      { id: 2, name: 'Product B', currentStock: 15, minStockLevel: 10 },\n      { id: 3, name: 'Product C', currentStock: 0, minStockLevel: 5 },\n      { id: 4, name: 'Product D', currentStock: 10, minStockLevel: 10 },\n    ];\n\n    const isLowStock = (product: any) => product.currentStock < product.minStockLevel;\n    const lowStockProducts = products.filter(isLowStock);\n\n    expect(lowStockProducts).toHaveLength(2);\n    expect(lowStockProducts.map(p => p.id)).toEqual([1, 3]);\n  });\n\n  test('should handle edge cases for low stock detection', () => {\n    const edgeCases = [\n      { id: 1, currentStock: 0, minStockLevel: 0 }, // Both zero\n      { id: 2, currentStock: 1, minStockLevel: 0 }, // Min stock zero\n      { id: 3, currentStock: 5, minStockLevel: 5 }, // Equal values\n    ];\n\n    const isLowStock = (product: any) => product.currentStock < product.minStockLevel;\n    const lowStockProducts = edgeCases.filter(isLowStock);\n\n    expect(lowStockProducts).toHaveLength(0); // None should be low stock\n  });\n});"],"names":["jest","mock","prisma","product","findUnique","fn","update","auditLog","create","auditService","logAction","verifyToken","mockReturnValue","userId","extractToken","cacheService","invalidateInventory","revalidateTag","revalidatePath","mockPrisma","require","mockVerifyToken","mockExtractToken","describe","beforeEach","clearAllMocks","mockExistingProduct","id","name","sku","barcode","description","price","weightedAverageCost","minStockLevel","categoryId","mockUpdatedProduct","mockResolvedValue","test","requestBody","request","Request","method","headers","body","JSON","stringify","response","PUT","params","responseData","json","expect","status","toBe","success","toHaveBeenCalledWith","where","data","retailPrice","message","action","entityType","entityId","changes","old","new","timestamp","any","Date","mockRejectedValue","Error","validValues","forEach","value","Number","isInteger","stringNumbers","parsed","parseInt","products","currentStock","isLowStock","lowStockProducts","filter","toHaveLength","map","p","toEqual","edgeCases"],"mappings":"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"}