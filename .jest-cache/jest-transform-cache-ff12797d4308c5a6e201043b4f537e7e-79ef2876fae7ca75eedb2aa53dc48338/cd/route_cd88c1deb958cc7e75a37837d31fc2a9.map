{"version":3,"names":["cov_25l7g5ubwo","actualCoverage","s","POST","request","f","authDelete","_auth","validateTokenPermission","authManage","b","isValid","_server","NextResponse","json","success","message","status","body","ids","Array","isArray","length","numericIds","map","id","parseInt","filter","n","isNaN","results","_invoiceService","deleteInvoice","push","err","console","error","failed","r","deleted","String"],"sources":["/Users/sachin/Documents/md-sports-/src/app/api/invoices/bulk-delete/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { validateTokenPermission } from '@/lib/auth';\nimport { deleteInvoice } from '@/services/invoiceService';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const authDelete = await validateTokenPermission(request, 'sales:delete');\n    const authManage = await validateTokenPermission(request, 'invoice:manage');\n\n    if (!authDelete.isValid && !authManage.isValid) {\n      return NextResponse.json({\n        success: false,\n        message: \"Permission denied. Requires 'sales:delete' or 'invoice:manage'.\",\n      }, { status: 403 });\n    }\n\n    const body = await request.json();\n    const ids: unknown = body?.ids;\n\n    if (!Array.isArray(ids) || ids.length === 0) {\n      return NextResponse.json(\n        { success: false, message: 'ids[] array is required' },\n        { status: 400 },\n      );\n    }\n\n    const numericIds: number[] = ids\n      .map((id: any) => parseInt(id, 10))\n      .filter((n) => !isNaN(n));\n\n    if (numericIds.length === 0) {\n      return NextResponse.json({ success: false, message: 'No valid numeric IDs provided' }, { status: 400 });\n    }\n\n    const results: { id: number; success: boolean; error?: string }[] = [];\n\n    for (const id of numericIds) {\n      try {\n        await deleteInvoice(id);\n        results.push({ id, success: true });\n      } catch (err: any) {\n        console.error(`Bulk delete error for invoice ${id}:`, err);\n        results.push({ id, success: false, error: err.message || 'unknown error' });\n      }\n    }\n\n    const failed = results.filter((r) => !r.success);\n\n    return NextResponse.json({\n      success: failed.length === 0,\n      deleted: results.filter((r) => r.success).map((r) => r.id),\n      failed,\n    });\n  } catch (error) {\n    console.error('Bulk invoice delete error:', error);\n    return NextResponse.json({ success: false, message: 'Server error', error: String(error) }, { status: 500 });\n  }\n} "],"mappings":"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","ignoreList":[]}