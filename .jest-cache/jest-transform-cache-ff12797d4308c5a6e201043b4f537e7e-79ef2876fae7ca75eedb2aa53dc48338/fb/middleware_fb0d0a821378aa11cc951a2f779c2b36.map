{"version":3,"names":["config","cov_1whg2y2s1h","f","s","middleware","generateUUID","b","crypto","randomUUID","replace","c","r","Math","random","v","toString","SHOP_RESTRICTED_ROUTES","ADMIN_CROSS_SHOP_ROUTES","validateShopAccess","req","targetShopId","userShopId","_auth","getShopIdFromToken","_userId","getUserIdFromToken","token","headers","get","split","targetShopIdNum","parseInt","userShopIdNum","error","console","addShopContext","response","userId","set","API_ROUTES","SKIP_PATHS","request","pathname","nextUrl","some","path","startsWith","endsWith","match","_server","NextResponse","next","process","env","NODE_ENV","SKIP_MIDDLEWARE","isShopRestricted","route","isAdminRoute","url","URL","queryShopId","searchParams","hasShopAccess","undefined","JSON","stringify","success","message","status","ip","isRateLimitedRoute","rlResult","_rateLimiter","rateLimiter","check","allowed","count","remaining","resetTimeMs","ceil","Date","now","includes","method","csrfTokenFromCookie","cookies","value","csrfTokenFromHeader","isAuthRoute","currentToken","csrfToken","name","httpOnly","sameSite","secure","maxAge","matcher"],"sources":["/Users/sachin/Documents/md-sports-/src/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { getUserIdFromToken, getShopIdFromToken } from '@/lib/auth';\nimport { rateLimiter } from '@/lib/rateLimiter';\n\n// Generate UUID using Web Crypto API instead of Node.js crypto\nfunction generateUUID() {\n    // This implementation works in Edge Runtime\n    if (typeof crypto !== 'undefined' && crypto.randomUUID) {\n        return crypto.randomUUID();\n    }\n\n    // Fallback implementation\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n\n// Shop-specific API routes that need shop-based filtering\nconst SHOP_RESTRICTED_ROUTES = [\n    '/api/products',\n    '/api/inventory',\n    '/api/invoices',\n    '/api/purchases',\n    '/api/dashboard',\n    '/api/reports'\n];\n\n// Routes that allow cross-shop access for admins\nconst ADMIN_CROSS_SHOP_ROUTES = [\n    '/api/shops',\n    '/api/users',\n    '/api/settings',\n    '/api/reports/shop-performance',\n    '/api/reports/shop-comparison'\n];\n\n/**\n * Check if user has permission to access data from a specific shop\n */\nasync function validateShopAccess(req: NextRequest, targetShopId?: string | number): Promise<boolean> {\n    try {\n        const userShopId = await getShopIdFromToken(req);\n        const _userId = await getUserIdFromToken(req);\n\n        // Development mode - allow all access\n        const token = req.headers.get('authorization')?.split(' ')[1];\n        if (token === 'dev-token') {\n            return true;\n        }\n\n        // If no target shop specified, allow access\n        if (!targetShopId) {\n            return true;\n        }\n\n        // For Edge Runtime compatibility, we'll skip permission checks in middleware\n        // and rely on API route-level permission validation instead\n        // This is a temporary fix to avoid Prisma Edge Runtime issues\n        \n        // Allow access for now - permission checks will happen in API routes\n        // TODO: Implement edge-compatible permission checking if needed\n\n        // Check if user belongs to the target shop\n        const targetShopIdNum = typeof targetShopId === 'string' ? parseInt(targetShopId) : targetShopId;\n        const userShopIdNum = typeof userShopId === 'string' ? parseInt(userShopId) : userShopId;\n        return userShopIdNum === targetShopIdNum;\n\n    } catch (error) {\n        console.error('Error validating shop access:', error);\n        return false;\n    }\n}\n\n/**\n * Add shop context to request headers for API routes\n */\nasync function addShopContext(req: NextRequest, response: NextResponse): Promise<NextResponse> {\n    const userShopId = await getShopIdFromToken(req);\n    const userId = await getUserIdFromToken(req);\n\n    if (userShopId) {\n        response.headers.set('X-User-Shop-Id', userShopId.toString());\n    }\n\n    if (userId) {\n        response.headers.set('X-User-Id', userId.toString());\n    }\n\n    return response;\n}\n\n// Rate limiting configuration is now handled by lib/rateLimiter.ts\n\n// API routes that should be protected\nconst API_ROUTES = [\n    '/api/auth/login',\n    '/api/auth/register',\n    '/api/auth/refresh',\n];\n\n// Static assets and paths to skip middleware processing\nconst SKIP_PATHS = [\n    '/_next',\n    '/images',\n    '/favicon.ico',\n    '/robots.txt',\n    '/manifest.json',\n    '/sitemap.xml',\n    '.svg',\n    '.png',\n    '.jpg',\n    '.jpeg',\n    '.gif',\n    '.webp',\n    '.css',\n    '.js',\n];\n\nexport async function middleware(request: NextRequest) {\n    const pathname = request.nextUrl.pathname;\n\n    // Skip middleware for static assets and non-critical paths\n    if (SKIP_PATHS.some(path => pathname.startsWith(path) || pathname.endsWith(path)) ||\n        pathname.startsWith('/_next') ||  // Skip Next.js internal paths\n        pathname.match(/\\.(svg|png|jpg|jpeg|gif|webp|css|js)$/)) { // Skip static files\n        return NextResponse.next();\n    }\n\n    // Skip middleware in development if needed\n    if (process.env.NODE_ENV === 'development' && process.env.SKIP_MIDDLEWARE === 'true') {\n        return NextResponse.next();\n    }\n\n    let response = NextResponse.next();\n\n    // Add shop-based access control for API routes\n    if (pathname.startsWith('/api/')) {\n        // Check if this is a shop-restricted route\n        const isShopRestricted = SHOP_RESTRICTED_ROUTES.some(route => pathname.startsWith(route));\n        const isAdminRoute = ADMIN_CROSS_SHOP_ROUTES.some(route => pathname.startsWith(route));\n\n        if (isShopRestricted && !isAdminRoute) {\n            // Extract shopId from query parameters if present\n            const url = new URL(request.url);\n            const queryShopId = url.searchParams.get('shopId');\n\n            // Validate shop access\n            const hasShopAccess = await validateShopAccess(request, queryShopId || undefined);\n\n            if (!hasShopAccess) {\n                return new NextResponse(JSON.stringify({\n                    success: false,\n                    message: 'Access denied: You can only access data from your assigned shop'\n                }), {\n                    status: 403,\n                    headers: {\n                        'Content-Type': 'application/json'\n                    }\n                });\n            }\n        }\n\n        // Add shop context to response headers\n        response = await addShopContext(request, response);\n    }\n\n    // Get IP address from X-Forwarded-For header or remote address for rate limiting\n    const ip = request.ip || 'unknown';\n\n    const isRateLimitedRoute = API_ROUTES.some(route => pathname.startsWith(route));\n\n    if (isRateLimitedRoute) {\n        const rlResult = await rateLimiter.check(ip);\n\n        // Set rate-limit headers on every response (success or 429)\n        response.headers.set('X-RateLimit-Limit', rlResult.allowed ? rlResult.count.toString() : rlResult.count.toString());\n        response.headers.set('X-RateLimit-Remaining', rlResult.remaining.toString());\n        response.headers.set('X-RateLimit-Reset', rlResult.resetTimeMs.toString());\n\n        if (!rlResult.allowed) {\n            return new NextResponse(JSON.stringify({\n                success: false,\n                message: 'Too many requests, please try again later.'\n            }), {\n                status: 429,\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Retry-After': Math.ceil((rlResult.resetTimeMs - Date.now()) / 1000).toString(),\n                    'X-RateLimit-Limit': rlResult.count.toString(),\n                    'X-RateLimit-Remaining': '0',\n                    'X-RateLimit-Reset': rlResult.resetTimeMs.toString(),\n                }\n            });\n        }\n    }\n\n    // Set security headers only for HTML responses, not for API or assets\n    if (!pathname.startsWith('/api/') && !pathname.includes('.')) {\n        response.headers.set('X-Content-Type-Options', 'nosniff');\n        response.headers.set('X-Frame-Options', 'DENY');\n        response.headers.set('X-XSS-Protection', '1; mode=block');\n        response.headers.set('Referrer-Policy', 'same-origin');\n    }\n\n    // Add CSRF protection only for non-GET methods that are not static assets\n    if (request.method !== 'GET' && request.method !== 'HEAD') {\n        const csrfTokenFromCookie = request.cookies.get('csrfToken')?.value;\n        const csrfTokenFromHeader = request.headers.get('X-CSRF-Token');\n\n        // Skip CSRF check for login and initial auth routes, and maintenance endpoints\n        const isAuthRoute = ['/api/auth/login', '/api/auth/register', '/api/auth/refresh', '/api/fix-shopstaff-permissions'].some(\n            route => pathname.startsWith(route)\n        );\n\n        if (!isAuthRoute && (!csrfTokenFromCookie || csrfTokenFromHeader !== csrfTokenFromCookie)) {\n            return new NextResponse(JSON.stringify({\n                success: false,\n                message: 'Invalid CSRF token'\n            }), {\n                status: 403,\n                headers: {\n                    'Content-Type': 'application/json'\n                }\n            });\n        }\n    }\n\n    // For GET requests to pages, set a new CSRF token if one doesn't exist\n    // Only do this for HTML page requests, not for assets or API calls\n    if (request.method === 'GET' &&\n        !pathname.startsWith('/api/') &&\n        !pathname.includes('.') &&\n        !pathname.startsWith('/_next')) {\n\n        const currentToken = request.cookies.get('csrfToken')?.value;\n        if (!currentToken) {\n            const csrfToken = generateUUID();\n            response.cookies.set({\n                name: 'csrfToken',\n                value: csrfToken,\n                httpOnly: false, // Made accessible to JavaScript\n                sameSite: 'strict',\n                secure: process.env.NODE_ENV === 'production',\n                path: '/',\n                maxAge: 60 * 60 * 24, // 1 day\n            });\n        }\n    }\n\n    return response;\n}\n\nexport const config = {\n    matcher: [\n        // Apply the middleware to all API routes and page routes\n        // Exclude static assets and _next directory\n        '/api/:path*',\n        '/:path*',\n        '/:path*/:subpath*',\n    ],\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}