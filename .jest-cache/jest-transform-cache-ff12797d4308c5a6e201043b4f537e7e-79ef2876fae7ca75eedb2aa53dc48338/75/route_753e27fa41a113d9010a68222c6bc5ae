22d616897dc0d6fcc66cc612875b2eea
"use strict";

/* istanbul ignore next */
function cov_vn4mgc0gq() {
  var path = "/Users/sachin/Documents/md-sports-/src/app/api/users/route.ts";
  var hash = "219132d5b00ca0a816259aa98732b88185976bdf";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/sachin/Documents/md-sports-/src/app/api/users/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "2": {
        start: {
          line: 6,
          column: 24
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "3": {
        start: {
          line: 11,
          column: 0
        },
        end: {
          line: 18,
          column: 3
        }
      },
      "4": {
        start: {
          line: 13,
          column: 8
        },
        end: {
          line: 13,
          column: 19
        }
      },
      "5": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 20
        }
      },
      "6": {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 38
        }
      },
      "7": {
        start: {
          line: 20,
          column: 30
        },
        end: {
          line: 20,
          column: 86
        }
      },
      "8": {
        start: {
          line: 21,
          column: 20
        },
        end: {
          line: 21,
          column: 60
        }
      },
      "9": {
        start: {
          line: 22,
          column: 32
        },
        end: {
          line: 22,
          column: 77
        }
      },
      "10": {
        start: {
          line: 23,
          column: 16
        },
        end: {
          line: 23,
          column: 33
        }
      },
      "11": {
        start: {
          line: 25,
          column: 4
        },
        end: {
          line: 27,
          column: 6
        }
      },
      "12": {
        start: {
          line: 31,
          column: 28
        },
        end: {
          line: 31,
          column: 88
        }
      },
      "13": {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 34,
          column: 5
        }
      },
      "14": {
        start: {
          line: 33,
          column: 8
        },
        end: {
          line: 33,
          column: 31
        }
      },
      "15": {
        start: {
          line: 35,
          column: 4
        },
        end: {
          line: 76,
          column: 5
        }
      },
      "16": {
        start: {
          line: 36,
          column: 22
        },
        end: {
          line: 63,
          column: 10
        }
      },
      "17": {
        start: {
          line: 64,
          column: 8
        },
        end: {
          line: 67,
          column: 11
        }
      },
      "18": {
        start: {
          line: 69,
          column: 8
        },
        end: {
          line: 69,
          column: 54
        }
      },
      "19": {
        start: {
          line: 70,
          column: 8
        },
        end: {
          line: 75,
          column: 11
        }
      },
      "20": {
        start: {
          line: 84,
          column: 4
        },
        end: {
          line: 209,
          column: 5
        }
      },
      "21": {
        start: {
          line: 85,
          column: 25
        },
        end: {
          line: 85,
          column: 41
        }
      },
      "22": {
        start: {
          line: 86,
          column: 8
        },
        end: {
          line: 86,
          column: 53
        }
      },
      "23": {
        start: {
          line: 88,
          column: 8
        },
        end: {
          line: 95,
          column: 9
        }
      },
      "24": {
        start: {
          line: 89,
          column: 12
        },
        end: {
          line: 94,
          column: 15
        }
      },
      "25": {
        start: {
          line: 96,
          column: 8
        },
        end: {
          line: 103,
          column: 9
        }
      },
      "26": {
        start: {
          line: 97,
          column: 12
        },
        end: {
          line: 102,
          column: 15
        }
      },
      "27": {
        start: {
          line: 104,
          column: 8
        },
        end: {
          line: 111,
          column: 9
        }
      },
      "28": {
        start: {
          line: 105,
          column: 12
        },
        end: {
          line: 110,
          column: 15
        }
      },
      "29": {
        start: {
          line: 112,
          column: 8
        },
        end: {
          line: 119,
          column: 9
        }
      },
      "30": {
        start: {
          line: 113,
          column: 12
        },
        end: {
          line: 118,
          column: 15
        }
      },
      "31": {
        start: {
          line: 120,
          column: 8
        },
        end: {
          line: 127,
          column: 9
        }
      },
      "32": {
        start: {
          line: 121,
          column: 12
        },
        end: {
          line: 126,
          column: 15
        }
      },
      "33": {
        start: {
          line: 129,
          column: 23
        },
        end: {
          line: 129,
          column: 36
        }
      },
      "34": {
        start: {
          line: 131,
          column: 27
        },
        end: {
          line: 135,
          column: 10
        }
      },
      "35": {
        start: {
          line: 136,
          column: 8
        },
        end: {
          line: 143,
          column: 9
        }
      },
      "36": {
        start: {
          line: 137,
          column: 12
        },
        end: {
          line: 142,
          column: 15
        }
      },
      "37": {
        start: {
          line: 145,
          column: 8
        },
        end: {
          line: 164,
          column: 9
        }
      },
      "38": {
        start: {
          line: 146,
          column: 12
        },
        end: {
          line: 146,
          column: 102
        }
      },
      "39": {
        start: {
          line: 147,
          column: 40
        },
        end: {
          line: 154,
          column: 14
        }
      },
      "40": {
        start: {
          line: 155,
          column: 12
        },
        end: {
          line: 163,
          column: 13
        }
      },
      "41": {
        start: {
          line: 156,
          column: 40
        },
        end: {
          line: 156,
          column: 88
        }
      },
      "42": {
        start: {
          line: 156,
          column: 81
        },
        end: {
          line: 156,
          column: 87
        }
      },
      "43": {
        start: {
          line: 157,
          column: 16
        },
        end: {
          line: 157,
          column: 97
        }
      },
      "44": {
        start: {
          line: 158,
          column: 16
        },
        end: {
          line: 158,
          column: 55
        }
      },
      "45": {
        start: {
          line: 159,
          column: 16
        },
        end: {
          line: 159,
          column: 57
        }
      },
      "46": {
        start: {
          line: 160,
          column: 16
        },
        end: {
          line: 160,
          column: 61
        }
      },
      "47": {
        start: {
          line: 162,
          column: 16
        },
        end: {
          line: 162,
          column: 91
        }
      },
      "48": {
        start: {
          line: 165,
          column: 31
        },
        end: {
          line: 165,
          column: 82
        }
      },
      "49": {
        start: {
          line: 167,
          column: 39
        },
        end: {
          line: 167,
          column: 43
        }
      },
      "50": {
        start: {
          line: 168,
          column: 8
        },
        end: {
          line: 180,
          column: 9
        }
      },
      "51": {
        start: {
          line: 169,
          column: 31
        },
        end: {
          line: 178,
          column: 14
        }
      },
      "52": {
        start: {
          line: 179,
          column: 12
        },
        end: {
          line: 179,
          column: 64
        }
      },
      "53": {
        start: {
          line: 182,
          column: 24
        },
        end: {
          line: 195,
          column: 10
        }
      },
      "54": {
        start: {
          line: 196,
          column: 8
        },
        end: {
          line: 200,
          column: 11
        }
      },
      "55": {
        start: {
          line: 202,
          column: 8
        },
        end: {
          line: 202,
          column: 53
        }
      },
      "56": {
        start: {
          line: 203,
          column: 8
        },
        end: {
          line: 208,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 16
          }
        },
        loc: {
          start: {
            line: 5,
            column: 30
          },
          end: {
            line: 10,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 9
          },
          end: {
            line: 12,
            column: 10
          }
        },
        loc: {
          start: {
            line: 12,
            column: 20
          },
          end: {
            line: 14,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 10
          },
          end: {
            line: 15,
            column: 11
          }
        },
        loc: {
          start: {
            line: 15,
            column: 21
          },
          end: {
            line: 17,
            column: 5
          }
        },
        line: 15
      },
      "3": {
        name: "_interop_require_default",
        decl: {
          start: {
            line: 24,
            column: 9
          },
          end: {
            line: 24,
            column: 33
          }
        },
        loc: {
          start: {
            line: 24,
            column: 39
          },
          end: {
            line: 28,
            column: 1
          }
        },
        line: 24
      },
      "4": {
        name: "GET",
        decl: {
          start: {
            line: 29,
            column: 15
          },
          end: {
            line: 29,
            column: 18
          }
        },
        loc: {
          start: {
            line: 29,
            column: 24
          },
          end: {
            line: 77,
            column: 1
          }
        },
        line: 29
      },
      "5": {
        name: "POST",
        decl: {
          start: {
            line: 78,
            column: 15
          },
          end: {
            line: 78,
            column: 19
          }
        },
        loc: {
          start: {
            line: 78,
            column: 25
          },
          end: {
            line: 210,
            column: 1
          }
        },
        line: 78
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 156,
            column: 76
          },
          end: {
            line: 156,
            column: 77
          }
        },
        loc: {
          start: {
            line: 156,
            column: 81
          },
          end: {
            line: 156,
            column: 87
          }
        },
        line: 156
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 25,
            column: 11
          },
          end: {
            line: 27,
            column: 5
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 25,
            column: 35
          },
          end: {
            line: 25,
            column: 38
          }
        }, {
          start: {
            line: 25,
            column: 41
          },
          end: {
            line: 27,
            column: 5
          }
        }],
        line: 25
      },
      "1": {
        loc: {
          start: {
            line: 25,
            column: 11
          },
          end: {
            line: 25,
            column: 32
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 25,
            column: 11
          },
          end: {
            line: 25,
            column: 14
          }
        }, {
          start: {
            line: 25,
            column: 18
          },
          end: {
            line: 25,
            column: 32
          }
        }],
        line: 25
      },
      "2": {
        loc: {
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 34,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 32,
            column: 4
          },
          end: {
            line: 34,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 32
      },
      "3": {
        loc: {
          start: {
            line: 88,
            column: 8
          },
          end: {
            line: 95,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 88,
            column: 8
          },
          end: {
            line: 95,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 88
      },
      "4": {
        loc: {
          start: {
            line: 96,
            column: 8
          },
          end: {
            line: 103,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 96,
            column: 8
          },
          end: {
            line: 103,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 96
      },
      "5": {
        loc: {
          start: {
            line: 104,
            column: 8
          },
          end: {
            line: 111,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 104,
            column: 8
          },
          end: {
            line: 111,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 104
      },
      "6": {
        loc: {
          start: {
            line: 104,
            column: 12
          },
          end: {
            line: 104,
            column: 62
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 104,
            column: 12
          },
          end: {
            line: 104,
            column: 30
          }
        }, {
          start: {
            line: 104,
            column: 34
          },
          end: {
            line: 104,
            column: 62
          }
        }],
        line: 104
      },
      "7": {
        loc: {
          start: {
            line: 112,
            column: 8
          },
          end: {
            line: 119,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 112,
            column: 8
          },
          end: {
            line: 119,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 112
      },
      "8": {
        loc: {
          start: {
            line: 112,
            column: 12
          },
          end: {
            line: 112,
            column: 83
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 112,
            column: 12
          },
          end: {
            line: 112,
            column: 26
          }
        }, {
          start: {
            line: 112,
            column: 30
          },
          end: {
            line: 112,
            column: 50
          }
        }, {
          start: {
            line: 112,
            column: 54
          },
          end: {
            line: 112,
            column: 83
          }
        }],
        line: 112
      },
      "9": {
        loc: {
          start: {
            line: 120,
            column: 8
          },
          end: {
            line: 127,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 120,
            column: 8
          },
          end: {
            line: 127,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 120
      },
      "10": {
        loc: {
          start: {
            line: 120,
            column: 12
          },
          end: {
            line: 120,
            column: 70
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 120,
            column: 12
          },
          end: {
            line: 120,
            column: 33
          }
        }, {
          start: {
            line: 120,
            column: 37
          },
          end: {
            line: 120,
            column: 70
          }
        }],
        line: 120
      },
      "11": {
        loc: {
          start: {
            line: 136,
            column: 8
          },
          end: {
            line: 143,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 136,
            column: 8
          },
          end: {
            line: 143,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 136
      },
      "12": {
        loc: {
          start: {
            line: 145,
            column: 8
          },
          end: {
            line: 164,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 145,
            column: 8
          },
          end: {
            line: 164,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 145
      },
      "13": {
        loc: {
          start: {
            line: 155,
            column: 12
          },
          end: {
            line: 163,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 155,
            column: 12
          },
          end: {
            line: 163,
            column: 13
          }
        }, {
          start: {
            line: 161,
            column: 19
          },
          end: {
            line: 163,
            column: 13
          }
        }],
        line: 155
      },
      "14": {
        loc: {
          start: {
            line: 168,
            column: 8
          },
          end: {
            line: 180,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 168,
            column: 8
          },
          end: {
            line: 180,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 168
      },
      "15": {
        loc: {
          start: {
            line: 192,
            column: 33
          },
          end: {
            line: 192,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 192,
            column: 33
          },
          end: {
            line: 192,
            column: 57
          }
        }, {
          start: {
            line: 192,
            column: 61
          },
          end: {
            line: 192,
            column: 63
          }
        }],
        line: 192
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0,
      "55": 0,
      "56": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0],
      "7": [0, 0],
      "8": [0, 0, 0],
      "9": [0, 0],
      "10": [0, 0],
      "11": [0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0],
      "15": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/sachin/Documents/md-sports-/src/app/api/users/route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { requirePermission } from '@/lib/utils/middleware';\nimport { permissionService } from '@/lib/services/PermissionService';\nimport bcrypt from 'bcryptjs';\nimport { randomUUID } from 'crypto';\nimport { z } from 'zod';\n\n// GET: List all users\nexport async function GET(req: NextRequest) {\n    // Check for 'user:manage' permission\n    const permissionError = await requirePermission('user:manage')(req);\n    if (permissionError) {\n        return permissionError;\n    }\n\n    try {\n        const users = await prisma.user.findMany({\n            select: {\n                id: true,\n                name: true,\n                email: true,\n                phone: true,\n                isActive: true,\n                roleId: true,\n                shopId: true,\n                roleName: true,\n                permissions: true,\n                allowedAccounts: true,\n                createdAt: true,\n                updatedAt: true,\n                role: {\n                    select: {\n                        id: true,\n                        name: true\n                    }\n                },\n                shop: {\n                    select: {\n                        id: true,\n                        name: true\n                    }\n                }\n            }\n        });\n\n        return NextResponse.json({\n            success: true,\n            users\n        });\n    } catch (error) {\n        console.error('Error fetching users:', error);\n        return NextResponse.json(\n            { success: false, message: 'Failed to fetch users' },\n            { status: 500 }\n        );\n    }\n}\n\n// POST: Create a new user\nexport async function POST(req: NextRequest) {\n    // Temporarily bypass permission check for adding users\n    // const permissionError = await requirePermission('user:manage')(req);\n    // if (permissionError) {\n    //     return permissionError;\n    // }\n\n    try {\n        const userData = await req.json();\n\n        console.log('Received user data:', userData); // Log the incoming data\n\n        // Validation examples\n        if (!userData.name) {\n            return NextResponse.json(\n                { success: false, message: 'Name is required' },\n                { status: 400 }\n            );\n        }\n\n        if (!userData.email) {\n            return NextResponse.json(\n                { success: false, message: 'Email is required' },\n                { status: 400 }\n            );\n        }\n\n        if (!userData.password || userData.password.length < 8) {\n            return NextResponse.json(\n                { success: false, message: 'Password must be at least 8 characters' },\n                { status: 400 }\n            );\n        }\n\n        if (!userData.shop || userData.shop === '' || userData.shop === 'undefined') {\n            return NextResponse.json(\n                { success: false, message: 'Shop assignment is required' },\n                { status: 400 }\n            );\n        }\n\n        if (!userData.permissions || userData.permissions.length === 0) {\n            return NextResponse.json(\n                { success: false, message: 'At least one permission is required' },\n                { status: 400 }\n            );\n        }\n\n        // Validate shop ID (keep as string since it's a cuid)\n        const shopId = userData.shop;\n        \n        // Verify the shop exists in the database\n        const shopExists = await prisma.shop.findUnique({\n            where: { id: shopId }\n        });\n        \n        if (!shopExists) {\n            return NextResponse.json(\n                { success: false, message: 'Invalid shop ID provided - shop does not exist' },\n                { status: 400 }\n            );\n        }\n\n        // If a role template is selected, find its permissions\n        if (userData.roleTemplate) {\n            console.log(`Role template \"${userData.roleTemplate}\" selected. Fetching permissions...`);\n\n            const roleWithPermissions = await prisma.role.findUnique({\n                where: { name: userData.roleTemplate },\n                include: { permissions: true }\n            });\n\n            if (roleWithPermissions) {\n                const permissionNames = roleWithPermissions.permissions.map((p: { name: string }) => p.name);\n                console.log(`Permissions for role \"${userData.roleTemplate}\":`, permissionNames);\n                userData.permissions = permissionNames;\n                userData.roleId = roleWithPermissions.id;\n                userData.roleName = roleWithPermissions.name;\n            } else {\n                console.warn(`Role \"${userData.roleTemplate}\" not found in the database.`);\n            }\n        }\n        \n        const hashedPassword = await bcrypt.hash(userData.password, 10);\n\n        // Ensure shop:assigned_only permission exists if needed\n        let shopAssignedPermissionId: string | null = null;\n        if (userData.permissions.includes('shop:assigned_only')) {\n            const permission = await prisma.permission.upsert({\n                where: { name: 'shop:assigned_only' },\n                update: {},\n                create: {\n                    name: 'shop:assigned_only',\n                    description: 'Restricts user access to only their assigned shop',\n                },\n            });\n            shopAssignedPermissionId = permission.id.toString();\n        }\n\n                        // Prepare user data\n        const newUser = await prisma.user.create({\n            data: {\n                id: randomUUID(),\n                name: userData.name,\n                email: userData.email,\n                password: hashedPassword,\n                roleId: userData.roleId,\n                roleName: userData.roleName, // Add this line\n                shopId: shopId,\n                permissions: userData.permissions,\n                allowedAccounts: userData.allowedAccounts || [],\n                isActive: true\n            },\n        });\n\n        return NextResponse.json({\n            success: true,\n            message: 'User created successfully',\n            data: newUser\n        });\n    } catch (error) {\n        console.error('Error creating user:', error);\n        return NextResponse.json(\n            { success: false, message: 'Failed to create user' },\n            { status: 500 }\n        );\n    }\n}"],
      names: ["GET", "POST", "req", "permissionError", "requirePermission", "users", "prisma", "user", "findMany", "select", "id", "name", "email", "phone", "isActive", "roleId", "shopId", "roleName", "permissions", "allowedAccounts", "createdAt", "updatedAt", "role", "shop", "NextResponse", "json", "success", "error", "console", "message", "status", "userData", "log", "password", "length", "shopExists", "findUnique", "where", "roleTemplate", "roleWithPermissions", "include", "permissionNames", "map", "p", "warn", "hashedPassword", "bcrypt", "hash", "shopAssignedPermissionId", "includes", "permission", "upsert", "update", "create", "description", "toString", "newUser", "data", "randomUUID"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "219132d5b00ca0a816259aa98732b88185976bdf"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_vn4mgc0gq = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_vn4mgc0gq();
cov_vn4mgc0gq().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_vn4mgc0gq().f[0]++;
  cov_vn4mgc0gq().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: all[name]
    });
  }
}
/* istanbul ignore next */
cov_vn4mgc0gq().s[3]++;
_export(exports, {
  GET: function () {
    /* istanbul ignore next */
    cov_vn4mgc0gq().f[1]++;
    cov_vn4mgc0gq().s[4]++;
    return GET;
  },
  POST: function () {
    /* istanbul ignore next */
    cov_vn4mgc0gq().f[2]++;
    cov_vn4mgc0gq().s[5]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_vn4mgc0gq().s[6]++, require("next/server"));
const _prisma =
/* istanbul ignore next */
(/*#__PURE__*/cov_vn4mgc0gq().s[7]++, _interop_require_default(require("../../../lib/prisma")));
const _middleware =
/* istanbul ignore next */
(cov_vn4mgc0gq().s[8]++, require("../../../lib/utils/middleware"));
const _bcryptjs =
/* istanbul ignore next */
(/*#__PURE__*/cov_vn4mgc0gq().s[9]++, _interop_require_default(require("bcryptjs")));
const _crypto =
/* istanbul ignore next */
(cov_vn4mgc0gq().s[10]++, require("crypto"));
function _interop_require_default(obj) {
  /* istanbul ignore next */
  cov_vn4mgc0gq().f[3]++;
  cov_vn4mgc0gq().s[11]++;
  return /* istanbul ignore next */(cov_vn4mgc0gq().b[1][0]++, obj) &&
  /* istanbul ignore next */
  (cov_vn4mgc0gq().b[1][1]++, obj.__esModule) ?
  /* istanbul ignore next */
  (cov_vn4mgc0gq().b[0][0]++, obj) :
  /* istanbul ignore next */
  (cov_vn4mgc0gq().b[0][1]++, {
    default: obj
  });
}
async function GET(req) {
  /* istanbul ignore next */
  cov_vn4mgc0gq().f[4]++;
  // Check for 'user:manage' permission
  const permissionError =
  /* istanbul ignore next */
  (cov_vn4mgc0gq().s[12]++, await (0, _middleware.requirePermission)("user:manage")(req));
  /* istanbul ignore next */
  cov_vn4mgc0gq().s[13]++;
  if (permissionError) {
    /* istanbul ignore next */
    cov_vn4mgc0gq().b[2][0]++;
    cov_vn4mgc0gq().s[14]++;
    return permissionError;
  } else
  /* istanbul ignore next */
  {
    cov_vn4mgc0gq().b[2][1]++;
  }
  cov_vn4mgc0gq().s[15]++;
  try {
    const users =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[16]++, await _prisma.default.user.findMany({
      select: {
        id: true,
        name: true,
        email: true,
        phone: true,
        isActive: true,
        roleId: true,
        shopId: true,
        roleName: true,
        permissions: true,
        allowedAccounts: true,
        createdAt: true,
        updatedAt: true,
        role: {
          select: {
            id: true,
            name: true
          }
        },
        shop: {
          select: {
            id: true,
            name: true
          }
        }
      }
    }));
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[17]++;
    return _server.NextResponse.json({
      success: true,
      users
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[18]++;
    console.error("Error fetching users:", error);
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[19]++;
    return _server.NextResponse.json({
      success: false,
      message: "Failed to fetch users"
    }, {
      status: 500
    });
  }
}
async function POST(req) {
  /* istanbul ignore next */
  cov_vn4mgc0gq().f[5]++;
  cov_vn4mgc0gq().s[20]++;
  // Temporarily bypass permission check for adding users
  // const permissionError = await requirePermission('user:manage')(req);
  // if (permissionError) {
  //     return permissionError;
  // }
  try {
    const userData =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[21]++, await req.json());
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[22]++;
    console.log("Received user data:", userData); // Log the incoming data
    // Validation examples
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[23]++;
    if (!userData.name) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[3][0]++;
      cov_vn4mgc0gq().s[24]++;
      return _server.NextResponse.json({
        success: false,
        message: "Name is required"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[3][1]++;
    }
    cov_vn4mgc0gq().s[25]++;
    if (!userData.email) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[4][0]++;
      cov_vn4mgc0gq().s[26]++;
      return _server.NextResponse.json({
        success: false,
        message: "Email is required"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[4][1]++;
    }
    cov_vn4mgc0gq().s[27]++;
    if (
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[6][0]++, !userData.password) ||
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[6][1]++, userData.password.length < 8)) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[5][0]++;
      cov_vn4mgc0gq().s[28]++;
      return _server.NextResponse.json({
        success: false,
        message: "Password must be at least 8 characters"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[5][1]++;
    }
    cov_vn4mgc0gq().s[29]++;
    if (
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[8][0]++, !userData.shop) ||
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[8][1]++, userData.shop === "") ||
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[8][2]++, userData.shop === "undefined")) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[7][0]++;
      cov_vn4mgc0gq().s[30]++;
      return _server.NextResponse.json({
        success: false,
        message: "Shop assignment is required"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[7][1]++;
    }
    cov_vn4mgc0gq().s[31]++;
    if (
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[10][0]++, !userData.permissions) ||
    /* istanbul ignore next */
    (cov_vn4mgc0gq().b[10][1]++, userData.permissions.length === 0)) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[9][0]++;
      cov_vn4mgc0gq().s[32]++;
      return _server.NextResponse.json({
        success: false,
        message: "At least one permission is required"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[9][1]++;
    }
    // Validate shop ID (keep as string since it's a cuid)
    const shopId =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[33]++, userData.shop);
    // Verify the shop exists in the database
    const shopExists =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[34]++, await _prisma.default.shop.findUnique({
      where: {
        id: shopId
      }
    }));
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[35]++;
    if (!shopExists) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[11][0]++;
      cov_vn4mgc0gq().s[36]++;
      return _server.NextResponse.json({
        success: false,
        message: "Invalid shop ID provided - shop does not exist"
      }, {
        status: 400
      });
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[11][1]++;
    }
    // If a role template is selected, find its permissions
    cov_vn4mgc0gq().s[37]++;
    if (userData.roleTemplate) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[12][0]++;
      cov_vn4mgc0gq().s[38]++;
      console.log(`Role template "${userData.roleTemplate}" selected. Fetching permissions...`);
      const roleWithPermissions =
      /* istanbul ignore next */
      (cov_vn4mgc0gq().s[39]++, await _prisma.default.role.findUnique({
        where: {
          name: userData.roleTemplate
        },
        include: {
          permissions: true
        }
      }));
      /* istanbul ignore next */
      cov_vn4mgc0gq().s[40]++;
      if (roleWithPermissions) {
        /* istanbul ignore next */
        cov_vn4mgc0gq().b[13][0]++;
        const permissionNames =
        /* istanbul ignore next */
        (cov_vn4mgc0gq().s[41]++, roleWithPermissions.permissions.map(p => {
          /* istanbul ignore next */
          cov_vn4mgc0gq().f[6]++;
          cov_vn4mgc0gq().s[42]++;
          return p.name;
        }));
        /* istanbul ignore next */
        cov_vn4mgc0gq().s[43]++;
        console.log(`Permissions for role "${userData.roleTemplate}":`, permissionNames);
        /* istanbul ignore next */
        cov_vn4mgc0gq().s[44]++;
        userData.permissions = permissionNames;
        /* istanbul ignore next */
        cov_vn4mgc0gq().s[45]++;
        userData.roleId = roleWithPermissions.id;
        /* istanbul ignore next */
        cov_vn4mgc0gq().s[46]++;
        userData.roleName = roleWithPermissions.name;
      } else {
        /* istanbul ignore next */
        cov_vn4mgc0gq().b[13][1]++;
        cov_vn4mgc0gq().s[47]++;
        console.warn(`Role "${userData.roleTemplate}" not found in the database.`);
      }
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[12][1]++;
    }
    const hashedPassword =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[48]++, await _bcryptjs.default.hash(userData.password, 10));
    // Ensure shop:assigned_only permission exists if needed
    let shopAssignedPermissionId =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[49]++, null);
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[50]++;
    if (userData.permissions.includes("shop:assigned_only")) {
      /* istanbul ignore next */
      cov_vn4mgc0gq().b[14][0]++;
      const permission =
      /* istanbul ignore next */
      (cov_vn4mgc0gq().s[51]++, await _prisma.default.permission.upsert({
        where: {
          name: "shop:assigned_only"
        },
        update: {},
        create: {
          name: "shop:assigned_only",
          description: "Restricts user access to only their assigned shop"
        }
      }));
      /* istanbul ignore next */
      cov_vn4mgc0gq().s[52]++;
      shopAssignedPermissionId = permission.id.toString();
    } else
    /* istanbul ignore next */
    {
      cov_vn4mgc0gq().b[14][1]++;
    }
    // Prepare user data
    const newUser =
    /* istanbul ignore next */
    (cov_vn4mgc0gq().s[53]++, await _prisma.default.user.create({
      data: {
        id: (0, _crypto.randomUUID)(),
        name: userData.name,
        email: userData.email,
        password: hashedPassword,
        roleId: userData.roleId,
        roleName: userData.roleName,
        shopId: shopId,
        permissions: userData.permissions,
        allowedAccounts:
        /* istanbul ignore next */
        (cov_vn4mgc0gq().b[15][0]++, userData.allowedAccounts) ||
        /* istanbul ignore next */
        (cov_vn4mgc0gq().b[15][1]++, []),
        isActive: true
      }
    }));
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[54]++;
    return _server.NextResponse.json({
      success: true,
      message: "User created successfully",
      data: newUser
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[55]++;
    console.error("Error creating user:", error);
    /* istanbul ignore next */
    cov_vn4mgc0gq().s[56]++;
    return _server.NextResponse.json({
      success: false,
      message: "Failed to create user"
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJjb3Zfdm40bWdjMGdxIiwiZiIsInMiLCJQT1NUIiwicmVxIiwicGVybWlzc2lvbkVycm9yIiwiX21pZGRsZXdhcmUiLCJyZXF1aXJlUGVybWlzc2lvbiIsImIiLCJ1c2VycyIsIl9wcmlzbWEiLCJkZWZhdWx0IiwidXNlciIsImZpbmRNYW55Iiwic2VsZWN0IiwiaWQiLCJuYW1lIiwiZW1haWwiLCJwaG9uZSIsImlzQWN0aXZlIiwicm9sZUlkIiwic2hvcElkIiwicm9sZU5hbWUiLCJwZXJtaXNzaW9ucyIsImFsbG93ZWRBY2NvdW50cyIsImNyZWF0ZWRBdCIsInVwZGF0ZWRBdCIsInJvbGUiLCJzaG9wIiwiX3NlcnZlciIsIk5leHRSZXNwb25zZSIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsInN0YXR1cyIsInVzZXJEYXRhIiwibG9nIiwicGFzc3dvcmQiLCJsZW5ndGgiLCJzaG9wRXhpc3RzIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwicm9sZVRlbXBsYXRlIiwicm9sZVdpdGhQZXJtaXNzaW9ucyIsImluY2x1ZGUiLCJwZXJtaXNzaW9uTmFtZXMiLCJtYXAiLCJwIiwid2FybiIsImhhc2hlZFBhc3N3b3JkIiwiX2JjcnlwdGpzIiwiaGFzaCIsInNob3BBc3NpZ25lZFBlcm1pc3Npb25JZCIsImluY2x1ZGVzIiwicGVybWlzc2lvbiIsInVwc2VydCIsInVwZGF0ZSIsImNyZWF0ZSIsImRlc2NyaXB0aW9uIiwidG9TdHJpbmciLCJuZXdVc2VyIiwiZGF0YSIsIl9jcnlwdG8iLCJyYW5kb21VVUlEIl0sInNvdXJjZXMiOlsiL1VzZXJzL3NhY2hpbi9Eb2N1bWVudHMvbWQtc3BvcnRzLS9zcmMvYXBwL2FwaS91c2Vycy9yb3V0ZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHByaXNtYSBmcm9tICdAL2xpYi9wcmlzbWEnO1xuaW1wb3J0IHsgcmVxdWlyZVBlcm1pc3Npb24gfSBmcm9tICdAL2xpYi91dGlscy9taWRkbGV3YXJlJztcbmltcG9ydCB7IHBlcm1pc3Npb25TZXJ2aWNlIH0gZnJvbSAnQC9saWIvc2VydmljZXMvUGVybWlzc2lvblNlcnZpY2UnO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgeyByYW5kb21VVUlEIH0gZnJvbSAnY3J5cHRvJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuXG4vLyBHRVQ6IExpc3QgYWxsIHVzZXJzXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgICAvLyBDaGVjayBmb3IgJ3VzZXI6bWFuYWdlJyBwZXJtaXNzaW9uXG4gICAgY29uc3QgcGVybWlzc2lvbkVycm9yID0gYXdhaXQgcmVxdWlyZVBlcm1pc3Npb24oJ3VzZXI6bWFuYWdlJykocmVxKTtcbiAgICBpZiAocGVybWlzc2lvbkVycm9yKSB7XG4gICAgICAgIHJldHVybiBwZXJtaXNzaW9uRXJyb3I7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBob25lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHJvbGVJZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzaG9wSWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcm9sZU5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgcGVybWlzc2lvbnM6IHRydWUsXG4gICAgICAgICAgICAgICAgYWxsb3dlZEFjY291bnRzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgcm9sZToge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzaG9wOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgdXNlcnNcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlcnM6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXJzJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgfVxufVxuXG4vLyBQT1NUOiBDcmVhdGUgYSBuZXcgdXNlclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBOZXh0UmVxdWVzdCkge1xuICAgIC8vIFRlbXBvcmFyaWx5IGJ5cGFzcyBwZXJtaXNzaW9uIGNoZWNrIGZvciBhZGRpbmcgdXNlcnNcbiAgICAvLyBjb25zdCBwZXJtaXNzaW9uRXJyb3IgPSBhd2FpdCByZXF1aXJlUGVybWlzc2lvbigndXNlcjptYW5hZ2UnKShyZXEpO1xuICAgIC8vIGlmIChwZXJtaXNzaW9uRXJyb3IpIHtcbiAgICAvLyAgICAgcmV0dXJuIHBlcm1pc3Npb25FcnJvcjtcbiAgICAvLyB9XG5cbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IHJlcS5qc29uKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ1JlY2VpdmVkIHVzZXIgZGF0YTonLCB1c2VyRGF0YSk7IC8vIExvZyB0aGUgaW5jb21pbmcgZGF0YVxuXG4gICAgICAgIC8vIFZhbGlkYXRpb24gZXhhbXBsZXNcbiAgICAgICAgaWYgKCF1c2VyRGF0YS5uYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ05hbWUgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF1c2VyRGF0YS5lbWFpbCkge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdFbWFpbCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXVzZXJEYXRhLnBhc3N3b3JkIHx8IHVzZXJEYXRhLnBhc3N3b3JkLmxlbmd0aCA8IDgpIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnUGFzc3dvcmQgbXVzdCBiZSBhdCBsZWFzdCA4IGNoYXJhY3RlcnMnIH0sXG4gICAgICAgICAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF1c2VyRGF0YS5zaG9wIHx8IHVzZXJEYXRhLnNob3AgPT09ICcnIHx8IHVzZXJEYXRhLnNob3AgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogJ1Nob3AgYXNzaWdubWVudCBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXVzZXJEYXRhLnBlcm1pc3Npb25zIHx8IHVzZXJEYXRhLnBlcm1pc3Npb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdBdCBsZWFzdCBvbmUgcGVybWlzc2lvbiBpcyByZXF1aXJlZCcgfSxcbiAgICAgICAgICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSBzaG9wIElEIChrZWVwIGFzIHN0cmluZyBzaW5jZSBpdCdzIGEgY3VpZClcbiAgICAgICAgY29uc3Qgc2hvcElkID0gdXNlckRhdGEuc2hvcDtcbiAgICAgICAgXG4gICAgICAgIC8vIFZlcmlmeSB0aGUgc2hvcCBleGlzdHMgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgIGNvbnN0IHNob3BFeGlzdHMgPSBhd2FpdCBwcmlzbWEuc2hvcC5maW5kVW5pcXVlKHtcbiAgICAgICAgICAgIHdoZXJlOiB7IGlkOiBzaG9wSWQgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghc2hvcEV4aXN0cykge1xuICAgICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgICAgICAgIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdJbnZhbGlkIHNob3AgSUQgcHJvdmlkZWQgLSBzaG9wIGRvZXMgbm90IGV4aXN0JyB9LFxuICAgICAgICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGEgcm9sZSB0ZW1wbGF0ZSBpcyBzZWxlY3RlZCwgZmluZCBpdHMgcGVybWlzc2lvbnNcbiAgICAgICAgaWYgKHVzZXJEYXRhLnJvbGVUZW1wbGF0ZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFJvbGUgdGVtcGxhdGUgXCIke3VzZXJEYXRhLnJvbGVUZW1wbGF0ZX1cIiBzZWxlY3RlZC4gRmV0Y2hpbmcgcGVybWlzc2lvbnMuLi5gKTtcblxuICAgICAgICAgICAgY29uc3Qgcm9sZVdpdGhQZXJtaXNzaW9ucyA9IGF3YWl0IHByaXNtYS5yb2xlLmZpbmRVbmlxdWUoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IG5hbWU6IHVzZXJEYXRhLnJvbGVUZW1wbGF0ZSB9LFxuICAgICAgICAgICAgICAgIGluY2x1ZGU6IHsgcGVybWlzc2lvbnM6IHRydWUgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChyb2xlV2l0aFBlcm1pc3Npb25zKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGVybWlzc2lvbk5hbWVzID0gcm9sZVdpdGhQZXJtaXNzaW9ucy5wZXJtaXNzaW9ucy5tYXAoKHA6IHsgbmFtZTogc3RyaW5nIH0pID0+IHAubmFtZSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFBlcm1pc3Npb25zIGZvciByb2xlIFwiJHt1c2VyRGF0YS5yb2xlVGVtcGxhdGV9XCI6YCwgcGVybWlzc2lvbk5hbWVzKTtcbiAgICAgICAgICAgICAgICB1c2VyRGF0YS5wZXJtaXNzaW9ucyA9IHBlcm1pc3Npb25OYW1lcztcbiAgICAgICAgICAgICAgICB1c2VyRGF0YS5yb2xlSWQgPSByb2xlV2l0aFBlcm1pc3Npb25zLmlkO1xuICAgICAgICAgICAgICAgIHVzZXJEYXRhLnJvbGVOYW1lID0gcm9sZVdpdGhQZXJtaXNzaW9ucy5uYW1lO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFJvbGUgXCIke3VzZXJEYXRhLnJvbGVUZW1wbGF0ZX1cIiBub3QgZm91bmQgaW4gdGhlIGRhdGFiYXNlLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHVzZXJEYXRhLnBhc3N3b3JkLCAxMCk7XG5cbiAgICAgICAgLy8gRW5zdXJlIHNob3A6YXNzaWduZWRfb25seSBwZXJtaXNzaW9uIGV4aXN0cyBpZiBuZWVkZWRcbiAgICAgICAgbGV0IHNob3BBc3NpZ25lZFBlcm1pc3Npb25JZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICAgIGlmICh1c2VyRGF0YS5wZXJtaXNzaW9ucy5pbmNsdWRlcygnc2hvcDphc3NpZ25lZF9vbmx5JykpIHtcbiAgICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBwcmlzbWEucGVybWlzc2lvbi51cHNlcnQoe1xuICAgICAgICAgICAgICAgIHdoZXJlOiB7IG5hbWU6ICdzaG9wOmFzc2lnbmVkX29ubHknIH0sXG4gICAgICAgICAgICAgICAgdXBkYXRlOiB7fSxcbiAgICAgICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3Nob3A6YXNzaWduZWRfb25seScsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUmVzdHJpY3RzIHVzZXIgYWNjZXNzIHRvIG9ubHkgdGhlaXIgYXNzaWduZWQgc2hvcCcsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2hvcEFzc2lnbmVkUGVybWlzc2lvbklkID0gcGVybWlzc2lvbi5pZC50b1N0cmluZygpO1xuICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXBhcmUgdXNlciBkYXRhXG4gICAgICAgIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGlkOiByYW5kb21VVUlEKCksXG4gICAgICAgICAgICAgICAgbmFtZTogdXNlckRhdGEubmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIHJvbGVJZDogdXNlckRhdGEucm9sZUlkLFxuICAgICAgICAgICAgICAgIHJvbGVOYW1lOiB1c2VyRGF0YS5yb2xlTmFtZSwgLy8gQWRkIHRoaXMgbGluZVxuICAgICAgICAgICAgICAgIHNob3BJZDogc2hvcElkLFxuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25zOiB1c2VyRGF0YS5wZXJtaXNzaW9ucyxcbiAgICAgICAgICAgICAgICBhbGxvd2VkQWNjb3VudHM6IHVzZXJEYXRhLmFsbG93ZWRBY2NvdW50cyB8fCBbXSxcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBtZXNzYWdlOiAnVXNlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgICBkYXRhOiBuZXdVc2VyXG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHVzZXI6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSB1c2VyJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7RUFTc0JBLEdBQUcsV0FBQUEsQ0FBQTtJQUFBO0lBQUFDLGFBQUEsR0FBQUMsQ0FBQTtJQUFBRCxhQUFBLEdBQUFFLENBQUE7V0FBSEgsR0FBQTs7RUFtREFJLElBQUksV0FBQUEsQ0FBQTtJQUFBO0lBQUFILGFBQUEsR0FBQUMsQ0FBQTtJQUFBRCxhQUFBLEdBQUFFLENBQUE7V0FBSkMsSUFBQTs7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