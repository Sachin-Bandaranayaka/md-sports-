030342bd2331c7728037c227c216b531
"use strict";

/* istanbul ignore next */
function cov_20xu9akzyb() {
  var path = "/Users/sachin/Documents/md-sports-/src/app/api/dashboard/shop-wise/route.ts";
  var hash = "475dbc711da2c4d9dfc96d9e372735dd1573db91";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/sachin/Documents/md-sports-/src/app/api/dashboard/shop-wise/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 5,
          column: 0
        },
        end: {
          line: 10,
          column: 3
        }
      },
      "2": {
        start: {
          line: 8,
          column: 8
        },
        end: {
          line: 8,
          column: 19
        }
      },
      "3": {
        start: {
          line: 11,
          column: 16
        },
        end: {
          line: 11,
          column: 38
        }
      },
      "4": {
        start: {
          line: 12,
          column: 16
        },
        end: {
          line: 12,
          column: 49
        }
      },
      "5": {
        start: {
          line: 13,
          column: 14
        },
        end: {
          line: 13,
          column: 45
        }
      },
      "6": {
        start: {
          line: 15,
          column: 4
        },
        end: {
          line: 193,
          column: 5
        }
      },
      "7": {
        start: {
          line: 17,
          column: 27
        },
        end: {
          line: 17,
          column: 94
        }
      },
      "8": {
        start: {
          line: 18,
          column: 8
        },
        end: {
          line: 24,
          column: 9
        }
      },
      "9": {
        start: {
          line: 19,
          column: 12
        },
        end: {
          line: 23,
          column: 15
        }
      },
      "10": {
        start: {
          line: 26,
          column: 33
        },
        end: {
          line: 26,
          column: 53
        }
      },
      "11": {
        start: {
          line: 27,
          column: 31
        },
        end: {
          line: 27,
          column: 60
        }
      },
      "12": {
        start: {
          line: 28,
          column: 29
        },
        end: {
          line: 28,
          column: 56
        }
      },
      "13": {
        start: {
          line: 30,
          column: 24
        },
        end: {
          line: 30,
          column: 74
        }
      },
      "14": {
        start: {
          line: 31,
          column: 26
        },
        end: {
          line: 35,
          column: 12
        }
      },
      "15": {
        start: {
          line: 32,
          column: 25
        },
        end: {
          line: 32,
          column: 35
        }
      },
      "16": {
        start: {
          line: 33,
          column: 12
        },
        end: {
          line: 33,
          column: 46
        }
      },
      "17": {
        start: {
          line: 34,
          column: 12
        },
        end: {
          line: 34,
          column: 24
        }
      },
      "18": {
        start: {
          line: 36,
          column: 8
        },
        end: {
          line: 39,
          column: 11
        }
      },
      "19": {
        start: {
          line: 41,
          column: 22
        },
        end: {
          line: 49,
          column: 44
        }
      },
      "20": {
        start: {
          line: 41,
          column: 55
        },
        end: {
          line: 49,
          column: 14
        }
      },
      "21": {
        start: {
          line: 50,
          column: 8
        },
        end: {
          line: 56,
          column: 9
        }
      },
      "22": {
        start: {
          line: 51,
          column: 12
        },
        end: {
          line: 55,
          column: 15
        }
      },
      "23": {
        start: {
          line: 58,
          column: 28
        },
        end: {
          line: 154,
          column: 11
        }
      },
      "24": {
        start: {
          line: 60,
          column: 40
        },
        end: {
          line: 71,
          column: 72
        }
      },
      "25": {
        start: {
          line: 60,
          column: 73
        },
        end: {
          line: 67,
          column: 21
        }
      },
      "26": {
        start: {
          line: 72,
          column: 39
        },
        end: {
          line: 72,
          column: 194
        }
      },
      "27": {
        start: {
          line: 74,
          column: 33
        },
        end: {
          line: 92,
          column: 64
        }
      },
      "28": {
        start: {
          line: 74,
          column: 66
        },
        end: {
          line: 88,
          column: 18
        }
      },
      "29": {
        start: {
          line: 93,
          column: 32
        },
        end: {
          line: 93,
          column: 66
        }
      },
      "30": {
        start: {
          line: 95,
          column: 38
        },
        end: {
          line: 113,
          column: 78
        }
      },
      "31": {
        start: {
          line: 95,
          column: 71
        },
        end: {
          line: 109,
          column: 18
        }
      },
      "32": {
        start: {
          line: 114,
          column: 40
        },
        end: {
          line: 114,
          column: 73
        }
      },
      "33": {
        start: {
          line: 116,
          column: 32
        },
        end: {
          line: 134,
          column: 63
        }
      },
      "34": {
        start: {
          line: 116,
          column: 65
        },
        end: {
          line: 130,
          column: 18
        }
      },
      "35": {
        start: {
          line: 135,
          column: 31
        },
        end: {
          line: 135,
          column: 58
        }
      },
      "36": {
        start: {
          line: 137,
          column: 34
        },
        end: {
          line: 144,
          column: 77
        }
      },
      "37": {
        start: {
          line: 137,
          column: 67
        },
        end: {
          line: 144,
          column: 18
        }
      },
      "38": {
        start: {
          line: 145,
          column: 12
        },
        end: {
          line: 153,
          column: 14
        }
      },
      "39": {
        start: {
          line: 156,
          column: 23
        },
        end: {
          line: 168,
          column: 10
        }
      },
      "40": {
        start: {
          line: 156,
          column: 56
        },
        end: {
          line: 162,
          column: 13
        }
      },
      "41": {
        start: {
          line: 169,
          column: 8
        },
        end: {
          line: 183,
          column: 11
        }
      },
      "42": {
        start: {
          line: 185,
          column: 8
        },
        end: {
          line: 185,
          column: 76
        }
      },
      "43": {
        start: {
          line: 186,
          column: 8
        },
        end: {
          line: 192,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 7,
            column: 9
          },
          end: {
            line: 7,
            column: 10
          }
        },
        loc: {
          start: {
            line: 7,
            column: 20
          },
          end: {
            line: 9,
            column: 5
          }
        },
        line: 7
      },
      "1": {
        name: "GET",
        decl: {
          start: {
            line: 14,
            column: 15
          },
          end: {
            line: 14,
            column: 18
          }
        },
        loc: {
          start: {
            line: 14,
            column: 28
          },
          end: {
            line: 194,
            column: 1
          }
        },
        line: 14
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 31,
            column: 71
          },
          end: {
            line: 31,
            column: 72
          }
        },
        loc: {
          start: {
            line: 31,
            column: 75
          },
          end: {
            line: 35,
            column: 9
          }
        },
        line: 31
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 41,
            column: 51
          },
          end: {
            line: 41,
            column: 52
          }
        },
        loc: {
          start: {
            line: 41,
            column: 55
          },
          end: {
            line: 49,
            column: 14
          }
        },
        line: 41
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 58,
            column: 56
          },
          end: {
            line: 58,
            column: 57
          }
        },
        loc: {
          start: {
            line: 58,
            column: 70
          },
          end: {
            line: 154,
            column: 9
          }
        },
        line: 58
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 60,
            column: 69
          },
          end: {
            line: 60,
            column: 70
          }
        },
        loc: {
          start: {
            line: 60,
            column: 73
          },
          end: {
            line: 67,
            column: 21
          }
        },
        line: 60
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 74,
            column: 62
          },
          end: {
            line: 74,
            column: 63
          }
        },
        loc: {
          start: {
            line: 74,
            column: 66
          },
          end: {
            line: 88,
            column: 18
          }
        },
        line: 74
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 95,
            column: 67
          },
          end: {
            line: 95,
            column: 68
          }
        },
        loc: {
          start: {
            line: 95,
            column: 71
          },
          end: {
            line: 109,
            column: 18
          }
        },
        line: 95
      },
      "8": {
        name: "(anonymous_8)",
        decl: {
          start: {
            line: 116,
            column: 61
          },
          end: {
            line: 116,
            column: 62
          }
        },
        loc: {
          start: {
            line: 116,
            column: 65
          },
          end: {
            line: 130,
            column: 18
          }
        },
        line: 116
      },
      "9": {
        name: "(anonymous_9)",
        decl: {
          start: {
            line: 137,
            column: 63
          },
          end: {
            line: 137,
            column: 64
          }
        },
        loc: {
          start: {
            line: 137,
            column: 67
          },
          end: {
            line: 144,
            column: 18
          }
        },
        line: 137
      },
      "10": {
        name: "(anonymous_10)",
        decl: {
          start: {
            line: 156,
            column: 42
          },
          end: {
            line: 156,
            column: 43
          }
        },
        loc: {
          start: {
            line: 156,
            column: 56
          },
          end: {
            line: 162,
            column: 13
          }
        },
        line: 156
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 18,
            column: 8
          },
          end: {
            line: 24,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 18,
            column: 8
          },
          end: {
            line: 24,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 18
      },
      "1": {
        loc: {
          start: {
            line: 30,
            column: 24
          },
          end: {
            line: 30,
            column: 74
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 30,
            column: 39
          },
          end: {
            line: 30,
            column: 61
          }
        }, {
          start: {
            line: 30,
            column: 64
          },
          end: {
            line: 30,
            column: 74
          }
        }],
        line: 30
      },
      "2": {
        loc: {
          start: {
            line: 31,
            column: 26
          },
          end: {
            line: 35,
            column: 12
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 31,
            column: 43
          },
          end: {
            line: 31,
            column: 67
          }
        }, {
          start: {
            line: 31,
            column: 70
          },
          end: {
            line: 35,
            column: 12
          }
        }],
        line: 31
      },
      "3": {
        loc: {
          start: {
            line: 50,
            column: 8
          },
          end: {
            line: 56,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 50,
            column: 8
          },
          end: {
            line: 56,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 50
      },
      "4": {
        loc: {
          start: {
            line: 50,
            column: 12
          },
          end: {
            line: 50,
            column: 40
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 50,
            column: 12
          },
          end: {
            line: 50,
            column: 18
          }
        }, {
          start: {
            line: 50,
            column: 22
          },
          end: {
            line: 50,
            column: 40
          }
        }],
        line: 50
      },
      "5": {
        loc: {
          start: {
            line: 72,
            column: 39
          },
          end: {
            line: 72,
            column: 194
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 72,
            column: 141
          },
          end: {
            line: 72,
            column: 190
          }
        }, {
          start: {
            line: 72,
            column: 193
          },
          end: {
            line: 72,
            column: 194
          }
        }],
        line: 72
      },
      "6": {
        loc: {
          start: {
            line: 72,
            column: 39
          },
          end: {
            line: 72,
            column: 138
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 72,
            column: 39
          },
          end: {
            line: 72,
            column: 58
          }
        }, {
          start: {
            line: 72,
            column: 62
          },
          end: {
            line: 72,
            column: 84
          }
        }, {
          start: {
            line: 72,
            column: 88
          },
          end: {
            line: 72,
            column: 138
          }
        }],
        line: 72
      },
      "7": {
        loc: {
          start: {
            line: 93,
            column: 32
          },
          end: {
            line: 93,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 93,
            column: 32
          },
          end: {
            line: 93,
            column: 61
          }
        }, {
          start: {
            line: 93,
            column: 65
          },
          end: {
            line: 93,
            column: 66
          }
        }],
        line: 93
      },
      "8": {
        loc: {
          start: {
            line: 114,
            column: 40
          },
          end: {
            line: 114,
            column: 73
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 114,
            column: 40
          },
          end: {
            line: 114,
            column: 68
          }
        }, {
          start: {
            line: 114,
            column: 72
          },
          end: {
            line: 114,
            column: 73
          }
        }],
        line: 114
      },
      "9": {
        loc: {
          start: {
            line: 135,
            column: 31
          },
          end: {
            line: 135,
            column: 58
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 135,
            column: 31
          },
          end: {
            line: 135,
            column: 53
          }
        }, {
          start: {
            line: 135,
            column: 57
          },
          end: {
            line: 135,
            column: 58
          }
        }],
        line: 135
      },
      "10": {
        loc: {
          start: {
            line: 189,
            column: 21
          },
          end: {
            line: 189,
            column: 77
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 189,
            column: 46
          },
          end: {
            line: 189,
            column: 59
          }
        }, {
          start: {
            line: 189,
            column: 62
          },
          end: {
            line: 189,
            column: 77
          }
        }],
        line: 189
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0],
      "10": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/sachin/Documents/md-sports-/src/app/api/dashboard/shop-wise/route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server';\nimport { prisma, safeQuery } from '@/lib/prisma';\nimport { validateTokenPermission } from '@/lib/auth';\n\n// Interface for shop-wise metrics\ninterface ShopWiseMetrics {\n    shopId: string;\n    shopName: string;\n    totalInventoryCost: number;\n    totalProfit: number;\n    totalSales: number;\n    outstandingInvoices: number;\n    lowStockItems: number;\n}\n\nexport async function GET(request: NextRequest) {\n    try {\n        // Validate token and permissions\n        const authResult = await validateTokenPermission(request, 'view_dashboard');\n        if (!authResult.isValid) {\n            return NextResponse.json({ error: authResult.message }, { status: 401 });\n        }\n\n        // Extract date range from query parameters\n        const { searchParams } = new URL(request.url);\n        const startDateParam = searchParams.get('startDate');\n        const endDateParam = searchParams.get('endDate');\n        \n        // Default to current month if no dates provided\n        const endDate = endDateParam ? new Date(endDateParam) : new Date();\n        const startDate = startDateParam ? new Date(startDateParam) : (() => {\n            const date = new Date();\n            date.setDate(date.getDate() - 30); // Default to last 30 days\n            return date;\n        })();\n\n        console.log('Fetching shop-wise metrics for date range:', { startDate, endDate });\n\n        // 1. Get all active shops\n        const shops = await safeQuery(\n            () => prisma.shop.findMany({\n                where: { is_active: true },\n                select: {\n                    id: true,\n                    name: true\n                }\n            }),\n            [],\n            'Failed to fetch shops'\n        );\n\n        if (!shops || shops.length === 0) {\n            return NextResponse.json({\n                success: true,\n                data: [],\n                message: 'No active shops found'\n            });\n        }\n\n        // 2. Calculate metrics for each shop\n        const shopMetrics: ShopWiseMetrics[] = await Promise.all(\n            shops.map(async (shop) => {\n                // Calculate total inventory cost for this shop using shop-specific cost\n                const inventoryCostResult = await safeQuery<Array<{ totalinventorycost: bigint | number | null }>>(\n                    () => prisma.$queryRaw`\n                        SELECT SUM(COALESCE(i.shopspecificcost, 0) * i.quantity) as \"totalinventorycost\"\n                        FROM \"InventoryItem\" i\n                        WHERE i.quantity > 0 \n                        AND i.shopspecificcost IS NOT NULL \n                        AND i.shopspecificcost > 0\n                        AND i.\"shopId\" = ${shop.id}\n                    `,\n                    [{ totalinventorycost: 0 }],\n                    `Failed to calculate inventory cost for shop ${shop.id}`\n                );\n\n                const totalInventoryCost = inventoryCostResult && inventoryCostResult[0] && inventoryCostResult[0].totalinventorycost !== null\n                    ? Number(inventoryCostResult[0].totalinventorycost)\n                    : 0;\n\n                // Calculate total profit for this shop (from invoices in the date range)\n                const profitResult = await safeQuery(\n                    () => prisma.invoice.aggregate({\n                        where: {\n                            shopId: shop.id,\n                            status: { not: 'Cancelled' },\n                            invoiceDate: {\n                                gte: startDate,\n                                lte: endDate\n                            }\n                        },\n                        _sum: {\n                            totalProfit: true\n                        }\n                    }),\n                    { _sum: { totalProfit: null } },\n                    `Failed to calculate profit for shop ${shop.id}`\n                );\n\n                const totalProfit = profitResult._sum.totalProfit || 0;\n\n                // Calculate outstanding invoices for this shop\n                const outstandingResult = await safeQuery(\n                    () => prisma.invoice.aggregate({\n                        where: {\n                            shopId: shop.id,\n                            status: { notIn: ['paid', 'cancelled', 'void'] }\n                        },\n                        _sum: {\n                            total: true\n                        }\n                    }),\n                    { _sum: { total: null } },\n                    `Failed to calculate outstanding invoices for shop ${shop.id}`\n                );\n\n                const outstandingInvoices = outstandingResult._sum.total || 0;\n\n                // Calculate total sales for this shop (from invoices in the date range)\n                const salesResult = await safeQuery(\n                    () => prisma.invoice.aggregate({\n                        where: {\n                            shopId: shop.id,\n                            status: { not: 'Cancelled' },\n                            invoiceDate: {\n                                gte: startDate,\n                                lte: endDate\n                            }\n                        },\n                        _sum: {\n                            total: true\n                        }\n                    }),\n                    { _sum: { total: null } },\n                    `Failed to calculate sales for shop ${shop.id}`\n                );\n\n                const totalSales = salesResult._sum.total || 0;\n\n                // Count low stock items for this shop (quantity <= 10)\n                const lowStockCount = await safeQuery(\n                    () => prisma.inventoryItem.count({\n                        where: {\n                            shopId: shop.id,\n                            quantity: { lte: 10 }\n                        }\n                    }),\n                    0,\n                    `Failed to count low stock items for shop ${shop.id}`\n                );\n\n                return {\n                    shopId: shop.id,\n                    shopName: shop.name,\n                    totalInventoryCost,\n                    totalProfit,\n                    totalSales,\n                    outstandingInvoices,\n                    lowStockItems: lowStockCount\n                };\n            })\n        );\n\n        // 3. Calculate totals across all shops\n        const totals = shopMetrics.reduce(\n            (acc, shop) => ({\n                totalInventoryCost: acc.totalInventoryCost + shop.totalInventoryCost,\n                totalProfit: acc.totalProfit + shop.totalProfit,\n                totalSales: acc.totalSales + shop.totalSales,\n                outstandingInvoices: acc.outstandingInvoices + shop.outstandingInvoices,\n                lowStockItems: acc.lowStockItems + shop.lowStockItems\n            }),\n            {\n                totalInventoryCost: 0,\n                totalProfit: 0,\n                totalSales: 0,\n                outstandingInvoices: 0,\n                lowStockItems: 0\n            }\n        );\n\n        return NextResponse.json({\n            success: true,\n            data: {\n                shopMetrics,\n                totals,\n                dateRange: {\n                    startDate: startDate.toISOString(),\n                    endDate: endDate.toISOString()\n                }\n            },\n            meta: {\n                shopsCount: shops.length,\n                generatedAt: new Date().toISOString()\n            }\n        });\n\n    } catch (error) {\n        console.error('Error fetching shop-wise dashboard metrics:', error);\n        return NextResponse.json(\n            {\n                success: false,\n                error: 'Failed to fetch shop-wise dashboard metrics',\n                details: error instanceof Error ? error.message : 'Unknown error'\n            },\n            { status: 500 }\n        );\n    }\n}"],
      names: ["GET", "request", "authResult", "validateTokenPermission", "isValid", "NextResponse", "json", "error", "message", "status", "searchParams", "URL", "url", "startDateParam", "get", "endDateParam", "endDate", "Date", "startDate", "date", "setDate", "getDate", "console", "log", "shops", "safeQuery", "prisma", "shop", "findMany", "where", "is_active", "select", "id", "name", "length", "success", "data", "shopMetrics", "Promise", "all", "map", "inventoryCostResult", "$queryRaw", "totalinventorycost", "totalInventoryCost", "Number", "profitResult", "invoice", "aggregate", "shopId", "not", "invoiceDate", "gte", "lte", "_sum", "totalProfit", "outstandingResult", "notIn", "total", "outstandingInvoices", "salesResult", "totalSales", "lowStockCount", "inventoryItem", "count", "quantity", "shopName", "lowStockItems", "totals", "reduce", "acc", "dateRange", "toISOString", "meta", "shopsCount", "generatedAt", "details", "Error"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "475dbc711da2c4d9dfc96d9e372735dd1573db91"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_20xu9akzyb = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_20xu9akzyb();
cov_20xu9akzyb().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
/* istanbul ignore next */
cov_20xu9akzyb().s[1]++;
Object.defineProperty(exports, "GET", {
  enumerable: true,
  get: function () {
    /* istanbul ignore next */
    cov_20xu9akzyb().f[0]++;
    cov_20xu9akzyb().s[2]++;
    return GET;
  }
});
const _server =
/* istanbul ignore next */
(cov_20xu9akzyb().s[3]++, require("next/server"));
const _prisma =
/* istanbul ignore next */
(cov_20xu9akzyb().s[4]++, require("../../../../lib/prisma"));
const _auth =
/* istanbul ignore next */
(cov_20xu9akzyb().s[5]++, require("../../../../lib/auth"));
async function GET(request) {
  /* istanbul ignore next */
  cov_20xu9akzyb().f[1]++;
  cov_20xu9akzyb().s[6]++;
  try {
    // Validate token and permissions
    const authResult =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[7]++, await (0, _auth.validateTokenPermission)(request, "view_dashboard"));
    /* istanbul ignore next */
    cov_20xu9akzyb().s[8]++;
    if (!authResult.isValid) {
      /* istanbul ignore next */
      cov_20xu9akzyb().b[0][0]++;
      cov_20xu9akzyb().s[9]++;
      return _server.NextResponse.json({
        error: authResult.message
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_20xu9akzyb().b[0][1]++;
    }
    // Extract date range from query parameters
    const {
      searchParams
    } =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[10]++, new URL(request.url));
    const startDateParam =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[11]++, searchParams.get("startDate"));
    const endDateParam =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[12]++, searchParams.get("endDate"));
    // Default to current month if no dates provided
    const endDate =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[13]++, endDateParam ?
    /* istanbul ignore next */
    (cov_20xu9akzyb().b[1][0]++, new Date(endDateParam)) :
    /* istanbul ignore next */
    (cov_20xu9akzyb().b[1][1]++, new Date()));
    const startDate =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[14]++, startDateParam ?
    /* istanbul ignore next */
    (cov_20xu9akzyb().b[2][0]++, new Date(startDateParam)) :
    /* istanbul ignore next */
    (cov_20xu9akzyb().b[2][1]++, (() => {
      /* istanbul ignore next */
      cov_20xu9akzyb().f[2]++;
      const date =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[15]++, new Date());
      /* istanbul ignore next */
      cov_20xu9akzyb().s[16]++;
      date.setDate(date.getDate() - 30); // Default to last 30 days
      /* istanbul ignore next */
      cov_20xu9akzyb().s[17]++;
      return date;
    })()));
    /* istanbul ignore next */
    cov_20xu9akzyb().s[18]++;
    console.log("Fetching shop-wise metrics for date range:", {
      startDate,
      endDate
    });
    // 1. Get all active shops
    const shops =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[19]++, await (0, _prisma.safeQuery)(() => {
      /* istanbul ignore next */
      cov_20xu9akzyb().f[3]++;
      cov_20xu9akzyb().s[20]++;
      return _prisma.prisma.shop.findMany({
        where: {
          is_active: true
        },
        select: {
          id: true,
          name: true
        }
      });
    }, [], "Failed to fetch shops"));
    /* istanbul ignore next */
    cov_20xu9akzyb().s[21]++;
    if (
    /* istanbul ignore next */
    (cov_20xu9akzyb().b[4][0]++, !shops) ||
    /* istanbul ignore next */
    (cov_20xu9akzyb().b[4][1]++, shops.length === 0)) {
      /* istanbul ignore next */
      cov_20xu9akzyb().b[3][0]++;
      cov_20xu9akzyb().s[22]++;
      return _server.NextResponse.json({
        success: true,
        data: [],
        message: "No active shops found"
      });
    } else
    /* istanbul ignore next */
    {
      cov_20xu9akzyb().b[3][1]++;
    }
    // 2. Calculate metrics for each shop
    const shopMetrics =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[23]++, await Promise.all(shops.map(async shop => {
      /* istanbul ignore next */
      cov_20xu9akzyb().f[4]++;
      // Calculate total inventory cost for this shop using shop-specific cost
      const inventoryCostResult =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[24]++, await (0, _prisma.safeQuery)(() => {
        /* istanbul ignore next */
        cov_20xu9akzyb().f[5]++;
        cov_20xu9akzyb().s[25]++;
        return _prisma.prisma.$queryRaw`
                        SELECT SUM(COALESCE(i.shopspecificcost, 0) * i.quantity) as "totalinventorycost"
                        FROM "InventoryItem" i
                        WHERE i.quantity > 0 
                        AND i.shopspecificcost IS NOT NULL 
                        AND i.shopspecificcost > 0
                        AND i."shopId" = ${shop.id}
                    `;
      }, [{
        totalinventorycost: 0
      }], `Failed to calculate inventory cost for shop ${shop.id}`));
      const totalInventoryCost =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[26]++,
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[6][0]++, inventoryCostResult) &&
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[6][1]++, inventoryCostResult[0]) &&
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[6][2]++, inventoryCostResult[0].totalinventorycost !== null) ?
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[5][0]++, Number(inventoryCostResult[0].totalinventorycost)) :
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[5][1]++, 0));
      // Calculate total profit for this shop (from invoices in the date range)
      const profitResult =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[27]++, await (0, _prisma.safeQuery)(() => {
        /* istanbul ignore next */
        cov_20xu9akzyb().f[6]++;
        cov_20xu9akzyb().s[28]++;
        return _prisma.prisma.invoice.aggregate({
          where: {
            shopId: shop.id,
            status: {
              not: "Cancelled"
            },
            invoiceDate: {
              gte: startDate,
              lte: endDate
            }
          },
          _sum: {
            totalProfit: true
          }
        });
      }, {
        _sum: {
          totalProfit: null
        }
      }, `Failed to calculate profit for shop ${shop.id}`));
      const totalProfit =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[29]++,
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[7][0]++, profitResult._sum.totalProfit) ||
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[7][1]++, 0));
      // Calculate outstanding invoices for this shop
      const outstandingResult =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[30]++, await (0, _prisma.safeQuery)(() => {
        /* istanbul ignore next */
        cov_20xu9akzyb().f[7]++;
        cov_20xu9akzyb().s[31]++;
        return _prisma.prisma.invoice.aggregate({
          where: {
            shopId: shop.id,
            status: {
              notIn: ["paid", "cancelled", "void"]
            }
          },
          _sum: {
            total: true
          }
        });
      }, {
        _sum: {
          total: null
        }
      }, `Failed to calculate outstanding invoices for shop ${shop.id}`));
      const outstandingInvoices =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[32]++,
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[8][0]++, outstandingResult._sum.total) ||
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[8][1]++, 0));
      // Calculate total sales for this shop (from invoices in the date range)
      const salesResult =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[33]++, await (0, _prisma.safeQuery)(() => {
        /* istanbul ignore next */
        cov_20xu9akzyb().f[8]++;
        cov_20xu9akzyb().s[34]++;
        return _prisma.prisma.invoice.aggregate({
          where: {
            shopId: shop.id,
            status: {
              not: "Cancelled"
            },
            invoiceDate: {
              gte: startDate,
              lte: endDate
            }
          },
          _sum: {
            total: true
          }
        });
      }, {
        _sum: {
          total: null
        }
      }, `Failed to calculate sales for shop ${shop.id}`));
      const totalSales =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[35]++,
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[9][0]++, salesResult._sum.total) ||
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[9][1]++, 0));
      // Count low stock items for this shop (quantity <= 10)
      const lowStockCount =
      /* istanbul ignore next */
      (cov_20xu9akzyb().s[36]++, await (0, _prisma.safeQuery)(() => {
        /* istanbul ignore next */
        cov_20xu9akzyb().f[9]++;
        cov_20xu9akzyb().s[37]++;
        return _prisma.prisma.inventoryItem.count({
          where: {
            shopId: shop.id,
            quantity: {
              lte: 10
            }
          }
        });
      }, 0, `Failed to count low stock items for shop ${shop.id}`));
      /* istanbul ignore next */
      cov_20xu9akzyb().s[38]++;
      return {
        shopId: shop.id,
        shopName: shop.name,
        totalInventoryCost,
        totalProfit,
        totalSales,
        outstandingInvoices,
        lowStockItems: lowStockCount
      };
    })));
    // 3. Calculate totals across all shops
    const totals =
    /* istanbul ignore next */
    (cov_20xu9akzyb().s[39]++, shopMetrics.reduce((acc, shop) => {
      /* istanbul ignore next */
      cov_20xu9akzyb().f[10]++;
      cov_20xu9akzyb().s[40]++;
      return {
        totalInventoryCost: acc.totalInventoryCost + shop.totalInventoryCost,
        totalProfit: acc.totalProfit + shop.totalProfit,
        totalSales: acc.totalSales + shop.totalSales,
        outstandingInvoices: acc.outstandingInvoices + shop.outstandingInvoices,
        lowStockItems: acc.lowStockItems + shop.lowStockItems
      };
    }, {
      totalInventoryCost: 0,
      totalProfit: 0,
      totalSales: 0,
      outstandingInvoices: 0,
      lowStockItems: 0
    }));
    /* istanbul ignore next */
    cov_20xu9akzyb().s[41]++;
    return _server.NextResponse.json({
      success: true,
      data: {
        shopMetrics,
        totals,
        dateRange: {
          startDate: startDate.toISOString(),
          endDate: endDate.toISOString()
        }
      },
      meta: {
        shopsCount: shops.length,
        generatedAt: new Date().toISOString()
      }
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_20xu9akzyb().s[42]++;
    console.error("Error fetching shop-wise dashboard metrics:", error);
    /* istanbul ignore next */
    cov_20xu9akzyb().s[43]++;
    return _server.NextResponse.json({
      success: false,
      error: "Failed to fetch shop-wise dashboard metrics",
      details: error instanceof Error ?
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[10][0]++, error.message) :
      /* istanbul ignore next */
      (cov_20xu9akzyb().b[10][1]++, "Unknown error")
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjB4dTlha3p5YiIsImFjdHVhbENvdmVyYWdlIiwicyIsIkdFVCIsInJlcXVlc3QiLCJmIiwiYXV0aFJlc3VsdCIsIl9hdXRoIiwidmFsaWRhdGVUb2tlblBlcm1pc3Npb24iLCJpc1ZhbGlkIiwiYiIsIl9zZXJ2ZXIiLCJOZXh0UmVzcG9uc2UiLCJqc29uIiwiZXJyb3IiLCJtZXNzYWdlIiwic3RhdHVzIiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwic3RhcnREYXRlUGFyYW0iLCJnZXQiLCJlbmREYXRlUGFyYW0iLCJlbmREYXRlIiwiRGF0ZSIsInN0YXJ0RGF0ZSIsImRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImNvbnNvbGUiLCJsb2ciLCJzaG9wcyIsIl9wcmlzbWEiLCJzYWZlUXVlcnkiLCJwcmlzbWEiLCJzaG9wIiwiZmluZE1hbnkiLCJ3aGVyZSIsImlzX2FjdGl2ZSIsInNlbGVjdCIsImlkIiwibmFtZSIsImxlbmd0aCIsInN1Y2Nlc3MiLCJkYXRhIiwic2hvcE1ldHJpY3MiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiaW52ZW50b3J5Q29zdFJlc3VsdCIsIiRxdWVyeVJhdyIsInRvdGFsaW52ZW50b3J5Y29zdCIsInRvdGFsSW52ZW50b3J5Q29zdCIsIk51bWJlciIsInByb2ZpdFJlc3VsdCIsImludm9pY2UiLCJhZ2dyZWdhdGUiLCJzaG9wSWQiLCJub3QiLCJpbnZvaWNlRGF0ZSIsImd0ZSIsImx0ZSIsIl9zdW0iLCJ0b3RhbFByb2ZpdCIsIm91dHN0YW5kaW5nUmVzdWx0Iiwibm90SW4iLCJ0b3RhbCIsIm91dHN0YW5kaW5nSW52b2ljZXMiLCJzYWxlc1Jlc3VsdCIsInRvdGFsU2FsZXMiLCJsb3dTdG9ja0NvdW50IiwiaW52ZW50b3J5SXRlbSIsImNvdW50IiwicXVhbnRpdHkiLCJzaG9wTmFtZSIsImxvd1N0b2NrSXRlbXMiLCJ0b3RhbHMiLCJyZWR1Y2UiLCJhY2MiLCJkYXRlUmFuZ2UiLCJ0b0lTT1N0cmluZyIsIm1ldGEiLCJzaG9wc0NvdW50IiwiZ2VuZXJhdGVkQXQiLCJkZXRhaWxzIiwiRXJyb3IiXSwic291cmNlcyI6WyIvVXNlcnMvc2FjaGluL0RvY3VtZW50cy9tZC1zcG9ydHMtL3NyYy9hcHAvYXBpL2Rhc2hib2FyZC9zaG9wLXdpc2Uvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IHByaXNtYSwgc2FmZVF1ZXJ5IH0gZnJvbSAnQC9saWIvcHJpc21hJztcbmltcG9ydCB7IHZhbGlkYXRlVG9rZW5QZXJtaXNzaW9uIH0gZnJvbSAnQC9saWIvYXV0aCc7XG5cbi8vIEludGVyZmFjZSBmb3Igc2hvcC13aXNlIG1ldHJpY3NcbmludGVyZmFjZSBTaG9wV2lzZU1ldHJpY3Mge1xuICAgIHNob3BJZDogc3RyaW5nO1xuICAgIHNob3BOYW1lOiBzdHJpbmc7XG4gICAgdG90YWxJbnZlbnRvcnlDb3N0OiBudW1iZXI7XG4gICAgdG90YWxQcm9maXQ6IG51bWJlcjtcbiAgICB0b3RhbFNhbGVzOiBudW1iZXI7XG4gICAgb3V0c3RhbmRpbmdJbnZvaWNlczogbnVtYmVyO1xuICAgIGxvd1N0b2NrSXRlbXM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICAgIHRyeSB7XG4gICAgICAgIC8vIFZhbGlkYXRlIHRva2VuIGFuZCBwZXJtaXNzaW9uc1xuICAgICAgICBjb25zdCBhdXRoUmVzdWx0ID0gYXdhaXQgdmFsaWRhdGVUb2tlblBlcm1pc3Npb24ocmVxdWVzdCwgJ3ZpZXdfZGFzaGJvYXJkJyk7XG4gICAgICAgIGlmICghYXV0aFJlc3VsdC5pc1ZhbGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogYXV0aFJlc3VsdC5tZXNzYWdlIH0sIHsgc3RhdHVzOiA0MDEgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBFeHRyYWN0IGRhdGUgcmFuZ2UgZnJvbSBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKTtcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlUGFyYW0gPSBzZWFyY2hQYXJhbXMuZ2V0KCdzdGFydERhdGUnKTtcbiAgICAgICAgY29uc3QgZW5kRGF0ZVBhcmFtID0gc2VhcmNoUGFyYW1zLmdldCgnZW5kRGF0ZScpO1xuICAgICAgICBcbiAgICAgICAgLy8gRGVmYXVsdCB0byBjdXJyZW50IG1vbnRoIGlmIG5vIGRhdGVzIHByb3ZpZGVkXG4gICAgICAgIGNvbnN0IGVuZERhdGUgPSBlbmREYXRlUGFyYW0gPyBuZXcgRGF0ZShlbmREYXRlUGFyYW0pIDogbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gc3RhcnREYXRlUGFyYW0gPyBuZXcgRGF0ZShzdGFydERhdGVQYXJhbSkgOiAoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgLSAzMCk7IC8vIERlZmF1bHQgdG8gbGFzdCAzMCBkYXlzXG4gICAgICAgICAgICByZXR1cm4gZGF0ZTtcbiAgICAgICAgfSkoKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2hpbmcgc2hvcC13aXNlIG1ldHJpY3MgZm9yIGRhdGUgcmFuZ2U6JywgeyBzdGFydERhdGUsIGVuZERhdGUgfSk7XG5cbiAgICAgICAgLy8gMS4gR2V0IGFsbCBhY3RpdmUgc2hvcHNcbiAgICAgICAgY29uc3Qgc2hvcHMgPSBhd2FpdCBzYWZlUXVlcnkoXG4gICAgICAgICAgICAoKSA9PiBwcmlzbWEuc2hvcC5maW5kTWFueSh7XG4gICAgICAgICAgICAgICAgd2hlcmU6IHsgaXNfYWN0aXZlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0cnVlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBbXSxcbiAgICAgICAgICAgICdGYWlsZWQgdG8gZmV0Y2ggc2hvcHMnXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKCFzaG9wcyB8fCBzaG9wcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkYXRhOiBbXSxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTm8gYWN0aXZlIHNob3BzIGZvdW5kJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAyLiBDYWxjdWxhdGUgbWV0cmljcyBmb3IgZWFjaCBzaG9wXG4gICAgICAgIGNvbnN0IHNob3BNZXRyaWNzOiBTaG9wV2lzZU1ldHJpY3NbXSA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgc2hvcHMubWFwKGFzeW5jIChzaG9wKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIGludmVudG9yeSBjb3N0IGZvciB0aGlzIHNob3AgdXNpbmcgc2hvcC1zcGVjaWZpYyBjb3N0XG4gICAgICAgICAgICAgICAgY29uc3QgaW52ZW50b3J5Q29zdFJlc3VsdCA9IGF3YWl0IHNhZmVRdWVyeTxBcnJheTx7IHRvdGFsaW52ZW50b3J5Y29zdDogYmlnaW50IHwgbnVtYmVyIHwgbnVsbCB9Pj4oXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHByaXNtYS4kcXVlcnlSYXdgXG4gICAgICAgICAgICAgICAgICAgICAgICBTRUxFQ1QgU1VNKENPQUxFU0NFKGkuc2hvcHNwZWNpZmljY29zdCwgMCkgKiBpLnF1YW50aXR5KSBhcyBcInRvdGFsaW52ZW50b3J5Y29zdFwiXG4gICAgICAgICAgICAgICAgICAgICAgICBGUk9NIFwiSW52ZW50b3J5SXRlbVwiIGlcbiAgICAgICAgICAgICAgICAgICAgICAgIFdIRVJFIGkucXVhbnRpdHkgPiAwIFxuICAgICAgICAgICAgICAgICAgICAgICAgQU5EIGkuc2hvcHNwZWNpZmljY29zdCBJUyBOT1QgTlVMTCBcbiAgICAgICAgICAgICAgICAgICAgICAgIEFORCBpLnNob3BzcGVjaWZpY2Nvc3QgPiAwXG4gICAgICAgICAgICAgICAgICAgICAgICBBTkQgaS5cInNob3BJZFwiID0gJHtzaG9wLmlkfVxuICAgICAgICAgICAgICAgICAgICBgLFxuICAgICAgICAgICAgICAgICAgICBbeyB0b3RhbGludmVudG9yeWNvc3Q6IDAgfV0sXG4gICAgICAgICAgICAgICAgICAgIGBGYWlsZWQgdG8gY2FsY3VsYXRlIGludmVudG9yeSBjb3N0IGZvciBzaG9wICR7c2hvcC5pZH1gXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsSW52ZW50b3J5Q29zdCA9IGludmVudG9yeUNvc3RSZXN1bHQgJiYgaW52ZW50b3J5Q29zdFJlc3VsdFswXSAmJiBpbnZlbnRvcnlDb3N0UmVzdWx0WzBdLnRvdGFsaW52ZW50b3J5Y29zdCAhPT0gbnVsbFxuICAgICAgICAgICAgICAgICAgICA/IE51bWJlcihpbnZlbnRvcnlDb3N0UmVzdWx0WzBdLnRvdGFsaW52ZW50b3J5Y29zdClcbiAgICAgICAgICAgICAgICAgICAgOiAwO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHByb2ZpdCBmb3IgdGhpcyBzaG9wIChmcm9tIGludm9pY2VzIGluIHRoZSBkYXRlIHJhbmdlKVxuICAgICAgICAgICAgICAgIGNvbnN0IHByb2ZpdFJlc3VsdCA9IGF3YWl0IHNhZmVRdWVyeShcbiAgICAgICAgICAgICAgICAgICAgKCkgPT4gcHJpc21hLmludm9pY2UuYWdncmVnYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcElkOiBzaG9wLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogeyBub3Q6ICdDYW5jZWxsZWQnIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW52b2ljZURhdGU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ3RlOiBzdGFydERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx0ZTogZW5kRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBfc3VtOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQcm9maXQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgIHsgX3N1bTogeyB0b3RhbFByb2ZpdDogbnVsbCB9IH0sXG4gICAgICAgICAgICAgICAgICAgIGBGYWlsZWQgdG8gY2FsY3VsYXRlIHByb2ZpdCBmb3Igc2hvcCAke3Nob3AuaWR9YFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbFByb2ZpdCA9IHByb2ZpdFJlc3VsdC5fc3VtLnRvdGFsUHJvZml0IHx8IDA7XG5cbiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgb3V0c3RhbmRpbmcgaW52b2ljZXMgZm9yIHRoaXMgc2hvcFxuICAgICAgICAgICAgICAgIGNvbnN0IG91dHN0YW5kaW5nUmVzdWx0ID0gYXdhaXQgc2FmZVF1ZXJ5KFxuICAgICAgICAgICAgICAgICAgICAoKSA9PiBwcmlzbWEuaW52b2ljZS5hZ2dyZWdhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9wSWQ6IHNob3AuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB7IG5vdEluOiBbJ3BhaWQnLCAnY2FuY2VsbGVkJywgJ3ZvaWQnXSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3N1bToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICB7IF9zdW06IHsgdG90YWw6IG51bGwgfSB9LFxuICAgICAgICAgICAgICAgICAgICBgRmFpbGVkIHRvIGNhbGN1bGF0ZSBvdXRzdGFuZGluZyBpbnZvaWNlcyBmb3Igc2hvcCAke3Nob3AuaWR9YFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBvdXRzdGFuZGluZ0ludm9pY2VzID0gb3V0c3RhbmRpbmdSZXN1bHQuX3N1bS50b3RhbCB8fCAwO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHNhbGVzIGZvciB0aGlzIHNob3AgKGZyb20gaW52b2ljZXMgaW4gdGhlIGRhdGUgcmFuZ2UpXG4gICAgICAgICAgICAgICAgY29uc3Qgc2FsZXNSZXN1bHQgPSBhd2FpdCBzYWZlUXVlcnkoXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHByaXNtYS5pbnZvaWNlLmFnZ3JlZ2F0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3BJZDogc2hvcC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHsgbm90OiAnQ2FuY2VsbGVkJyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludm9pY2VEYXRlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGd0ZTogc3RhcnREYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdGU6IGVuZERhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgX3N1bToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICB7IF9zdW06IHsgdG90YWw6IG51bGwgfSB9LFxuICAgICAgICAgICAgICAgICAgICBgRmFpbGVkIHRvIGNhbGN1bGF0ZSBzYWxlcyBmb3Igc2hvcCAke3Nob3AuaWR9YFxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0b3RhbFNhbGVzID0gc2FsZXNSZXN1bHQuX3N1bS50b3RhbCB8fCAwO1xuXG4gICAgICAgICAgICAgICAgLy8gQ291bnQgbG93IHN0b2NrIGl0ZW1zIGZvciB0aGlzIHNob3AgKHF1YW50aXR5IDw9IDEwKVxuICAgICAgICAgICAgICAgIGNvbnN0IGxvd1N0b2NrQ291bnQgPSBhd2FpdCBzYWZlUXVlcnkoXG4gICAgICAgICAgICAgICAgICAgICgpID0+IHByaXNtYS5pbnZlbnRvcnlJdGVtLmNvdW50KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcElkOiBzaG9wLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1YW50aXR5OiB7IGx0ZTogMTAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAgICAgYEZhaWxlZCB0byBjb3VudCBsb3cgc3RvY2sgaXRlbXMgZm9yIHNob3AgJHtzaG9wLmlkfWBcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgc2hvcElkOiBzaG9wLmlkLFxuICAgICAgICAgICAgICAgICAgICBzaG9wTmFtZTogc2hvcC5uYW1lLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEludmVudG9yeUNvc3QsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUHJvZml0LFxuICAgICAgICAgICAgICAgICAgICB0b3RhbFNhbGVzLFxuICAgICAgICAgICAgICAgICAgICBvdXRzdGFuZGluZ0ludm9pY2VzLFxuICAgICAgICAgICAgICAgICAgICBsb3dTdG9ja0l0ZW1zOiBsb3dTdG9ja0NvdW50XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gMy4gQ2FsY3VsYXRlIHRvdGFscyBhY3Jvc3MgYWxsIHNob3BzXG4gICAgICAgIGNvbnN0IHRvdGFscyA9IHNob3BNZXRyaWNzLnJlZHVjZShcbiAgICAgICAgICAgIChhY2MsIHNob3ApID0+ICh7XG4gICAgICAgICAgICAgICAgdG90YWxJbnZlbnRvcnlDb3N0OiBhY2MudG90YWxJbnZlbnRvcnlDb3N0ICsgc2hvcC50b3RhbEludmVudG9yeUNvc3QsXG4gICAgICAgICAgICAgICAgdG90YWxQcm9maXQ6IGFjYy50b3RhbFByb2ZpdCArIHNob3AudG90YWxQcm9maXQsXG4gICAgICAgICAgICAgICAgdG90YWxTYWxlczogYWNjLnRvdGFsU2FsZXMgKyBzaG9wLnRvdGFsU2FsZXMsXG4gICAgICAgICAgICAgICAgb3V0c3RhbmRpbmdJbnZvaWNlczogYWNjLm91dHN0YW5kaW5nSW52b2ljZXMgKyBzaG9wLm91dHN0YW5kaW5nSW52b2ljZXMsXG4gICAgICAgICAgICAgICAgbG93U3RvY2tJdGVtczogYWNjLmxvd1N0b2NrSXRlbXMgKyBzaG9wLmxvd1N0b2NrSXRlbXNcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRvdGFsSW52ZW50b3J5Q29zdDogMCxcbiAgICAgICAgICAgICAgICB0b3RhbFByb2ZpdDogMCxcbiAgICAgICAgICAgICAgICB0b3RhbFNhbGVzOiAwLFxuICAgICAgICAgICAgICAgIG91dHN0YW5kaW5nSW52b2ljZXM6IDAsXG4gICAgICAgICAgICAgICAgbG93U3RvY2tJdGVtczogMFxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIHNob3BNZXRyaWNzLFxuICAgICAgICAgICAgICAgIHRvdGFscyxcbiAgICAgICAgICAgICAgICBkYXRlUmFuZ2U6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnREYXRlOiBzdGFydERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgZW5kRGF0ZTogZW5kRGF0ZS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ldGE6IHtcbiAgICAgICAgICAgICAgICBzaG9wc0NvdW50OiBzaG9wcy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHNob3Atd2lzZSBkYXNoYm9hcmQgbWV0cmljczonLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmZXRjaCBzaG9wLXdpc2UgZGFzaGJvYXJkIG1ldHJpY3MnLFxuICAgICAgICAgICAgICAgIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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