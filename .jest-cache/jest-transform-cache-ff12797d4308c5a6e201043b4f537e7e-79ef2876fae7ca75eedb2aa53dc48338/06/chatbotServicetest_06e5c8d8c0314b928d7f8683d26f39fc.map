{"version":3,"sources":["/Users/sachin/Documents/md-sports-/tests/unit/chatbotService.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, afterEach, jest } from '@jest/globals';\nimport axios, { AxiosError } from 'axios';\nimport { chatbotService, ChatMessage, ChatResponse } from '@/services/chatbotService';\n\n// Mock axios\njest.mock('axios');\nconst mockAxios = {\n  get: jest.fn(),\n  post: jest.fn(),\n};\n(axios as any).get = mockAxios.get;\n(axios as any).post = mockAxios.post;\n\n// Mock document.cookie for getCookie function\nObject.defineProperty(global, 'document', {\n  value: {\n    cookie: '',\n    addEventListener: jest.fn(),\n    removeEventListener: jest.fn(),\n  },\n  writable: true,\n});\n\ndescribe('ChatbotService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Reset document.cookie\n    (global.document as any).cookie = '';\n  });\n\n  afterEach(() => {\n    jest.resetAllMocks();\n  });\n\n  describe('sendMessage', () => {\n    const mockMessages: ChatMessage[] = [\n      { role: 'user', content: 'Hello, how can I help?' },\n      { role: 'assistant', content: 'I can help you with your sports equipment needs.' }\n    ];\n\n    const mockResponse: ChatResponse = {\n      role: 'assistant',\n      content: 'Thank you for your message. How can I assist you today?'\n    };\n\n    it('should send message successfully when API key is configured', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock successful chatbot response\n      mockAxios.post.mockResolvedValue({\n        data: mockResponse\n      });\n\n      const result = await chatbotService.sendMessage(mockMessages);\n\n      expect(result).toEqual(mockResponse);\n      expect(mockAxios.get).toHaveBeenCalledWith('/api/test-settings');\n      expect(mockAxios.post).toHaveBeenCalledWith(\n        '/api/chatbot',\n        { messages: mockMessages },\n        {\n          headers: {\n            'Content-Type': 'application/json',\n          }\n        }\n      );\n    });\n\n    it('should include CSRF token when available', async () => {\n      // Set CSRF token in cookie\n      (global.document as any).cookie = 'csrfToken=test-csrf-token; other=value';\n\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock successful chatbot response\n      mockAxios.post.mockResolvedValue({\n        data: mockResponse\n      });\n\n      await chatbotService.sendMessage(mockMessages);\n\n      expect(mockAxios.post).toHaveBeenCalledWith(\n        '/api/chatbot',\n        { messages: mockMessages },\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRF-Token': 'test-csrf-token'\n          }\n        }\n      );\n    });\n\n    it('should throw error when API key is not configured', async () => {\n      // Mock API key check failure\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: false,\n          isEmpty: true,\n          valueLength: 0\n        }\n      });\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Deepseek API key is not configured. Please set it in the AI Assistant settings page.');\n\n      expect(mockAxios.post).not.toHaveBeenCalled();\n    });\n\n    it('should throw error when API key is empty', async () => {\n      // Mock API key check with empty key\n      mockAxios.get.mockResolvedValueOnce({\n        data: {\n          success: true,\n          isEmpty: true,\n          valueLength: 0\n        }\n      });\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Deepseek API key is not configured. Please set it in the AI Assistant settings page.');\n    });\n\n    it('should handle API key check errors', async () => {\n      // Mock API key check error\n      const configError = new Error('Configuration check failed');\n      mockAxios.get.mockRejectedValueOnce(configError);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Configuration check failed');\n    });\n\n    it('should handle axios error with response data', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock axios error with response\n      const axiosError = {\n        isAxiosError: true,\n        response: {\n          status: 400,\n          data: {\n            error: 'Invalid request format'\n          }\n        },\n        toJSON: () => ({ message: 'Request failed' })\n      } as AxiosError;\n\n      mockAxios.post.mockRejectedValueOnce(axiosError);\n      mockAxios.isAxiosError.mockReturnValue(true);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Invalid request format');\n    });\n\n    it('should handle 403 forbidden error', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock 403 error\n      const axiosError = {\n        isAxiosError: true,\n        response: {\n          status: 403,\n          data: {}\n        },\n        toJSON: () => ({ message: 'Forbidden' })\n      } as AxiosError;\n\n      mockAxios.post.mockRejectedValueOnce(axiosError);\n      mockAxios.isAxiosError.mockReturnValue(true);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Access to the chatbot service was denied (403). Please check API key and configuration in AI Assistant settings, or a CSRF token issue might exist.');\n    });\n\n    it('should handle network errors', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock network error (no response)\n      const axiosError = {\n        isAxiosError: true,\n        request: {},\n        response: undefined,\n        toJSON: () => ({ message: 'Network Error' })\n      } as AxiosError;\n\n      mockAxios.post.mockRejectedValueOnce(axiosError);\n      mockAxios.isAxiosError.mockReturnValue(true);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('No response received from the chatbot service. Please check your network connection and server status.');\n    });\n\n    it('should handle request setup errors', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock request setup error\n      const axiosError = {\n        isAxiosError: true,\n        message: 'Request setup failed',\n        request: undefined,\n        response: undefined,\n        toJSON: () => ({ message: 'Request setup failed' })\n      } as AxiosError;\n\n      mockAxios.post.mockRejectedValueOnce(axiosError);\n      mockAxios.isAxiosError.mockReturnValue(true);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Error setting up chatbot request: Request setup failed');\n    });\n\n    it('should handle non-axios errors', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock non-axios error\n      const genericError = new Error('Generic error');\n      mockAxios.post.mockRejectedValueOnce(genericError);\n      mockAxios.isAxiosError.mockReturnValue(false);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Generic error');\n    });\n\n    it('should handle errors without message', async () => {\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock error without message\n      const errorWithoutMessage = {};\n      mockAxios.post.mockRejectedValueOnce(errorWithoutMessage);\n      mockAxios.isAxiosError.mockReturnValue(false);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('An unexpected error occurred with the chatbot service.');\n    });\n\n    it('should handle API key check axios error with response data', async () => {\n      // Mock API key check axios error\n      const configAxiosError = {\n        isAxiosError: true,\n        response: {\n          data: {\n            message: 'Settings API error'\n          }\n        }\n      } as AxiosError;\n\n      mockAxios.get.mockRejectedValueOnce(configAxiosError);\n\n      await expect(chatbotService.sendMessage(mockMessages))\n        .rejects\n        .toThrow('Settings API error');\n    });\n  });\n\n  describe('getBusinessInfo', () => {\n    it('should return business information', async () => {\n      const businessInfo = await chatbotService.getBusinessInfo();\n\n      expect(businessInfo).toEqual({\n        businessName: 'MS Sports',\n        inventoryCount: 'Over 1,000 items',\n        topSellingProducts: ['Sports Shoes', 'Jerseys', 'Training Equipment'],\n        customerCount: 'Over 500 registered customers',\n        supplierCount: '50+ active suppliers',\n      });\n    });\n\n    it('should return consistent data structure', async () => {\n      const businessInfo = await chatbotService.getBusinessInfo();\n\n      expect(businessInfo).toHaveProperty('businessName');\n      expect(businessInfo).toHaveProperty('inventoryCount');\n      expect(businessInfo).toHaveProperty('topSellingProducts');\n      expect(businessInfo).toHaveProperty('customerCount');\n      expect(businessInfo).toHaveProperty('supplierCount');\n      expect(Array.isArray(businessInfo.topSellingProducts)).toBe(true);\n    });\n  });\n\n  describe('checkConfiguration', () => {\n    it('should return configured when API key exists and is not empty', async () => {\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          exists: true,\n          isEmpty: false\n        }\n      });\n\n      const result = await chatbotService.checkConfiguration();\n\n      expect(result).toEqual({ isConfigured: true });\n      expect(mockAxios.get).toHaveBeenCalledWith('/api/test-settings', {\n        headers: {}\n      });\n    });\n\n    it('should include CSRF token in configuration check', async () => {\n      // Set CSRF token in cookie\n      (global.document as any).cookie = 'csrfToken=config-csrf-token; other=value';\n\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          exists: true,\n          isEmpty: false\n        }\n      });\n\n      await chatbotService.checkConfiguration();\n\n      expect(mockAxios.get).toHaveBeenCalledWith('/api/test-settings', {\n        headers: {\n          'X-CSRF-Token': 'config-csrf-token'\n        }\n      });\n    });\n\n    it('should return not configured when setting not found', async () => {\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: false,\n          exists: false\n        }\n      });\n\n      const result = await chatbotService.checkConfiguration();\n\n      expect(result).toEqual({\n        isConfigured: false,\n        message: 'API key setting not found in database'\n      });\n    });\n\n    it('should return not configured when API key is empty', async () => {\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          exists: true,\n          isEmpty: true\n        }\n      });\n\n      const result = await chatbotService.checkConfiguration();\n\n      expect(result).toEqual({\n        isConfigured: false,\n        message: 'API key is empty. Please configure it in settings.'\n      });\n    });\n\n    it('should handle configuration check errors', async () => {\n      const error = new Error('Network error');\n      mockAxios.get.mockRejectedValueOnce(error);\n      const consoleSpy = jest.spyOn(console, 'error').mockImplementation();\n\n      const result = await chatbotService.checkConfiguration();\n\n      expect(result).toEqual({\n        isConfigured: false,\n        message: 'Failed to check configuration. Please try again.'\n      });\n      expect(consoleSpy).toHaveBeenCalledWith('Error checking chatbot configuration:', error);\n\n      consoleSpy.mockRestore();\n    });\n  });\n\n  describe('getCookie function (via sendMessage)', () => {\n    it('should extract CSRF token from cookie string', async () => {\n      // Set multiple cookies including CSRF token\n      (global.document as any).cookie = 'sessionId=abc123; csrfToken=test-token; userId=456';\n\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock successful chatbot response\n      mockAxios.post.mockResolvedValue({\n        data: { role: 'assistant', content: 'Response' }\n      });\n\n      await chatbotService.sendMessage([{ role: 'user', content: 'test' }]);\n\n      expect(mockAxios.post).toHaveBeenCalledWith(\n        '/api/chatbot',\n        { messages: [{ role: 'user', content: 'test' }] },\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRF-Token': 'test-token'\n          }\n        }\n      );\n    });\n\n    it('should handle missing CSRF token gracefully', async () => {\n      // Set cookies without CSRF token\n      (global.document as any).cookie = 'sessionId=abc123; userId=456';\n\n      // Mock successful API key check\n      mockAxios.get.mockResolvedValue({\n        data: {\n          success: true,\n          isEmpty: false,\n          valueLength: 32\n        }\n      });\n\n      // Mock successful chatbot response\n      mockAxios.post.mockResolvedValue({\n        data: { role: 'assistant', content: 'Response' }\n      });\n\n      await chatbotService.sendMessage([{ role: 'user', content: 'test' }]);\n\n      expect(mockAxios.post).toHaveBeenCalledWith(\n        '/api/chatbot',\n        { messages: [{ role: 'user', content: 'test' }] },\n        {\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        }\n      );\n    });\n  });\n});"],"names":["jest","mock","mockAxios","get","fn","post","axios","Object","defineProperty","global","value","cookie","addEventListener","removeEventListener","writable","describe","beforeEach","clearAllMocks","document","afterEach","resetAllMocks","mockMessages","role","content","mockResponse","it","mockResolvedValue","data","success","isEmpty","valueLength","result","chatbotService","sendMessage","expect","toEqual","toHaveBeenCalledWith","messages","headers","rejects","toThrow","not","toHaveBeenCalled","mockResolvedValueOnce","configError","Error","mockRejectedValueOnce","axiosError","isAxiosError","response","status","error","toJSON","message","mockReturnValue","request","undefined","genericError","errorWithoutMessage","configAxiosError","businessInfo","getBusinessInfo","businessName","inventoryCount","topSellingProducts","customerCount","supplierCount","toHaveProperty","Array","isArray","toBe","exists","checkConfiguration","isConfigured","consoleSpy","spyOn","console","mockImplementation","mockRestore"],"mappings":"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"}