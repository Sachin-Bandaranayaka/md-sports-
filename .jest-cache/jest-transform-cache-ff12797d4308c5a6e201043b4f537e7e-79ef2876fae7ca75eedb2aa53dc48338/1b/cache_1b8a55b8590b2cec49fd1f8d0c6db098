4e304fbf61e2f07659c0e04ce54ac19e
/**
 * Redis-based caching service for improved performance
 * Falls back to in-memory cache in development
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    CACHE_CONFIG: function() {
        return CACHE_CONFIG;
    },
    cache: function() {
        return cache;
    },
    cacheService: function() {
        return cache;
    },
    cleanupCache: function() {
        return cleanupCache;
    }
});
const _ioredis = require("ioredis");
// Cache configuration
const CACHE_CONFIG = {
    // Default TTL in seconds
    DEFAULT_TTL: 300,
    // Cache keys
    KEYS: {
        INVENTORY_SUMMARY: "inventory:summary",
        INVOICES: "invoices:list",
        INVOICE_STATS: "invoices:stats",
        CATEGORIES: "categories:list",
        SHOPS: "shops:list",
        CUSTOMERS: "customers:list",
        PRODUCTS: "products:list",
        // Authentication cache keys
        USER_SESSION: "auth:user:session",
        USER_PERMISSIONS: "auth:user:permissions",
        ROLE_PERMISSIONS: "auth:role:permissions",
        TOKEN_VALIDATION: "auth:token:validation"
    },
    // TTL for different data types
    TTL: {
        INVENTORY: 60,
        INVOICES: 120,
        STATS: 300,
        REFERENCE_DATA: 3600,
        // Authentication TTLs
        USER_SESSION: 900,
        USER_PERMISSIONS: 1800,
        ROLE_PERMISSIONS: 3600,
        TOKEN_VALIDATION: 300
    }
};
// In-memory cache fallback for development
class MemoryCache {
    constructor(){
        this.cache = new Map();
        // Clean up expired entries every 5 minutes
        this.cleanupInterval = setInterval(()=>{
            this.cleanup();
        }, 5 * 60 * 1000);
    }
    async get(key) {
        const entry = this.cache.get(key);
        if (!entry) return null;
        if (Date.now() > entry.expires) {
            this.cache.delete(key);
            return null;
        }
        return entry.data;
    }
    async set(key, value, ttlSeconds = CACHE_CONFIG.DEFAULT_TTL) {
        const expires = Date.now() + ttlSeconds * 1000;
        this.cache.set(key, {
            data: value,
            expires
        });
    }
    async del(key) {
        this.cache.delete(key);
    }
    async invalidatePattern(pattern) {
        const regex = new RegExp(pattern.replace("*", ".*"));
        for (const key of this.cache.keys()){
            if (regex.test(key)) {
                this.cache.delete(key);
            }
        }
    }
    cleanup() {
        const now = Date.now();
        for (const [key, entry] of this.cache.entries()){
            if (now > entry.expires) {
                this.cache.delete(key);
            }
        }
    }
    destroy() {
        if (this.cleanupInterval) {
            clearInterval(this.cleanupInterval);
        }
        this.cache.clear();
    }
}
// Redis cache implementation
class RedisCache {
    constructor(){
        this.isConnected = false;
        const _redisUrl = process.env.REDIS_URL || "redis://localhost:6379";
        this.redis = new _ioredis.Redis({
            host: process.env.REDIS_HOST || "localhost",
            port: parseInt(process.env.REDIS_PORT || "6379"),
            retryDelayOnFailover: 100,
            maxRetriesPerRequest: 3,
            lazyConnect: true
        });
        this.redis.on("connect", ()=>{
            console.log("✅ Redis connected");
            this.isConnected = true;
        });
        this.redis.on("error", (error)=>{
            console.error("❌ Redis connection error:", error);
            this.isConnected = false;
        });
    }
    async get(key) {
        if (!this.isConnected) return null;
        try {
            const value = await this.redis.get(key);
            return value ? JSON.parse(value) : null;
        } catch (error) {
            console.error("Redis get error:", error);
            return null;
        }
    }
    async set(key, value, ttlSeconds = CACHE_CONFIG.DEFAULT_TTL) {
        if (!this.isConnected) return;
        try {
            await this.redis.setex(key, ttlSeconds, JSON.stringify(value));
        } catch (error) {
            console.error("Redis set error:", error);
        }
    }
    async del(key) {
        if (!this.isConnected) return;
        try {
            await this.redis.del(key);
        } catch (error) {
            console.error("Redis del error:", error);
        }
    }
    async invalidatePattern(pattern) {
        if (!this.isConnected) return;
        try {
            const keys = await this.redis.keys(pattern);
            if (keys.length > 0) {
                await this.redis.del(...keys);
            }
        } catch (error) {
            console.error("Redis invalidatePattern error:", error);
        }
    }
    disconnect() {
        this.redis.disconnect();
    }
}
// Cache service implementation
class CacheManager {
    constructor(){
        this.useRedis = process.env.NODE_ENV === "production" && !!process.env.REDIS_URL;
        if (this.useRedis) {
            console.log("\uD83D\uDE80 Using Redis cache");
            this.cache = new RedisCache();
        } else {
            console.log("\uD83D\uDCBE Using in-memory cache");
            this.cache = new MemoryCache();
        }
    }
    async get(key) {
        return this.cache.get(key);
    }
    async set(key, value, ttlSeconds) {
        return this.cache.set(key, value, ttlSeconds);
    }
    async del(key) {
        return this.cache.del(key);
    }
    async invalidatePattern(pattern) {
        return this.cache.invalidatePattern(pattern);
    }
    // Helper methods for common cache operations
    async getOrSet(key, fetcher, ttlSeconds) {
        // Try to get from cache first
        const cached = await this.get(key);
        if (cached !== null) {
            return cached;
        }
        // Fetch fresh data
        const data = await fetcher();
        // Store in cache
        await this.set(key, data, ttlSeconds);
        return data;
    }
    // Generate cache key with parameters
    generateKey(prefix, params = {}) {
        const sortedParams = Object.keys(params).sort().map((key)=>`${key}:${params[key]}`).join("|");
        return sortedParams ? `${prefix}:${sortedParams}` : prefix;
    }
    // Invalidate related cache entries
    async invalidateInventory() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVENTORY_SUMMARY}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.PRODUCTS}*`)
        ]);
    }
    async invalidateInvoices() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVOICES}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVOICE_STATS}*`)
        ]);
    }
    async invalidateReferenceData() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.CATEGORIES}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.SHOPS}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.CUSTOMERS}*`)
        ]);
    }
    // Authentication cache invalidation methods
    async invalidateUserSession(userId) {
        const userSessionKey = this.generateKey(CACHE_CONFIG.KEYS.USER_SESSION, {
            userId
        });
        await this.del(userSessionKey);
    }
    async invalidateUserPermissions(userId) {
        const userPermissionsKey = this.generateKey(CACHE_CONFIG.KEYS.USER_PERMISSIONS, {
            userId
        });
        await this.del(userPermissionsKey);
    }
    async invalidateRolePermissions(roleId) {
        const rolePermissionsKey = this.generateKey(CACHE_CONFIG.KEYS.ROLE_PERMISSIONS, {
            roleId
        });
        await this.del(rolePermissionsKey);
        // Also invalidate all user permissions for users with this role
        await this.invalidatePattern(`${CACHE_CONFIG.KEYS.USER_PERMISSIONS}*`);
    }
    async invalidateTokenValidation(token) {
        const tokenKey = this.generateKey(CACHE_CONFIG.KEYS.TOKEN_VALIDATION, {
            token: token.substring(0, 20)
        });
        await this.del(tokenKey);
    }
    async invalidateAllUserAuth(userId) {
        await Promise.all([
            this.invalidateUserSession(userId),
            this.invalidateUserPermissions(userId)
        ]);
    }
    destroy() {
        if (this.cache && typeof this.cache.destroy === "function") {
            this.cache.destroy();
        }
        if (this.cache && typeof this.cache.disconnect === "function") {
            this.cache.disconnect();
        }
    }
}
// Export singleton instance
const cache = new CacheManager();
// Cleanup on process exit
process.on("SIGINT", ()=>{
    cache.destroy();
});
process.on("SIGTERM", ()=>{
    cache.destroy();
});
const cleanupCache = ()=>{
    cache.destroy();
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL2xpYi9jYWNoZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlZGlzLWJhc2VkIGNhY2hpbmcgc2VydmljZSBmb3IgaW1wcm92ZWQgcGVyZm9ybWFuY2VcbiAqIEZhbGxzIGJhY2sgdG8gaW4tbWVtb3J5IGNhY2hlIGluIGRldmVsb3BtZW50XG4gKi9cblxuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdpb3JlZGlzJztcblxuLy8gQ2FjaGUgY29uZmlndXJhdGlvblxuY29uc3QgQ0FDSEVfQ09ORklHID0ge1xuICAgIC8vIERlZmF1bHQgVFRMIGluIHNlY29uZHNcbiAgICBERUZBVUxUX1RUTDogMzAwLCAvLyA1IG1pbnV0ZXNcblxuICAgIC8vIENhY2hlIGtleXNcbiAgICBLRVlTOiB7XG4gICAgICAgIElOVkVOVE9SWV9TVU1NQVJZOiAnaW52ZW50b3J5OnN1bW1hcnknLFxuICAgICAgICBJTlZPSUNFUzogJ2ludm9pY2VzOmxpc3QnLFxuICAgICAgICBJTlZPSUNFX1NUQVRTOiAnaW52b2ljZXM6c3RhdHMnLFxuICAgICAgICBDQVRFR09SSUVTOiAnY2F0ZWdvcmllczpsaXN0JyxcbiAgICAgICAgU0hPUFM6ICdzaG9wczpsaXN0JyxcbiAgICAgICAgQ1VTVE9NRVJTOiAnY3VzdG9tZXJzOmxpc3QnLFxuICAgICAgICBQUk9EVUNUUzogJ3Byb2R1Y3RzOmxpc3QnLFxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBjYWNoZSBrZXlzXG4gICAgICAgIFVTRVJfU0VTU0lPTjogJ2F1dGg6dXNlcjpzZXNzaW9uJyxcbiAgICAgICAgVVNFUl9QRVJNSVNTSU9OUzogJ2F1dGg6dXNlcjpwZXJtaXNzaW9ucycsXG4gICAgICAgIFJPTEVfUEVSTUlTU0lPTlM6ICdhdXRoOnJvbGU6cGVybWlzc2lvbnMnLFxuICAgICAgICBUT0tFTl9WQUxJREFUSU9OOiAnYXV0aDp0b2tlbjp2YWxpZGF0aW9uJyxcbiAgICB9LFxuXG4gICAgLy8gVFRMIGZvciBkaWZmZXJlbnQgZGF0YSB0eXBlc1xuICAgIFRUTDoge1xuICAgICAgICBJTlZFTlRPUlk6IDYwLCAvLyAxIG1pbnV0ZVxuICAgICAgICBJTlZPSUNFUzogMTIwLCAvLyAyIG1pbnV0ZXNcbiAgICAgICAgU1RBVFM6IDMwMCwgLy8gNSBtaW51dGVzXG4gICAgICAgIFJFRkVSRU5DRV9EQVRBOiAzNjAwLCAvLyAxIGhvdXIgKGNhdGVnb3JpZXMsIHNob3BzLCBldGMuKVxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBUVExzXG4gICAgICAgIFVTRVJfU0VTU0lPTjogOTAwLCAvLyAxNSBtaW51dGVzXG4gICAgICAgIFVTRVJfUEVSTUlTU0lPTlM6IDE4MDAsIC8vIDMwIG1pbnV0ZXNcbiAgICAgICAgUk9MRV9QRVJNSVNTSU9OUzogMzYwMCwgLy8gMSBob3VyXG4gICAgICAgIFRPS0VOX1ZBTElEQVRJT046IDMwMCwgLy8gNSBtaW51dGVzXG4gICAgfVxufTtcblxuLy8gSW4tbWVtb3J5IGNhY2hlIGZhbGxiYWNrIGZvciBkZXZlbG9wbWVudFxuY2xhc3MgTWVtb3J5Q2FjaGUge1xuICAgIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgeyBkYXRhOiBhbnk7IGV4cGlyZXM6IG51bWJlciB9PigpO1xuICAgIHByaXZhdGUgY2xlYW51cEludGVydmFsOiBOb2RlSlMuVGltZW91dDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBDbGVhbiB1cCBleHBpcmVkIGVudHJpZXMgZXZlcnkgNSBtaW51dGVzXG4gICAgICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbGVhbnVwKCk7XG4gICAgICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuICAgIH1cblxuICAgIGFzeW5jIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFlbnRyeSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgaWYgKERhdGUubm93KCkgPiBlbnRyeS5leHBpcmVzKSB7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW50cnkuZGF0YTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM6IG51bWJlciA9IENBQ0hFX0NPTkZJRy5ERUZBVUxUX1RUTCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBleHBpcmVzID0gRGF0ZS5ub3coKSArICh0dGxTZWNvbmRzICogMTAwMCk7XG4gICAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgeyBkYXRhOiB2YWx1ZSwgZXhwaXJlcyB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZSgnKicsICcuKicpKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5jYWNoZS5rZXlzKCkpIHtcbiAgICAgICAgICAgIGlmIChyZWdleC50ZXN0KGtleSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhbnVwKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgaWYgKG5vdyA+IGVudHJ5LmV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuY2xlYW51cEludGVydmFsKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cEludGVydmFsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gICAgfVxufVxuXG4vLyBSZWRpcyBjYWNoZSBpbXBsZW1lbnRhdGlvblxuY2xhc3MgUmVkaXNDYWNoZSB7XG4gICAgcHJpdmF0ZSByZWRpczogUmVkaXM7XG4gICAgcHJpdmF0ZSBpc0Nvbm5lY3RlZCA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IF9yZWRpc1VybCA9IHByb2Nlc3MuZW52LlJFRElTX1VSTCB8fCAncmVkaXM6Ly9sb2NhbGhvc3Q6NjM3OSc7XG5cbiAgICAgICAgdGhpcy5yZWRpcyA9IG5ldyBSZWRpcyh7XG4gICAgICAgICAgICBob3N0OiBwcm9jZXNzLmVudi5SRURJU19IT1NUIHx8ICdsb2NhbGhvc3QnLFxuICAgICAgICAgICAgcG9ydDogcGFyc2VJbnQocHJvY2Vzcy5lbnYuUkVESVNfUE9SVCB8fCAnNjM3OScpLFxuICAgICAgICAgICAgcmV0cnlEZWxheU9uRmFpbG92ZXI6IDEwMCxcbiAgICAgICAgICAgIG1heFJldHJpZXNQZXJSZXF1ZXN0OiAzLFxuICAgICAgICAgICAgbGF6eUNvbm5lY3Q6IHRydWUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVkaXMub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFJlZGlzIGNvbm5lY3RlZCcpO1xuICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVkaXMub24oJ2Vycm9yJywgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgUmVkaXMgY29ubmVjdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gYXdhaXQgdGhpcy5yZWRpcy5nZXQoa2V5KTtcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA/IEpTT04ucGFyc2UodmFsdWUpIDogbnVsbDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGdldCBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHNldChrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgdHRsU2Vjb25kczogbnVtYmVyID0gQ0FDSEVfQ09ORklHLkRFRkFVTFRfVFRMKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkgcmV0dXJuO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLnNldGV4KGtleSwgdHRsU2Vjb25kcywgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIHNldCBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSByZXR1cm47XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGtleSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWRpcyBkZWwgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgaW52YWxpZGF0ZVBhdHRlcm4ocGF0dGVybjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkgcmV0dXJuO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBrZXlzID0gYXdhaXQgdGhpcy5yZWRpcy5rZXlzKHBhdHRlcm4pO1xuICAgICAgICAgICAgaWYgKGtleXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKC4uLmtleXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVkaXMgaW52YWxpZGF0ZVBhdHRlcm4gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGlzY29ubmVjdCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5yZWRpcy5kaXNjb25uZWN0KCk7XG4gICAgfVxufVxuXG4vLyBDYWNoZSBzZXJ2aWNlIGludGVyZmFjZVxuaW50ZXJmYWNlIENhY2hlU2VydmljZSB7XG4gICAgZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxhbnk+O1xuICAgIHNldChrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgdHRsU2Vjb25kcz86IG51bWJlcik6IFByb21pc2U8dm9pZD47XG4gICAgZGVsKGtleTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbiAgICBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xuICAgIGRlc3Ryb3k/KCk6IHZvaWQ7XG59XG5cbi8vIENhY2hlIHNlcnZpY2UgaW1wbGVtZW50YXRpb25cbmNsYXNzIENhY2hlTWFuYWdlciBpbXBsZW1lbnRzIENhY2hlU2VydmljZSB7XG4gICAgcHJpdmF0ZSBjYWNoZTogQ2FjaGVTZXJ2aWNlO1xuICAgIHByaXZhdGUgdXNlUmVkaXM6IGJvb2xlYW47XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy51c2VSZWRpcyA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgJiYgISFwcm9jZXNzLmVudi5SRURJU19VUkw7XG5cbiAgICAgICAgaWYgKHRoaXMudXNlUmVkaXMpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5qAIFVzaW5nIFJlZGlzIGNhY2hlJyk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlID0gbmV3IFJlZGlzQ2FjaGUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5K+IFVzaW5nIGluLW1lbW9yeSBjYWNoZScpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZSA9IG5ldyBNZW1vcnlDYWNoZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KGtleSk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCB0dGxTZWNvbmRzPzogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlLnNldChrZXksIHZhbHVlLCB0dGxTZWNvbmRzKTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZGVsKGtleSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaW52YWxpZGF0ZVBhdHRlcm4ocGF0dGVybjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlLmludmFsaWRhdGVQYXR0ZXJuKHBhdHRlcm4pO1xuICAgIH1cblxuICAgIC8vIEhlbHBlciBtZXRob2RzIGZvciBjb21tb24gY2FjaGUgb3BlcmF0aW9uc1xuICAgIGFzeW5jIGdldE9yU2V0PFQ+KFxuICAgICAgICBrZXk6IHN0cmluZyxcbiAgICAgICAgZmV0Y2hlcjogKCkgPT4gUHJvbWlzZTxUPixcbiAgICAgICAgdHRsU2Vjb25kcz86IG51bWJlclxuICAgICk6IFByb21pc2U8VD4ge1xuICAgICAgICAvLyBUcnkgdG8gZ2V0IGZyb20gY2FjaGUgZmlyc3RcbiAgICAgICAgY29uc3QgY2FjaGVkID0gYXdhaXQgdGhpcy5nZXQoa2V5KTtcbiAgICAgICAgaWYgKGNhY2hlZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZldGNoIGZyZXNoIGRhdGFcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoZXIoKTtcblxuICAgICAgICAvLyBTdG9yZSBpbiBjYWNoZVxuICAgICAgICBhd2FpdCB0aGlzLnNldChrZXksIGRhdGEsIHR0bFNlY29uZHMpO1xuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGNhY2hlIGtleSB3aXRoIHBhcmFtZXRlcnNcbiAgICBnZW5lcmF0ZUtleShwcmVmaXg6IHN0cmluZywgcGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge30pOiBzdHJpbmcge1xuICAgICAgICBjb25zdCBzb3J0ZWRQYXJhbXMgPSBPYmplY3Qua2V5cyhwYXJhbXMpXG4gICAgICAgICAgICAuc29ydCgpXG4gICAgICAgICAgICAubWFwKGtleSA9PiBgJHtrZXl9OiR7cGFyYW1zW2tleV19YClcbiAgICAgICAgICAgIC5qb2luKCd8Jyk7XG5cbiAgICAgICAgcmV0dXJuIHNvcnRlZFBhcmFtcyA/IGAke3ByZWZpeH06JHtzb3J0ZWRQYXJhbXN9YCA6IHByZWZpeDtcbiAgICB9XG5cbiAgICAvLyBJbnZhbGlkYXRlIHJlbGF0ZWQgY2FjaGUgZW50cmllc1xuICAgIGFzeW5jIGludmFsaWRhdGVJbnZlbnRvcnkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIHRoaXMuaW52YWxpZGF0ZVBhdHRlcm4oYCR7Q0FDSEVfQ09ORklHLktFWVMuSU5WRU5UT1JZX1NVTU1BUll9KmApLFxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5QUk9EVUNUU30qYCksXG4gICAgICAgIF0pO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVJbnZvaWNlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5JTlZPSUNFU30qYCksXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLklOVk9JQ0VfU1RBVFN9KmApLFxuICAgICAgICBdKTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUmVmZXJlbmNlRGF0YSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5DQVRFR09SSUVTfSpgKSxcbiAgICAgICAgICAgIHRoaXMuaW52YWxpZGF0ZVBhdHRlcm4oYCR7Q0FDSEVfQ09ORklHLktFWVMuU0hPUFN9KmApLFxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5DVVNUT01FUlN9KmApLFxuICAgICAgICBdKTtcbiAgICB9XG5cbiAgICAvLyBBdXRoZW50aWNhdGlvbiBjYWNoZSBpbnZhbGlkYXRpb24gbWV0aG9kc1xuICAgIGFzeW5jIGludmFsaWRhdGVVc2VyU2Vzc2lvbih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB1c2VyU2Vzc2lvbktleSA9IHRoaXMuZ2VuZXJhdGVLZXkoQ0FDSEVfQ09ORklHLktFWVMuVVNFUl9TRVNTSU9OLCB7IHVzZXJJZCB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWwodXNlclNlc3Npb25LZXkpO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVVc2VyUGVybWlzc2lvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgdXNlclBlcm1pc3Npb25zS2V5ID0gdGhpcy5nZW5lcmF0ZUtleShDQUNIRV9DT05GSUcuS0VZUy5VU0VSX1BFUk1JU1NJT05TLCB7IHVzZXJJZCB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWwodXNlclBlcm1pc3Npb25zS2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUm9sZVBlcm1pc3Npb25zKHJvbGVJZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHJvbGVQZXJtaXNzaW9uc0tleSA9IHRoaXMuZ2VuZXJhdGVLZXkoQ0FDSEVfQ09ORklHLktFWVMuUk9MRV9QRVJNSVNTSU9OUywgeyByb2xlSWQgfSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVsKHJvbGVQZXJtaXNzaW9uc0tleSk7XG4gICAgICAgIC8vIEFsc28gaW52YWxpZGF0ZSBhbGwgdXNlciBwZXJtaXNzaW9ucyBmb3IgdXNlcnMgd2l0aCB0aGlzIHJvbGVcbiAgICAgICAgYXdhaXQgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5VU0VSX1BFUk1JU1NJT05TfSpgKTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlVG9rZW5WYWxpZGF0aW9uKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgdG9rZW5LZXkgPSB0aGlzLmdlbmVyYXRlS2V5KENBQ0hFX0NPTkZJRy5LRVlTLlRPS0VOX1ZBTElEQVRJT04sIHsgdG9rZW46IHRva2VuLnN1YnN0cmluZygwLCAyMCkgfSk7XG4gICAgICAgIGF3YWl0IHRoaXMuZGVsKHRva2VuS2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlQWxsVXNlckF1dGgodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlVXNlclNlc3Npb24odXNlcklkKSxcbiAgICAgICAgICAgIHRoaXMuaW52YWxpZGF0ZVVzZXJQZXJtaXNzaW9ucyh1c2VySWQpLFxuICAgICAgICBdKTtcbiAgICB9XG5cbiAgICBkZXN0cm95KCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5jYWNoZSAmJiB0eXBlb2YgKHRoaXMuY2FjaGUgYXMgYW55KS5kZXN0cm95ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAodGhpcy5jYWNoZSBhcyBhbnkpLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jYWNoZSAmJiB0eXBlb2YgKHRoaXMuY2FjaGUgYXMgYW55KS5kaXNjb25uZWN0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAodGhpcy5jYWNoZSBhcyBhbnkpLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuY29uc3QgY2FjaGUgPSBuZXcgQ2FjaGVNYW5hZ2VyKCk7XG5leHBvcnQgeyBjYWNoZSB9O1xuXG4vLyBFeHBvcnQgYXMgY2FjaGVTZXJ2aWNlIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5leHBvcnQgeyBjYWNoZSBhcyBjYWNoZVNlcnZpY2UgfTtcblxuLy8gRXhwb3J0IHR5cGVzIGFuZCBjb25zdGFudHNcbmV4cG9ydCB7IENBQ0hFX0NPTkZJRyB9O1xuZXhwb3J0IHR5cGUgeyBDYWNoZVNlcnZpY2UgfTtcblxuLy8gQ2xlYW51cCBvbiBwcm9jZXNzIGV4aXRcbnByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IHtcbiAgICBjYWNoZS5kZXN0cm95KCk7XG59KTtcblxucHJvY2Vzcy5vbignU0lHVEVSTScsICgpID0+IHtcbiAgICBjYWNoZS5kZXN0cm95KCk7XG59KTtcblxuLy8gRXhwb3J0IGNsZWFudXAgZnVuY3Rpb24gZm9yIHRlc3RzXG5leHBvcnQgY29uc3QgY2xlYW51cENhY2hlID0gKCkgPT4ge1xuICAgIGNhY2hlLmRlc3Ryb3koKTtcbn07Il0sIm5hbWVzIjpbIkNBQ0hFX0NPTkZJRyIsImNhY2hlIiwiY2FjaGVTZXJ2aWNlIiwiY2xlYW51cENhY2hlIiwiREVGQVVMVF9UVEwiLCJLRVlTIiwiSU5WRU5UT1JZX1NVTU1BUlkiLCJJTlZPSUNFUyIsIklOVk9JQ0VfU1RBVFMiLCJDQVRFR09SSUVTIiwiU0hPUFMiLCJDVVNUT01FUlMiLCJQUk9EVUNUUyIsIlVTRVJfU0VTU0lPTiIsIlVTRVJfUEVSTUlTU0lPTlMiLCJST0xFX1BFUk1JU1NJT05TIiwiVE9LRU5fVkFMSURBVElPTiIsIlRUTCIsIklOVkVOVE9SWSIsIlNUQVRTIiwiUkVGRVJFTkNFX0RBVEEiLCJNZW1vcnlDYWNoZSIsImNvbnN0cnVjdG9yIiwiTWFwIiwiY2xlYW51cEludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJjbGVhbnVwIiwiZ2V0Iiwia2V5IiwiZW50cnkiLCJEYXRlIiwibm93IiwiZXhwaXJlcyIsImRlbGV0ZSIsImRhdGEiLCJzZXQiLCJ2YWx1ZSIsInR0bFNlY29uZHMiLCJkZWwiLCJpbnZhbGlkYXRlUGF0dGVybiIsInBhdHRlcm4iLCJyZWdleCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJrZXlzIiwidGVzdCIsImVudHJpZXMiLCJkZXN0cm95IiwiY2xlYXJJbnRlcnZhbCIsImNsZWFyIiwiUmVkaXNDYWNoZSIsImlzQ29ubmVjdGVkIiwiX3JlZGlzVXJsIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsInJlZGlzIiwiUmVkaXMiLCJob3N0IiwiUkVESVNfSE9TVCIsInBvcnQiLCJwYXJzZUludCIsIlJFRElTX1BPUlQiLCJyZXRyeURlbGF5T25GYWlsb3ZlciIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwibGF6eUNvbm5lY3QiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsIkpTT04iLCJwYXJzZSIsInNldGV4Iiwic3RyaW5naWZ5IiwibGVuZ3RoIiwiZGlzY29ubmVjdCIsIkNhY2hlTWFuYWdlciIsInVzZVJlZGlzIiwiTk9ERV9FTlYiLCJnZXRPclNldCIsImZldGNoZXIiLCJjYWNoZWQiLCJnZW5lcmF0ZUtleSIsInByZWZpeCIsInBhcmFtcyIsInNvcnRlZFBhcmFtcyIsIk9iamVjdCIsInNvcnQiLCJtYXAiLCJqb2luIiwiaW52YWxpZGF0ZUludmVudG9yeSIsIlByb21pc2UiLCJhbGwiLCJpbnZhbGlkYXRlSW52b2ljZXMiLCJpbnZhbGlkYXRlUmVmZXJlbmNlRGF0YSIsImludmFsaWRhdGVVc2VyU2Vzc2lvbiIsInVzZXJJZCIsInVzZXJTZXNzaW9uS2V5IiwiaW52YWxpZGF0ZVVzZXJQZXJtaXNzaW9ucyIsInVzZXJQZXJtaXNzaW9uc0tleSIsImludmFsaWRhdGVSb2xlUGVybWlzc2lvbnMiLCJyb2xlSWQiLCJyb2xlUGVybWlzc2lvbnNLZXkiLCJpbnZhbGlkYXRlVG9rZW5WYWxpZGF0aW9uIiwidG9rZW4iLCJ0b2tlbktleSIsInN1YnN0cmluZyIsImludmFsaWRhdGVBbGxVc2VyQXV0aCJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7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