{"version":3,"names":["_default","Invoice","_sequelize","Model","addItem","productId","quantity","price","cov_1bdb9nqvom","f","InvoiceItem","s","_db","default","model","_item","create","invoiceId","id","unitPrice","subtotal","calculateTotals","removeItem","lineItemId","destroy","where","items","findAll","reduce","sum","item","get","taxAmount","tax","discountAmount","discount","total","update","markAsPaid","paymentStatus","init","type","DataTypes","INTEGER","autoIncrement","primaryKey","shopId","allowNull","customerId","userId","STRING","comment","invoiceNumber","unique","date","DATE","defaultValue","NOW","DECIMAL","status","ENUM","dueDate","sequelize","modelName","tableName","timestamps"],"sources":["/Users/sachin/Documents/md-sports-/src/lib/models/Invoice.ts"],"sourcesContent":["import { Model, DataTypes } from 'sequelize';\nimport sequelize from '../db';\n\nclass Invoice extends Model {\n    public id!: number;\n    public shopId!: number;\n    public customerId!: number;\n    public userId!: string;\n    public invoiceNumber!: string;\n    public date!: Date;\n    public subtotal!: number;\n    public tax!: number;\n    public discount!: number;\n    public total!: number;\n    public status!: string;\n    public paymentStatus!: string;\n    public dueDate!: Date;\n    public readonly createdAt!: Date;\n    public readonly updatedAt!: Date;\n\n    // Custom instance methods\n    public async addItem(productId: number, quantity: number, price: number): Promise<void> {\n        const InvoiceItem = sequelize.model('invoice_item');\n        const _item = await InvoiceItem.create({\n            invoiceId: this.id,\n            productId,\n            quantity,\n            unitPrice: price,\n            subtotal: quantity * price\n        });\n\n        // Recalculate invoice totals\n        await this.calculateTotals();\n    }\n\n    public async removeItem(lineItemId: number): Promise<void> {\n        const InvoiceItem = sequelize.model('invoice_item');\n        await InvoiceItem.destroy({\n            where: { id: lineItemId, invoiceId: this.id }\n        });\n\n        // Recalculate invoice totals\n        await this.calculateTotals();\n    }\n\n    public async calculateTotals(): Promise<void> {\n        const InvoiceItem = sequelize.model('invoice_item');\n        const items = await InvoiceItem.findAll({\n            where: { invoiceId: this.id }\n        });\n\n        // Calculate subtotal\n        const subtotal = items.reduce((sum, item) =>\n            sum + (item.get('subtotal') as number), 0);\n\n        // Apply tax and discount\n        const taxAmount = subtotal * (this.tax / 100);\n        const discountAmount = subtotal * (this.discount / 100);\n        const total = subtotal + taxAmount - discountAmount;\n\n        // Update invoice\n        await this.update({\n            subtotal,\n            total\n        });\n    }\n\n    public async markAsPaid(): Promise<void> {\n        await this.update({\n            paymentStatus: 'paid'\n        });\n    }\n}\n\nInvoice.init({\n    id: {\n        type: DataTypes.INTEGER,\n        autoIncrement: true,\n        primaryKey: true\n    },\n    shopId: {\n        type: DataTypes.INTEGER,\n        allowNull: false\n    },\n    customerId: {\n        type: DataTypes.INTEGER,\n        allowNull: false\n    },\n    userId: {\n        type: DataTypes.STRING,\n        allowNull: false,\n        comment: 'User who created the invoice'\n    },\n    invoiceNumber: {\n        type: DataTypes.STRING(20),\n        allowNull: false,\n        unique: true\n    },\n    date: {\n        type: DataTypes.DATE,\n        allowNull: false,\n        defaultValue: DataTypes.NOW\n    },\n    subtotal: {\n        type: DataTypes.DECIMAL(10, 2),\n        allowNull: false,\n        defaultValue: 0.00\n    },\n    tax: {\n        type: DataTypes.DECIMAL(5, 2),\n        allowNull: false,\n        defaultValue: 0.00\n    },\n    discount: {\n        type: DataTypes.DECIMAL(5, 2),\n        allowNull: false,\n        defaultValue: 0.00\n    },\n    total: {\n        type: DataTypes.DECIMAL(10, 2),\n        allowNull: false,\n        defaultValue: 0.00\n    },\n    status: {\n        type: DataTypes.ENUM('draft', 'issued', 'cancelled'),\n        allowNull: false,\n        defaultValue: 'draft'\n    },\n    paymentStatus: {\n        type: DataTypes.ENUM('unpaid', 'partial', 'paid'),\n        allowNull: false,\n        defaultValue: 'unpaid'\n    },\n    dueDate: {\n        type: DataTypes.DATE,\n        allowNull: true\n    }\n}, {\n    sequelize,\n    modelName: 'invoice',\n    tableName: 'invoices',\n    timestamps: true\n});\n\nexport default Invoice;"],"mappings":"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","ignoreList":[]}