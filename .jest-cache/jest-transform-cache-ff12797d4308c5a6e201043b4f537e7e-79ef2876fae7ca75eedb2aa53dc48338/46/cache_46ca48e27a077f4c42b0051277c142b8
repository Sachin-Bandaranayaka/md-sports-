000e7c3394ec70ee05b29a6d128d2c1c
/**
 * Redis-based caching service for improved performance
 * Falls back to in-memory cache in development
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    CACHE_CONFIG: function() {
        return CACHE_CONFIG;
    },
    cache: function() {
        return cache;
    },
    cacheService: function() {
        return cache;
    }
});
const _ioredis = require("ioredis");
// Cache configuration
const CACHE_CONFIG = {
    // Default TTL in seconds
    DEFAULT_TTL: 300,
    // Cache keys
    KEYS: {
        INVENTORY_SUMMARY: "inventory:summary",
        INVOICES: "invoices:list",
        INVOICE_STATS: "invoices:stats",
        CATEGORIES: "categories:list",
        SHOPS: "shops:list",
        CUSTOMERS: "customers:list",
        PRODUCTS: "products:list",
        // Authentication cache keys
        USER_SESSION: "auth:user:session",
        USER_PERMISSIONS: "auth:user:permissions",
        ROLE_PERMISSIONS: "auth:role:permissions",
        TOKEN_VALIDATION: "auth:token:validation"
    },
    // TTL for different data types
    TTL: {
        INVENTORY: 60,
        INVOICES: 120,
        STATS: 300,
        REFERENCE_DATA: 3600,
        // Authentication TTLs
        USER_SESSION: 900,
        USER_PERMISSIONS: 1800,
        ROLE_PERMISSIONS: 3600,
        TOKEN_VALIDATION: 300
    }
};
// In-memory cache fallback for development
class MemoryCache {
    constructor(){
        this.cache = new Map();
        // Clean up expired entries every 5 minutes
        this.cleanupInterval = setInterval(()=>{
            this.cleanup();
        }, 5 * 60 * 1000);
    }
    async get(key) {
        const entry = this.cache.get(key);
        if (!entry) return null;
        if (Date.now() > entry.expires) {
            this.cache.delete(key);
            return null;
        }
        return entry.data;
    }
    async set(key, value, ttlSeconds = CACHE_CONFIG.DEFAULT_TTL) {
        const expires = Date.now() + ttlSeconds * 1000;
        this.cache.set(key, {
            data: value,
            expires
        });
    }
    async del(key) {
        this.cache.delete(key);
    }
    async invalidatePattern(pattern) {
        const regex = new RegExp(pattern.replace("*", ".*"));
        for (const key of this.cache.keys()){
            if (regex.test(key)) {
                this.cache.delete(key);
            }
        }
    }
    cleanup() {
        const now = Date.now();
        for (const [key, entry] of this.cache.entries()){
            if (now > entry.expires) {
                this.cache.delete(key);
            }
        }
    }
    destroy() {
        clearInterval(this.cleanupInterval);
        this.cache.clear();
    }
}
// Redis cache implementation
class RedisCache {
    constructor(){
        this.isConnected = false;
        const redisUrl = process.env.REDIS_URL || "redis://localhost:6379";
        this.redis = new _ioredis.Redis(redisUrl, {
            retryDelayOnFailover: 100,
            maxRetriesPerRequest: 3,
            lazyConnect: true
        });
        this.redis.on("connect", ()=>{
            console.log("✅ Redis connected");
            this.isConnected = true;
        });
        this.redis.on("error", (error)=>{
            console.error("❌ Redis connection error:", error);
            this.isConnected = false;
        });
    }
    async get(key) {
        if (!this.isConnected) return null;
        try {
            const value = await this.redis.get(key);
            return value ? JSON.parse(value) : null;
        } catch (error) {
            console.error("Redis get error:", error);
            return null;
        }
    }
    async set(key, value, ttlSeconds = CACHE_CONFIG.DEFAULT_TTL) {
        if (!this.isConnected) return;
        try {
            await this.redis.setex(key, ttlSeconds, JSON.stringify(value));
        } catch (error) {
            console.error("Redis set error:", error);
        }
    }
    async del(key) {
        if (!this.isConnected) return;
        try {
            await this.redis.del(key);
        } catch (error) {
            console.error("Redis del error:", error);
        }
    }
    async invalidatePattern(pattern) {
        if (!this.isConnected) return;
        try {
            const keys = await this.redis.keys(pattern);
            if (keys.length > 0) {
                await this.redis.del(...keys);
            }
        } catch (error) {
            console.error("Redis invalidatePattern error:", error);
        }
    }
    disconnect() {
        this.redis.disconnect();
    }
}
// Cache service implementation
class CacheManager {
    constructor(){
        this.useRedis = process.env.NODE_ENV === "production" && !!process.env.REDIS_URL;
        if (this.useRedis) {
            console.log("\uD83D\uDE80 Using Redis cache");
            this.cache = new RedisCache();
        } else {
            console.log("\uD83D\uDCBE Using in-memory cache");
            this.cache = new MemoryCache();
        }
    }
    async get(key) {
        return this.cache.get(key);
    }
    async set(key, value, ttlSeconds) {
        return this.cache.set(key, value, ttlSeconds);
    }
    async del(key) {
        return this.cache.del(key);
    }
    async invalidatePattern(pattern) {
        return this.cache.invalidatePattern(pattern);
    }
    // Helper methods for common cache operations
    async getOrSet(key, fetcher, ttlSeconds) {
        // Try to get from cache first
        const cached = await this.get(key);
        if (cached !== null) {
            return cached;
        }
        // Fetch fresh data
        const data = await fetcher();
        // Store in cache
        await this.set(key, data, ttlSeconds);
        return data;
    }
    // Generate cache key with parameters
    generateKey(prefix, params = {}) {
        const sortedParams = Object.keys(params).sort().map((key)=>`${key}:${params[key]}`).join("|");
        return sortedParams ? `${prefix}:${sortedParams}` : prefix;
    }
    // Invalidate related cache entries
    async invalidateInventory() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVENTORY_SUMMARY}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.PRODUCTS}*`)
        ]);
    }
    async invalidateInvoices() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVOICES}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVOICE_STATS}*`)
        ]);
    }
    async invalidateReferenceData() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.CATEGORIES}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.SHOPS}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.CUSTOMERS}*`)
        ]);
    }
    // Authentication cache invalidation methods
    async invalidateUserSession(userId) {
        const userSessionKey = this.generateKey(CACHE_CONFIG.KEYS.USER_SESSION, {
            userId
        });
        await this.del(userSessionKey);
    }
    async invalidateUserPermissions(userId) {
        const userPermissionsKey = this.generateKey(CACHE_CONFIG.KEYS.USER_PERMISSIONS, {
            userId
        });
        await this.del(userPermissionsKey);
    }
    async invalidateRolePermissions(roleId) {
        const rolePermissionsKey = this.generateKey(CACHE_CONFIG.KEYS.ROLE_PERMISSIONS, {
            roleId
        });
        await this.del(rolePermissionsKey);
        // Also invalidate all user permissions for users with this role
        await this.invalidatePattern(`${CACHE_CONFIG.KEYS.USER_PERMISSIONS}*`);
    }
    async invalidateTokenValidation(token) {
        const tokenKey = this.generateKey(CACHE_CONFIG.KEYS.TOKEN_VALIDATION, {
            token: token.substring(0, 20)
        });
        await this.del(tokenKey);
    }
    async invalidateAllUserAuth(userId) {
        await Promise.all([
            this.invalidateUserSession(userId),
            this.invalidateUserPermissions(userId)
        ]);
    }
}
// Export singleton instance
const cache = new CacheManager();
// Cleanup on process exit
process.on("SIGINT", ()=>{
    if (cache.cache instanceof RedisCache) {
        cache.cache.disconnect();
    } else if (cache.cache instanceof MemoryCache) {
        cache.cache.destroy();
    }
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL2xpYi9jYWNoZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlZGlzLWJhc2VkIGNhY2hpbmcgc2VydmljZSBmb3IgaW1wcm92ZWQgcGVyZm9ybWFuY2VcbiAqIEZhbGxzIGJhY2sgdG8gaW4tbWVtb3J5IGNhY2hlIGluIGRldmVsb3BtZW50XG4gKi9cblxuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdpb3JlZGlzJztcblxuLy8gQ2FjaGUgY29uZmlndXJhdGlvblxuY29uc3QgQ0FDSEVfQ09ORklHID0ge1xuICAgIC8vIERlZmF1bHQgVFRMIGluIHNlY29uZHNcbiAgICBERUZBVUxUX1RUTDogMzAwLCAvLyA1IG1pbnV0ZXNcblxuICAgIC8vIENhY2hlIGtleXNcbiAgICBLRVlTOiB7XG4gICAgICAgIElOVkVOVE9SWV9TVU1NQVJZOiAnaW52ZW50b3J5OnN1bW1hcnknLFxuICAgICAgICBJTlZPSUNFUzogJ2ludm9pY2VzOmxpc3QnLFxuICAgICAgICBJTlZPSUNFX1NUQVRTOiAnaW52b2ljZXM6c3RhdHMnLFxuICAgICAgICBDQVRFR09SSUVTOiAnY2F0ZWdvcmllczpsaXN0JyxcbiAgICAgICAgU0hPUFM6ICdzaG9wczpsaXN0JyxcbiAgICAgICAgQ1VTVE9NRVJTOiAnY3VzdG9tZXJzOmxpc3QnLFxuICAgICAgICBQUk9EVUNUUzogJ3Byb2R1Y3RzOmxpc3QnLFxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBjYWNoZSBrZXlzXG4gICAgICAgIFVTRVJfU0VTU0lPTjogJ2F1dGg6dXNlcjpzZXNzaW9uJyxcbiAgICAgICAgVVNFUl9QRVJNSVNTSU9OUzogJ2F1dGg6dXNlcjpwZXJtaXNzaW9ucycsXG4gICAgICAgIFJPTEVfUEVSTUlTU0lPTlM6ICdhdXRoOnJvbGU6cGVybWlzc2lvbnMnLFxuICAgICAgICBUT0tFTl9WQUxJREFUSU9OOiAnYXV0aDp0b2tlbjp2YWxpZGF0aW9uJyxcbiAgICB9LFxuXG4gICAgLy8gVFRMIGZvciBkaWZmZXJlbnQgZGF0YSB0eXBlc1xuICAgIFRUTDoge1xuICAgICAgICBJTlZFTlRPUlk6IDYwLCAvLyAxIG1pbnV0ZVxuICAgICAgICBJTlZPSUNFUzogMTIwLCAvLyAyIG1pbnV0ZXNcbiAgICAgICAgU1RBVFM6IDMwMCwgLy8gNSBtaW51dGVzXG4gICAgICAgIFJFRkVSRU5DRV9EQVRBOiAzNjAwLCAvLyAxIGhvdXIgKGNhdGVnb3JpZXMsIHNob3BzLCBldGMuKVxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBUVExzXG4gICAgICAgIFVTRVJfU0VTU0lPTjogOTAwLCAvLyAxNSBtaW51dGVzXG4gICAgICAgIFVTRVJfUEVSTUlTU0lPTlM6IDE4MDAsIC8vIDMwIG1pbnV0ZXNcbiAgICAgICAgUk9MRV9QRVJNSVNTSU9OUzogMzYwMCwgLy8gMSBob3VyXG4gICAgICAgIFRPS0VOX1ZBTElEQVRJT046IDMwMCwgLy8gNSBtaW51dGVzXG4gICAgfVxufTtcblxuLy8gSW4tbWVtb3J5IGNhY2hlIGZhbGxiYWNrIGZvciBkZXZlbG9wbWVudFxuY2xhc3MgTWVtb3J5Q2FjaGUge1xuICAgIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgeyBkYXRhOiBhbnk7IGV4cGlyZXM6IG51bWJlciB9PigpO1xuICAgIHByaXZhdGUgY2xlYW51cEludGVydmFsOiBOb2RlSlMuVGltZW91dDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBDbGVhbiB1cCBleHBpcmVkIGVudHJpZXMgZXZlcnkgNSBtaW51dGVzXG4gICAgICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbGVhbnVwKCk7XG4gICAgICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuICAgIH1cblxuICAgIGFzeW5jIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFlbnRyeSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgaWYgKERhdGUubm93KCkgPiBlbnRyeS5leHBpcmVzKSB7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW50cnkuZGF0YTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM6IG51bWJlciA9IENBQ0hFX0NPTkZJRy5ERUZBVUxUX1RUTCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBleHBpcmVzID0gRGF0ZS5ub3coKSArICh0dGxTZWNvbmRzICogMTAwMCk7XG4gICAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgeyBkYXRhOiB2YWx1ZSwgZXhwaXJlcyB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZSgnKicsICcuKicpKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5jYWNoZS5rZXlzKCkpIHtcbiAgICAgICAgICAgIGlmIChyZWdleC50ZXN0KGtleSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhbnVwKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgaWYgKG5vdyA+IGVudHJ5LmV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNsZWFudXBJbnRlcnZhbCk7XG4gICAgICAgIHRoaXMuY2FjaGUuY2xlYXIoKTtcbiAgICB9XG59XG5cbi8vIFJlZGlzIGNhY2hlIGltcGxlbWVudGF0aW9uXG5jbGFzcyBSZWRpc0NhY2hlIHtcbiAgICBwcml2YXRlIHJlZGlzOiBSZWRpcztcbiAgICBwcml2YXRlIGlzQ29ubmVjdGVkID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgY29uc3QgcmVkaXNVcmwgPSBwcm9jZXNzLmVudi5SRURJU19VUkwgfHwgJ3JlZGlzOi8vbG9jYWxob3N0OjYzNzknO1xuXG4gICAgICAgIHRoaXMucmVkaXMgPSBuZXcgUmVkaXMocmVkaXNVcmwsIHtcbiAgICAgICAgICAgIHJldHJ5RGVsYXlPbkZhaWxvdmVyOiAxMDAsXG4gICAgICAgICAgICBtYXhSZXRyaWVzUGVyUmVxdWVzdDogMyxcbiAgICAgICAgICAgIGxhenlDb25uZWN0OiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnJlZGlzLm9uKCdjb25uZWN0JywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+KchSBSZWRpcyBjb25uZWN0ZWQnKTtcbiAgICAgICAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnJlZGlzLm9uKCdlcnJvcicsIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFJlZGlzIGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5pc0Nvbm5lY3RlZCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb25uZWN0ZWQpIHJldHVybiBudWxsO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHRoaXMucmVkaXMuZ2V0KGtleSk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUgPyBKU09OLnBhcnNlKHZhbHVlKSA6IG51bGw7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWRpcyBnZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM6IG51bWJlciA9IENBQ0hFX0NPTkZJRy5ERUZBVUxUX1RUTCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb25uZWN0ZWQpIHJldHVybjtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5zZXRleChrZXksIHR0bFNlY29uZHMsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWRpcyBzZXQgZXJyb3I6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZGVsKGtleTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmICghdGhpcy5pc0Nvbm5lY3RlZCkgcmV0dXJuO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbChrZXkpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVkaXMgZGVsIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVQYXR0ZXJuKHBhdHRlcm46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb25uZWN0ZWQpIHJldHVybjtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qga2V5cyA9IGF3YWl0IHRoaXMucmVkaXMua2V5cyhwYXR0ZXJuKTtcbiAgICAgICAgICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLmRlbCguLi5rZXlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGludmFsaWRhdGVQYXR0ZXJuIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRpc2Nvbm5lY3QoKTogdm9pZCB7XG4gICAgICAgIHRoaXMucmVkaXMuZGlzY29ubmVjdCgpO1xuICAgIH1cbn1cblxuLy8gQ2FjaGUgc2VydmljZSBpbnRlcmZhY2VcbmludGVyZmFjZSBDYWNoZVNlcnZpY2Uge1xuICAgIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8YW55PjtcbiAgICBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM/OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+O1xuICAgIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD47XG4gICAgaW52YWxpZGF0ZVBhdHRlcm4ocGF0dGVybjogc3RyaW5nKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuLy8gQ2FjaGUgc2VydmljZSBpbXBsZW1lbnRhdGlvblxuY2xhc3MgQ2FjaGVNYW5hZ2VyIGltcGxlbWVudHMgQ2FjaGVTZXJ2aWNlIHtcbiAgICBwcml2YXRlIGNhY2hlOiBDYWNoZVNlcnZpY2U7XG4gICAgcHJpdmF0ZSB1c2VSZWRpczogYm9vbGVhbjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnVzZVJlZGlzID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyAmJiAhIXByb2Nlc3MuZW52LlJFRElTX1VSTDtcblxuICAgICAgICBpZiAodGhpcy51c2VSZWRpcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfmoAgVXNpbmcgUmVkaXMgY2FjaGUnKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUgPSBuZXcgUmVkaXNDYWNoZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfkr4gVXNpbmcgaW4tbWVtb3J5IGNhY2hlJyk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlID0gbmV3IE1lbW9yeUNhY2hlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM/OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuc2V0KGtleSwgdmFsdWUsIHR0bFNlY29uZHMpO1xuICAgIH1cblxuICAgIGFzeW5jIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5kZWwoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuaW52YWxpZGF0ZVBhdHRlcm4ocGF0dGVybik7XG4gICAgfVxuXG4gICAgLy8gSGVscGVyIG1ldGhvZHMgZm9yIGNvbW1vbiBjYWNoZSBvcGVyYXRpb25zXG4gICAgYXN5bmMgZ2V0T3JTZXQ8VD4oXG4gICAgICAgIGtleTogc3RyaW5nLFxuICAgICAgICBmZXRjaGVyOiAoKSA9PiBQcm9taXNlPFQ+LFxuICAgICAgICB0dGxTZWNvbmRzPzogbnVtYmVyXG4gICAgKTogUHJvbWlzZTxUPiB7XG4gICAgICAgIC8vIFRyeSB0byBnZXQgZnJvbSBjYWNoZSBmaXJzdFxuICAgICAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgICAgICBpZiAoY2FjaGVkICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggZnJlc2ggZGF0YVxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgZmV0Y2hlcigpO1xuXG4gICAgICAgIC8vIFN0b3JlIGluIGNhY2hlXG4gICAgICAgIGF3YWl0IHRoaXMuc2V0KGtleSwgZGF0YSwgdHRsU2Vjb25kcyk7XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgY2FjaGUga2V5IHdpdGggcGFyYW1ldGVyc1xuICAgIGdlbmVyYXRlS2V5KHByZWZpeDogc3RyaW5nLCBwYXJhbXM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHNvcnRlZFBhcmFtcyA9IE9iamVjdC5rZXlzKHBhcmFtcylcbiAgICAgICAgICAgIC5zb3J0KClcbiAgICAgICAgICAgIC5tYXAoa2V5ID0+IGAke2tleX06JHtwYXJhbXNba2V5XX1gKVxuICAgICAgICAgICAgLmpvaW4oJ3wnKTtcblxuICAgICAgICByZXR1cm4gc29ydGVkUGFyYW1zID8gYCR7cHJlZml4fToke3NvcnRlZFBhcmFtc31gIDogcHJlZml4O1xuICAgIH1cblxuICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZSBlbnRyaWVzXG4gICAgYXN5bmMgaW52YWxpZGF0ZUludmVudG9yeSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5JTlZFTlRPUllfU1VNTUFSWX0qYCksXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLlBST0RVQ1RTfSpgKSxcbiAgICAgICAgXSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaW52YWxpZGF0ZUludm9pY2VzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLklOVk9JQ0VTfSpgKSxcbiAgICAgICAgICAgIHRoaXMuaW52YWxpZGF0ZVBhdHRlcm4oYCR7Q0FDSEVfQ09ORklHLktFWVMuSU5WT0lDRV9TVEFUU30qYCksXG4gICAgICAgIF0pO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVSZWZlcmVuY2VEYXRhKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLkNBVEVHT1JJRVN9KmApLFxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5TSE9QU30qYCksXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLkNVU1RPTUVSU30qYCksXG4gICAgICAgIF0pO1xuICAgIH1cblxuICAgIC8vIEF1dGhlbnRpY2F0aW9uIGNhY2hlIGludmFsaWRhdGlvbiBtZXRob2RzXG4gICAgYXN5bmMgaW52YWxpZGF0ZVVzZXJTZXNzaW9uKHVzZXJJZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHVzZXJTZXNzaW9uS2V5ID0gdGhpcy5nZW5lcmF0ZUtleShDQUNIRV9DT05GSUcuS0VZUy5VU0VSX1NFU1NJT04sIHsgdXNlcklkIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmRlbCh1c2VyU2Vzc2lvbktleSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaW52YWxpZGF0ZVVzZXJQZXJtaXNzaW9ucyh1c2VySWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB1c2VyUGVybWlzc2lvbnNLZXkgPSB0aGlzLmdlbmVyYXRlS2V5KENBQ0hFX0NPTkZJRy5LRVlTLlVTRVJfUEVSTUlTU0lPTlMsIHsgdXNlcklkIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmRlbCh1c2VyUGVybWlzc2lvbnNLZXkpO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVSb2xlUGVybWlzc2lvbnMocm9sZUlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3Qgcm9sZVBlcm1pc3Npb25zS2V5ID0gdGhpcy5nZW5lcmF0ZUtleShDQUNIRV9DT05GSUcuS0VZUy5ST0xFX1BFUk1JU1NJT05TLCB7IHJvbGVJZCB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWwocm9sZVBlcm1pc3Npb25zS2V5KTtcbiAgICAgICAgLy8gQWxzbyBpbnZhbGlkYXRlIGFsbCB1c2VyIHBlcm1pc3Npb25zIGZvciB1c2VycyB3aXRoIHRoaXMgcm9sZVxuICAgICAgICBhd2FpdCB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLlVTRVJfUEVSTUlTU0lPTlN9KmApO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVUb2tlblZhbGlkYXRpb24odG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB0b2tlbktleSA9IHRoaXMuZ2VuZXJhdGVLZXkoQ0FDSEVfQ09ORklHLktFWVMuVE9LRU5fVkFMSURBVElPTiwgeyB0b2tlbjogdG9rZW4uc3Vic3RyaW5nKDAsIDIwKSB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWwodG9rZW5LZXkpO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVBbGxVc2VyQXV0aCh1c2VySWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVVc2VyU2Vzc2lvbih1c2VySWQpLFxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlVXNlclBlcm1pc3Npb25zKHVzZXJJZCksXG4gICAgICAgIF0pO1xuICAgIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuY29uc3QgY2FjaGUgPSBuZXcgQ2FjaGVNYW5hZ2VyKCk7XG5leHBvcnQgeyBjYWNoZSB9O1xuXG4vLyBFeHBvcnQgYXMgY2FjaGVTZXJ2aWNlIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5leHBvcnQgeyBjYWNoZSBhcyBjYWNoZVNlcnZpY2UgfTtcblxuLy8gRXhwb3J0IHR5cGVzIGFuZCBjb25zdGFudHNcbmV4cG9ydCB7IENBQ0hFX0NPTkZJRyB9O1xuZXhwb3J0IHR5cGUgeyBDYWNoZVNlcnZpY2UgfTtcblxuLy8gQ2xlYW51cCBvbiBwcm9jZXNzIGV4aXRcbnByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IHtcbiAgICBpZiAoY2FjaGUuY2FjaGUgaW5zdGFuY2VvZiBSZWRpc0NhY2hlKSB7XG4gICAgICAgIChjYWNoZS5jYWNoZSBhcyBhbnkpLmRpc2Nvbm5lY3QoKTtcbiAgICB9IGVsc2UgaWYgKGNhY2hlLmNhY2hlIGluc3RhbmNlb2YgTWVtb3J5Q2FjaGUpIHtcbiAgICAgICAgKGNhY2hlLmNhY2hlIGFzIGFueSkuZGVzdHJveSgpO1xuICAgIH1cbn0pOyJdLCJuYW1lcyI6WyJDQUNIRV9DT05GSUciLCJjYWNoZSIsImNhY2hlU2VydmljZSIsIkRFRkFVTFRfVFRMIiwiS0VZUyIsIklOVkVOVE9SWV9TVU1NQVJZIiwiSU5WT0lDRVMiLCJJTlZPSUNFX1NUQVRTIiwiQ0FURUdPUklFUyIsIlNIT1BTIiwiQ1VTVE9NRVJTIiwiUFJPRFVDVFMiLCJVU0VSX1NFU1NJT04iLCJVU0VSX1BFUk1JU1NJT05TIiwiUk9MRV9QRVJNSVNTSU9OUyIsIlRPS0VOX1ZBTElEQVRJT04iLCJUVEwiLCJJTlZFTlRPUlkiLCJTVEFUUyIsIlJFRkVSRU5DRV9EQVRBIiwiTWVtb3J5Q2FjaGUiLCJjb25zdHJ1Y3RvciIsIk1hcCIsImNsZWFudXBJbnRlcnZhbCIsInNldEludGVydmFsIiwiY2xlYW51cCIsImdldCIsImtleSIsImVudHJ5IiwiRGF0ZSIsIm5vdyIsImV4cGlyZXMiLCJkZWxldGUiLCJkYXRhIiwic2V0IiwidmFsdWUiLCJ0dGxTZWNvbmRzIiwiZGVsIiwiaW52YWxpZGF0ZVBhdHRlcm4iLCJwYXR0ZXJuIiwicmVnZXgiLCJSZWdFeHAiLCJyZXBsYWNlIiwia2V5cyIsInRlc3QiLCJlbnRyaWVzIiwiZGVzdHJveSIsImNsZWFySW50ZXJ2YWwiLCJjbGVhciIsIlJlZGlzQ2FjaGUiLCJpc0Nvbm5lY3RlZCIsInJlZGlzVXJsIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsInJlZGlzIiwiUmVkaXMiLCJyZXRyeURlbGF5T25GYWlsb3ZlciIsIm1heFJldHJpZXNQZXJSZXF1ZXN0IiwibGF6eUNvbm5lY3QiLCJvbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsIkpTT04iLCJwYXJzZSIsInNldGV4Iiwic3RyaW5naWZ5IiwibGVuZ3RoIiwiZGlzY29ubmVjdCIsIkNhY2hlTWFuYWdlciIsInVzZVJlZGlzIiwiTk9ERV9FTlYiLCJnZXRPclNldCIsImZldGNoZXIiLCJjYWNoZWQiLCJnZW5lcmF0ZUtleSIsInByZWZpeCIsInBhcmFtcyIsInNvcnRlZFBhcmFtcyIsIk9iamVjdCIsInNvcnQiLCJtYXAiLCJqb2luIiwiaW52YWxpZGF0ZUludmVudG9yeSIsIlByb21pc2UiLCJhbGwiLCJpbnZhbGlkYXRlSW52b2ljZXMiLCJpbnZhbGlkYXRlUmVmZXJlbmNlRGF0YSIsImludmFsaWRhdGVVc2VyU2Vzc2lvbiIsInVzZXJJZCIsInVzZXJTZXNzaW9uS2V5IiwiaW52YWxpZGF0ZVVzZXJQZXJtaXNzaW9ucyIsInVzZXJQZXJtaXNzaW9uc0tleSIsImludmFsaWRhdGVSb2xlUGVybWlzc2lvbnMiLCJyb2xlSWQiLCJyb2xlUGVybWlzc2lvbnNLZXkiLCJpbnZhbGlkYXRlVG9rZW5WYWxpZGF0aW9uIiwidG9rZW4iLCJ0b2tlbktleSIsInN1YnN0cmluZyIsImludmFsaWRhdGVBbGxVc2VyQXV0aCJdLCJtYXBwaW5ncyI6IkFBQUE7OztDQUdDOzs7Ozs7Ozs7OztJQWlUUUEsWUFBWTtlQUFaQTs7SUFOQUMsS0FBSztlQUFMQTs7SUFHU0MsWUFBWTtlQUFyQkQ7Ozt5QkE1U2E7QUFFdEIsc0JBQXNCO0FBQ3RCLE1BQU1ELGVBQWU7SUFDakIseUJBQXlCO0lBQ3pCRyxhQUFhO0lBRWIsYUFBYTtJQUNiQyxNQUFNO1FBQ0ZDLG1CQUFtQjtRQUNuQkMsVUFBVTtRQUNWQyxlQUFlO1FBQ2ZDLFlBQVk7UUFDWkMsT0FBTztRQUNQQyxXQUFXO1FBQ1hDLFVBQVU7UUFDViw0QkFBNEI7UUFDNUJDLGNBQWM7UUFDZEMsa0JBQWtCO1FBQ2xCQyxrQkFBa0I7UUFDbEJDLGtCQUFrQjtJQUN0QjtJQUVBLCtCQUErQjtJQUMvQkMsS0FBSztRQUNEQyxXQUFXO1FBQ1hYLFVBQVU7UUFDVlksT0FBTztRQUNQQyxnQkFBZ0I7UUFDaEIsc0JBQXNCO1FBQ3RCUCxjQUFjO1FBQ2RDLGtCQUFrQjtRQUNsQkMsa0JBQWtCO1FBQ2xCQyxrQkFBa0I7SUFDdEI7QUFDSjtBQUVBLDJDQUEyQztBQUMzQyxNQUFNSztJQUlGQyxhQUFjO2FBSE5wQixRQUFRLElBQUlxQjtRQUloQiwyQ0FBMkM7UUFDM0MsSUFBSSxDQUFDQyxlQUFlLEdBQUdDLFlBQVk7WUFDL0IsSUFB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