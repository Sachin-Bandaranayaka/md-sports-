40d9ee26f61946cc4545a367effbf554
// Fixed Database connection and configuration tests
// This file contains the corrected version of db.test.ts
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _db = require("../../src/lib/db");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {
        __proto__: null
    };
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
// Mock Prisma Client
const mockPrisma = {
    $connect: _globals.jest.fn(),
    $disconnect: _globals.jest.fn(),
    $executeRaw: _globals.jest.fn(),
    $queryRaw: _globals.jest.fn(),
    $transaction: _globals.jest.fn(),
    user: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    product: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    category: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    supplier: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    customer: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    salesInvoice: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    purchaseInvoice: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    inventoryItem: {
        findMany: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    }
};
// Mock database configuration
_globals.jest.mock("@/lib/config/database", ()=>({
        databaseConfig: {
            host: "localhost",
            port: 5432,
            database: "test_db",
            username: "test_user",
            password: "test_password",
            dialect: "postgresql",
            logging: false,
            pool: {
                max: 5,
                min: 0,
                acquire: 30000,
                idle: 10000
            }
        }
    }));
// Mock the Prisma import
_globals.jest.mock("@/lib/prisma", ()=>({
        __esModule: true,
        default: mockPrisma
    }));
describe("Database Library", ()=>{
    beforeEach(()=>{
        _globals.jest.clearAllMocks();
    });
    describe("db export", ()=>{
        it("should export db as the prisma client", ()=>{
            expect(_db.db).toBeDefined();
            expect(_db.db).toBe(mockPrismaClient);
        });
        it("should have user methods", ()=>{
            expect(_db.db.user).toBeDefined();
            expect(_db.db.user.findMany).toBeDefined();
            expect(_db.db.user.findUnique).toBeDefined();
            expect(_db.db.user.create).toBeDefined();
            expect(_db.db.user.update).toBeDefined();
            expect(_db.db.user.delete).toBeDefined();
        });
        it("should have shop methods", ()=>{
            expect(_db.db.shop).toBeDefined();
            expect(_db.db.shop.findMany).toBeDefined();
            expect(_db.db.shop.findUnique).toBeDefined();
            expect(_db.db.shop.create).toBeDefined();
            expect(_db.db.shop.update).toBeDefined();
            expect(_db.db.shop.delete).toBeDefined();
        });
        it("should have connection methods", ()=>{
            expect(_db.db.$connect).toBeDefined();
            expect(_db.db.$disconnect).toBeDefined();
            expect(_db.db.$transaction).toBeDefined();
        });
    });
    describe("prisma export", ()=>{
        it("should export prisma as the same client", ()=>{
            expect(_db.prisma).toBeDefined();
            expect(_db.prisma).toBe(mockPrismaClient);
            expect(_db.prisma).toBe(_db.db);
        });
    });
    describe("default export", ()=>{
        it("should export db as default", async ()=>{
            const defaultExport = await Promise.resolve().then(()=>/*#__PURE__*/ _interop_require_wildcard(require("../../src/lib/db")));
            expect(defaultExport.default).toBeDefined();
            expect(defaultExport.default).toBe(_db.db);
            expect(defaultExport.default).toBe(mockPrismaClient);
        });
    });
    describe("database operations", ()=>{
        it("should allow user queries", async ()=>{
            const mockUser = {
                id: 1,
                name: "Test User",
                email: "test@example.com"
            };
            mockPrisma.user.findUnique.mockResolvedValue(mockUser);
            const result = await _db.db.user.findUnique({
                where: {
                    id: 1
                }
            });
            expect(result).toEqual(mockUser);
            expect(mockPrisma.user.findUnique).toHaveBeenCalledWith({
                where: {
                    id: 1
                }
            });
        });
        it("should allow shop queries", async ()=>{
            const mockShop = {
                id: "shop1",
                name: "Test Shop"
            };
            mockPrisma.shop.findUnique.mockResolvedValue(mockShop);
            const result = await _db.db.shop.findUnique({
                where: {
                    id: "shop1"
                }
            });
            expect(result).toEqual(mockShop);
            expect(mockPrisma.shop.findUnique).toHaveBeenCalledWith({
                where: {
                    id: "shop1"
                }
            });
        });
        it("should allow transactions", async ()=>{
            const mockResult = {
                success: true
            };
            mockPrisma.$transaction.mockResolvedValue(mockResult);
            const transactionFn = _globals.jest.fn().mockResolvedValue(mockResult);
            const result = await _db.db.$transaction(transactionFn);
            expect(result).toEqual(mockResult);
            expect(mockPrisma.$transaction).toHaveBeenCalledWith(transactionFn);
        });
        it("should handle connection operations", async ()=>{
            mockPrisma.$connect.mockResolvedValue(undefined);
            mockPrisma.$disconnect.mockResolvedValue(undefined);
            await _db.db.$connect();
            await _db.db.$disconnect();
            expect(mockPrisma.$connect).toHaveBeenCalled();
            expect(mockPrisma.$disconnect).toHaveBeenCalled();
        });
    });
    describe("error handling", ()=>{
        it("should propagate database errors", async ()=>{
            const dbError = new Error("Database connection failed");
            mockPrisma.user.findUnique.mockRejectedValue(dbError);
            await expect(_db.db.user.findUnique({
                where: {
                    id: 1
                }
            })).rejects.toThrow("Database connection failed");
        });
        it("should propagate transaction errors", async ()=>{
            const transactionError = new Error("Transaction failed");
            mockPrisma.$transaction.mockRejectedValue(transactionError);
            const transactionFn = _globals.jest.fn();
            await expect(_db.db.$transaction(transactionFn)).rejects.toThrow("Transaction failed");
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vdGVzdHMvdW5pdC9kYi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIEZpeGVkIERhdGFiYXNlIGNvbm5lY3Rpb24gYW5kIGNvbmZpZ3VyYXRpb24gdGVzdHNcbi8vIFRoaXMgZmlsZSBjb250YWlucyB0aGUgY29ycmVjdGVkIHZlcnNpb24gb2YgZGIudGVzdC50c1xuXG5pbXBvcnQgeyBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbi8vIE1vY2sgUHJpc21hIENsaWVudFxuY29uc3QgbW9ja1ByaXNtYSA9IHtcbiAgJGNvbm5lY3Q6IGplc3QuZm4oKSxcbiAgJGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcbiAgJGV4ZWN1dGVSYXc6IGplc3QuZm4oKSxcbiAgJHF1ZXJ5UmF3OiBqZXN0LmZuKCksXG4gICR0cmFuc2FjdGlvbjogamVzdC5mbigpLFxuICB1c2VyOiB7XG4gICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgY291bnQ6IGplc3QuZm4oKVxuICB9LFxuICBwcm9kdWN0OiB7XG4gICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgY291bnQ6IGplc3QuZm4oKVxuICB9LFxuICBjYXRlZ29yeToge1xuICAgIGZpbmRNYW55OiBqZXN0LmZuKCksXG4gICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgIGNvdW50OiBqZXN0LmZuKClcbiAgfSxcbiAgc3VwcGxpZXI6IHtcbiAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICBjb3VudDogamVzdC5mbigpXG4gIH0sXG4gIGN1c3RvbWVyOiB7XG4gICAgZmluZE1hbnk6IGplc3QuZm4oKSxcbiAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgY291bnQ6IGplc3QuZm4oKVxuICB9LFxuICBzYWxlc0ludm9pY2U6IHtcbiAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICBjb3VudDogamVzdC5mbigpXG4gIH0sXG4gIHB1cmNoYXNlSW52b2ljZToge1xuICAgIGZpbmRNYW55OiBqZXN0LmZuKCksXG4gICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgIGNvdW50OiBqZXN0LmZuKClcbiAgfSxcbiAgaW52ZW50b3J5SXRlbToge1xuICAgIGZpbmRNYW55OiBqZXN0LmZuKCksXG4gICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgIGNvdW50OiBqZXN0LmZuKClcbiAgfVxufTtcblxuLy8gTW9jayBkYXRhYmFzZSBjb25maWd1cmF0aW9uXG5qZXN0Lm1vY2soJ0AvbGliL2NvbmZpZy9kYXRhYmFzZScsICgpID0+ICh7XG4gIGRhdGFiYXNlQ29uZmlnOiB7XG4gICAgaG9zdDogJ2xvY2FsaG9zdCcsXG4gICAgcG9ydDogNTQzMixcbiAgICBkYXRhYmFzZTogJ3Rlc3RfZGInLFxuICAgIHVzZXJuYW1lOiAndGVzdF91c2VyJyxcbiAgICBwYXNzd29yZDogJ3Rlc3RfcGFzc3dvcmQnLFxuICAgIGRpYWxlY3Q6ICdwb3N0Z3Jlc3FsJyxcbiAgICBsb2dnaW5nOiBmYWxzZSxcbiAgICBwb29sOiB7XG4gICAgICBtYXg6IDUsXG4gICAgICBtaW46IDAsXG4gICAgICBhY3F1aXJlOiAzMDAwMCxcbiAgICAgIGlkbGU6IDEwMDAwXG4gICAgfVxuICB9XG59KSk7XG5cbi8vIE1vY2sgdGhlIFByaXNtYSBpbXBvcnRcbmplc3QubW9jaygnQC9saWIvcHJpc21hJywgKCkgPT4gKHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgZGVmYXVsdDogbW9ja1ByaXNtYSxcbn0pKTtcblxuaW1wb3J0IHsgZGIsIHByaXNtYSB9IGZyb20gJ0AvbGliL2RiJztcblxuZGVzY3JpYmUoJ0RhdGFiYXNlIExpYnJhcnknLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGIgZXhwb3J0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhwb3J0IGRiIGFzIHRoZSBwcmlzbWEgY2xpZW50JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGRiKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiKS50b0JlKG1vY2tQcmlzbWFDbGllbnQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIHVzZXIgbWV0aG9kcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChkYi51c2VyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnVzZXIuZmluZE1hbnkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGIudXNlci5maW5kVW5pcXVlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnVzZXIuY3JlYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnVzZXIudXBkYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnVzZXIuZGVsZXRlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIHNob3AgbWV0aG9kcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChkYi5zaG9wKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnNob3AuZmluZE1hbnkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGIuc2hvcC5maW5kVW5pcXVlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnNob3AuY3JlYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnNob3AudXBkYXRlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRiLnNob3AuZGVsZXRlKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYXZlIGNvbm5lY3Rpb24gbWV0aG9kcycsICgpID0+IHtcbiAgICAgIGV4cGVjdChkYi4kY29ubmVjdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkYi4kZGlzY29ubmVjdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChkYi4kdHJhbnNhY3Rpb24pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdwcmlzbWEgZXhwb3J0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhwb3J0IHByaXNtYSBhcyB0aGUgc2FtZSBjbGllbnQnLCAoKSA9PiB7XG4gICAgICBleHBlY3QocHJpc21hKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHByaXNtYSkudG9CZShtb2NrUHJpc21hQ2xpZW50KTtcbiAgICAgIGV4cGVjdChwcmlzbWEpLnRvQmUoZGIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGVmYXVsdCBleHBvcnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBleHBvcnQgZGIgYXMgZGVmYXVsdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlZmF1bHRFeHBvcnQgPSBhd2FpdCBpbXBvcnQoJ0AvbGliL2RiJyk7XG4gICAgICBleHBlY3QoZGVmYXVsdEV4cG9ydC5kZWZhdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRlZmF1bHRFeHBvcnQuZGVmYXVsdCkudG9CZShkYik7XG4gICAgICBleHBlY3QoZGVmYXVsdEV4cG9ydC5kZWZhdWx0KS50b0JlKG1vY2tQcmlzbWFDbGllbnQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGF0YWJhc2Ugb3BlcmF0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IHVzZXIgcXVlcmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0geyBpZDogMSwgbmFtZTogJ1Rlc3QgVXNlcicsIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScgfTtcbiAgICAgIG1vY2tQcmlzbWEudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tVc2VyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIudXNlci5maW5kVW5pcXVlKHsgd2hlcmU6IHsgaWQ6IDEgfSB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrVXNlcik7XG4gICAgICBleHBlY3QobW9ja1ByaXNtYS51c2VyLmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgd2hlcmU6IHsgaWQ6IDEgfSB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgc2hvcCBxdWVyaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Nob3AgPSB7IGlkOiAnc2hvcDEnLCBuYW1lOiAnVGVzdCBTaG9wJyB9O1xuICAgICAgbW9ja1ByaXNtYS5zaG9wLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Nob3ApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5zaG9wLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBpZDogJ3Nob3AxJyB9IH0pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tTaG9wKTtcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLnNob3AuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyB3aGVyZTogeyBpZDogJ3Nob3AxJyB9IH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyB0cmFuc2FjdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVzdWx0ID0geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgICBtb2NrUHJpc21hLiR0cmFuc2FjdGlvbi5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcblxuICAgICAgY29uc3QgdHJhbnNhY3Rpb25GbiA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLiR0cmFuc2FjdGlvbih0cmFuc2FjdGlvbkZuKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVzdWx0KTtcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLiR0cmFuc2FjdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgodHJhbnNhY3Rpb25Gbik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb25uZWN0aW9uIG9wZXJhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLiRjb25uZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG4gICAgICBtb2NrUHJpc21hLiRkaXNjb25uZWN0Lm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAgIGF3YWl0IGRiLiRjb25uZWN0KCk7XG4gICAgICBhd2FpdCBkYi4kZGlzY29ubmVjdCgpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1ByaXNtYS4kY29ubmVjdCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEuJGRpc2Nvbm5lY3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Vycm9yIGhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJvcGFnYXRlIGRhdGFiYXNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRiRXJyb3IgPSBuZXcgRXJyb3IoJ0RhdGFiYXNlIGNvbm5lY3Rpb24gZmFpbGVkJyk7XG4gICAgICBtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVqZWN0ZWRWYWx1ZShkYkVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGRiLnVzZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGlkOiAxIH0gfSkpLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvcGFnYXRlIHRyYW5zYWN0aW9uIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9uRXJyb3IgPSBuZXcgRXJyb3IoJ1RyYW5zYWN0aW9uIGZhaWxlZCcpO1xuICAgICAgbW9ja1ByaXNtYS4kdHJhbnNhY3Rpb24ubW9ja1JlamVjdGVkVmFsdWUodHJhbnNhY3Rpb25FcnJvcik7XG5cbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9uRm4gPSBqZXN0LmZuKCk7XG4gICAgICBhd2FpdCBleHBlY3QoZGIuJHRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uRm4pKS5yZWplY3RzLnRvVGhyb3coJ1RyYW5zYWN0aW9uIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJuYW1lcyI6WyJtb2NrUHJpc21hIiwiJGNvbm5lY3QiLCJqZXN0IiwiZm4iLCIkZGlzY29ubmVjdCIsIiRleGVjdXRlUmF3IiwiJHF1ZXJ5UmF3IiwiJHRyYW5zYWN0aW9uIiwidXNlciIsImZpbmRNYW55IiwiZmluZFVuaXF1ZSIsImNyZWF0ZSIsInVwZGF0ZSIsImRlbGV0ZSIsImNvdW50IiwicHJvZHVjdCIsImNhdGVnb3J5Iiwic3VwcGxpZXIiLCJjdXN0b21lciIsInNhbGVzSW52b2ljZSIsInB1cmNoYXNlSW52b2ljZSIsImludmVudG9yeUl0ZW0iLCJtb2NrIiwiZGF0YWJhc2VDb25maWciLCJob3N0IiwicG9ydCIsImRhdGFiYXNlIiwidXNlcm5hbWUiLCJwYXNzd29yZCIsImRpYWxlY3QiLCJsb2dnaW5nIiwicG9vbCIsIm1heCIsIm1pbiIsImFjcXVpcmUiLCJpZGxlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwiaXQiLCJleHBlY3QiLCJkYiIsInRvQmVEZWZpbmVkIiwidG9CZSIsIm1vY2tQcmlzbWFDbGllbnQiLCJzaG9wIiwicHJpc21hIiwiZGVmYXVsdEV4cG9ydCIsIm1vY2tVc2VyIiwiaWQiLCJuYW1lIiwiZW1haWwiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInJlc3VsdCIsIndoZXJlIiwidG9FcXVhbCIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwibW9ja1Nob3AiLCJtb2NrUmVzdWx0Iiwic3VjY2VzcyIsInRyYW5zYWN0aW9uRm4iLCJ1bmRlZmluZWQiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwiZGJFcnJvciIsIkVycm9yIiwibW9ja1JlamVjdGVkVmFsdWUiLCJyZWplY3RzIiwidG9UaHJvdyIsInRyYW5zYWN0aW9uRXJyb3IiXSwibWFwcGluZ3MiOiJBQUFBLG9EQUFvRDtBQUNwRCx5REFBeUQ7Ozs7O3lCQUVwQztvQkFxR007Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWxHM0IscUJBQXFCO0FBQ3JCLE1BQU1BLGFBQWE7SUFDakJDLFVBQVVDLGFBQUksQ0FBQ0MsRUFBRTtJQUNqQkMsYUFBYUYsYUFBSSxDQUFDQyxFQUFFO0lBQ3BCRSxhQUFhSCxhQUFJLENBQUNDLEVBQUU7SUFDcEJHLFdBQVdKLGFBQUksQ0FBQ0MsRUFBRTtJQUNsQkksY0FBY0wsYUFBSSxDQUFDQyxFQUFFO0lBQ3JCSyxNQUFNO1FBQ0pDLFVBQVVQLGFBQUksQ0FBQ0MsRUFBRTtRQUNqQk8sWUFBWVIsYUFBSSxDQUFDQyxFQUFFO1FBQ25CUSxRQUFRVCxhQUFJLENBQUNDLEVBQUU7UUFDZlMsUUFBUVYsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZVLFFBQVFYLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVyxPQUFPWixhQUFJLENBQUNDLEVBQUU7SUFDaEI7SUFDQVksU0FBUztRQUNQTixVQUFVUCxhQUFJLENBQUNDLEVBQUU7UUFDakJPLFlBQVlSLGFBQUksQ0FBQ0MsRUFBRTtRQUNuQlEsUUFBUVQsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZTLFFBQVFWLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVSxRQUFRWCxhQUFJLENBQUNDLEVBQUU7UUFDZlcsT0FBT1osYUFBSSxDQUFDQyxFQUFFO0lBQ2hCO0lBQ0FhLFVBQVU7UUFDUlAsVUFBVVAsYUFBSSxDQUFDQyxFQUFFO1FBQ2pCTyxZQUFZUixhQUFJLENBQUNDLEVBQUU7UUFDbkJRLFFBQVFULGFBQUksQ0FBQ0MsRUFBRTtRQUNmUyxRQUFRVixhQUFJLENBQUNDLEVBQUU7UUFDZlUsUUFBUVgsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZXLE9BQU9aLGFBQUksQ0FBQ0MsRUFBRTtJQUNoQjtJQUNBYyxVQUFVO1FBQ1JSLFVBQVVQLGFBQUksQ0FBQ0MsRUFBRTtRQUNqQk8sWUFBWVIsYUFBSSxDQUFDQyxFQUFFO1FBQ25CUSxRQUFRVCxhQUFJLENBQUNDLEVBQUU7UUFDZlMsUUFBUVYsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZVLFFBQVFYLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVyxPQUFPWixhQUFJLENBQUNDLEVBQUU7SUFDaEI7SUFDQWUsVUFBVTtRQUNSVCxVQUFVUCxhQUFJLENBQUNDLEVBQUU7UUFDakJPLFlBQVlSLGFBQUksQ0FBQ0MsRUFBRTtRQUNuQlEsUUFBUVQsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZTLFFBQVFWLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVSxRQUFRWCxhQUFJLENBQUNDLEVBQUU7UUFDZlcsT0FBT1osYUFBSSxDQUFDQyxFQUFFO0lBQ2hCO0lBQ0FnQixjQUFjO1FBQ1pWLFVBQVVQLGFBQUksQ0FBQ0MsRUFBRTtRQUNqQk8sWUFBWVIsYUFBSSxDQUFDQyxFQUFFO1FBQ25CUSxRQUFRVCxhQUFJLENBQUNDLEVBQUU7UUFDZlMsUUFBUVYsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZVLFFBQVFYLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVyxPQUFPWixhQUFJLENBQUNDLEVBQUU7SUFDaEI7SUFDQWlCLGlCQUFpQjtRQUNmWCxVQUFVUCxhQUFJLENBQUNDLEVBQUU7UUFDakJPLFlBQVlSLGFBQUksQ0FBQ0MsRUFBRTtRQUNuQlEsUUFBUVQsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZTLFFBQVFWLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVSxRQUFRWCxhQUFJLENBQUNDLEVBQUU7UUFDZlcsT0FBT1osYUFBSSxDQUFDQyxFQUFFO0lBQ2hCO0lBQ0FrQixlQUFlO1FBQ2JaLFVBQVVQLGFBQUksQ0FBQ0MsRUFBRTtRQUNqQk8sWUFBWVIsYUFBSSxDQUFDQyxFQUFFO1FBQ25CUSxRQUFRVCxhQUFJLENBQUNDLEVBQUU7UUFDZlMsUUFBUVYsYUFBSSxDQUFDQyxFQUFFO1FBQ2ZVLFFBQVFYLGFBQUksQ0FBQ0MsRUFBRTtRQUNmVyxPQUFPWixhQUFJLENBQUNDLEVBQUU7SUFDaEI7QUFDRjtBQUVBLDhCQUE4QjtBQUM5QkQsYUFBSSxDQUFDb0IsSUFBSSxDQUFDLHlCQUF5QixJQUFPLENBQUE7UUFDeENDLGdCQUFnQjtZQUNkQyxNQUFNO1lBQ05DLE1BQU07WUFDTkMsVUFBVTtZQUNWQyxVQUFVO1lBQ1ZDLFVBQVU7WUFDVkMsU0FBUztZQUNUQyxTQUFTO1lBQ1RDLE1BQU07Z0JBQ0pDLEtBQUs7Z0JBQ0xDLEtBQUs7Z0JBQ0xDLFNBQVM7Z0JBQ1RDLE1BQU07WUFDUjtRQUNGO0lBQ0YsQ0FBQTtBQUVBLHlCQUF5QjtBQUN6QmpDLGFBQUksQ0FBQ29CLElBQUksQ0FBQyxnQkFBZ0IsSUFBTyxDQUFBO1FBQy9CYyxZQUFZO1FBQ1pDLFNBQVNyQztJQUNYLENBQUE7QUFJQXNDLFNBQVMsb0JBQW9CO0lBQzNCQyxXQUFXO1FBQ1RyQyxhQUFJLENBQUNzQyxhQUFhO0lBQ3BCO0lBRUFGLFNBQVMsYUFBYTtRQUNwQkcsR0FBRyx5Q0FBeUM7WUFDMUNDLE9BQU9DLE1BQUUsRUFBRUMsV0FBVztZQUN0QkYsT0FBT0MsTUFBRSxFQUFFRSxJQUFJLENBQUNDO1FBQ2xCO1FBRUFMLEdBQUcsNEJBQTRCO1lBQzdCQyxPQUFPQyxNQUFFLENBQUNuQyxJQUFJLEVBQUVvQyxXQUFXO1lBQzNCRixPQUFPQyxNQUFFLENBQUNuQyxJQUFJLENBQUNDLFFBQVEsRUFBRW1DLFdBQVc7WUFDcENGLE9BQU9DLE1BQUUsQ0FBQ25DLElBQUksQ0FBQ0UsVUFBVSxFQUFFa0MsV0FBVztZQUN0Q0YsT0FBT0MsTUFBRSxDQUFDbkMsSUFBSSxDQUFDRyxNQUFNLEVBQUVpQyxXQUFXO1lBQ2xDRixPQUFPQyxNQUFFLENBQUNuQyxJQUFJLENBQUNJLE1BQU0sRUFBRWdDLFdBQVc7WUFDbENGLE9BQU9DLE1BQUUsQ0FBQ25DLElBQUksQ0FBQ0ssTUFBTSxFQUFFK0IsV0FBVztRQUNwQztRQUVBSCxHQUFHLDRCQUE0QjtZQUM3QkMsT0FBT0MsTUFBRSxDQUFDSSxJQUFJLEVBQUVILFdBQVc7WUFDM0JGLE9BQU9DLE1BQUUsQ0FBQ0ksSUFBSSxDQUFDdEMsUUFBUSxFQUFFbUMsV0FBVztZQUNwQ0YsT0FBT0MsTUFBRSxDQUFDSSxJQUFJLENBQUNyQyxVQUFVLEVBQUVrQyxXQUFXO1lBQ3RDRixPQUFPQyxNQUFFLENBQUNJLElBQUksQ0FBQ3BDLE1BQU0sRUFBRWlDLFdBQVc7WUFDbENGLE9BQU9DLE1BQUUsQ0FBQ0ksSUFBSSxDQUFDbkMsTUFBTSxFQUFFZ0MsV0FBVztZQUNsQ0YsT0FBT0MsTUFBRSxDQUFDSSxJQUFJLENBQUNsQyxNQUFNLEVBQUUrQixXQUFXO1FBQ3BDO1FBRUFILEdBQUcsa0NBQWtDO1lBQ25DQyxPQUFPQyxNQUFFLENBQUMxQyxRQUFRLEVBQUUyQyxXQUFXO1lBQy9CRixPQUFPQyxNQUFFLENBQUN2QyxXQUFXLEVBQUV3QyxXQUFXO1lBQ2xDRixPQUFPQyxNQUFFLENBQUNwQyxZQUFZLEVBQUVxQyxXQUFXO1FBQ3JDO0lBQ0Y7SUFFQU4sU0FBUyxpQkFBaUI7UUFDeEJHLEdBQUcsMkNBQTJDO1lBQzVDQyxPQUFPTSxVQUFNLEVBQUVKLFdBQVc7WUFDMUJGLE9BQU9NLFVBQU0sRUFBRUgsSUFBSSxDQUFDQztZQUNwQkosT0FBT00sVUFBTSxFQUFFSCxJQUFJLENBQUNGLE1BQUU7UUFDeEI7SUFDRjtJQUVBTCxTQUFTLGtCQUFrQjtRQUN6QkcsR0FBRywrQkFBK0I7WUFDaEMsTUFBTVEsZ0JBQWdCLE1BQU0sbUVBQUEsUUFBTztZQUNuQ1AsT0FBT08sY0FBY1osT0FBTyxFQUFFTyxXQUFXO1lBQ3pDRixPQUFPTyxjQUFjWixPQUFPLEVBQUVRLElBQUksQ0FBQ0YsTUFBRTtZQUNyQ0QsT0FBT08sY0FBY1osT0FBTyxFQUFFUSxJQUFJLENBQUNDO1FBQ3JDO0lBQ0Y7SUFFQVIsU0FBUyx1QkFBdUI7UUFDOUJHLEdBQUcsNkJBQTZCO1lBQzlCLE1BQU1TLFdBQVc7Z0JBQUVDLElBQUk7Z0JBQUdDLE1BQU07Z0JBQWFDLE9BQU87WUFBbUI7WUFDdkVyRCxXQUFXUSxJQUFJLENBQUNFLFVBQVUsQ0FBQzRDLGlCQUFpQixDQUFDSjtZQUU3QyxNQUFNSyxTQUFTLE1BQU1aLE1BQUUsQ0FBQ25DLElBQUksQ0FBQ0UsVUFBVSxDQUFDO2dCQUFFOEMsT0FBTztvQkFBRUwsSUFBSTtnQkFBRTtZQUFFO1lBRTNEVCxPQUFPYSxRQUFRRSxPQUFPLENBQUNQO1lBQ3ZCUixPQUFPMUMsV0FBV1EsSUFBSSxDQUFDRSxVQUFVLEVBQUVnRCxvQkFBb0IsQ0FBQztnQkFBRUYsT0FBTztvQkFBRUwsSUFBSTtnQkFBRTtZQUFFO1FBQzdFO1FBRUFWLEdBQUcsNkJBQTZCO1lBQzlCLE1BQU1rQixXQUFXO2dCQUFFUixJQUFJO2dCQUFTQyxNQUFNO1lBQVk7WUFDbERwRCxXQUFXK0MsSUFBSSxDQUFDckMsVUFBVSxDQUFDNEMsaUJBQWlCLENBQUNLO1lBRTdDLE1BQU1KLFNBQVMsTUFBTVosTUFBRSxDQUFDSSxJQUFJLENBQUNyQyxVQUFVLENBQUM7Z0JBQUU4QyxPQUFPO29CQUFFTCxJQUFJO2dCQUFRO1lBQUU7WUFFakVULE9BQU9hLFFBQVFFLE9BQU8sQ0FBQ0U7WUFDdkJqQixPQUFPMUMsV0FBVytDLElBQUksQ0FBQ3JDLFVBQVUsRUFBRWdELG9CQUFvQixDQUFDO2dCQUFFRixPQUFPO29CQUFFTCxJQUFJO2dCQUFRO1lBQUU7UUFDbkY7UUFFQVYsR0FBRyw2QkFBNkI7WUFDOUIsTUFBTW1CLGFBQWE7Z0JBQUVDLFNBQVM7WUFBSztZQUNuQzdELFdBQVdPLFlBQVksQ0FBQytDLGlCQUFpQixDQUFDTTtZQUUxQyxNQUFNRSxnQkFBZ0I1RCxhQUFJLENBQUNDLEVBQUUsR0FBR21ELGlCQUFpQixDQUFDTTtZQUNsRCxNQUFNTCxTQUFTLE1BQU1aLE1BQUUsQ0FBQ3BDLFlBQVksQ0FBQ3VEO1lBRXJDcEIsT0FBT2EsUUFBUUUsT0FBTyxDQUFDRztZQUN2QmxCLE9BQU8xQyxXQUFXTyxZQUFZLEVBQUVtRCxvQkFBb0IsQ0FBQ0k7UUFDdkQ7UUFFQXJCLEdBQUcsdUNBQXVDO1lBQ3hDekMsV0FBV0MsUUFBUSxDQUFDcUQsaUJBQWlCLENBQUNTO1lBQ3RDL0QsV0FBV0ksV0FBVyxDQUFDa0QsaUJBQWlCLENBQUNTO1lBRXpDLE1BQU1wQixNQUFFLENBQUMxQyxRQUFRO1lBQ2pCLE1BQU0wQyxNQUFFLENBQUN2QyxXQUFXO1lBRXBCc0MsT0FBTzFDLFdBQVdDLFFBQVEsRUFBRStELGdCQUFnQjtZQUM1Q3RCLE9BQU8xQyxXQUFXSSxXQUFXLEVBQUU0RCxnQkFBZ0I7UUFDakQ7SUFDRjtJQUVBMUIsU0FBUyxrQkFBa0I7UUFDekJHLEdBQUcsb0NBQW9DO1lBQ3JDLE1BQU13QixVQUFVLElBQUlDLE1BQU07WUFDMUJsRSxXQUFXUSxJQUFJLENBQUNFLFVBQVUsQ0FBQ3lELGlCQUFpQixDQUFDRjtZQUU3QyxNQUFNdkIsT0FBT0MsTUFBRSxDQUFDbkMsSUFBSSxDQUFDRSxVQUFVLENBQUM7Z0JBQUU4QyxPQUFPO29CQUFFTCxJQUFJO2dCQUFFO1lBQUUsSUFBSWlCLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDO1FBQ3pFO1FBRUE1QixHQUFHLHVDQUF1QztZQUN4QyxNQUFNNkIsbUJBQW1CLElBQUlKLE1BQU07WUFDbkNsRSxXQUFXTyxZQUFZLENBQUM0RCxpQkFBaUIsQ0FBQ0c7WUFFMUMsTUFBTVIsZ0JBQWdCNUQsYUFBSSxDQUFDQyxFQUFFO1lBQzdCLE1BQU11QyxPQUFPQyxNQUFFLENBQUNwQyxZQUFZLENBQUN1RCxnQkFBZ0JNLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDO1FBQy9EO0lBQ0Y7QUFDRiJ9