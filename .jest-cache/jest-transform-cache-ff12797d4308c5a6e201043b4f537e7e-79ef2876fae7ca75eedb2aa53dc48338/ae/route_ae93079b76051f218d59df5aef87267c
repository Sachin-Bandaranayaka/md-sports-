6ea18ca5a264dea2927bf460a7d564ed
"use strict";

/* istanbul ignore next */
function cov_29cerbptvx() {
  var path = "/Users/sachin/Documents/md-sports-/src/app/api/shops/route.ts";
  var hash = "5acd66c6baed31e2f4f7d84a684a09fcb43a1464";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/sachin/Documents/md-sports-/src/app/api/shops/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 2,
          column: 0
        },
        end: {
          line: 4,
          column: 3
        }
      },
      "1": {
        start: {
          line: 6,
          column: 4
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "2": {
        start: {
          line: 6,
          column: 24
        },
        end: {
          line: 9,
          column: 7
        }
      },
      "3": {
        start: {
          line: 11,
          column: 0
        },
        end: {
          line: 18,
          column: 3
        }
      },
      "4": {
        start: {
          line: 13,
          column: 8
        },
        end: {
          line: 13,
          column: 19
        }
      },
      "5": {
        start: {
          line: 16,
          column: 8
        },
        end: {
          line: 16,
          column: 20
        }
      },
      "6": {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 38
        }
      },
      "7": {
        start: {
          line: 20,
          column: 30
        },
        end: {
          line: 20,
          column: 86
        }
      },
      "8": {
        start: {
          line: 21,
          column: 14
        },
        end: {
          line: 21,
          column: 42
        }
      },
      "9": {
        start: {
          line: 23,
          column: 4
        },
        end: {
          line: 25,
          column: 6
        }
      },
      "10": {
        start: {
          line: 28,
          column: 4
        },
        end: {
          line: 174,
          column: 5
        }
      },
      "11": {
        start: {
          line: 29,
          column: 20
        },
        end: {
          line: 29,
          column: 36
        }
      },
      "12": {
        start: {
          line: 30,
          column: 23
        },
        end: {
          line: 30,
          column: 64
        }
      },
      "13": {
        start: {
          line: 32,
          column: 43
        },
        end: {
          line: 32,
          column: 114
        }
      },
      "14": {
        start: {
          line: 33,
          column: 37
        },
        end: {
          line: 33,
          column: 97
        }
      },
      "15": {
        start: {
          line: 34,
          column: 8
        },
        end: {
          line: 41,
          column: 9
        }
      },
      "16": {
        start: {
          line: 35,
          column: 12
        },
        end: {
          line: 40,
          column: 15
        }
      },
      "17": {
        start: {
          line: 43,
          column: 22
        },
        end: {
          line: 43,
          column: 50
        }
      },
      "18": {
        start: {
          line: 44,
          column: 24
        },
        end: {
          line: 44,
          column: 74
        }
      },
      "19": {
        start: {
          line: 45,
          column: 25
        },
        end: {
          line: 45,
          column: 48
        }
      },
      "20": {
        start: {
          line: 46,
          column: 27
        },
        end: {
          line: 46,
          column: 67
        }
      },
      "21": {
        start: {
          line: 47,
          column: 35
        },
        end: {
          line: 47,
          column: 93
        }
      },
      "22": {
        start: {
          line: 48,
          column: 37
        },
        end: {
          line: 48,
          column: 97
        }
      },
      "23": {
        start: {
          line: 49,
          column: 24
        },
        end: {
          line: 49,
          column: 114
        }
      },
      "24": {
        start: {
          line: 51,
          column: 26
        },
        end: {
          line: 51,
          column: 47
        }
      },
      "25": {
        start: {
          line: 53,
          column: 8
        },
        end: {
          line: 61,
          column: 11
        }
      },
      "26": {
        start: {
          line: 62,
          column: 8
        },
        end: {
          line: 89,
          column: 9
        }
      },
      "27": {
        start: {
          line: 64,
          column: 30
        },
        end: {
          line: 64,
          column: 32
        }
      },
      "28": {
        start: {
          line: 67,
          column: 12
        },
        end: {
          line: 74,
          column: 13
        }
      },
      "29": {
        start: {
          line: 68,
          column: 16
        },
        end: {
          line: 70,
          column: 18
        }
      },
      "30": {
        start: {
          line: 71,
          column: 16
        },
        end: {
          line: 71,
          column: 66
        }
      },
      "31": {
        start: {
          line: 73,
          column: 16
        },
        end: {
          line: 73,
          column: 124
        }
      },
      "32": {
        start: {
          line: 75,
          column: 26
        },
        end: {
          line: 84,
          column: 14
        }
      },
      "33": {
        start: {
          line: 85,
          column: 12
        },
        end: {
          line: 88,
          column: 15
        }
      },
      "34": {
        start: {
          line: 91,
          column: 26
        },
        end: {
          line: 91,
          column: 28
        }
      },
      "35": {
        start: {
          line: 93,
          column: 8
        },
        end: {
          line: 97,
          column: 9
        }
      },
      "36": {
        start: {
          line: 94,
          column: 12
        },
        end: {
          line: 96,
          column: 14
        }
      },
      "37": {
        start: {
          line: 98,
          column: 22
        },
        end: {
          line: 141,
          column: 10
        }
      },
      "38": {
        start: {
          line: 143,
          column: 35
        },
        end: {
          line: 149,
          column: 10
        }
      },
      "39": {
        start: {
          line: 144,
          column: 46
        },
        end: {
          line: 144,
          column: 50
        }
      },
      "40": {
        start: {
          line: 145,
          column: 12
        },
        end: {
          line: 148,
          column: 14
        }
      },
      "41": {
        start: {
          line: 150,
          column: 8
        },
        end: {
          line: 155,
          column: 9
        }
      },
      "42": {
        start: {
          line: 151,
          column: 12
        },
        end: {
          line: 154,
          column: 15
        }
      },
      "43": {
        start: {
          line: 156,
          column: 8
        },
        end: {
          line: 159,
          column: 11
        }
      },
      "44": {
        start: {
          line: 161,
          column: 8
        },
        end: {
          line: 161,
          column: 70
        }
      },
      "45": {
        start: {
          line: 163,
          column: 27
        },
        end: {
          line: 163,
          column: 79
        }
      },
      "46": {
        start: {
          line: 164,
          column: 8
        },
        end: {
          line: 167,
          column: 9
        }
      },
      "47": {
        start: {
          line: 165,
          column: 12
        },
        end: {
          line: 165,
          column: 41
        }
      },
      "48": {
        start: {
          line: 168,
          column: 8
        },
        end: {
          line: 173,
          column: 11
        }
      },
      "49": {
        start: {
          line: 177,
          column: 4
        },
        end: {
          line: 201,
          column: 5
        }
      },
      "50": {
        start: {
          line: 178,
          column: 21
        },
        end: {
          line: 178,
          column: 41
        }
      },
      "51": {
        start: {
          line: 179,
          column: 24
        },
        end: {
          line: 186,
          column: 10
        }
      },
      "52": {
        start: {
          line: 187,
          column: 8
        },
        end: {
          line: 192,
          column: 11
        }
      },
      "53": {
        start: {
          line: 194,
          column: 8
        },
        end: {
          line: 194,
          column: 53
        }
      },
      "54": {
        start: {
          line: 195,
          column: 8
        },
        end: {
          line: 200,
          column: 11
        }
      }
    },
    fnMap: {
      "0": {
        name: "_export",
        decl: {
          start: {
            line: 5,
            column: 9
          },
          end: {
            line: 5,
            column: 16
          }
        },
        loc: {
          start: {
            line: 5,
            column: 30
          },
          end: {
            line: 10,
            column: 1
          }
        },
        line: 5
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 12,
            column: 9
          },
          end: {
            line: 12,
            column: 10
          }
        },
        loc: {
          start: {
            line: 12,
            column: 20
          },
          end: {
            line: 14,
            column: 5
          }
        },
        line: 12
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 10
          },
          end: {
            line: 15,
            column: 11
          }
        },
        loc: {
          start: {
            line: 15,
            column: 21
          },
          end: {
            line: 17,
            column: 5
          }
        },
        line: 15
      },
      "3": {
        name: "_interop_require_default",
        decl: {
          start: {
            line: 22,
            column: 9
          },
          end: {
            line: 22,
            column: 33
          }
        },
        loc: {
          start: {
            line: 22,
            column: 39
          },
          end: {
            line: 26,
            column: 1
          }
        },
        line: 22
      },
      "4": {
        name: "GET",
        decl: {
          start: {
            line: 27,
            column: 15
          },
          end: {
            line: 27,
            column: 18
          }
        },
        loc: {
          start: {
            line: 27,
            column: 24
          },
          end: {
            line: 175,
            column: 1
          }
        },
        line: 27
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 143,
            column: 45
          },
          end: {
            line: 143,
            column: 46
          }
        },
        loc: {
          start: {
            line: 143,
            column: 53
          },
          end: {
            line: 149,
            column: 9
          }
        },
        line: 143
      },
      "6": {
        name: "POST",
        decl: {
          start: {
            line: 176,
            column: 15
          },
          end: {
            line: 176,
            column: 19
          }
        },
        loc: {
          start: {
            line: 176,
            column: 29
          },
          end: {
            line: 202,
            column: 1
          }
        },
        line: 176
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 23,
            column: 11
          },
          end: {
            line: 25,
            column: 5
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 23,
            column: 35
          },
          end: {
            line: 23,
            column: 38
          }
        }, {
          start: {
            line: 23,
            column: 41
          },
          end: {
            line: 25,
            column: 5
          }
        }],
        line: 23
      },
      "1": {
        loc: {
          start: {
            line: 23,
            column: 11
          },
          end: {
            line: 23,
            column: 32
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 23,
            column: 11
          },
          end: {
            line: 23,
            column: 14
          }
        }, {
          start: {
            line: 23,
            column: 18
          },
          end: {
            line: 23,
            column: 32
          }
        }],
        line: 23
      },
      "2": {
        loc: {
          start: {
            line: 34,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 34,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 34
      },
      "3": {
        loc: {
          start: {
            line: 34,
            column: 12
          },
          end: {
            line: 34,
            column: 80
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 34,
            column: 12
          },
          end: {
            line: 34,
            column: 47
          }
        }, {
          start: {
            line: 34,
            column: 51
          },
          end: {
            line: 34,
            column: 80
          }
        }],
        line: 34
      },
      "4": {
        loc: {
          start: {
            line: 44,
            column: 24
          },
          end: {
            line: 44,
            column: 74
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 44,
            column: 32
          },
          end: {
            line: 44,
            column: 67
          }
        }, {
          start: {
            line: 44,
            column: 70
          },
          end: {
            line: 44,
            column: 74
          }
        }],
        line: 44
      },
      "5": {
        loc: {
          start: {
            line: 45,
            column: 25
          },
          end: {
            line: 45,
            column: 48
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 45,
            column: 25
          },
          end: {
            line: 45,
            column: 42
          }
        }, {
          start: {
            line: 45,
            column: 46
          },
          end: {
            line: 45,
            column: 48
          }
        }],
        line: 45
      },
      "6": {
        loc: {
          start: {
            line: 49,
            column: 24
          },
          end: {
            line: 49,
            column: 114
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 49,
            column: 24
          },
          end: {
            line: 49,
            column: 52
          }
        }, {
          start: {
            line: 49,
            column: 56
          },
          end: {
            line: 49,
            column: 82
          }
        }, {
          start: {
            line: 49,
            column: 86
          },
          end: {
            line: 49,
            column: 114
          }
        }],
        line: 49
      },
      "7": {
        loc: {
          start: {
            line: 62,
            column: 8
          },
          end: {
            line: 89,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 62,
            column: 8
          },
          end: {
            line: 89,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 62
      },
      "8": {
        loc: {
          start: {
            line: 67,
            column: 12
          },
          end: {
            line: 74,
            column: 13
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 67,
            column: 12
          },
          end: {
            line: 74,
            column: 13
          }
        }, {
          start: {
            line: 72,
            column: 19
          },
          end: {
            line: 74,
            column: 13
          }
        }],
        line: 67
      },
      "9": {
        loc: {
          start: {
            line: 67,
            column: 16
          },
          end: {
            line: 67,
            column: 67
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 67,
            column: 16
          },
          end: {
            line: 67,
            column: 24
          }
        }, {
          start: {
            line: 67,
            column: 28
          },
          end: {
            line: 67,
            column: 38
          }
        }, {
          start: {
            line: 67,
            column: 42
          },
          end: {
            line: 67,
            column: 67
          }
        }],
        line: 67
      },
      "10": {
        loc: {
          start: {
            line: 93,
            column: 8
          },
          end: {
            line: 97,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 93,
            column: 8
          },
          end: {
            line: 97,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 93
      },
      "11": {
        loc: {
          start: {
            line: 93,
            column: 12
          },
          end: {
            line: 93,
            column: 63
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 93,
            column: 12
          },
          end: {
            line: 93,
            column: 20
          }
        }, {
          start: {
            line: 93,
            column: 24
          },
          end: {
            line: 93,
            column: 34
          }
        }, {
          start: {
            line: 93,
            column: 38
          },
          end: {
            line: 93,
            column: 63
          }
        }],
        line: 93
      },
      "12": {
        loc: {
          start: {
            line: 150,
            column: 8
          },
          end: {
            line: 155,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 150,
            column: 8
          },
          end: {
            line: 155,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 150
      },
      "13": {
        loc: {
          start: {
            line: 150,
            column: 12
          },
          end: {
            line: 150,
            column: 66
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 150,
            column: 12
          },
          end: {
            line: 150,
            column: 31
          }
        }, {
          start: {
            line: 150,
            column: 35
          },
          end: {
            line: 150,
            column: 66
          }
        }],
        line: 150
      },
      "14": {
        loc: {
          start: {
            line: 164,
            column: 8
          },
          end: {
            line: 167,
            column: 9
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 164,
            column: 8
          },
          end: {
            line: 167,
            column: 9
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 164
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0,
      "28": 0,
      "29": 0,
      "30": 0,
      "31": 0,
      "32": 0,
      "33": 0,
      "34": 0,
      "35": 0,
      "36": 0,
      "37": 0,
      "38": 0,
      "39": 0,
      "40": 0,
      "41": 0,
      "42": 0,
      "43": 0,
      "44": 0,
      "45": 0,
      "46": 0,
      "47": 0,
      "48": 0,
      "49": 0,
      "50": 0,
      "51": 0,
      "52": 0,
      "53": 0,
      "54": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0],
      "6": [0, 0, 0],
      "7": [0, 0],
      "8": [0, 0],
      "9": [0, 0, 0],
      "10": [0, 0],
      "11": [0, 0, 0],
      "12": [0, 0],
      "13": [0, 0],
      "14": [0, 0]
    },
    inputSourceMap: {
      version: 3,
      sources: ["/Users/sachin/Documents/md-sports-/src/app/api/shops/route.ts"],
      sourcesContent: ["import { NextRequest, NextResponse } from 'next/server';\nimport prisma from '@/lib/prisma';\nimport { validateTokenPermission, getShopIdFromToken, extractToken, verifyToken } from '@/lib/auth';\nimport { ShopAccessControl } from '@/lib/utils/shopMiddleware';\n\nexport async function GET(req: NextRequest) {\n  try {\n    const url = new URL(req.url);\n    const simple = url.searchParams.get('simple') === 'true';\n\n    // Validate token and permissions - check for shop distribution view or shop manage\n    const shopDistributionPermission = await validateTokenPermission(req, 'shop:distribution:view');\n    const shopManagePermission = await validateTokenPermission(req, 'shop:manage');\n    \n    if (!shopDistributionPermission.isValid && !shopManagePermission.isValid) {\n      return NextResponse.json(\n        { success: false, message: 'Permission denied: shop:distribution:view or shop:manage required' },\n        { status: 401 }\n      );\n    }\n\n    // Get user's role and shop context for filtering\n    const token = extractToken(req);\n    const payload = token ? await verifyToken(token) : null;\n    const userRole = payload?.roleName as string ?? '';\n    const userShopId = await getShopIdFromToken(req);\n    const adminAllPermission = await validateTokenPermission(req, 'admin:all');\n    const userManagePermission = await validateTokenPermission(req, 'user:manage');\n    \n    const isAdmin = shopManagePermission.isValid || adminAllPermission.isValid || userManagePermission.isValid;\n    \n    // Development mode - allow all access\n    const isDevMode = token === 'dev-token';\n\n    // Debug logging\n    console.log('Shops API Debug:', {\n        isAdmin,\n        userShopId,\n        userRole,\n        isDevMode,\n        shopManagePermission: shopManagePermission.isValid,\n        adminAllPermission: adminAllPermission.isValid,\n        userManagePermission: userManagePermission.isValid\n    });\n\n    if (simple) {\n      // Return simplified shop data for dropdowns\n      let whereClause = {};\n      \n      // If user is not admin, filter by their assigned shop\n      // UNLESS they are a Shop Staff user, in which case they need all shops for transfers\n       if (!isAdmin && userShopId && userRole !== 'Shop Staff') {\n         whereClause = {\n           id: userShopId\n         };\n         console.log('Applying shop filter:', whereClause);\n       } else {\n         console.log('No shop filter applied - isAdmin:', isAdmin, 'userShopId:', userShopId, 'userRole:', userRole);\n       }\n      \n      const shops = await prisma.shop.findMany({\n        where: whereClause,\n        select: {\n          id: true,\n          name: true,\n        },\n        orderBy: {\n          name: 'asc',\n        },\n      });\n\n      return NextResponse.json({\n        success: true,\n        data: shops,\n      });\n    }\n\n        // Fetch shops from the database with proper numeric IDs\n        let whereClause = {};\n        \n        // If user is not admin, filter by their assigned shop\n         if (!isAdmin && userShopId && userRole !== 'Shop Staff') {\n             whereClause = {\n                 id: userShopId\n             };\n         }\n        \n        const shops = await prisma.shop.findMany({\n            where: whereClause,\n            orderBy: {\n                name: 'asc'\n            },\n            select: {\n                id: true,\n                name: true,\n                location: true,\n                contact_person: true,\n                phone: true,\n                email: true,\n                is_active: true,\n                opening_time: true,\n                closing_time: true,\n                manager_id: true,\n                opening_date: true,\n                status: true,\n                address_line1: true,\n                address_line2: true,\n                city: true,\n                state: true,\n                postal_code: true,\n                country: true,\n                latitude: true,\n                longitude: true,\n                tax_rate: true,\n                createdAt: true,\n                updatedAt: true,\n                manager: {\n                    select: {\n                        id: true,\n                        name: true,\n                        email: true,\n                        phone: true\n                    }\n                },\n                _count: {\n                    select: {\n                        InventoryItem: true\n                    }\n                }\n            }\n        });\n\n        // Transform the data to include total_inventory count\n        const shopsWithInventory = shops.map(shop => {\n            const { _count, ...restOfShop } = shop;\n            return {\n                ...restOfShop,\n                total_inventory: _count.InventoryItem\n            };\n        });\n\n        if (!shopsWithInventory || shopsWithInventory.length === 0) {\n            return NextResponse.json({ success: true, data: [] });\n        }\n\n        return NextResponse.json({ success: true, data: shopsWithInventory });\n\n    } catch (error) {\n        console.error('[API/SHOPS_GET] Error fetching shops:', error);\n        // It's good practice to avoid sending detailed internal error messages to the client.\n        let errorMessage = 'An unexpected error occurred while fetching shops.';\n        if (error instanceof Error) {\n            errorMessage = error.message;\n            // You could log error.message for server-side debugging\n        }\n        return NextResponse.json({ success: false, message: errorMessage }, { status: 500 });\n    }\n}\n\n// POST: Create a new shop\nexport async function POST(request: NextRequest) {\n    try {\n        const body = await request.json();\n\n        const newShop = await prisma.shop.create({\n            data: {\n                name: body.name,\n                location: body.location,\n                is_active: body.is_active,\n                status: body.status,\n            },\n        });\n\n        return NextResponse.json({\n            success: true,\n            data: newShop\n        }, { status: 201 });\n    } catch (error) {\n        console.error('Error creating shop:', error);\n        return NextResponse.json(\n            { success: false, message: 'Failed to create shop' },\n            { status: 500 }\n        );\n    }\n}"],
      names: ["GET", "POST", "req", "url", "URL", "simple", "searchParams", "get", "shopDistributionPermission", "validateTokenPermission", "shopManagePermission", "isValid", "NextResponse", "json", "success", "message", "status", "token", "extractToken", "payload", "verifyToken", "userRole", "roleName", "userShopId", "getShopIdFromToken", "adminAllPermission", "userManagePermission", "isAdmin", "isDevMode", "console", "log", "whereClause", "id", "shops", "prisma", "shop", "findMany", "where", "select", "name", "orderBy", "data", "location", "contact_person", "phone", "email", "is_active", "opening_time", "closing_time", "manager_id", "opening_date", "address_line1", "address_line2", "city", "state", "postal_code", "country", "latitude", "longitude", "tax_rate", "createdAt", "updatedAt", "manager", "_count", "InventoryItem", "shopsWithInventory", "map", "restOfShop", "total_inventory", "length", "error", "errorMessage", "Error", "request", "body", "newShop", "create"],
      mappings: "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"
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "5acd66c6baed31e2f4f7d84a684a09fcb43a1464"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_29cerbptvx = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_29cerbptvx();
cov_29cerbptvx().s[0]++;
Object.defineProperty(exports, "__esModule", {
  value: true
});
function _export(target, all) {
  /* istanbul ignore next */
  cov_29cerbptvx().f[0]++;
  cov_29cerbptvx().s[1]++;
  for (var name in all) {
    /* istanbul ignore next */
    cov_29cerbptvx().s[2]++;
    Object.defineProperty(target, name, {
      enumerable: true,
      get: all[name]
    });
  }
}
/* istanbul ignore next */
cov_29cerbptvx().s[3]++;
_export(exports, {
  GET: function () {
    /* istanbul ignore next */
    cov_29cerbptvx().f[1]++;
    cov_29cerbptvx().s[4]++;
    return GET;
  },
  POST: function () {
    /* istanbul ignore next */
    cov_29cerbptvx().f[2]++;
    cov_29cerbptvx().s[5]++;
    return POST;
  }
});
const _server =
/* istanbul ignore next */
(cov_29cerbptvx().s[6]++, require("next/server"));
const _prisma =
/* istanbul ignore next */
(/*#__PURE__*/cov_29cerbptvx().s[7]++, _interop_require_default(require("../../../lib/prisma")));
const _auth =
/* istanbul ignore next */
(cov_29cerbptvx().s[8]++, require("../../../lib/auth"));
function _interop_require_default(obj) {
  /* istanbul ignore next */
  cov_29cerbptvx().f[3]++;
  cov_29cerbptvx().s[9]++;
  return /* istanbul ignore next */(cov_29cerbptvx().b[1][0]++, obj) &&
  /* istanbul ignore next */
  (cov_29cerbptvx().b[1][1]++, obj.__esModule) ?
  /* istanbul ignore next */
  (cov_29cerbptvx().b[0][0]++, obj) :
  /* istanbul ignore next */
  (cov_29cerbptvx().b[0][1]++, {
    default: obj
  });
}
async function GET(req) {
  /* istanbul ignore next */
  cov_29cerbptvx().f[4]++;
  cov_29cerbptvx().s[10]++;
  try {
    const url =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[11]++, new URL(req.url));
    const simple =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[12]++, url.searchParams.get("simple") === "true");
    // Validate token and permissions - check for shop distribution view or shop manage
    const shopDistributionPermission =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[13]++, await (0, _auth.validateTokenPermission)(req, "shop:distribution:view"));
    const shopManagePermission =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[14]++, await (0, _auth.validateTokenPermission)(req, "shop:manage"));
    /* istanbul ignore next */
    cov_29cerbptvx().s[15]++;
    if (
    /* istanbul ignore next */
    (cov_29cerbptvx().b[3][0]++, !shopDistributionPermission.isValid) &&
    /* istanbul ignore next */
    (cov_29cerbptvx().b[3][1]++, !shopManagePermission.isValid)) {
      /* istanbul ignore next */
      cov_29cerbptvx().b[2][0]++;
      cov_29cerbptvx().s[16]++;
      return _server.NextResponse.json({
        success: false,
        message: "Permission denied: shop:distribution:view or shop:manage required"
      }, {
        status: 401
      });
    } else
    /* istanbul ignore next */
    {
      cov_29cerbptvx().b[2][1]++;
    }
    // Get user's role and shop context for filtering
    const token =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[17]++, (0, _auth.extractToken)(req));
    const payload =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[18]++, token ?
    /* istanbul ignore next */
    (cov_29cerbptvx().b[4][0]++, await (0, _auth.verifyToken)(token)) :
    /* istanbul ignore next */
    (cov_29cerbptvx().b[4][1]++, null));
    const userRole =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[19]++,
    /* istanbul ignore next */
    (cov_29cerbptvx().b[5][0]++, payload?.roleName) ??
    /* istanbul ignore next */
    (cov_29cerbptvx().b[5][1]++, ""));
    const userShopId =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[20]++, await (0, _auth.getShopIdFromToken)(req));
    const adminAllPermission =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[21]++, await (0, _auth.validateTokenPermission)(req, "admin:all"));
    const userManagePermission =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[22]++, await (0, _auth.validateTokenPermission)(req, "user:manage"));
    const isAdmin =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[23]++,
    /* istanbul ignore next */
    (cov_29cerbptvx().b[6][0]++, shopManagePermission.isValid) ||
    /* istanbul ignore next */
    (cov_29cerbptvx().b[6][1]++, adminAllPermission.isValid) ||
    /* istanbul ignore next */
    (cov_29cerbptvx().b[6][2]++, userManagePermission.isValid));
    // Development mode - allow all access
    const isDevMode =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[24]++, token === "dev-token");
    // Debug logging
    /* istanbul ignore next */
    cov_29cerbptvx().s[25]++;
    console.log("Shops API Debug:", {
      isAdmin,
      userShopId,
      userRole,
      isDevMode,
      shopManagePermission: shopManagePermission.isValid,
      adminAllPermission: adminAllPermission.isValid,
      userManagePermission: userManagePermission.isValid
    });
    /* istanbul ignore next */
    cov_29cerbptvx().s[26]++;
    if (simple) {
      /* istanbul ignore next */
      cov_29cerbptvx().b[7][0]++;
      // Return simplified shop data for dropdowns
      let whereClause =
      /* istanbul ignore next */
      (cov_29cerbptvx().s[27]++, {});
      // If user is not admin, filter by their assigned shop
      // UNLESS they are a Shop Staff user, in which case they need all shops for transfers
      /* istanbul ignore next */
      cov_29cerbptvx().s[28]++;
      if (
      /* istanbul ignore next */
      (cov_29cerbptvx().b[9][0]++, !isAdmin) &&
      /* istanbul ignore next */
      (cov_29cerbptvx().b[9][1]++, userShopId) &&
      /* istanbul ignore next */
      (cov_29cerbptvx().b[9][2]++, userRole !== "Shop Staff")) {
        /* istanbul ignore next */
        cov_29cerbptvx().b[8][0]++;
        cov_29cerbptvx().s[29]++;
        whereClause = {
          id: userShopId
        };
        /* istanbul ignore next */
        cov_29cerbptvx().s[30]++;
        console.log("Applying shop filter:", whereClause);
      } else {
        /* istanbul ignore next */
        cov_29cerbptvx().b[8][1]++;
        cov_29cerbptvx().s[31]++;
        console.log("No shop filter applied - isAdmin:", isAdmin, "userShopId:", userShopId, "userRole:", userRole);
      }
      const shops =
      /* istanbul ignore next */
      (cov_29cerbptvx().s[32]++, await _prisma.default.shop.findMany({
        where: whereClause,
        select: {
          id: true,
          name: true
        },
        orderBy: {
          name: "asc"
        }
      }));
      /* istanbul ignore next */
      cov_29cerbptvx().s[33]++;
      return _server.NextResponse.json({
        success: true,
        data: shops
      });
    } else
    /* istanbul ignore next */
    {
      cov_29cerbptvx().b[7][1]++;
    }
    // Fetch shops from the database with proper numeric IDs
    let whereClause =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[34]++, {});
    // If user is not admin, filter by their assigned shop
    /* istanbul ignore next */
    cov_29cerbptvx().s[35]++;
    if (
    /* istanbul ignore next */
    (cov_29cerbptvx().b[11][0]++, !isAdmin) &&
    /* istanbul ignore next */
    (cov_29cerbptvx().b[11][1]++, userShopId) &&
    /* istanbul ignore next */
    (cov_29cerbptvx().b[11][2]++, userRole !== "Shop Staff")) {
      /* istanbul ignore next */
      cov_29cerbptvx().b[10][0]++;
      cov_29cerbptvx().s[36]++;
      whereClause = {
        id: userShopId
      };
    } else
    /* istanbul ignore next */
    {
      cov_29cerbptvx().b[10][1]++;
    }
    const shops =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[37]++, await _prisma.default.shop.findMany({
      where: whereClause,
      orderBy: {
        name: "asc"
      },
      select: {
        id: true,
        name: true,
        location: true,
        contact_person: true,
        phone: true,
        email: true,
        is_active: true,
        opening_time: true,
        closing_time: true,
        manager_id: true,
        opening_date: true,
        status: true,
        address_line1: true,
        address_line2: true,
        city: true,
        state: true,
        postal_code: true,
        country: true,
        latitude: true,
        longitude: true,
        tax_rate: true,
        createdAt: true,
        updatedAt: true,
        manager: {
          select: {
            id: true,
            name: true,
            email: true,
            phone: true
          }
        },
        _count: {
          select: {
            InventoryItem: true
          }
        }
      }
    }));
    // Transform the data to include total_inventory count
    const shopsWithInventory =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[38]++, shops.map(shop => {
      /* istanbul ignore next */
      cov_29cerbptvx().f[5]++;
      const {
        _count,
        ...restOfShop
      } =
      /* istanbul ignore next */
      (cov_29cerbptvx().s[39]++, shop);
      /* istanbul ignore next */
      cov_29cerbptvx().s[40]++;
      return {
        ...restOfShop,
        total_inventory: _count.InventoryItem
      };
    }));
    /* istanbul ignore next */
    cov_29cerbptvx().s[41]++;
    if (
    /* istanbul ignore next */
    (cov_29cerbptvx().b[13][0]++, !shopsWithInventory) ||
    /* istanbul ignore next */
    (cov_29cerbptvx().b[13][1]++, shopsWithInventory.length === 0)) {
      /* istanbul ignore next */
      cov_29cerbptvx().b[12][0]++;
      cov_29cerbptvx().s[42]++;
      return _server.NextResponse.json({
        success: true,
        data: []
      });
    } else
    /* istanbul ignore next */
    {
      cov_29cerbptvx().b[12][1]++;
    }
    cov_29cerbptvx().s[43]++;
    return _server.NextResponse.json({
      success: true,
      data: shopsWithInventory
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_29cerbptvx().s[44]++;
    console.error("[API/SHOPS_GET] Error fetching shops:", error);
    // It's good practice to avoid sending detailed internal error messages to the client.
    let errorMessage =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[45]++, "An unexpected error occurred while fetching shops.");
    /* istanbul ignore next */
    cov_29cerbptvx().s[46]++;
    if (error instanceof Error) {
      /* istanbul ignore next */
      cov_29cerbptvx().b[14][0]++;
      cov_29cerbptvx().s[47]++;
      errorMessage = error.message;
      // You could log error.message for server-side debugging
    } else
    /* istanbul ignore next */
    {
      cov_29cerbptvx().b[14][1]++;
    }
    cov_29cerbptvx().s[48]++;
    return _server.NextResponse.json({
      success: false,
      message: errorMessage
    }, {
      status: 500
    });
  }
}
async function POST(request) {
  /* istanbul ignore next */
  cov_29cerbptvx().f[6]++;
  cov_29cerbptvx().s[49]++;
  try {
    const body =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[50]++, await request.json());
    const newShop =
    /* istanbul ignore next */
    (cov_29cerbptvx().s[51]++, await _prisma.default.shop.create({
      data: {
        name: body.name,
        location: body.location,
        is_active: body.is_active,
        status: body.status
      }
    }));
    /* istanbul ignore next */
    cov_29cerbptvx().s[52]++;
    return _server.NextResponse.json({
      success: true,
      data: newShop
    }, {
      status: 201
    });
  } catch (error) {
    /* istanbul ignore next */
    cov_29cerbptvx().s[53]++;
    console.error("Error creating shop:", error);
    /* istanbul ignore next */
    cov_29cerbptvx().s[54]++;
    return _server.NextResponse.json({
      success: false,
      message: "Failed to create shop"
    }, {
      status: 500
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHRVQiLCJjb3ZfMjljZXJicHR2eCIsImYiLCJzIiwiUE9TVCIsInJlcSIsInVybCIsIlVSTCIsInNpbXBsZSIsInNlYXJjaFBhcmFtcyIsImdldCIsInNob3BEaXN0cmlidXRpb25QZXJtaXNzaW9uIiwiX2F1dGgiLCJ2YWxpZGF0ZVRva2VuUGVybWlzc2lvbiIsInNob3BNYW5hZ2VQZXJtaXNzaW9uIiwiYiIsImlzVmFsaWQiLCJfc2VydmVyIiwiTmV4dFJlc3BvbnNlIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwic3RhdHVzIiwidG9rZW4iLCJleHRyYWN0VG9rZW4iLCJwYXlsb2FkIiwidmVyaWZ5VG9rZW4iLCJ1c2VyUm9sZSIsInJvbGVOYW1lIiwidXNlclNob3BJZCIsImdldFNob3BJZEZyb21Ub2tlbiIsImFkbWluQWxsUGVybWlzc2lvbiIsInVzZXJNYW5hZ2VQZXJtaXNzaW9uIiwiaXNBZG1pbiIsImlzRGV2TW9kZSIsImNvbnNvbGUiLCJsb2ciLCJ3aGVyZUNsYXVzZSIsImlkIiwic2hvcHMiLCJfcHJpc21hIiwiZGVmYXVsdCIsInNob3AiLCJmaW5kTWFueSIsIndoZXJlIiwic2VsZWN0IiwibmFtZSIsIm9yZGVyQnkiLCJkYXRhIiwibG9jYXRpb24iLCJjb250YWN0X3BlcnNvbiIsInBob25lIiwiZW1haWwiLCJpc19hY3RpdmUiLCJvcGVuaW5nX3RpbWUiLCJjbG9zaW5nX3RpbWUiLCJtYW5hZ2VyX2lkIiwib3BlbmluZ19kYXRlIiwiYWRkcmVzc19saW5lMSIsImFkZHJlc3NfbGluZTIiLCJjaXR5Iiwic3RhdGUiLCJwb3N0YWxfY29kZSIsImNvdW50cnkiLCJsYXRpdHVkZSIsImxvbmdpdHVkZSIsInRheF9yYXRlIiwiY3JlYXRlZEF0IiwidXBkYXRlZEF0IiwibWFuYWdlciIsIl9jb3VudCIsIkludmVudG9yeUl0ZW0iLCJzaG9wc1dpdGhJbnZlbnRvcnkiLCJtYXAiLCJyZXN0T2ZTaG9wIiwidG90YWxfaW52ZW50b3J5IiwibGVuZ3RoIiwiZXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJFcnJvciIsInJlcXVlc3QiLCJib2R5IiwibmV3U2hvcCIsImNyZWF0ZSJdLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL2FwcC9hcGkvc2hvcHMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCBwcmlzbWEgZnJvbSAnQC9saWIvcHJpc21hJztcbmltcG9ydCB7IHZhbGlkYXRlVG9rZW5QZXJtaXNzaW9uLCBnZXRTaG9wSWRGcm9tVG9rZW4sIGV4dHJhY3RUb2tlbiwgdmVyaWZ5VG9rZW4gfSBmcm9tICdAL2xpYi9hdXRoJztcbmltcG9ydCB7IFNob3BBY2Nlc3NDb250cm9sIH0gZnJvbSAnQC9saWIvdXRpbHMvc2hvcE1pZGRsZXdhcmUnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcS51cmwpO1xuICAgIGNvbnN0IHNpbXBsZSA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCdzaW1wbGUnKSA9PT0gJ3RydWUnO1xuXG4gICAgLy8gVmFsaWRhdGUgdG9rZW4gYW5kIHBlcm1pc3Npb25zIC0gY2hlY2sgZm9yIHNob3AgZGlzdHJpYnV0aW9uIHZpZXcgb3Igc2hvcCBtYW5hZ2VcbiAgICBjb25zdCBzaG9wRGlzdHJpYnV0aW9uUGVybWlzc2lvbiA9IGF3YWl0IHZhbGlkYXRlVG9rZW5QZXJtaXNzaW9uKHJlcSwgJ3Nob3A6ZGlzdHJpYnV0aW9uOnZpZXcnKTtcbiAgICBjb25zdCBzaG9wTWFuYWdlUGVybWlzc2lvbiA9IGF3YWl0IHZhbGlkYXRlVG9rZW5QZXJtaXNzaW9uKHJlcSwgJ3Nob3A6bWFuYWdlJyk7XG4gICAgXG4gICAgaWYgKCFzaG9wRGlzdHJpYnV0aW9uUGVybWlzc2lvbi5pc1ZhbGlkICYmICFzaG9wTWFuYWdlUGVybWlzc2lvbi5pc1ZhbGlkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdQZXJtaXNzaW9uIGRlbmllZDogc2hvcDpkaXN0cmlidXRpb246dmlldyBvciBzaG9wOm1hbmFnZSByZXF1aXJlZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEdldCB1c2VyJ3Mgcm9sZSBhbmQgc2hvcCBjb250ZXh0IGZvciBmaWx0ZXJpbmdcbiAgICBjb25zdCB0b2tlbiA9IGV4dHJhY3RUb2tlbihyZXEpO1xuICAgIGNvbnN0IHBheWxvYWQgPSB0b2tlbiA/IGF3YWl0IHZlcmlmeVRva2VuKHRva2VuKSA6IG51bGw7XG4gICAgY29uc3QgdXNlclJvbGUgPSBwYXlsb2FkPy5yb2xlTmFtZSBhcyBzdHJpbmcgPz8gJyc7XG4gICAgY29uc3QgdXNlclNob3BJZCA9IGF3YWl0IGdldFNob3BJZEZyb21Ub2tlbihyZXEpO1xuICAgIGNvbnN0IGFkbWluQWxsUGVybWlzc2lvbiA9IGF3YWl0IHZhbGlkYXRlVG9rZW5QZXJtaXNzaW9uKHJlcSwgJ2FkbWluOmFsbCcpO1xuICAgIGNvbnN0IHVzZXJNYW5hZ2VQZXJtaXNzaW9uID0gYXdhaXQgdmFsaWRhdGVUb2tlblBlcm1pc3Npb24ocmVxLCAndXNlcjptYW5hZ2UnKTtcbiAgICBcbiAgICBjb25zdCBpc0FkbWluID0gc2hvcE1hbmFnZVBlcm1pc3Npb24uaXNWYWxpZCB8fCBhZG1pbkFsbFBlcm1pc3Npb24uaXNWYWxpZCB8fCB1c2VyTWFuYWdlUGVybWlzc2lvbi5pc1ZhbGlkO1xuICAgIFxuICAgIC8vIERldmVsb3BtZW50IG1vZGUgLSBhbGxvdyBhbGwgYWNjZXNzXG4gICAgY29uc3QgaXNEZXZNb2RlID0gdG9rZW4gPT09ICdkZXYtdG9rZW4nO1xuXG4gICAgLy8gRGVidWcgbG9nZ2luZ1xuICAgIGNvbnNvbGUubG9nKCdTaG9wcyBBUEkgRGVidWc6Jywge1xuICAgICAgICBpc0FkbWluLFxuICAgICAgICB1c2VyU2hvcElkLFxuICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgaXNEZXZNb2RlLFxuICAgICAgICBzaG9wTWFuYWdlUGVybWlzc2lvbjogc2hvcE1hbmFnZVBlcm1pc3Npb24uaXNWYWxpZCxcbiAgICAgICAgYWRtaW5BbGxQZXJtaXNzaW9uOiBhZG1pbkFsbFBlcm1pc3Npb24uaXNWYWxpZCxcbiAgICAgICAgdXNlck1hbmFnZVBlcm1pc3Npb246IHVzZXJNYW5hZ2VQZXJtaXNzaW9uLmlzVmFsaWRcbiAgICB9KTtcblxuICAgIGlmIChzaW1wbGUpIHtcbiAgICAgIC8vIFJldHVybiBzaW1wbGlmaWVkIHNob3AgZGF0YSBmb3IgZHJvcGRvd25zXG4gICAgICBsZXQgd2hlcmVDbGF1c2UgPSB7fTtcbiAgICAgIFxuICAgICAgLy8gSWYgdXNlciBpcyBub3QgYWRtaW4sIGZpbHRlciBieSB0aGVpciBhc3NpZ25lZCBzaG9wXG4gICAgICAvLyBVTkxFU1MgdGhleSBhcmUgYSBTaG9wIFN0YWZmIHVzZXIsIGluIHdoaWNoIGNhc2UgdGhleSBuZWVkIGFsbCBzaG9wcyBmb3IgdHJhbnNmZXJzXG4gICAgICAgaWYgKCFpc0FkbWluICYmIHVzZXJTaG9wSWQgJiYgdXNlclJvbGUgIT09ICdTaG9wIFN0YWZmJykge1xuICAgICAgICAgd2hlcmVDbGF1c2UgPSB7XG4gICAgICAgICAgIGlkOiB1c2VyU2hvcElkXG4gICAgICAgICB9O1xuICAgICAgICAgY29uc29sZS5sb2coJ0FwcGx5aW5nIHNob3AgZmlsdGVyOicsIHdoZXJlQ2xhdXNlKTtcbiAgICAgICB9IGVsc2Uge1xuICAgICAgICAgY29uc29sZS5sb2coJ05vIHNob3AgZmlsdGVyIGFwcGxpZWQgLSBpc0FkbWluOicsIGlzQWRtaW4sICd1c2VyU2hvcElkOicsIHVzZXJTaG9wSWQsICd1c2VyUm9sZTonLCB1c2VyUm9sZSk7XG4gICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCBzaG9wcyA9IGF3YWl0IHByaXNtYS5zaG9wLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHdoZXJlQ2xhdXNlLFxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgbmFtZTogJ2FzYycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogc2hvcHMsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggc2hvcHMgZnJvbSB0aGUgZGF0YWJhc2Ugd2l0aCBwcm9wZXIgbnVtZXJpYyBJRHNcbiAgICAgICAgbGV0IHdoZXJlQ2xhdXNlID0ge307XG4gICAgICAgIFxuICAgICAgICAvLyBJZiB1c2VyIGlzIG5vdCBhZG1pbiwgZmlsdGVyIGJ5IHRoZWlyIGFzc2lnbmVkIHNob3BcbiAgICAgICAgIGlmICghaXNBZG1pbiAmJiB1c2VyU2hvcElkICYmIHVzZXJSb2xlICE9PSAnU2hvcCBTdGFmZicpIHtcbiAgICAgICAgICAgICB3aGVyZUNsYXVzZSA9IHtcbiAgICAgICAgICAgICAgICAgaWQ6IHVzZXJTaG9wSWRcbiAgICAgICAgICAgICB9O1xuICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3Qgc2hvcHMgPSBhd2FpdCBwcmlzbWEuc2hvcC5maW5kTWFueSh7XG4gICAgICAgICAgICB3aGVyZTogd2hlcmVDbGF1c2UsXG4gICAgICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgICAgICAgbmFtZTogJ2FzYydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbnRhY3RfcGVyc29uOiB0cnVlLFxuICAgICAgICAgICAgICAgIHBob25lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGlzX2FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBvcGVuaW5nX3RpbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgY2xvc2luZ190aW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIG1hbmFnZXJfaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgb3BlbmluZ19kYXRlOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN0YXR1czogdHJ1ZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzX2xpbmUxOiB0cnVlLFxuICAgICAgICAgICAgICAgIGFkZHJlc3NfbGluZTI6IHRydWUsXG4gICAgICAgICAgICAgICAgY2l0eTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzdGF0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwb3N0YWxfY29kZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjb3VudHJ5OiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB0YXhfcmF0ZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0OiB0cnVlLFxuICAgICAgICAgICAgICAgIG1hbmFnZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob25lOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEludmVudG9yeUl0ZW06IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVHJhbnNmb3JtIHRoZSBkYXRhIHRvIGluY2x1ZGUgdG90YWxfaW52ZW50b3J5IGNvdW50XG4gICAgICAgIGNvbnN0IHNob3BzV2l0aEludmVudG9yeSA9IHNob3BzLm1hcChzaG9wID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2NvdW50LCAuLi5yZXN0T2ZTaG9wIH0gPSBzaG9wO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0T2ZTaG9wLFxuICAgICAgICAgICAgICAgIHRvdGFsX2ludmVudG9yeTogX2NvdW50LkludmVudG9yeUl0ZW1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghc2hvcHNXaXRoSW52ZW50b3J5IHx8IHNob3BzV2l0aEludmVudG9yeS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IFtdIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogc2hvcHNXaXRoSW52ZW50b3J5IH0pO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignW0FQSS9TSE9QU19HRVRdIEVycm9yIGZldGNoaW5nIHNob3BzOicsIGVycm9yKTtcbiAgICAgICAgLy8gSXQncyBnb29kIHByYWN0aWNlIHRvIGF2b2lkIHNlbmRpbmcgZGV0YWlsZWQgaW50ZXJuYWwgZXJyb3IgbWVzc2FnZXMgdG8gdGhlIGNsaWVudC5cbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIHdoaWxlIGZldGNoaW5nIHNob3BzLic7XG4gICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgLy8gWW91IGNvdWxkIGxvZyBlcnJvci5tZXNzYWdlIGZvciBzZXJ2ZXItc2lkZSBkZWJ1Z2dpbmdcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogZXJyb3JNZXNzYWdlIH0sIHsgc3RhdHVzOiA1MDAgfSk7XG4gICAgfVxufVxuXG4vLyBQT1NUOiBDcmVhdGUgYSBuZXcgc2hvcFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICAgICAgY29uc3QgbmV3U2hvcCA9IGF3YWl0IHByaXNtYS5zaG9wLmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogYm9keS5uYW1lLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBib2R5LmxvY2F0aW9uLFxuICAgICAgICAgICAgICAgIGlzX2FjdGl2ZTogYm9keS5pc19hY3RpdmUsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBib2R5LnN0YXR1cyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgZGF0YTogbmV3U2hvcFxuICAgICAgICB9LCB7IHN0YXR1czogMjAxIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHNob3A6JywgZXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBzaG9wJyB9LFxuICAgICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICAgICk7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0VBS3NCQSxHQUFHLFdBQUFBLENBQUE7SUFBQTtJQUFBQyxjQUFBLEdBQUFDLENBQUE7SUFBQUQsY0FBQSxHQUFBRSxDQUFBO1dBQUhILEdBQUE7O0VBMkpBSSxJQUFJLFdBQUFBLENB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