{"version":3,"sources":["/Users/sachin/Documents/md-sports-/src/app/api/audit-trail/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { verifyToken } from '@/lib/auth';\nimport { auditService } from '@/services/auditService';\nimport { revalidateTag } from 'next/cache';\n\n// GET /api/audit-trail - Get audit trail entries\nexport async function GET(request: NextRequest) {\n  try {\n    console.log('=== AUDIT TRAIL API DEBUG ===');\n    const authHeader = request.headers.get('Authorization');\n    console.log('Authorization header:', authHeader ? `${authHeader.substring(0, 20)}...` : 'none');\n    \n    const token = authHeader?.replace('Bearer ', '');\n    if (!token) {\n      console.log('No token found in Authorization header');\n      return NextResponse.json({ error: 'No token provided' }, { status: 401 });\n    }\n\n    console.log('Token extracted:', token.substring(0, 20) + '...');\n    const decoded = await verifyToken(token);\n    console.log('Token verification result:', decoded ? 'SUCCESS' : 'FAILED');\n    \n    if (!decoded || !decoded.sub) {\n      console.log('Token validation failed - decoded:', decoded);\n      return NextResponse.json({ error: 'Invalid token' }, { status: 401 });\n    }\n    \n    console.log('Token validated successfully for user:', decoded.sub);\n\n    const { searchParams } = new URL(request.url);\n    const entity = searchParams.get('entity') || undefined;\n    const entityId = searchParams.get('entityId');\n    const limit = parseInt(searchParams.get('limit') || '20');\n    const offset = parseInt(searchParams.get('offset') || '0');\n    const type = searchParams.get('type') || 'all'; // 'all', 'deleted', 'history'\n    const dateFrom = searchParams.get('dateFrom');\n    const dateTo = searchParams.get('dateTo');\n\n    if (type === 'deleted') {\n      // Get recycle bin items\n      const result = await auditService.getRecycleBinItems(\n        entity,\n        limit,\n        offset,\n        dateFrom,\n        dateTo\n      );\n      return NextResponse.json(result);\n    } else if (type === 'history' && entity && entityId) {\n        // Get entity history\n        const history = await auditService.getEntityHistory(\n          entity,\n          parseInt(entityId),\n          limit,\n          dateFrom,\n          dateTo\n        );\n        return NextResponse.json({ items: history, total: history.length });\n    } else {\n        // Get all audit entries\n        const result = await auditService.getAuditEntries(\n          entity,\n          limit,\n          offset,\n          dateFrom,\n          dateTo\n        );\n      return NextResponse.json(result);\n    }\n  } catch (error) {\n    console.error('Error fetching audit trail:', error);\n    return NextResponse.json(\n      { error: 'Failed to fetch audit trail' },\n      { status: 500 }\n    );\n  }\n}"],"names":["GET","request","console","log","authHeader","headers","get","substring","token","replace","NextResponse","json","error","status","decoded","verifyToken","sub","searchParams","URL","url","entity","undefined","entityId","limit","parseInt","offset","type","dateFrom","dateTo","result","auditService","getRecycleBinItems","history","getEntityHistory","items","total","length","getAuditEntries"],"mappings":";;;;+BAMsBA;;;eAAAA;;;wBANoB;sBACd;8BACC;AAItB,eAAeA,IAAIC,OAAoB;IAC5C,IAAI;QACFC,QAAQC,GAAG,CAAC;QACZ,MAAMC,aAAaH,QAAQI,OAAO,CAACC,GAAG,CAAC;QACvCJ,QAAQC,GAAG,CAAC,yBAAyBC,aAAa,CAAC,EAAEA,WAAWG,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC,GAAG;QAExF,MAAMC,QAAQJ,YAAYK,QAAQ,WAAW;QAC7C,IAAI,CAACD,OAAO;YACVN,QAAQC,GAAG,CAAC;YACZ,OAAOO,oBAAY,CAACC,IAAI,CAAC;gBAAEC,OAAO;YAAoB,GAAG;gBAAEC,QAAQ;YAAI;QACzE;QAEAX,QAAQC,GAAG,CAAC,oBAAoBK,MAAMD,SAAS,CAAC,GAAG,MAAM;QACzD,MAAMO,UAAU,MAAMC,IAAAA,iBAAW,EAACP;QAClCN,QAAQC,GAAG,CAAC,8BAA8BW,UAAU,YAAY;QAEhE,IAAI,CAACA,WAAW,CAACA,QAAQE,GAAG,EAAE;YAC5Bd,QAAQC,GAAG,CAAC,sCAAsCW;YAClD,OAAOJ,oBAAY,CAACC,IAAI,CAAC;gBAAEC,OAAO;YAAgB,GAAG;gBAAEC,QAAQ;YAAI;QACrE;QAEAX,QAAQC,GAAG,CAAC,0CAA0CW,QAAQE,GAAG;QAEjE,MAAM,EAAEC,YAAY,EAAE,GAAG,IAAIC,IAAIjB,QAAQkB,GAAG;QAC5C,MAAMC,SAASH,aAAaX,GAAG,CAAC,aAAae;QAC7C,MAAMC,WAAWL,aAAaX,GAAG,CAAC;QAClC,MAAMiB,QAAQC,SAASP,aAAaX,GAAG,CAAC,YAAY;QACpD,MAAMmB,SAASD,SAASP,aAAaX,GAAG,CAAC,aAAa;QACtD,MAAMoB,OAAOT,aAAaX,GAAG,CAAC,WAAW,OAAO,8BAA8B;QAC9E,MAAMqB,WAAWV,aAAaX,GAAG,CAAC;QAClC,MAAMsB,SAASX,aAAaX,GAAG,CAAC;QAEhC,IAAIoB,SAAS,WAAW;YACtB,wBAAwB;YACxB,MAAMG,SAAS,MAAMC,0BAAY,CAACC,kBAAkB,CAClDX,QACAG,OACAE,QACAE,UACAC;YAEF,OAAOlB,oBAAY,CAACC,IAAI,CAACkB;QAC3B,OAAO,IAAIH,SAAS,aAAaN,UAAUE,UAAU;YACjD,qBAAqB;YACrB,MAAMU,UAAU,MAAMF,0BAAY,CAACG,gBAAgB,CACjDb,QACAI,SAASF,WACTC,OACAI,UACAC;YAEF,OAAOlB,oBAAY,CAACC,IAAI,CAAC;gBAAEuB,OAAOF;gBAASG,OAAOH,QAAQI,MAAM;YAAC;QACrE,OAAO;YACH,wBAAwB;YACxB,MAAMP,SAAS,MAAMC,0BAAY,CAACO,eAAe,CAC/CjB,QACAG,OACAE,QACAE,UACAC;YAEJ,OAAOlB,oBAAY,CAACC,IAAI,CAACkB;QAC3B;IACF,EAAE,OAAOjB,OAAO;QACdV,QAAQU,KAAK,CAAC,+BAA+BA;QAC7C,OAAOF,oBAAY,CAACC,IAAI,CACtB;YAAEC,OAAO;QAA8B,GACvC;YAAEC,QAAQ;QAAI;IAElB;AACF"}