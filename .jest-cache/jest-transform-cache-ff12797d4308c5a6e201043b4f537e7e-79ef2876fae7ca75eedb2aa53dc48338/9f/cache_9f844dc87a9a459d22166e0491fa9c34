59a2e2001c371eca562775d03c8a13ed
/**
 * Redis-based caching service for improved performance
 * Falls back to in-memory cache in development
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    CACHE_CONFIG: function() {
        return CACHE_CONFIG;
    },
    cache: function() {
        return cache;
    },
    cacheService: function() {
        return cache;
    },
    cleanupCache: function() {
        return cleanupCache;
    }
});
const _ioredis = require("ioredis");
// Cache configuration
const CACHE_CONFIG = {
    // Default TTL in seconds
    DEFAULT_TTL: 300,
    // Cache keys
    KEYS: {
        INVENTORY_SUMMARY: "inventory:summary",
        INVOICES: "invoices:list",
        INVOICE_STATS: "invoices:stats",
        CATEGORIES: "categories:list",
        SHOPS: "shops:list",
        CUSTOMERS: "customers:list",
        PRODUCTS: "products:list",
        // Authentication cache keys
        USER_SESSION: "auth:user:session",
        USER_PERMISSIONS: "auth:user:permissions",
        ROLE_PERMISSIONS: "auth:role:permissions",
        TOKEN_VALIDATION: "auth:token:validation"
    },
    // TTL for different data types
    TTL: {
        INVENTORY: 60,
        INVOICES: 120,
        STATS: 300,
        REFERENCE_DATA: 3600,
        // Authentication TTLs
        USER_SESSION: 900,
        USER_PERMISSIONS: 1800,
        ROLE_PERMISSIONS: 3600,
        TOKEN_VALIDATION: 300
    }
};
// In-memory cache fallback for development
class MemoryCache {
    constructor(){
        this.cache = new Map();
        // Clean up expired entries every 5 minutes
        this.cleanupInterval = setInterval(()=>{
            this.cleanup();
        }, 5 * 60 * 1000);
    }
    async get(key) {
        const entry = this.cache.get(key);
        if (!entry) return null;
        if (Date.now() > entry.expires) {
            this.cache.delete(key);
            return null;
        }
        return entry.data;
    }
    async set(key, value, ttlSeconds = CACHE_CONFIG.DEFAULT_TTL) {
        const expires = Date.now() + ttlSeconds * 1000;
        this.cache.set(key, {
            data: value,
            expires
        });
    }
    async del(key) {
        this.cache.delete(key);
    }
    async invalidatePattern(pattern) {
        const regex = new RegExp(pattern.replace("*", ".*"));
        for (const key of this.cache.keys()){
            if (regex.test(key)) {
                this.cache.delete(key);
            }
        }
    }
    cleanup() {
        const now = Date.now();
        for (const [key, entry] of this.cache.entries()){
            if (now > entry.expires) {
                this.cache.delete(key);
            }
        }
    }
    destroy() {
        if (this.cleanupInterval) {
            clearInterval(this.cleanupInterval);
        }
        this.cache.clear();
    }
}
// Redis cache implementation
class RedisCache {
    constructor(){
        this.isConnected = false;
        const redisUrl = process.env.REDIS_URL || "redis://localhost:6379";
        this.redis = new _ioredis.Redis(redisUrl, {
            retryDelayOnFailover: 100,
            maxRetriesPerRequest: 3,
            lazyConnect: true
        });
        this.redis.on("connect", ()=>{
            console.log("✅ Redis connected");
            this.isConnected = true;
        });
        this.redis.on("error", (error)=>{
            console.error("❌ Redis connection error:", error);
            this.isConnected = false;
        });
    }
    async get(key) {
        if (!this.isConnected) return null;
        try {
            const value = await this.redis.get(key);
            return value ? JSON.parse(value) : null;
        } catch (error) {
            console.error("Redis get error:", error);
            return null;
        }
    }
    async set(key, value, ttlSeconds = CACHE_CONFIG.DEFAULT_TTL) {
        if (!this.isConnected) return;
        try {
            await this.redis.setex(key, ttlSeconds, JSON.stringify(value));
        } catch (error) {
            console.error("Redis set error:", error);
        }
    }
    async del(key) {
        if (!this.isConnected) return;
        try {
            await this.redis.del(key);
        } catch (error) {
            console.error("Redis del error:", error);
        }
    }
    async invalidatePattern(pattern) {
        if (!this.isConnected) return;
        try {
            const keys = await this.redis.keys(pattern);
            if (keys.length > 0) {
                await this.redis.del(...keys);
            }
        } catch (error) {
            console.error("Redis invalidatePattern error:", error);
        }
    }
    disconnect() {
        this.redis.disconnect();
    }
}
// Cache service implementation
class CacheManager {
    constructor(){
        this.useRedis = process.env.NODE_ENV === "production" && !!process.env.REDIS_URL;
        if (this.useRedis) {
            console.log("\uD83D\uDE80 Using Redis cache");
            this.cache = new RedisCache();
        } else {
            console.log("\uD83D\uDCBE Using in-memory cache");
            this.cache = new MemoryCache();
        }
    }
    async get(key) {
        return this.cache.get(key);
    }
    async set(key, value, ttlSeconds) {
        return this.cache.set(key, value, ttlSeconds);
    }
    async del(key) {
        return this.cache.del(key);
    }
    async invalidatePattern(pattern) {
        return this.cache.invalidatePattern(pattern);
    }
    // Helper methods for common cache operations
    async getOrSet(key, fetcher, ttlSeconds) {
        // Try to get from cache first
        const cached = await this.get(key);
        if (cached !== null) {
            return cached;
        }
        // Fetch fresh data
        const data = await fetcher();
        // Store in cache
        await this.set(key, data, ttlSeconds);
        return data;
    }
    // Generate cache key with parameters
    generateKey(prefix, params = {}) {
        const sortedParams = Object.keys(params).sort().map((key)=>`${key}:${params[key]}`).join("|");
        return sortedParams ? `${prefix}:${sortedParams}` : prefix;
    }
    // Invalidate related cache entries
    async invalidateInventory() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVENTORY_SUMMARY}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.PRODUCTS}*`)
        ]);
    }
    async invalidateInvoices() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVOICES}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.INVOICE_STATS}*`)
        ]);
    }
    async invalidateReferenceData() {
        await Promise.all([
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.CATEGORIES}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.SHOPS}*`),
            this.invalidatePattern(`${CACHE_CONFIG.KEYS.CUSTOMERS}*`)
        ]);
    }
    // Authentication cache invalidation methods
    async invalidateUserSession(userId) {
        const userSessionKey = this.generateKey(CACHE_CONFIG.KEYS.USER_SESSION, {
            userId
        });
        await this.del(userSessionKey);
    }
    async invalidateUserPermissions(userId) {
        const userPermissionsKey = this.generateKey(CACHE_CONFIG.KEYS.USER_PERMISSIONS, {
            userId
        });
        await this.del(userPermissionsKey);
    }
    async invalidateRolePermissions(roleId) {
        const rolePermissionsKey = this.generateKey(CACHE_CONFIG.KEYS.ROLE_PERMISSIONS, {
            roleId
        });
        await this.del(rolePermissionsKey);
        // Also invalidate all user permissions for users with this role
        await this.invalidatePattern(`${CACHE_CONFIG.KEYS.USER_PERMISSIONS}*`);
    }
    async invalidateTokenValidation(token) {
        const tokenKey = this.generateKey(CACHE_CONFIG.KEYS.TOKEN_VALIDATION, {
            token: token.substring(0, 20)
        });
        await this.del(tokenKey);
    }
    async invalidateAllUserAuth(userId) {
        await Promise.all([
            this.invalidateUserSession(userId),
            this.invalidateUserPermissions(userId)
        ]);
    }
    destroy() {
        if (this.cache && typeof this.cache.destroy === "function") {
            this.cache.destroy();
        }
        if (this.cache && typeof this.cache.disconnect === "function") {
            this.cache.disconnect();
        }
    }
}
// Export singleton instance
const cache = new CacheManager();
// Cleanup on process exit
process.on("SIGINT", ()=>{
    cache.destroy();
});
process.on("SIGTERM", ()=>{
    cache.destroy();
});
const cleanupCache = ()=>{
    cache.destroy();
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL2xpYi9jYWNoZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlZGlzLWJhc2VkIGNhY2hpbmcgc2VydmljZSBmb3IgaW1wcm92ZWQgcGVyZm9ybWFuY2VcbiAqIEZhbGxzIGJhY2sgdG8gaW4tbWVtb3J5IGNhY2hlIGluIGRldmVsb3BtZW50XG4gKi9cblxuaW1wb3J0IHsgUmVkaXMgfSBmcm9tICdpb3JlZGlzJztcblxuLy8gQ2FjaGUgY29uZmlndXJhdGlvblxuY29uc3QgQ0FDSEVfQ09ORklHID0ge1xuICAgIC8vIERlZmF1bHQgVFRMIGluIHNlY29uZHNcbiAgICBERUZBVUxUX1RUTDogMzAwLCAvLyA1IG1pbnV0ZXNcblxuICAgIC8vIENhY2hlIGtleXNcbiAgICBLRVlTOiB7XG4gICAgICAgIElOVkVOVE9SWV9TVU1NQVJZOiAnaW52ZW50b3J5OnN1bW1hcnknLFxuICAgICAgICBJTlZPSUNFUzogJ2ludm9pY2VzOmxpc3QnLFxuICAgICAgICBJTlZPSUNFX1NUQVRTOiAnaW52b2ljZXM6c3RhdHMnLFxuICAgICAgICBDQVRFR09SSUVTOiAnY2F0ZWdvcmllczpsaXN0JyxcbiAgICAgICAgU0hPUFM6ICdzaG9wczpsaXN0JyxcbiAgICAgICAgQ1VTVE9NRVJTOiAnY3VzdG9tZXJzOmxpc3QnLFxuICAgICAgICBQUk9EVUNUUzogJ3Byb2R1Y3RzOmxpc3QnLFxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBjYWNoZSBrZXlzXG4gICAgICAgIFVTRVJfU0VTU0lPTjogJ2F1dGg6dXNlcjpzZXNzaW9uJyxcbiAgICAgICAgVVNFUl9QRVJNSVNTSU9OUzogJ2F1dGg6dXNlcjpwZXJtaXNzaW9ucycsXG4gICAgICAgIFJPTEVfUEVSTUlTU0lPTlM6ICdhdXRoOnJvbGU6cGVybWlzc2lvbnMnLFxuICAgICAgICBUT0tFTl9WQUxJREFUSU9OOiAnYXV0aDp0b2tlbjp2YWxpZGF0aW9uJyxcbiAgICB9LFxuXG4gICAgLy8gVFRMIGZvciBkaWZmZXJlbnQgZGF0YSB0eXBlc1xuICAgIFRUTDoge1xuICAgICAgICBJTlZFTlRPUlk6IDYwLCAvLyAxIG1pbnV0ZVxuICAgICAgICBJTlZPSUNFUzogMTIwLCAvLyAyIG1pbnV0ZXNcbiAgICAgICAgU1RBVFM6IDMwMCwgLy8gNSBtaW51dGVzXG4gICAgICAgIFJFRkVSRU5DRV9EQVRBOiAzNjAwLCAvLyAxIGhvdXIgKGNhdGVnb3JpZXMsIHNob3BzLCBldGMuKVxuICAgICAgICAvLyBBdXRoZW50aWNhdGlvbiBUVExzXG4gICAgICAgIFVTRVJfU0VTU0lPTjogOTAwLCAvLyAxNSBtaW51dGVzXG4gICAgICAgIFVTRVJfUEVSTUlTU0lPTlM6IDE4MDAsIC8vIDMwIG1pbnV0ZXNcbiAgICAgICAgUk9MRV9QRVJNSVNTSU9OUzogMzYwMCwgLy8gMSBob3VyXG4gICAgICAgIFRPS0VOX1ZBTElEQVRJT046IDMwMCwgLy8gNSBtaW51dGVzXG4gICAgfVxufTtcblxuLy8gSW4tbWVtb3J5IGNhY2hlIGZhbGxiYWNrIGZvciBkZXZlbG9wbWVudFxuY2xhc3MgTWVtb3J5Q2FjaGUge1xuICAgIHByaXZhdGUgY2FjaGUgPSBuZXcgTWFwPHN0cmluZywgeyBkYXRhOiBhbnk7IGV4cGlyZXM6IG51bWJlciB9PigpO1xuICAgIHByaXZhdGUgY2xlYW51cEludGVydmFsOiBOb2RlSlMuVGltZW91dDtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBDbGVhbiB1cCBleHBpcmVkIGVudHJpZXMgZXZlcnkgNSBtaW51dGVzXG4gICAgICAgIHRoaXMuY2xlYW51cEludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbGVhbnVwKCk7XG4gICAgICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuICAgIH1cblxuICAgIGFzeW5jIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFlbnRyeSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgaWYgKERhdGUubm93KCkgPiBlbnRyeS5leHBpcmVzKSB7XG4gICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW50cnkuZGF0YTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM6IG51bWJlciA9IENBQ0hFX0NPTkZJRy5ERUZBVUxUX1RUTCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBleHBpcmVzID0gRGF0ZS5ub3coKSArICh0dGxTZWNvbmRzICogMTAwMCk7XG4gICAgICAgIHRoaXMuY2FjaGUuc2V0KGtleSwgeyBkYXRhOiB2YWx1ZSwgZXhwaXJlcyB9KTtcbiAgICB9XG5cbiAgICBhc3luYyBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZSgnKicsICcuKicpKTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5jYWNoZS5rZXlzKCkpIHtcbiAgICAgICAgICAgIGlmIChyZWdleC50ZXN0KGtleSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhbnVwKCk6IHZvaWQge1xuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLmNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgaWYgKG5vdyA+IGVudHJ5LmV4cGlyZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhY2hlLmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuY2xlYW51cEludGVydmFsKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuY2xlYW51cEludGVydmFsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gICAgfVxufVxuXG4vLyBSZWRpcyBjYWNoZSBpbXBsZW1lbnRhdGlvblxuY2xhc3MgUmVkaXNDYWNoZSB7XG4gICAgcHJpdmF0ZSByZWRpczogUmVkaXM7XG4gICAgcHJpdmF0ZSBpc0Nvbm5lY3RlZCA9IGZhbHNlO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGNvbnN0IHJlZGlzVXJsID0gcHJvY2Vzcy5lbnYuUkVESVNfVVJMIHx8ICdyZWRpczovL2xvY2FsaG9zdDo2Mzc5JztcblxuICAgICAgICB0aGlzLnJlZGlzID0gbmV3IFJlZGlzKHJlZGlzVXJsLCB7XG4gICAgICAgICAgICByZXRyeURlbGF5T25GYWlsb3ZlcjogMTAwLFxuICAgICAgICAgICAgbWF4UmV0cmllc1BlclJlcXVlc3Q6IDMsXG4gICAgICAgICAgICBsYXp5Q29ubmVjdDogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yZWRpcy5vbignY29ubmVjdCcsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgUmVkaXMgY29ubmVjdGVkJyk7XG4gICAgICAgICAgICB0aGlzLmlzQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5yZWRpcy5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBSZWRpcyBjb25uZWN0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgICAgIHRoaXMuaXNDb25uZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0KGtleTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSByZXR1cm4gbnVsbDtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLnJlZGlzLmdldChrZXkpO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlID8gSlNPTi5wYXJzZSh2YWx1ZSkgOiBudWxsO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVkaXMgZ2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCB0dGxTZWNvbmRzOiBudW1iZXIgPSBDQUNIRV9DT05GSUcuREVGQVVMVF9UVEwpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSByZXR1cm47XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucmVkaXMuc2V0ZXgoa2V5LCB0dGxTZWNvbmRzLCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignUmVkaXMgc2V0IGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoIXRoaXMuaXNDb25uZWN0ZWQpIHJldHVybjtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoa2V5KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlzIGRlbCBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29ubmVjdGVkKSByZXR1cm47XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBhd2FpdCB0aGlzLnJlZGlzLmtleXMocGF0dGVybik7XG4gICAgICAgICAgICBpZiAoa2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5yZWRpcy5kZWwoLi4ua2V5cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdSZWRpcyBpbnZhbGlkYXRlUGF0dGVybiBlcnJvcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkaXNjb25uZWN0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnJlZGlzLmRpc2Nvbm5lY3QoKTtcbiAgICB9XG59XG5cbi8vIENhY2hlIHNlcnZpY2UgaW50ZXJmYWNlXG5pbnRlcmZhY2UgQ2FjaGVTZXJ2aWNlIHtcbiAgICBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPGFueT47XG4gICAgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogYW55LCB0dGxTZWNvbmRzPzogbnVtYmVyKTogUHJvbWlzZTx2b2lkPjtcbiAgICBkZWwoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+O1xuICAgIGludmFsaWRhdGVQYXR0ZXJuKHBhdHRlcm46IHN0cmluZyk6IFByb21pc2U8dm9pZD47XG4gICAgZGVzdHJveT8oKTogdm9pZDtcbn1cblxuLy8gQ2FjaGUgc2VydmljZSBpbXBsZW1lbnRhdGlvblxuY2xhc3MgQ2FjaGVNYW5hZ2VyIGltcGxlbWVudHMgQ2FjaGVTZXJ2aWNlIHtcbiAgICBwcml2YXRlIGNhY2hlOiBDYWNoZVNlcnZpY2U7XG4gICAgcHJpdmF0ZSB1c2VSZWRpczogYm9vbGVhbjtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnVzZVJlZGlzID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyAmJiAhIXByb2Nlc3MuZW52LlJFRElTX1VSTDtcblxuICAgICAgICBpZiAodGhpcy51c2VSZWRpcykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfmoAgVXNpbmcgUmVkaXMgY2FjaGUnKTtcbiAgICAgICAgICAgIHRoaXMuY2FjaGUgPSBuZXcgUmVkaXNDYWNoZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfkr4gVXNpbmcgaW4tbWVtb3J5IGNhY2hlJyk7XG4gICAgICAgICAgICB0aGlzLmNhY2hlID0gbmV3IE1lbW9yeUNhY2hlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXQoa2V5OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBzZXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIHR0bFNlY29uZHM/OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuc2V0KGtleSwgdmFsdWUsIHR0bFNlY29uZHMpO1xuICAgIH1cblxuICAgIGFzeW5jIGRlbChrZXk6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZS5kZWwoa2V5KTtcbiAgICB9XG5cbiAgICBhc3luYyBpbnZhbGlkYXRlUGF0dGVybihwYXR0ZXJuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuaW52YWxpZGF0ZVBhdHRlcm4ocGF0dGVybik7XG4gICAgfVxuXG4gICAgLy8gSGVscGVyIG1ldGhvZHMgZm9yIGNvbW1vbiBjYWNoZSBvcGVyYXRpb25zXG4gICAgYXN5bmMgZ2V0T3JTZXQ8VD4oXG4gICAgICAgIGtleTogc3RyaW5nLFxuICAgICAgICBmZXRjaGVyOiAoKSA9PiBQcm9taXNlPFQ+LFxuICAgICAgICB0dGxTZWNvbmRzPzogbnVtYmVyXG4gICAgKTogUHJvbWlzZTxUPiB7XG4gICAgICAgIC8vIFRyeSB0byBnZXQgZnJvbSBjYWNoZSBmaXJzdFxuICAgICAgICBjb25zdCBjYWNoZWQgPSBhd2FpdCB0aGlzLmdldChrZXkpO1xuICAgICAgICBpZiAoY2FjaGVkICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmV0Y2ggZnJlc2ggZGF0YVxuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgZmV0Y2hlcigpO1xuXG4gICAgICAgIC8vIFN0b3JlIGluIGNhY2hlXG4gICAgICAgIGF3YWl0IHRoaXMuc2V0KGtleSwgZGF0YSwgdHRsU2Vjb25kcyk7XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgLy8gR2VuZXJhdGUgY2FjaGUga2V5IHdpdGggcGFyYW1ldGVyc1xuICAgIGdlbmVyYXRlS2V5KHByZWZpeDogc3RyaW5nLCBwYXJhbXM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fSk6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IHNvcnRlZFBhcmFtcyA9IE9iamVjdC5rZXlzKHBhcmFtcylcbiAgICAgICAgICAgIC5zb3J0KClcbiAgICAgICAgICAgIC5tYXAoa2V5ID0+IGAke2tleX06JHtwYXJhbXNba2V5XX1gKVxuICAgICAgICAgICAgLmpvaW4oJ3wnKTtcblxuICAgICAgICByZXR1cm4gc29ydGVkUGFyYW1zID8gYCR7cHJlZml4fToke3NvcnRlZFBhcmFtc31gIDogcHJlZml4O1xuICAgIH1cblxuICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZSBlbnRyaWVzXG4gICAgYXN5bmMgaW52YWxpZGF0ZUludmVudG9yeSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5JTlZFTlRPUllfU1VNTUFSWX0qYCksXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLlBST0RVQ1RTfSpgKSxcbiAgICAgICAgXSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaW52YWxpZGF0ZUludm9pY2VzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLklOVk9JQ0VTfSpgKSxcbiAgICAgICAgICAgIHRoaXMuaW52YWxpZGF0ZVBhdHRlcm4oYCR7Q0FDSEVfQ09ORklHLktFWVMuSU5WT0lDRV9TVEFUU30qYCksXG4gICAgICAgIF0pO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVSZWZlcmVuY2VEYXRhKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLkNBVEVHT1JJRVN9KmApLFxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlUGF0dGVybihgJHtDQUNIRV9DT05GSUcuS0VZUy5TSE9QU30qYCksXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLkNVU1RPTUVSU30qYCksXG4gICAgICAgIF0pO1xuICAgIH1cblxuICAgIC8vIEF1dGhlbnRpY2F0aW9uIGNhY2hlIGludmFsaWRhdGlvbiBtZXRob2RzXG4gICAgYXN5bmMgaW52YWxpZGF0ZVVzZXJTZXNzaW9uKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHVzZXJTZXNzaW9uS2V5ID0gdGhpcy5nZW5lcmF0ZUtleShDQUNIRV9DT05GSUcuS0VZUy5VU0VSX1NFU1NJT04sIHsgdXNlcklkIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmRlbCh1c2VyU2Vzc2lvbktleSk7XG4gICAgfVxuXG4gICAgYXN5bmMgaW52YWxpZGF0ZVVzZXJQZXJtaXNzaW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB1c2VyUGVybWlzc2lvbnNLZXkgPSB0aGlzLmdlbmVyYXRlS2V5KENBQ0hFX0NPTkZJRy5LRVlTLlVTRVJfUEVSTUlTU0lPTlMsIHsgdXNlcklkIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLmRlbCh1c2VyUGVybWlzc2lvbnNLZXkpO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVSb2xlUGVybWlzc2lvbnMocm9sZUlkOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3Qgcm9sZVBlcm1pc3Npb25zS2V5ID0gdGhpcy5nZW5lcmF0ZUtleShDQUNIRV9DT05GSUcuS0VZUy5ST0xFX1BFUk1JU1NJT05TLCB7IHJvbGVJZCB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWwocm9sZVBlcm1pc3Npb25zS2V5KTtcbiAgICAgICAgLy8gQWxzbyBpbnZhbGlkYXRlIGFsbCB1c2VyIHBlcm1pc3Npb25zIGZvciB1c2VycyB3aXRoIHRoaXMgcm9sZVxuICAgICAgICBhd2FpdCB0aGlzLmludmFsaWRhdGVQYXR0ZXJuKGAke0NBQ0hFX0NPTkZJRy5LRVlTLlVTRVJfUEVSTUlTU0lPTlN9KmApO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVUb2tlblZhbGlkYXRpb24odG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB0b2tlbktleSA9IHRoaXMuZ2VuZXJhdGVLZXkoQ0FDSEVfQ09ORklHLktFWVMuVE9LRU5fVkFMSURBVElPTiwgeyB0b2tlbjogdG9rZW4uc3Vic3RyaW5nKDAsIDIwKSB9KTtcbiAgICAgICAgYXdhaXQgdGhpcy5kZWwodG9rZW5LZXkpO1xuICAgIH1cblxuICAgIGFzeW5jIGludmFsaWRhdGVBbGxVc2VyQXV0aCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICB0aGlzLmludmFsaWRhdGVVc2VyU2Vzc2lvbih1c2VySWQpLFxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkYXRlVXNlclBlcm1pc3Npb25zKHVzZXJJZCksXG4gICAgICAgIF0pO1xuICAgIH1cblxuICAgIGRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmNhY2hlICYmIHR5cGVvZiAodGhpcy5jYWNoZSBhcyBhbnkpLmRlc3Ryb3kgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICh0aGlzLmNhY2hlIGFzIGFueSkuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNhY2hlICYmIHR5cGVvZiAodGhpcy5jYWNoZSBhcyBhbnkpLmRpc2Nvbm5lY3QgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICh0aGlzLmNhY2hlIGFzIGFueSkuZGlzY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5jb25zdCBjYWNoZSA9IG5ldyBDYWNoZU1hbmFnZXIoKTtcbmV4cG9ydCB7IGNhY2hlIH07XG5cbi8vIEV4cG9ydCBhcyBjYWNoZVNlcnZpY2UgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbmV4cG9ydCB7IGNhY2hlIGFzIGNhY2hlU2VydmljZSB9O1xuXG4vLyBFeHBvcnQgdHlwZXMgYW5kIGNvbnN0YW50c1xuZXhwb3J0IHsgQ0FDSEVfQ09ORklHIH07XG5leHBvcnQgdHlwZSB7IENhY2hlU2VydmljZSB9O1xuXG4vLyBDbGVhbnVwIG9uIHByb2Nlc3MgZXhpdFxucHJvY2Vzcy5vbignU0lHSU5UJywgKCkgPT4ge1xuICAgIGNhY2hlLmRlc3Ryb3koKTtcbn0pO1xuXG5wcm9jZXNzLm9uKCdTSUdURVJNJywgKCkgPT4ge1xuICAgIGNhY2hlLmRlc3Ryb3koKTtcbn0pO1xuXG4vLyBFeHBvcnQgY2xlYW51cCBmdW5jdGlvbiBmb3IgdGVzdHNcbmV4cG9ydCBjb25zdCBjbGVhbnVwQ2FjaGUgPSAoKSA9PiB7XG4gICAgY2FjaGUuZGVzdHJveSgpO1xufTsiXSwibmFtZXMiOlsiQ0FDSEVfQ09ORklHIiwiY2FjaGUiLCJjYWNoZVNlcnZpY2UiLCJjbGVhbnVwQ2FjaGUiLCJERUZBVUxUX1RUTCIsIktFWVMiLCJJTlZFTlRPUllfU1VNTUFSWSIsIklOVk9JQ0VTIiwiSU5WT0lDRV9TVEFUUyIsIkNBVEVHT1JJRVMiLCJTSE9QUyIsIkNVU1RPTUVSUyIsIlBST0RVQ1RTIiwiVVNFUl9TRVNTSU9OIiwiVVNFUl9QRVJNSVNTSU9OUyIsIlJPTEVfUEVSTUlTU0lPTlMiLCJUT0tFTl9WQUxJREFUSU9OIiwiVFRMIiwiSU5WRU5UT1JZIiwiU1RBVFMiLCJSRUZFUkVOQ0VfREFUQSIsIk1lbW9yeUNhY2hlIiwiY29uc3RydWN0b3IiLCJNYXAiLCJjbGVhbnVwSW50ZXJ2YWwiLCJzZXRJbnRlcnZhbCIsImNsZWFudXAiLCJnZXQiLCJrZXkiLCJlbnRyeSIsIkRhdGUiLCJub3ciLCJleHBpcmVzIiwiZGVsZXRlIiwiZGF0YSIsInNldCIsInZhbHVlIiwidHRsU2Vjb25kcyIsImRlbCIsImludmFsaWRhdGVQYXR0ZXJuIiwicGF0dGVybiIsInJlZ2V4IiwiUmVnRXhwIiwicmVwbGFjZSIsImtleXMiLCJ0ZXN0IiwiZW50cmllcyIsImRlc3Ryb3kiLCJjbGVhckludGVydmFsIiwiY2xlYXIiLCJSZWRpc0NhY2hlIiwiaXNDb25uZWN0ZWQiLCJyZWRpc1VybCIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJyZWRpcyIsIlJlZGlzIiwicmV0cnlEZWxheU9uRmFpbG92ZXIiLCJtYXhSZXRyaWVzUGVyUmVxdWVzdCIsImxhenlDb25uZWN0Iiwib24iLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJKU09OIiwicGFyc2UiLCJzZXRleCIsInN0cmluZ2lmeSIsImxlbmd0aCIsImRpc2Nvbm5lY3QiLCJDYWNoZU1hbmFnZXIiLCJ1c2VSZWRpcyIsIk5PREVfRU5WIiwiZ2V0T3JTZXQiLCJmZXRjaGVyIiwiY2FjaGVkIiwiZ2VuZXJhdGVLZXkiLCJwcmVmaXgiLCJwYXJhbXMiLCJzb3J0ZWRQYXJhbXMiLCJPYmplY3QiLCJzb3J0IiwibWFwIiwiam9pbiIsImludmFsaWRhdGVJbnZlbnRvcnkiLCJQcm9taXNlIiwiYWxsIiwiaW52YWxpZGF0ZUludm9pY2VzIiwiaW52YWxpZGF0ZVJlZmVyZW5jZURhdGEiLCJpbnZhbGlkYXRlVXNlclNlc3Npb24iLCJ1c2VySWQiLCJ1c2VyU2Vzc2lvbktleSIsImludmFsaWRhdGVVc2VyUGVybWlzc2lvbnMiLCJ1c2VyUGVybWlzc2lvbnNLZXkiLCJpbnZhbGlkYXRlUm9sZVBlcm1pc3Npb25zIiwicm9sZUlkIiwicm9sZVBlcm1pc3Npb25zS2V5IiwiaW52YWxpZGF0ZVRva2VuVmFsaWRhdGlvbiIsInRva2VuIiwidG9rZW5LZXkiLCJzdWJzdHJpbmciLCJpbnZhbGlkYXRlQWxsVXNlckF1dGgiXSwibWFwcGluZ3MiOiJBQUFBOzs7Q0FHQzs7Ozs7Ozs7Ozs7SUE2VFFBLFlBQVk7ZUFBWkE7O0lBTkFDLEtBQUs7ZUFBTEE7O0lBR1NDLFlBQVk7ZUFBckJEOztJQWdCSUUsWUFBWTtlQUFaQTs7O3lCQXhVUztBQUV0QixzQkFBc0I7QUFDdEIsTUFBTUgsZUFBZTtJQUNqQix5QkFBeUI7SUFDekJJLGFBQWE7SUFFYixhQUFhO0lBQ2JDLE1B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