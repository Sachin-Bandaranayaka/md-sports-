{"version":3,"names":["cov_torxfj5iv","actualCoverage","s","usePermission","routePermissions","f","user","_useAuth","useAuth","_router","_navigation","useRouter","pathname","usePathname","hasPermission","permission","b","permissions","length","includes","checkRoutePermission","requiredPermission","undefined","route","startsWith"],"sources":["/Users/sachin/Documents/md-sports-/src/hooks/usePermission.ts"],"sourcesContent":["'use client';\n\n\nimport { useRouter, usePathname } from 'next/navigation';\nimport { useAuth } from './useAuth';\n\n// Map routes to required permissions\nconst routePermissions: Record<string, string> = {\n    '/dashboard': 'view_dashboard',  // Require dashboard permission\n    '/inventory': 'inventory:view',  // Full inventory access (blocked for shop staff)\n    '/inventory/transfers': 'inventory:transfer',\n    '/inventory/distribution': 'shop:distribution:view',  // Shop distribution access\n    '/suppliers': 'supplier:view',\n    '/purchases': 'purchase:view',\n    '/quotations': 'quotation:view',\n    '/shops': 'shop:view',\n    '/customers': 'customer:view',\n    '/invoices': 'invoice:view',\n    '/accounting': 'accounting:view',\n    '/reports': 'report:view',\n    '/settings': 'settings:manage',\n};\n\nexport function usePermission() {\n    const { user } = useAuth();\n    const _router = useRouter();\n    const pathname = usePathname();\n\n    const hasPermission = (permission: string): boolean => {\n        if (!permission) return true; // No permission required\n        if (!user?.permissions || !user.permissions.length) return false;\n        \n        // Check for admin permissions first\n        if (user.permissions.includes('*') || user.permissions.includes('admin:all')) {\n            return true;\n        }\n        \n        return user.permissions.includes(permission);\n    };\n\n    // Check if user has permission to access the current route\n    const checkRoutePermission = (): boolean => {\n        // Default to dashboard for root path\n        if (pathname === '/') return true;\n\n        // Login page is always accessible\n        if (pathname === '/login') return true;\n\n        // For exact route matches\n        const requiredPermission = routePermissions[pathname];\n        if (requiredPermission !== undefined) {\n            return hasPermission(requiredPermission);\n        }\n\n        // For routes that don't have an exact match, check parent routes\n        for (const route in routePermissions) {\n            if (pathname.startsWith(route + '/')) {\n                return hasPermission(routePermissions[route]);\n            }\n        }\n\n        // If no matching route found, allow access by default\n        return true;\n    };\n\n    return {\n        hasPermission,\n        checkRoutePermission\n    };\n}"],"mappings":"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","ignoreList":[]}