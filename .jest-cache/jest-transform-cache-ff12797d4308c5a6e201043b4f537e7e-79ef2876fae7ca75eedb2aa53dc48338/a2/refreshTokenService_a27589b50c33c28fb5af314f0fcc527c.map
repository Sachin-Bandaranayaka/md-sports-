{"version":3,"names":["cleanupRefreshTokens","cov_cprhe2as4","f","s","generateRefreshToken","revokeAllUserRefreshTokens","revokeRefreshToken","verifyRefreshToken","REFRESH_TOKEN_EXPIRES_IN_DAYS","generateSecureToken","length","b","crypto","bytes","Uint8Array","getRandomValues","Array","from","map","byte","toString","padStart","join","Math","floor","random","userId","_prisma","default","refreshToken","console","error","Error","log","safeQuery","updateMany","where","isRevoked","expiresAt","gt","Date","data","token","setDate","getDate","substring","createdToken","create","updatedAt","id","message","stack","findUnique","update","now","deleteMany","OR","lt"],"sources":["/Users/sachin/Documents/md-sports-/src/services/refreshTokenService.ts"],"sourcesContent":["import prisma, { safeQuery } from '@/lib/prisma';\n\n// Configuration\nconst REFRESH_TOKEN_EXPIRES_IN_DAYS = 30;\n\n// Generate a secure random token using Web Crypto API\nconst generateSecureToken = (length = 40): string => {\n    // Use Web Crypto API which is supported in Edge Runtime\n    if (typeof crypto !== 'undefined') {\n        const bytes = new Uint8Array(length);\n        crypto.getRandomValues(bytes);\n        return Array.from(bytes)\n            .map(byte => byte.toString(16).padStart(2, '0'))\n            .join('');\n    }\n\n    // Fallback (less secure but works everywhere)\n    return Array.from(\n        { length },\n        () => Math.floor(Math.random() * 16).toString(16)\n    ).join('');\n};\n\n/**\n * Generate a new refresh token for a user\n */\nexport const generateRefreshToken = async (userId: string): Promise<string> => {\n    try {\n        // Verify prisma client is initialized\n        if (!prisma || !prisma.refreshToken) {\n            console.error('Prisma client or RefreshToken model not available');\n            throw new Error('Database client not initialized correctly');\n        }\n\n        // Log for debugging\n        console.log('Generating refresh token for user ID:', userId);\n\n        // IMPORTANT: Revoke all existing non-expired refresh tokens for this user\n        // This ensures only one active session per user at a time\n        console.log('Revoking all existing refresh tokens for user before creating new one');\n        await safeQuery(\n            () => prisma.refreshToken.updateMany({\n                where: {\n                    userId,\n                    isRevoked: false,\n                    expiresAt: { gt: new Date() }\n                },\n                data: { isRevoked: true },\n            }),\n            null,\n            'Failed to revoke existing refresh tokens'\n        );\n\n        // Generate a random token\n        const token = generateSecureToken(40);\n\n        // Calculate expiration date (30 days from now)\n        const expiresAt = new Date();\n        expiresAt.setDate(expiresAt.getDate() + REFRESH_TOKEN_EXPIRES_IN_DAYS);\n\n        // Log the token details before creating\n        console.log('Preparing to create refresh token with:', {\n            userId,\n            token: token.substring(0, 10) + '...',\n            expiresAt,\n        });\n\n        // Store the token in the database with retry logic\n        const createdToken = await safeQuery(\n            () => prisma.refreshToken.create({\n                data: {\n                    userId,\n                    token,\n                    expiresAt,\n                    updatedAt: new Date(),\n                },\n            }),\n            null,\n            'Failed to create refresh token'\n        );\n\n        if (!createdToken) {\n            throw new Error('Failed to create refresh token in database');\n        }\n\n        console.log('Successfully created refresh token with ID:', createdToken.id);\n\n        return token;\n    } catch (error) {\n        // More detailed error logging\n        console.error('Error generating refresh token:', error);\n        if (error instanceof Error) {\n            console.error('Error message:', error.message);\n            console.error('Error stack:', error.stack);\n        }\n        throw new Error('Failed to generate refresh token');\n    }\n};\n\n/**\n * Verify a refresh token and return the associated user ID if valid\n */\nexport const verifyRefreshToken = async (token: string): Promise<string | null> => {\n    try {\n        // Verify prisma client is initialized\n        if (!prisma || !prisma.refreshToken) {\n            console.error('Prisma client or RefreshToken model not available');\n            return null;\n        }\n\n        // Find the token in the database with retry logic\n        const refreshToken = await safeQuery(\n            () => prisma.refreshToken.findUnique({\n                where: { token },\n            }),\n            null,\n            'Failed to find refresh token'\n        );\n\n        // Check if token exists and is not revoked\n        if (!refreshToken || refreshToken.isRevoked) {\n            console.log('Token not found or revoked:', token.substring(0, 10) + '...');\n            return null;\n        }\n\n        // Check if token is expired\n        if (new Date() > refreshToken.expiresAt) {\n            console.log('Token expired:', token.substring(0, 10) + '...');\n\n            // Revoke expired token with retry logic\n            await safeQuery(\n                () => prisma.refreshToken.update({\n                    where: { id: refreshToken.id },\n                    data: { isRevoked: true },\n                }),\n                null,\n                'Failed to revoke expired refresh token'\n            );\n\n            return null;\n        }\n\n        return refreshToken.userId;\n    } catch (error) {\n        console.error('Error verifying refresh token:', error);\n        return null;\n    }\n};\n\n/**\n * Revoke a specific refresh token\n */\nexport const revokeRefreshToken = async (token: string): Promise<boolean> => {\n    try {\n        // Verify prisma client is initialized\n        if (!prisma || !prisma.refreshToken) {\n            console.error('Prisma client or RefreshToken model not available');\n            return false;\n        }\n\n        await safeQuery(\n            () => prisma.refreshToken.updateMany({\n                where: { token },\n                data: { isRevoked: true },\n            }),\n            null,\n            'Failed to revoke refresh token'\n        );\n\n        return true;\n    } catch (error) {\n        console.error('Error revoking refresh token:', error);\n        return false;\n    }\n};\n\n/**\n * Revoke all refresh tokens for a specific user\n */\nexport const revokeAllUserRefreshTokens = async (userId: string): Promise<boolean> => {\n    try {\n        // Verify prisma client is initialized\n        if (!prisma || !prisma.refreshToken) {\n            console.error('Prisma client or RefreshToken model not available');\n            return false;\n        }\n\n        await safeQuery(\n            () => prisma.refreshToken.updateMany({\n                where: { userId },\n                data: { isRevoked: true },\n            }),\n            null,\n            'Failed to revoke all user refresh tokens'\n        );\n\n        return true;\n    } catch (error) {\n        console.error('Error revoking user refresh tokens:', error);\n        return false;\n    }\n};\n\n/**\n * Clean up expired and revoked tokens\n * Note: This should be run periodically via a cron job\n */\nexport const cleanupRefreshTokens = async (): Promise<void> => {\n    try {\n        // Verify prisma client is initialized\n        if (!prisma || !prisma.refreshToken) {\n            console.error('Prisma client or RefreshToken model not available');\n            return;\n        }\n\n        const now = new Date();\n\n        await safeQuery(\n            () => prisma.refreshToken.deleteMany({\n                where: {\n                    OR: [\n                        { expiresAt: { lt: now } },\n                        { isRevoked: true },\n                    ],\n                },\n            }),\n            null,\n            'Failed to cleanup expired refresh tokens'\n        );\n    } catch (error) {\n        console.error('Error cleaning up refresh tokens:', error);\n    }\n};"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}