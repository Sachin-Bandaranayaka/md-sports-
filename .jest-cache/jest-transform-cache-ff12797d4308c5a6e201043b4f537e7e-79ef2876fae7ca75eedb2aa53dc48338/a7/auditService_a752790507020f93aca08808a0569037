3571cc33894cb185ef07c1e560ead3b0
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    AuditService: function() {
        return AuditService;
    },
    auditService: function() {
        return auditService;
    }
});
const _prisma = require("../lib/prisma");
class AuditService {
    constructor(){
        this.prisma = _prisma.prisma;
    }
    static getInstance() {
        if (!AuditService.instance) {
            AuditService.instance = new AuditService();
        }
        return AuditService.instance;
    }
    /**
   * Log an audit entry
   */ async logAction(entry) {
        try {
            // Prepare details object with all the additional information
            const details = {
                ...entry.details,
                originalData: entry.originalData,
                isDeleted: entry.isDeleted || false,
                deletedAt: entry.deletedAt,
                deletedBy: entry.deletedBy,
                canRecover: entry.canRecover || false,
                recoveredAt: entry.recoveredAt,
                recoveredBy: entry.recoveredBy
            };
            await this.prisma.auditLog.create({
                data: {
                    userId: entry.userId,
                    action: entry.action,
                    entity: entry.entity,
                    entityId: entry.entityId,
                    details: details
                }
            });
        } catch (error) {
            console.error("Failed to log audit entry:", error);
        // Don't throw error to avoid breaking the main operation
        }
    }
    /**
   * Soft delete an entity and log it
   */ async softDelete(entity, entityId, originalData, userId, canRecover = true) {
        await this.logAction({
            userId,
            action: "DELETE",
            entity,
            entityId,
            originalData,
            isDeleted: true,
            deletedAt: new Date(),
            deletedBy: userId,
            canRecover,
            details: {
                type: "soft_delete",
                recoverable: canRecover
            }
        });
    }
    /**
   * Get recycle bin items (deleted items that can be recovered)
   */ async getRecycleBinItems(entity, limit = 50, offset = 0) {
        const where = {
            action: "DELETE",
            ...entity && {
                entity
            }
        };
        const [items, total] = await Promise.all([
            this.prisma.auditLog.findMany({
                where,
                orderBy: {
                    createdAt: "desc"
                },
                take: limit,
                skip: offset
            }),
            this.prisma.auditLog.count({
                where
            })
        ]);
        // Filter and map items that are deleted and recoverable
        const recycleBinItems = items.filter((item)=>{
            const details = item.details;
            return details?.isDeleted && details?.canRecover && !details?.recoveredAt;
        }).map((item)=>{
            const details = item.details;
            return {
                id: item.id,
                entity: item.entity,
                entityId: item.entityId,
                originalData: details?.originalData,
                deletedAt: details?.deletedAt ? new Date(details.deletedAt) : item.createdAt,
                deletedBy: details?.deletedBy || item.userId,
                deletedByUser: undefined,
                canRecover: details?.canRecover || false
            };
        });
        return {
            items: recycleBinItems,
            total
        };
    }
    /**
   * Recover a deleted item
   */ async recoverItem(auditLogId, userId) {
        try {
            const auditEntry = await this.prisma.auditLog.findUnique({
                where: {
                    id: auditLogId
                }
            });
            if (!auditEntry) {
                return {
                    success: false,
                    message: "Audit entry not found"
                };
            }
            const details = auditEntry.details;
            if (!details?.isDeleted || !details?.canRecover || details?.recoveredAt) {
                return {
                    success: false,
                    message: "Item cannot be recovered"
                };
            }
            // Restore the data based on entity type
            const restoredData = await this.restoreEntityData(auditEntry.entity, details.originalData);
            if (!restoredData.success) {
                return restoredData;
            }
            // Mark as recovered by updating the details
            const updatedDetails = {
                ...details,
                recoveredAt: new Date(),
                recoveredBy: userId
            };
            await this.prisma.auditLog.update({
                where: {
                    id: auditLogId
                },
                data: {
                    details: updatedDetails
                }
            });
            // Log the recovery action
            await this.logAction({
                userId,
                action: "RECOVER",
                entity: auditEntry.entity,
                entityId: restoredData.data?.id,
                details: {
                    type: "recovery",
                    originalAuditLogId: auditLogId,
                    recoveredData: restoredData.data
                }
            });
            return {
                success: true,
                message: "Item recovered successfully",
                data: restoredData.data
            };
        } catch (error) {
            console.error("Failed to recover item:", error);
            return {
                success: false,
                message: "Failed to recover item"
            };
        }
    }
    /**
   * Restore entity data based on entity type
   */ async restoreEntityData(entity, originalData) {
        try {
            let restoredData;
            switch(entity.toLowerCase()){
                case "product":
                    restoredData = await this.prisma.product.create({
                        data: {
                            name: originalData.name,
                            description: originalData.description,
                            price: originalData.price,
                            cost: originalData.cost,
                            sku: originalData.sku,
                            barcode: originalData.barcode,
                            categoryId: originalData.categoryId,
                            supplierId: originalData.supplierId,
                            minStockLevel: originalData.minStockLevel,
                            maxStockLevel: originalData.maxStockLevel,
                            unit: originalData.unit,
                            weight: originalData.weight,
                            dimensions: originalData.dimensions,
                            isActive: originalData.isActive ?? true
                        }
                    });
                    break;
                case "customer":
                    restoredData = await this.prisma.customer.create({
                        data: {
                            name: originalData.name,
                            email: originalData.email,
                            phone: originalData.phone,
                            address: originalData.address,
                            city: originalData.city,
                            postalCode: originalData.postalCode,
                            country: originalData.country,
                            taxNumber: originalData.taxNumber,
                            creditLimit: originalData.creditLimit,
                            paymentTerms: originalData.paymentTerms,
                            isActive: originalData.isActive ?? true
                        }
                    });
                    break;
                case "supplier":
                    restoredData = await this.prisma.supplier.create({
                        data: {
                            name: originalData.name,
                            email: originalData.email,
                            phone: originalData.phone,
                            address: originalData.address,
                            city: originalData.city,
                            postalCode: originalData.postalCode,
                            country: originalData.country,
                            taxNumber: originalData.taxNumber,
                            paymentTerms: originalData.paymentTerms,
                            isActive: originalData.isActive ?? true
                        }
                    });
                    break;
                case "category":
                    restoredData = await this.prisma.category.create({
                        data: {
                            name: originalData.name,
                            description: originalData.description,
                            isActive: originalData.isActive ?? true
                        }
                    });
                    break;
                case "receipt":
                    restoredData = await this.prisma.receipt.create({
                        data: {
                            receiptNumber: originalData.receiptNumber,
                            amount: originalData.amount,
                            paymentId: originalData.paymentId,
                            issuedAt: originalData.issuedAt,
                            notes: originalData.notes
                        }
                    });
                    break;
                default:
                    return {
                        success: false,
                        message: `Recovery not supported for entity type: ${entity}`
                    };
            }
            return {
                success: true,
                message: "Entity restored successfully",
                data: restoredData
            };
        } catch (error) {
            console.error(`Failed to restore ${entity}:`, error);
            return {
                success: false,
                message: `Failed to restore ${entity}: ${error instanceof Error ? error.message : "Unknown error"}`
            };
        }
    }
    /**
   * Get audit history for an entity
   */ async getEntityHistory(entity, entityId, limit = 20) {
        const entries = await this.prisma.auditLog.findMany({
            where: {
                entity,
                entityId
            },
            include: {
                user: {
                    select: {
                        id: true,
                        name: true,
                        email: true
                    }
                },
                deletedByUser: {
                    select: {
                        id: true,
                        name: true,
                        email: true
                    }
                },
                recoveredByUser: {
                    select: {
                        id: true,
                        name: true,
                        email: true
                    }
                }
            },
            orderBy: {
                createdAt: "desc"
            },
            take: limit
        });
        return entries;
    }
    /**
   * Permanently delete items from recycle bin
   */ async permanentlyDelete(auditLogIds) {
        await this.prisma.auditLog.updateMany({
            where: {
                id: {
                    in: auditLogIds
                },
                isDeleted: true
            },
            data: {
                canRecover: false
            }
        });
    }
    /**
   * Clean up old deleted items (older than specified days)
   */ async cleanupOldDeletedItems(daysOld = 30) {
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - daysOld);
        const result = await this.prisma.auditLog.updateMany({
            where: {
                isDeleted: true,
                canRecover: true,
                deletedAt: {
                    lt: cutoffDate
                }
            },
            data: {
                canRecover: false
            }
        });
        return result.count;
    }
    /**
   * Get IDs of soft-deleted entities for a specific entity type
   */ async getDeletedEntityIds(entity) {
        try {
            const deletedEntries = await this.prisma.auditLog.findMany({
                where: {
                    entity,
                    action: "DELETE"
                },
                select: {
                    entityId: true,
                    details: true
                }
            });
            // Filter for items that are deleted and not recovered
            const deletedIds = deletedEntries.filter((entry)=>{
                const details = entry.details;
                return details?.isDeleted && !details?.recoveredAt;
            }).map((entry)=>entry.entityId).filter((id)=>id !== null);
            return deletedIds;
        } catch (error) {
            console.error(`Error getting deleted entity IDs for ${entity}:`, error);
            return [];
        }
    }
}
const auditService = AuditService.getInstance();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vc3JjL3NlcnZpY2VzL2F1ZGl0U2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGl0TG9nRW50cnkge1xuICBpZD86IG51bWJlcjtcbiAgdXNlcklkPzogbnVtYmVyO1xuICBhY3Rpb246IHN0cmluZztcbiAgZW50aXR5OiBzdHJpbmc7XG4gIGVudGl0eUlkPzogbnVtYmVyO1xuICBkZXRhaWxzPzogYW55O1xuICBvcmlnaW5hbERhdGE/OiBhbnk7XG4gIGlzRGVsZXRlZD86IGJvb2xlYW47XG4gIGRlbGV0ZWRBdD86IERhdGU7XG4gIGRlbGV0ZWRCeT86IG51bWJlcjtcbiAgY2FuUmVjb3Zlcj86IGJvb2xlYW47XG4gIHJlY292ZXJlZEF0PzogRGF0ZTtcbiAgcmVjb3ZlcmVkQnk/OiBudW1iZXI7XG4gIGNyZWF0ZWRBdD86IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjeWNsZUJpbkl0ZW0ge1xuICBpZDogbnVtYmVyO1xuICBlbnRpdHk6IHN0cmluZztcbiAgZW50aXR5SWQ6IG51bWJlcjtcbiAgb3JpZ2luYWxEYXRhOiBhbnk7XG4gIGRlbGV0ZWRBdDogRGF0ZTtcbiAgZGVsZXRlZEJ5OiBudW1iZXI7XG4gIGRlbGV0ZWRCeVVzZXI/OiB7XG4gICAgaWQ6IG51bWJlcjtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZW1haWw6IHN0cmluZztcbiAgfTtcbiAgY2FuUmVjb3ZlcjogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIEF1ZGl0U2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBBdWRpdFNlcnZpY2U7XG4gIHByaXZhdGUgcHJpc21hOiBQcmlzbWFDbGllbnQ7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnByaXNtYSA9IHByaXNtYTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogQXVkaXRTZXJ2aWNlIHtcbiAgICBpZiAoIUF1ZGl0U2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgQXVkaXRTZXJ2aWNlLmluc3RhbmNlID0gbmV3IEF1ZGl0U2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gQXVkaXRTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBhbiBhdWRpdCBlbnRyeVxuICAgKi9cbiAgYXN5bmMgbG9nQWN0aW9uKGVudHJ5OiBBdWRpdExvZ0VudHJ5KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFByZXBhcmUgZGV0YWlscyBvYmplY3Qgd2l0aCBhbGwgdGhlIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAgICAgIGNvbnN0IGRldGFpbHMgPSB7XG4gICAgICAgIC4uLmVudHJ5LmRldGFpbHMsXG4gICAgICAgIG9yaWdpbmFsRGF0YTogZW50cnkub3JpZ2luYWxEYXRhLFxuICAgICAgICBpc0RlbGV0ZWQ6IGVudHJ5LmlzRGVsZXRlZCB8fCBmYWxzZSxcbiAgICAgICAgZGVsZXRlZEF0OiBlbnRyeS5kZWxldGVkQXQsXG4gICAgICAgIGRlbGV0ZWRCeTogZW50cnkuZGVsZXRlZEJ5LFxuICAgICAgICBjYW5SZWNvdmVyOiBlbnRyeS5jYW5SZWNvdmVyIHx8IGZhbHNlLFxuICAgICAgICByZWNvdmVyZWRBdDogZW50cnkucmVjb3ZlcmVkQXQsXG4gICAgICAgIHJlY292ZXJlZEJ5OiBlbnRyeS5yZWNvdmVyZWRCeSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHRoaXMucHJpc21hLmF1ZGl0TG9nLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQ6IGVudHJ5LnVzZXJJZCxcbiAgICAgICAgICBhY3Rpb246IGVudHJ5LmFjdGlvbixcbiAgICAgICAgICBlbnRpdHk6IGVudHJ5LmVudGl0eSxcbiAgICAgICAgICBlbnRpdHlJZDogZW50cnkuZW50aXR5SWQsXG4gICAgICAgICAgZGV0YWlsczogZGV0YWlscyxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9nIGF1ZGl0IGVudHJ5OicsIGVycm9yKTtcbiAgICAgIC8vIERvbid0IHRocm93IGVycm9yIHRvIGF2b2lkIGJyZWFraW5nIHRoZSBtYWluIG9wZXJhdGlvblxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTb2Z0IGRlbGV0ZSBhbiBlbnRpdHkgYW5kIGxvZyBpdFxuICAgKi9cbiAgYXN5bmMgc29mdERlbGV0ZShcbiAgICBlbnRpdHk6IHN0cmluZyxcbiAgICBlbnRpdHlJZDogbnVtYmVyLFxuICAgIG9yaWdpbmFsRGF0YTogYW55LFxuICAgIHVzZXJJZDogbnVtYmVyLFxuICAgIGNhblJlY292ZXI6IGJvb2xlYW4gPSB0cnVlXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nQWN0aW9uKHtcbiAgICAgIHVzZXJJZCxcbiAgICAgIGFjdGlvbjogJ0RFTEVURScsXG4gICAgICBlbnRpdHksXG4gICAgICBlbnRpdHlJZCxcbiAgICAgIG9yaWdpbmFsRGF0YSxcbiAgICAgIGlzRGVsZXRlZDogdHJ1ZSxcbiAgICAgIGRlbGV0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIGRlbGV0ZWRCeTogdXNlcklkLFxuICAgICAgY2FuUmVjb3ZlcixcbiAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgdHlwZTogJ3NvZnRfZGVsZXRlJyxcbiAgICAgICAgcmVjb3ZlcmFibGU6IGNhblJlY292ZXIsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCByZWN5Y2xlIGJpbiBpdGVtcyAoZGVsZXRlZCBpdGVtcyB0aGF0IGNhbiBiZSByZWNvdmVyZWQpXG4gICAqL1xuICBhc3luYyBnZXRSZWN5Y2xlQmluSXRlbXMoXG4gICAgZW50aXR5Pzogc3RyaW5nLFxuICAgIGxpbWl0OiBudW1iZXIgPSA1MCxcbiAgICBvZmZzZXQ6IG51bWJlciA9IDBcbiAgKTogUHJvbWlzZTx7IGl0ZW1zOiBSZWN5Y2xlQmluSXRlbVtdOyB0b3RhbDogbnVtYmVyIH0+IHtcbiAgICBjb25zdCB3aGVyZSA9IHtcbiAgICAgIGFjdGlvbjogJ0RFTEVURScsXG4gICAgICAuLi4oZW50aXR5ICYmIHsgZW50aXR5IH0pLFxuICAgIH07XG5cbiAgICBjb25zdCBbaXRlbXMsIHRvdGFsXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHRoaXMucHJpc21hLmF1ZGl0TG9nLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJyxcbiAgICAgICAgfSxcbiAgICAgICAgdGFrZTogbGltaXQsXG4gICAgICAgIHNraXA6IG9mZnNldCxcbiAgICAgIH0pLFxuICAgICAgdGhpcy5wcmlzbWEuYXVkaXRMb2cuY291bnQoeyB3aGVyZSB9KSxcbiAgICBdKTtcblxuICAgIC8vIEZpbHRlciBhbmQgbWFwIGl0ZW1zIHRoYXQgYXJlIGRlbGV0ZWQgYW5kIHJlY292ZXJhYmxlXG4gICAgY29uc3QgcmVjeWNsZUJpbkl0ZW1zID0gaXRlbXNcbiAgICAgIC5maWx0ZXIoKGl0ZW0pID0+IHtcbiAgICAgICAgY29uc3QgZGV0YWlscyA9IGl0ZW0uZGV0YWlscyBhcyBhbnk7XG4gICAgICAgIHJldHVybiBkZXRhaWxzPy5pc0RlbGV0ZWQgJiYgZGV0YWlscz8uY2FuUmVjb3ZlciAmJiAhZGV0YWlscz8ucmVjb3ZlcmVkQXQ7XG4gICAgICB9KVxuICAgICAgLm1hcCgoaXRlbSkgPT4ge1xuICAgICAgICBjb25zdCBkZXRhaWxzID0gaXRlbS5kZXRhaWxzIGFzIGFueTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpZDogaXRlbS5pZCxcbiAgICAgICAgICBlbnRpdHk6IGl0ZW0uZW50aXR5LFxuICAgICAgICAgIGVudGl0eUlkOiBpdGVtLmVudGl0eUlkISxcbiAgICAgICAgICBvcmlnaW5hbERhdGE6IGRldGFpbHM/Lm9yaWdpbmFsRGF0YSxcbiAgICAgICAgICBkZWxldGVkQXQ6IGRldGFpbHM/LmRlbGV0ZWRBdCA/IG5ldyBEYXRlKGRldGFpbHMuZGVsZXRlZEF0KSA6IGl0ZW0uY3JlYXRlZEF0LFxuICAgICAgICAgIGRlbGV0ZWRCeTogZGV0YWlscz8uZGVsZXRlZEJ5IHx8IGl0ZW0udXNlcklkISxcbiAgICAgICAgICBkZWxldGVkQnlVc2VyOiB1bmRlZmluZWQsIC8vIFdlJ2xsIG5lZWQgdG8gZmV0Y2ggdGhpcyBzZXBhcmF0ZWx5IGlmIG5lZWRlZFxuICAgICAgICAgIGNhblJlY292ZXI6IGRldGFpbHM/LmNhblJlY292ZXIgfHwgZmFsc2UsXG4gICAgICAgIH07XG4gICAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBpdGVtczogcmVjeWNsZUJpbkl0ZW1zLFxuICAgICAgdG90YWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvdmVyIGEgZGVsZXRlZCBpdGVtXG4gICAqL1xuICBhc3luYyByZWNvdmVySXRlbShcbiAgICBhdWRpdExvZ0lkOiBudW1iZXIsXG4gICAgdXNlcklkOiBudW1iZXJcbiAgKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZzsgZGF0YT86IGFueSB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGF1ZGl0RW50cnkgPSBhd2FpdCB0aGlzLnByaXNtYS5hdWRpdExvZy5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGF1ZGl0TG9nSWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWF1ZGl0RW50cnkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdBdWRpdCBlbnRyeSBub3QgZm91bmQnIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRldGFpbHMgPSBhdWRpdEVudHJ5LmRldGFpbHMgYXMgYW55O1xuICAgICAgaWYgKCFkZXRhaWxzPy5pc0RlbGV0ZWQgfHwgIWRldGFpbHM/LmNhblJlY292ZXIgfHwgZGV0YWlscz8ucmVjb3ZlcmVkQXQpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6ICdJdGVtIGNhbm5vdCBiZSByZWNvdmVyZWQnIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc3RvcmUgdGhlIGRhdGEgYmFzZWQgb24gZW50aXR5IHR5cGVcbiAgICAgIGNvbnN0IHJlc3RvcmVkRGF0YSA9IGF3YWl0IHRoaXMucmVzdG9yZUVudGl0eURhdGEoXG4gICAgICAgIGF1ZGl0RW50cnkuZW50aXR5LFxuICAgICAgICBkZXRhaWxzLm9yaWdpbmFsRGF0YVxuICAgICAgKTtcblxuICAgICAgaWYgKCFyZXN0b3JlZERhdGEuc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzdG9yZWREYXRhO1xuICAgICAgfVxuXG4gICAgICAvLyBNYXJrIGFzIHJlY292ZXJlZCBieSB1cGRhdGluZyB0aGUgZGV0YWlsc1xuICAgICAgY29uc3QgdXBkYXRlZERldGFpbHMgPSB7XG4gICAgICAgIC4uLmRldGFpbHMsXG4gICAgICAgIHJlY292ZXJlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICByZWNvdmVyZWRCeTogdXNlcklkLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgdGhpcy5wcmlzbWEuYXVkaXRMb2cudXBkYXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IGF1ZGl0TG9nSWQgfSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGRldGFpbHM6IHVwZGF0ZWREZXRhaWxzLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIExvZyB0aGUgcmVjb3ZlcnkgYWN0aW9uXG4gICAgICBhd2FpdCB0aGlzLmxvZ0FjdGlvbih7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgYWN0aW9uOiAnUkVDT1ZFUicsXG4gICAgICAgIGVudGl0eTogYXVkaXRFbnRyeS5lbnRpdHksXG4gICAgICAgIGVudGl0eUlkOiByZXN0b3JlZERhdGEuZGF0YT8uaWQsXG4gICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICB0eXBlOiAncmVjb3ZlcnknLFxuICAgICAgICAgIG9yaWdpbmFsQXVkaXRMb2dJZDogYXVkaXRMb2dJZCxcbiAgICAgICAgICByZWNvdmVyZWREYXRhOiByZXN0b3JlZERhdGEuZGF0YSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnSXRlbSByZWNvdmVyZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgZGF0YTogcmVzdG9yZWREYXRhLmRhdGEsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcmVjb3ZlciBpdGVtOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlY292ZXIgaXRlbScgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVzdG9yZSBlbnRpdHkgZGF0YSBiYXNlZCBvbiBlbnRpdHkgdHlwZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByZXN0b3JlRW50aXR5RGF0YShcbiAgICBlbnRpdHk6IHN0cmluZyxcbiAgICBvcmlnaW5hbERhdGE6IGFueVxuICApOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nOyBkYXRhPzogYW55IH0+IHtcbiAgICB0cnkge1xuICAgICAgbGV0IHJlc3RvcmVkRGF0YTtcblxuICAgICAgc3dpdGNoIChlbnRpdHkudG9Mb3dlckNhc2UoKSkge1xuICAgICAgICBjYXNlICdwcm9kdWN0JzpcbiAgICAgICAgICByZXN0b3JlZERhdGEgPSBhd2FpdCB0aGlzLnByaXNtYS5wcm9kdWN0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIG5hbWU6IG9yaWdpbmFsRGF0YS5uYW1lLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogb3JpZ2luYWxEYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICBwcmljZTogb3JpZ2luYWxEYXRhLnByaWNlLFxuICAgICAgICAgICAgICBjb3N0OiBvcmlnaW5hbERhdGEuY29zdCxcbiAgICAgICAgICAgICAgc2t1OiBvcmlnaW5hbERhdGEuc2t1LFxuICAgICAgICAgICAgICBiYXJjb2RlOiBvcmlnaW5hbERhdGEuYmFyY29kZSxcbiAgICAgICAgICAgICAgY2F0ZWdvcnlJZDogb3JpZ2luYWxEYXRhLmNhdGVnb3J5SWQsXG4gICAgICAgICAgICAgIHN1cHBsaWVySWQ6IG9yaWdpbmFsRGF0YS5zdXBwbGllcklkLFxuICAgICAgICAgICAgICBtaW5TdG9ja0xldmVsOiBvcmlnaW5hbERhdGEubWluU3RvY2tMZXZlbCxcbiAgICAgICAgICAgICAgbWF4U3RvY2tMZXZlbDogb3JpZ2luYWxEYXRhLm1heFN0b2NrTGV2ZWwsXG4gICAgICAgICAgICAgIHVuaXQ6IG9yaWdpbmFsRGF0YS51bml0LFxuICAgICAgICAgICAgICB3ZWlnaHQ6IG9yaWdpbmFsRGF0YS53ZWlnaHQsXG4gICAgICAgICAgICAgIGRpbWVuc2lvbnM6IG9yaWdpbmFsRGF0YS5kaW1lbnNpb25zLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogb3JpZ2luYWxEYXRhLmlzQWN0aXZlID8/IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ2N1c3RvbWVyJzpcbiAgICAgICAgICByZXN0b3JlZERhdGEgPSBhd2FpdCB0aGlzLnByaXNtYS5jdXN0b21lci5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBuYW1lOiBvcmlnaW5hbERhdGEubmFtZSxcbiAgICAgICAgICAgICAgZW1haWw6IG9yaWdpbmFsRGF0YS5lbWFpbCxcbiAgICAgICAgICAgICAgcGhvbmU6IG9yaWdpbmFsRGF0YS5waG9uZSxcbiAgICAgICAgICAgICAgYWRkcmVzczogb3JpZ2luYWxEYXRhLmFkZHJlc3MsXG4gICAgICAgICAgICAgIGNpdHk6IG9yaWdpbmFsRGF0YS5jaXR5LFxuICAgICAgICAgICAgICBwb3N0YWxDb2RlOiBvcmlnaW5hbERhdGEucG9zdGFsQ29kZSxcbiAgICAgICAgICAgICAgY291bnRyeTogb3JpZ2luYWxEYXRhLmNvdW50cnksXG4gICAgICAgICAgICAgIHRheE51bWJlcjogb3JpZ2luYWxEYXRhLnRheE51bWJlcixcbiAgICAgICAgICAgICAgY3JlZGl0TGltaXQ6IG9yaWdpbmFsRGF0YS5jcmVkaXRMaW1pdCxcbiAgICAgICAgICAgICAgcGF5bWVudFRlcm1zOiBvcmlnaW5hbERhdGEucGF5bWVudFRlcm1zLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogb3JpZ2luYWxEYXRhLmlzQWN0aXZlID8/IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ3N1cHBsaWVyJzpcbiAgICAgICAgICByZXN0b3JlZERhdGEgPSBhd2FpdCB0aGlzLnByaXNtYS5zdXBwbGllci5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBuYW1lOiBvcmlnaW5hbERhdGEubmFtZSxcbiAgICAgICAgICAgICAgZW1haWw6IG9yaWdpbmFsRGF0YS5lbWFpbCxcbiAgICAgICAgICAgICAgcGhvbmU6IG9yaWdpbmFsRGF0YS5waG9uZSxcbiAgICAgICAgICAgICAgYWRkcmVzczogb3JpZ2luYWxEYXRhLmFkZHJlc3MsXG4gICAgICAgICAgICAgIGNpdHk6IG9yaWdpbmFsRGF0YS5jaXR5LFxuICAgICAgICAgICAgICBwb3N0YWxDb2RlOiBvcmlnaW5hbERhdGEucG9zdGFsQ29kZSxcbiAgICAgICAgICAgICAgY291bnRyeTogb3JpZ2luYWxEYXRhLmNvdW50cnksXG4gICAgICAgICAgICAgIHRheE51bWJlcjogb3JpZ2luYWxEYXRhLnRheE51bWJlcixcbiAgICAgICAgICAgICAgcGF5bWVudFRlcm1zOiBvcmlnaW5hbERhdGEucGF5bWVudFRlcm1zLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogb3JpZ2luYWxEYXRhLmlzQWN0aXZlID8/IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ2NhdGVnb3J5JzpcbiAgICAgICAgICByZXN0b3JlZERhdGEgPSBhd2FpdCB0aGlzLnByaXNtYS5jYXRlZ29yeS5jcmVhdGUoe1xuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBuYW1lOiBvcmlnaW5hbERhdGEubmFtZSxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG9yaWdpbmFsRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgaXNBY3RpdmU6IG9yaWdpbmFsRGF0YS5pc0FjdGl2ZSA/PyB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdyZWNlaXB0JzpcbiAgICAgICAgICByZXN0b3JlZERhdGEgPSBhd2FpdCB0aGlzLnByaXNtYS5yZWNlaXB0LmNyZWF0ZSh7XG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIHJlY2VpcHROdW1iZXI6IG9yaWdpbmFsRGF0YS5yZWNlaXB0TnVtYmVyLFxuICAgICAgICAgICAgICBhbW91bnQ6IG9yaWdpbmFsRGF0YS5hbW91bnQsXG4gICAgICAgICAgICAgIHBheW1lbnRJZDogb3JpZ2luYWxEYXRhLnBheW1lbnRJZCxcbiAgICAgICAgICAgICAgaXNzdWVkQXQ6IG9yaWdpbmFsRGF0YS5pc3N1ZWRBdCxcbiAgICAgICAgICAgICAgbm90ZXM6IG9yaWdpbmFsRGF0YS5ub3RlcyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlOiBgUmVjb3Zlcnkgbm90IHN1cHBvcnRlZCBmb3IgZW50aXR5IHR5cGU6ICR7ZW50aXR5fWAsXG4gICAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ0VudGl0eSByZXN0b3JlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBkYXRhOiByZXN0b3JlZERhdGEsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gcmVzdG9yZSAke2VudGl0eX06YCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gcmVzdG9yZSAke2VudGl0eX06ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhdWRpdCBoaXN0b3J5IGZvciBhbiBlbnRpdHlcbiAgICovXG4gIGFzeW5jIGdldEVudGl0eUhpc3RvcnkoXG4gICAgZW50aXR5OiBzdHJpbmcsXG4gICAgZW50aXR5SWQ6IG51bWJlcixcbiAgICBsaW1pdDogbnVtYmVyID0gMjBcbiAgKTogUHJvbWlzZTxBdWRpdExvZ0VudHJ5W10+IHtcbiAgICBjb25zdCBlbnRyaWVzID0gYXdhaXQgdGhpcy5wcmlzbWEuYXVkaXRMb2cuZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgZW50aXR5LFxuICAgICAgICBlbnRpdHlJZCxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGRlbGV0ZWRCeVVzZXI6IHtcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHJlY292ZXJlZEJ5VXNlcjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBvcmRlckJ5OiB7XG4gICAgICAgIGNyZWF0ZWRBdDogJ2Rlc2MnLFxuICAgICAgfSxcbiAgICAgIHRha2U6IGxpbWl0LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGVudHJpZXM7XG4gIH1cblxuICAvKipcbiAgICogUGVybWFuZW50bHkgZGVsZXRlIGl0ZW1zIGZyb20gcmVjeWNsZSBiaW5cbiAgICovXG4gIGFzeW5jIHBlcm1hbmVudGx5RGVsZXRlKGF1ZGl0TG9nSWRzOiBudW1iZXJbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMucHJpc21hLmF1ZGl0TG9nLnVwZGF0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IHsgaW46IGF1ZGl0TG9nSWRzIH0sXG4gICAgICAgIGlzRGVsZXRlZDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGNhblJlY292ZXI6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbiB1cCBvbGQgZGVsZXRlZCBpdGVtcyAob2xkZXIgdGhhbiBzcGVjaWZpZWQgZGF5cylcbiAgICovXG4gIGFzeW5jIGNsZWFudXBPbGREZWxldGVkSXRlbXMoZGF5c09sZDogbnVtYmVyID0gMzApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGN1dG9mZkRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGN1dG9mZkRhdGUuc2V0RGF0ZShjdXRvZmZEYXRlLmdldERhdGUoKSAtIGRheXNPbGQpO1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcmlzbWEuYXVkaXRMb2cudXBkYXRlTWFueSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpc0RlbGV0ZWQ6IHRydWUsXG4gICAgICAgIGNhblJlY292ZXI6IHRydWUsXG4gICAgICAgIGRlbGV0ZWRBdDoge1xuICAgICAgICAgIGx0OiBjdXRvZmZEYXRlLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgY2FuUmVjb3ZlcjogZmFsc2UsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlc3VsdC5jb3VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgSURzIG9mIHNvZnQtZGVsZXRlZCBlbnRpdGllcyBmb3IgYSBzcGVjaWZpYyBlbnRpdHkgdHlwZVxuICAgKi9cbiAgYXN5bmMgZ2V0RGVsZXRlZEVudGl0eUlkcyhlbnRpdHk6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGVsZXRlZEVudHJpZXMgPSBhd2FpdCB0aGlzLnByaXNtYS5hdWRpdExvZy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgZW50aXR5LFxuICAgICAgICAgIGFjdGlvbjogJ0RFTEVURScsXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGVudGl0eUlkOiB0cnVlLFxuICAgICAgICAgIGRldGFpbHM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gRmlsdGVyIGZvciBpdGVtcyB0aGF0IGFyZSBkZWxldGVkIGFuZCBub3QgcmVjb3ZlcmVkXG4gICAgICBjb25zdCBkZWxldGVkSWRzID0gZGVsZXRlZEVudHJpZXNcbiAgICAgICAgLmZpbHRlcigoZW50cnkpID0+IHtcbiAgICAgICAgICBjb25zdCBkZXRhaWxzID0gZW50cnkuZGV0YWlscyBhcyBhbnk7XG4gICAgICAgICAgcmV0dXJuIGRldGFpbHM/LmlzRGVsZXRlZCAmJiAhZGV0YWlscz8ucmVjb3ZlcmVkQXQ7XG4gICAgICAgIH0pXG4gICAgICAgIC5tYXAoKGVudHJ5KSA9PiBlbnRyeS5lbnRpdHlJZCEpXG4gICAgICAgIC5maWx0ZXIoKGlkKSA9PiBpZCAhPT0gbnVsbCk7XG5cbiAgICAgIHJldHVybiBkZWxldGVkSWRzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBnZXR0aW5nIGRlbGV0ZWQgZW50aXR5IElEcyBmb3IgJHtlbnRpdHl9OmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGF1ZGl0U2VydmljZSA9IEF1ZGl0U2VydmljZS5nZXRJbnN0YW5jZSgpOyJdLCJuYW1lcyI6WyJBdWRpdFNlcnZpY2UiLCJhdWRpdFNlcnZpY2UiLCJwcmlzbWEiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwibG9nQWN0aW9uIiwiZW50cnkiLCJkZXRhaWxzIiwib3JpZ2luYWxEYXRhIiwiaXNEZWxldGVkIiwiZGVsZXRlZEF0IiwiZGVsZXRlZEJ5IiwiY2FuUmVjb3ZlciIsInJlY292ZXJlZEF0IiwicmVjb3ZlcmVkQnkiLCJhdWRpdExvZyIsImNyZWF0ZSIsImRhdGEiLCJ1c2VySWQiLCJhY3Rpb24iLCJlbnRpdHkiLCJlbnRpdHlJZCIsImVycm9yIiwiY29uc29sZSIsInNvZnREZWxldGUiLCJEYXRlIiwidHlwZSIsInJlY292ZXJhYmxlIiwiZ2V0UmVjeWNsZUJpbkl0ZW1zIiwibGltaXQiLCJvZmZzZXQiLCJ3aGVyZSIsIml0ZW1zIiwidG90YWwiLCJQcm9taXNlIiwiYWxsIiwiZmluZE1hbnkiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidGFrZSIsInNraXAiLCJjb3VudCIsInJlY3ljbGVCaW5JdGVtcyIsImZpbHRlciIsIml0ZW0iLCJtYXAiLCJpZCIsImRlbGV0ZWRCeVVzZXIiLCJ1bmRlZmluZWQiLCJyZWNvdmVySXRlbSIsImF1ZGl0TG9nSWQiLCJhdWRpdEVudHJ5IiwiZmluZFVuaXF1ZSIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwicmVzdG9yZWREYXRhIiwicmVzdG9yZUVudGl0eURhdGEiLCJ1cGRhdGVkRGV0YWlscyIsInVwZGF0ZSIsIm9yaWdpbmFsQXVkaXRMb2dJZCIsInJlY292ZXJlZERhdGEiLCJ0b0xvd2VyQ2FzZSIsInByb2R1Y3QiLCJuYW1lIiwiZGVzY3JpcHRpb24iLCJwcmljZSIsImNvc3QiLCJza3UiLCJiYXJjb2RlIiwiY2F0ZWdvcnlJZCIsInN1cHBsaWVySWQiLCJtaW5TdG9ja0xldmVsIiwibWF4U3RvY2tMZXZlbCIsInVuaXQiLCJ3ZWlnaHQiLCJkaW1lbnNpb25zIiwiaXNBY3RpdmUiLCJjdXN0b21lciIsImVtYWlsIiwicGhvbmUiLCJhZGRyZXNzIiwiY2l0eSIsInBvc3RhbENvZGUiLCJjb3VudHJ5IiwidGF4TnVtYmVyIiwiY3JlZGl0TGltaXQiLCJwYXltZW50VGVybXMiLCJzdXBwbGllciIsImNhdGVnb3J5IiwicmVjZWlwdCIsInJlY2VpcHROdW1iZXIiLCJhbW91bnQiLCJwYXltZW50SWQiLCJpc3N1ZWRBdCIsIm5vdGVzIiwiRXJyb3IiLCJnZXRFbnRpdHlIaXN0b3J5IiwiZW50cmllcyIsImluY2x1ZGUiLCJ1c2VyIiwic2VsZWN0IiwicmVjb3ZlcmVkQnlVc2VyIiwicGVybWFuZW50bHlEZWxldGUiLCJhdWRpdExvZ0lkcyIsInVwZGF0ZU1hbnkiLCJpbiIsImNsZWFudXBPbGREZWxldGVkSXRlbXMiLCJkYXlzT2xkIiwiY3V0b2ZmRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwicmVzdWx0IiwibHQiLCJnZXREZWxldGVkRW50aXR5SWRzIiwiZGVsZXRlZEVudHJpZXMiLCJkZWxldGVkSWRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztJQW1DYUEsWUFBWTtlQUFaQTs7SUFvYUFDLFlBQVk7ZUFBWkE7Ozt3QkF0Y1U7QUFrQ2hCLE1BQU1EO0lBSVgsYUFBc0I7UUFDcEIsSUFBSSxDQUFDRSxNQUFNLEdBQUdBLGNBQU07SUFDdEI7SUFFQSxPQUFjQyxjQUE0QjtRQUN4QyxJQUFJLENBQUNILGFBQWFJLFFBQVEsRUFBRTtZQUMxQkosYUFBYUksUUFBUSxHQUFHLElBQUlKO1FBQzlCO1FBQ0EsT0FBT0EsYUFBYUksUUFBUTtJQUM5QjtJQUVBOztHQUVDLEdBQ0QsTUFBTUMsVUFBVUMsS0FBb0IsRUFBaUI7UUFDbkQsSUFBSTtZQUNGLDZEQUE2RDtZQUM3RCxNQUFNQyxVQUFVO2dCQUNkLEdBQUdELE1BQU1DLE9BQU87Z0JBQ2hCQyxjQUFjRixNQUFNRSxZQUFZO2dCQUNoQ0MsV0FBV0gsTUFBTUcsU0FBUyxJQUFJO2dCQUM5QkMsV0FBV0osTUFBTUksU0FBUztnQkFDMUJDLFdBQVdMLE1BQU1LLFNBQVM7Z0JBQzFCQyxZQUFZTixNQUFNTSxVQUFVLElBQUk7Z0JBQ2hDQyxhQUFhUCxNQUFNTyxXQUFXO2dCQUM5QkMsYUFBYVIsTUFBTVEsV0FBVztZQUNoQztZQUVBLE1BQU0sSUFBSSxDQUFDWixNQUFNLENBQUNhLFFBQVEsQ0FBQ0MsTUFBTSxDQUFDO2dCQUNoQ0MsTUFBTTtvQkFDSkMsUUFBUVosTUFBTVksTUFBTTtvQkFDcEJDLFFBQVFiLE1BQU1hLE1BQU07b0JBQ3BCQyxRQUFRZCxNQUFNYyxN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