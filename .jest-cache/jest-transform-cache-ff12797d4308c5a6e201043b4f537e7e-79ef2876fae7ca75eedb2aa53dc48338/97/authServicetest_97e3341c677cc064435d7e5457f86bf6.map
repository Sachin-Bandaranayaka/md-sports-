{"version":3,"sources":["/Users/sachin/Documents/md-sports-/tests/unit/authService.test.ts"],"sourcesContent":["// Fixed Unit tests for AuthService\n// This file tests the authentication service functionality\n\nimport { jest } from '@jest/globals';\n\n// Mock dependencies BEFORE importing the service\nconst mockCacheService = {\n  get: jest.fn(),\n  set: jest.fn(),\n  delete: jest.fn(),\n  increment: jest.fn(),\n  generateKey: jest.fn(),\n};\n\nconst mockPrisma = {\n  user: {\n    findUnique: jest.fn(),\n    findFirst: jest.fn(),\n    create: jest.fn(),\n    update: jest.fn(),\n    findMany: jest.fn(),\n  },\n  permission: {\n    findMany: jest.fn(),\n  },\n  session: {\n    create: jest.fn(),\n    findUnique: jest.fn(),\n    update: jest.fn(),\n    deleteMany: jest.fn(),\n  },\n  auditLog: {\n    create: jest.fn(),\n  },\n};\n\nconst mockBcrypt = {\n  hash: jest.fn(),\n  compare: jest.fn(),\n  genSalt: jest.fn(),\n};\n\nconst mockJwt = {\n  sign: jest.fn(),\n  verify: jest.fn(),\n  decode: jest.fn(),\n};\n\n// Mock modules\njest.mock('@/lib/prisma', () => ({\n  __esModule: true,\n  default: mockPrisma,\n}));\n\njest.mock('@/lib/cache', () => ({\n  cacheService: mockCacheService,\n  CACHE_CONFIG: {\n    KEYS: {\n      USER_SESSION: 'user_session',\n      TOKEN_VALIDATION: 'token_validation',\n    },\n    TTL: {\n      USER_SESSION: 3600,\n      TOKEN_VALIDATION: 1800,\n    },\n  },\n}));\n\njest.mock('bcryptjs', () => mockBcrypt);\njest.mock('jsonwebtoken', () => mockJwt);\n\n// Import after mocking\nimport { authenticateUser, generateToken, verifyToken, parseTimeStringToSeconds, getUserFromDecodedPayload, getUserFromToken } from '@/services/authService';\n\n// Create proper mock types for easier access\nconst mockUserFindFirst = mockPrisma.user.findFirst;\nconst mockPermissionFindMany = mockPrisma.permission.findMany;\n\ndescribe('AuthService', () => {\n  beforeEach(() => {\n    jest.clearAllMocks();\n    process.env.JWT_SECRET = 'test-secret-key';\n    process.env.JWT_ACCESS_TOKEN_EXPIRES_IN = '12h';\n    \n    // Setup default cache mocks\n    mockCacheService.generateKey.mockReturnValue('mock-cache-key');\n    mockCacheService.get.mockResolvedValue(null);\n    mockCacheService.set.mockResolvedValue(undefined);\n    \n    // Reset JWT mocks\n    mockJwt.sign.mockReturnValue('mock-token');\n    mockJwt.verify.mockReturnValue({ sub: 1, username: 'test', email: 'test@example.com', roleId: 1 });\n    mockJwt.decode.mockReturnValue(null);\n  });\n\n  describe('parseTimeStringToSeconds', () => {\n    test('should parse seconds correctly', () => {\n      expect(parseTimeStringToSeconds('30s')).toBe(30);\n    });\n\n    test('should parse minutes correctly', () => {\n      expect(parseTimeStringToSeconds('5m')).toBe(300);\n    });\n\n    test('should parse hours correctly', () => {\n      expect(parseTimeStringToSeconds('2h')).toBe(7200);\n    });\n\n    test('should parse days correctly', () => {\n      expect(parseTimeStringToSeconds('1d')).toBe(86400);\n    });\n\n    test('should return 0 for invalid input', () => {\n      expect(parseTimeStringToSeconds('')).toBe(0);\n      expect(parseTimeStringToSeconds('invalid')).toBe(0);\n      expect(parseTimeStringToSeconds('abc')).toBe(0);\n    });\n\n    test('should handle edge cases', () => {\n      expect(parseTimeStringToSeconds('0s')).toBe(0);\n      expect(parseTimeStringToSeconds('100x')).toBe(100); // Falls back to parsing the number part\n    });\n  });\n\n  describe('authenticateUser', () => {\n    const mockUser = {\n      id: 1,\n      email: 'test@example.com',\n      name: 'testuser',\n      password: 'hashedpassword',\n      isActive: true,\n      roleId: 1,\n      shopId: 1,\n      roleName: 'admin',\n      permissions: null,\n      role: {\n        id: 1,\n        name: 'admin',\n        permissions: [\n          { name: 'read_products' },\n          { name: 'write_products' }\n        ]\n      }\n    };\n\n    test('should authenticate valid user credentials', async () => {\n      mockUserFindFirst.mockResolvedValue(mockUser);\n      mockBcrypt.compare.mockResolvedValue(true as any);\n      mockJwt.sign.mockReturnValue('mock-jwt-token' as any);\n\n      const result = await authenticateUser('test@example.com', 'password123');\n\n      expect(result.success).toBe(true);\n      expect(result.token).toBe('mock-jwt-token');\n      expect(result.user).toEqual({\n        id: 1,\n        email: 'test@example.com',\n        username: 'testuser',\n        fullName: 'testuser',\n        roleId: 1,\n        roleName: 'admin',\n        shopId: 1,\n        permissions: ['read_products', 'write_products']\n      });\n      expect(mockUserFindFirst).toHaveBeenCalledWith({\n        where: {\n          email: 'test@example.com',\n          isActive: true\n        },\n        include: {\n          role: {\n            include: {\n              permissions: {\n                select: { name: true }\n              }\n            }\n          }\n        }\n      });\n    });\n\n    test('should reject invalid email', async () => {\n      mockUserFindFirst.mockResolvedValue(null);\n\n      const result = await authenticateUser('invalid@example.com', 'password123');\n\n      expect(result.success).toBe(false);\n      expect(result.message).toBe('Invalid email or password');\n    });\n\n    test('should reject invalid password', async () => {\n      mockUserFindFirst.mockResolvedValue(mockUser);\n      mockBcrypt.compare.mockResolvedValue(false as any);\n\n      const result = await authenticateUser('test@example.com', 'wrongpassword');\n\n      expect(result.success).toBe(false);\n      expect(result.message).toBe('Invalid email or password');\n    });\n\n    test('should reject inactive user', async () => {\n      mockUserFindFirst.mockResolvedValue(null); // findFirst with isActive: true returns null\n\n      const result = await authenticateUser('test@example.com', 'password123');\n\n      expect(result.success).toBe(false);\n      expect(result.message).toBe('Invalid email or password');\n    });\n\n    test('should handle database errors gracefully', async () => {\n      mockUserFindFirst.mockRejectedValue(new Error('Database connection failed'));\n\n      const result = await authenticateUser('test@example.com', 'password123');\n\n      expect(result.success).toBe(false);\n      expect(result.message).toBe('Authentication failed');\n    });\n\n    test('should handle bcrypt errors gracefully', async () => {\n      mockUserFindFirst.mockResolvedValue(mockUser);\n      mockBcrypt.compare.mockRejectedValue(new Error('Bcrypt error'));\n\n      const result = await authenticateUser('test@example.com', 'password123');\n\n      expect(result.success).toBe(false);\n      expect(result.message).toBe('Authentication failed');\n    });\n  });\n\n  describe('generateToken', () => {\n    const mockPayload = {\n      sub: 1,\n      username: 'testuser',\n      email: 'test@example.com',\n      roleId: 1,\n      shopId: 1,\n      permissions: ['read_products', 'write_products']\n    };\n\n    test('should generate JWT token', () => {\n      const mockToken = 'mock-jwt-token';\n      mockJwt.sign.mockReturnValue(mockToken);\n\n      const result = generateToken(mockPayload);\n\n      expect(result).toBe(mockToken);\n      expect(mockJwt.sign).toHaveBeenCalledWith(\n          mockPayload,\n          'test-secret-key',\n          { expiresIn: '12h' }\n        );\n    });\n  });\n\n  describe('verifyToken', () => {\n    test('should verify valid token from cache', async () => {\n      const mockPayload = {\n        sub: 1,\n        username: 'testuser',\n        email: 'test@example.com',\n        roleId: 1,\n        iat: Math.floor(Date.now() / 1000),\n        exp: Math.floor(Date.now() / 1000) + 3600\n      };\n      \n      mockCacheService.get.mockResolvedValue(mockPayload);\n\n      const result = await verifyToken('valid-token');\n\n      expect(result).toEqual(mockPayload);\n      expect(mockCacheService.get).toHaveBeenCalled();\n    });\n\n    test('should verify valid token and cache result', async () => {\n      const mockPayload = {\n        sub: 1,\n        username: 'testuser',\n        email: 'test@example.com',\n        roleId: 1,\n        iat: Math.floor(Date.now() / 1000),\n        exp: Math.floor(Date.now() / 1000) + 3600\n      };\n      \n      mockCacheService.get.mockResolvedValue(null); // Not in cache\n      mockJwt.verify.mockReturnValue(mockPayload as any);\n\n      const result = await verifyToken('valid-token');\n\n      expect(result).toEqual(mockPayload);\n      expect(mockJwt.verify).toHaveBeenCalledWith('valid-token', 'test-secret-key');\n      expect(mockCacheService.set).toHaveBeenCalled();\n    });\n\n    test('should throw error for invalid token', async () => {\n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('Invalid token');\n      });\n\n      await expect(verifyToken('invalid-token')).rejects.toThrow('Invalid token');\n    });\n\n    test('should throw error for expired token', async () => {\n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => {\n        const error = new Error('Token expired') as any;\n        error.name = 'TokenExpiredError';\n        error.expiredAt = new Date();\n        throw error;\n      });\n\n      await expect(verifyToken('expired-token')).rejects.toThrow('Token expired');\n    });\n  });\n\n  describe('getUserFromDecodedPayload', () => {\n    const mockUser = {\n      id: 1,\n      email: 'test@example.com',\n      name: 'testuser',\n      isActive: true,\n      roleId: 1,\n      shopId: 1,\n      role: {\n        id: 1,\n        name: 'admin',\n        permissions: [\n          { name: 'read_products' },\n          { name: 'write_products' }\n        ]\n      }\n    };\n\n    test('should return user from cache', async () => {\n      const payload = {\n        sub: 1,\n        username: 'testuser',\n        email: 'test@example.com',\n        roleId: 1\n      };\n      \n      const cachedUser = {\n        ...mockUser,\n        roleName: 'admin',\n        permissions: ['read_products', 'write_products']\n      };\n      \n      mockCacheService.get.mockResolvedValue(cachedUser);\n\n      const result = await getUserFromDecodedPayload(payload);\n\n      expect(result).toEqual(cachedUser);\n      expect(mockCacheService.get).toHaveBeenCalled();\n    });\n\n    test('should return user from database and cache it', async () => {\n      const payload = {\n        sub: 1,\n        username: 'testuser',\n        email: 'test@example.com',\n        roleId: 1\n      };\n      \n      mockCacheService.get.mockResolvedValue(null); // Not in cache\n      mockUserFindFirst.mockResolvedValue(mockUser);\n\n      const result = await getUserFromDecodedPayload(payload);\n\n      expect(result).toEqual({\n        ...mockUser,\n        roleName: 'admin',\n        permissions: ['read_products', 'write_products']\n      });\n      expect(mockCacheService.set).toHaveBeenCalled();\n    });\n\n    test('should return null for null payload', async () => {\n      const result = await getUserFromDecodedPayload(null);\n      expect(result).toBeNull();\n    });\n\n    test('should return null for invalid payload', async () => {\n      const result = await getUserFromDecodedPayload({} as any);\n      expect(result).toBeNull();\n    });\n\n    test('should return null when user not found', async () => {\n      const payload = {\n        sub: 999,\n        username: 'nonexistent',\n        email: 'nonexistent@example.com',\n        roleId: 1\n      };\n      \n      mockCacheService.get.mockResolvedValue(null);\n      mockUserFindFirst.mockResolvedValue(null);\n\n      const result = await getUserFromDecodedPayload(payload);\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('getUserFromToken', () => {\n    test('should return user from valid token', async () => {\n      const mockPayload = {\n        sub: 1,\n        username: 'testuser',\n        email: 'test@example.com',\n        roleId: 1\n      };\n      \n      const mockUser = {\n        id: 1,\n        email: 'test@example.com',\n        name: 'testuser',\n        isActive: true,\n        roleId: 1,\n        shopId: 1,\n        role: {\n          id: 1,\n          name: 'admin',\n          permissions: [{ name: 'read_products' }]\n        }\n      };\n\n      // Mock verifyToken to return payload\n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => mockPayload);\n      \n      // Mock getUserFromDecodedPayload\n      mockUserFindFirst.mockResolvedValue(mockUser);\n\n      const result = await getUserFromToken('valid-token');\n      \n      expect(result).toEqual({\n        ...mockUser,\n        roleName: 'admin',\n        permissions: ['read_products']\n      });\n    });\n\n    test('should throw error for invalid token', async () => {\n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('jwt malformed');\n      });\n\n      await expect(getUserFromToken('invalid-token')).rejects.toThrow('jwt malformed');\n    });\n  });\n\n  describe('Error Handling', () => {\n    test('should handle missing JWT_SECRET', async () => {\n      const originalSecret = process.env.JWT_SECRET;\n      delete process.env.JWT_SECRET;\n      \n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('secretOrPrivateKey must have a value');\n      });\n      \n      await expect(verifyToken('any-token')).rejects.toThrow();\n      \n      // Restore the secret\n      process.env.JWT_SECRET = originalSecret;\n    });\n\n    test('should handle malformed tokens gracefully', async () => {\n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('jwt malformed');\n      });\n      \n      await expect(verifyToken('not.a.valid.jwt.token')).rejects.toThrow('jwt malformed');\n    });\n\n    test('should handle empty token', async () => {\n      mockCacheService.get.mockResolvedValue(null);\n      mockJwt.verify.mockImplementation(() => {\n        throw new Error('jwt must be provided');\n      });\n      \n      await expect(verifyToken('')).rejects.toThrow('jwt must be provided');\n    });\n  });\n});"],"names":["mockCacheService","get","jest","fn","set","delete","increment","generateKey","mockPrisma","user","findUnique","findFirst","create","update","findMany","permission","session","deleteMany","auditLog","mockBcrypt","hash","compare","genSalt","mockJwt","sign","verify","decode","mock","__esModule","default","cacheService","CACHE_CONFIG","KEYS","USER_SESSION","TOKEN_VALIDATION","TTL","mockUserFindFirst","mockPermissionFindMany","describe","beforeEach","clearAllMocks","process","env","JWT_SECRET","JWT_ACCESS_TOKEN_EXPIRES_IN","mockReturnValue","mockResolvedValue","undefined","sub","username","email","roleId","test","expect","parseTimeStringToSeconds","toBe","mockUser","id","name","password","isActive","shopId","roleName","permissions","role","result","authenticateUser","success","token","toEqual","fullName","toHaveBeenCalledWith","where","include","select","message","mockRejectedValue","Error","mockPayload","mockToken","generateToken","expiresIn","iat","Math","floor","Date","now","exp","verifyToken","toHaveBeenCalled","mockImplementation","rejects","toThrow","error","expiredAt","payload","cachedUser","getUserFromDecodedPayload","toBeNull","getUserFromToken","originalSecret"],"mappings":"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"}