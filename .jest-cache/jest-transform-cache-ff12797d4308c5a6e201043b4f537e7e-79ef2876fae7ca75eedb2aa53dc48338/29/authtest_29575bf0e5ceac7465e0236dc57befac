43148b4e03d284b6d3eb28b8cb1888f7
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _bcryptjs = /*#__PURE__*/ _interop_require_default(require("bcryptjs"));
const _jsonwebtoken = /*#__PURE__*/ _interop_require_default(require("jsonwebtoken"));
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
// Mock dependencies
_globals.jest.mock("bcryptjs");
_globals.jest.mock("jsonwebtoken");
_globals.jest.mock("@prisma/client");
const mockBcrypt = _bcryptjs.default;
const mockJwt = _jsonwebtoken.default;
const mockPrisma = {
    user: {
        findUnique: _globals.jest.fn(),
        create: _globals.jest.fn(),
        update: _globals.jest.fn()
    },
    refreshToken: {
        create: _globals.jest.fn(),
        findUnique: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        deleteMany: _globals.jest.fn()
    },
    $disconnect: _globals.jest.fn()
};
// Mock the auth service (we'll test the actual implementation)
class AuthService {
    constructor(){
        this.prisma = mockPrisma;
    }
    async login(email, password) {
        // Find user by email
        const user = await this.prisma.user.findUnique({
            where: {
                email
            },
            select: {
                id: true,
                email: true,
                password: true,
                name: true,
                permissions: true,
                isActive: true,
                shopId: true
            }
        });
        if (!user) {
            throw new Error("Invalid credentials");
        }
        if (!user.isActive) {
            throw new Error("Account is deactivated");
        }
        // Verify password
        const isValidPassword = await _bcryptjs.default.compare(password, user.password);
        if (!isValidPassword) {
            throw new Error("Invalid credentials");
        }
        // Generate tokens
        const accessToken = this.generateAccessToken(user);
        const refreshToken = await this.generateRefreshToken(user.id);
        return {
            user: {
                id: user.id,
                email: user.email,
                name: user.name,
                permissions: user.permissions,
                shopId: user.shopId
            },
            accessToken,
            refreshToken
        };
    }
    generateAccessToken(user) {
        return _jsonwebtoken.default.sign({
            userId: user.id,
            email: user.email,
            permissions: user.permissions,
            shopId: user.shopId
        }, process.env.JWT_SECRET || "test-secret", {
            expiresIn: "15m"
        });
    }
    async generateRefreshToken(userId) {
        const token = _jsonwebtoken.default.sign({
            userId
        }, process.env.JWT_REFRESH_SECRET || "test-refresh-secret", {
            expiresIn: "7d"
        });
        // Store refresh token in database
        await this.prisma.refreshToken.create({
            data: {
                userId,
                token,
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
            }
        });
        return token;
    }
    async verifyToken(token) {
        try {
            const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET || "test-secret");
            return decoded;
        } catch (error) {
            throw new Error("Invalid token");
        }
    }
    async refreshAccessToken(refreshToken) {
        // Verify refresh token
        const decoded = _jsonwebtoken.default.verify(refreshToken, process.env.JWT_REFRESH_SECRET || "test-refresh-secret");
        // Check if refresh token exists in database
        const storedToken = await this.prisma.refreshToken.findUnique({
            where: {
                token: refreshToken
            },
            include: {
                user: true
            }
        });
        if (!storedToken || storedToken.isRevoked) {
            throw new Error("Invalid refresh token");
        }
        if (new Date() > storedToken.expiresAt) {
            throw new Error("Refresh token expired");
        }
        // Generate new access token
        const newAccessToken = this.generateAccessToken(storedToken.user);
        return {
            accessToken: newAccessToken,
            user: {
                id: storedToken.user.id,
                email: storedToken.user.email,
                name: storedToken.user.name,
                permissions: storedToken.user.permissions,
                shopId: storedToken.user.shopId
            }
        };
    }
    async logout(refreshToken) {
        // Revoke refresh token
        await this.prisma.refreshToken.deleteMany({
            where: {
                token: refreshToken
            }
        });
    }
    async logoutAllDevices(userId) {
        // Revoke all refresh tokens for user
        await this.prisma.refreshToken.deleteMany({
            where: {
                userId
            }
        });
    }
}
(0, _globals.describe)("AuthService", ()=>{
    let authService;
    (0, _globals.beforeEach)(()=>{
        authService = new AuthService();
        _globals.jest.clearAllMocks();
        // Set up environment variables
        process.env.JWT_SECRET = "test-secret";
        process.env.JWT_REFRESH_SECRET = "test-refresh-secret";
    });
    (0, _globals.afterEach)(()=>{
        _globals.jest.resetAllMocks();
    });
    (0, _globals.describe)("login", ()=>{
        const mockUser = {
            id: 1,
            email: "test@example.com",
            password: "hashedPassword",
            name: "Test User",
            permissions: [
                "inventory:read",
                "sales:create"
            ],
            isActive: true,
            shopId: "shop-1"
        };
        (0, _globals.it)("should successfully login with valid credentials", async ()=>{
            // Arrange
            mockPrisma.user.findUnique.mockResolvedValue(mockUser);
            mockBcrypt.compare.mockResolvedValue(true);
            mockJwt.sign.mockReturnValue("mock-access-token");
            mockPrisma.refreshToken.create.mockResolvedValue({
                token: "mock-refresh-token"
            });
            // Act
            const result = await authService.login("test@example.com", "password123");
            // Assert
            (0, _globals.expect)(mockPrisma.user.findUnique).toHaveBeenCalledWith({
                where: {
                    email: "test@example.com"
                },
                select: {
                    id: true,
                    email: true,
                    password: true,
                    name: true,
                    permissions: true,
                    isActive: true,
                    shopId: true
                }
            });
            (0, _globals.expect)(mockBcrypt.compare).toHaveBeenCalledWith("password123", "hashedPassword");
            (0, _globals.expect)(result).toEqual({
                user: {
                    id: 1,
                    email: "test@example.com",
                    name: "Test User",
                    permissions: [
                        "inventory:read",
                        "sales:create"
                    ],
                    shopId: "shop-1"
                },
                accessToken: "mock-access-token",
                refreshToken: "mock-access-token"
            });
        });
        (0, _globals.it)("should throw error for non-existent user", async ()=>{
            // Arrange
            mockPrisma.user.findUnique.mockResolvedValue(null);
            // Act & Assert
            await (0, _globals.expect)(authService.login("nonexistent@example.com", "password123")).rejects.toThrow("Invalid credentials");
            (0, _globals.expect)(mockBcrypt.compare).not.toHaveBeenCalled();
        });
        (0, _globals.it)("should throw error for inactive user", async ()=>{
            // Arrange
            const inactiveUser = {
                ...mockUser,
                isActive: false
            };
            mockPrisma.user.findUnique.mockResolvedValue(inactiveUser);
            // Act & Assert
            await (0, _globals.expect)(authService.login("test@example.com", "password123")).rejects.toThrow("Account is deactivated");
            (0, _globals.expect)(mockBcrypt.compare).not.toHaveBeenCalled();
        });
        (0, _globals.it)("should throw error for invalid password", async ()=>{
            // Arrange
            mockPrisma.user.findUnique.mockResolvedValue(mockUser);
            mockBcrypt.compare.mockResolvedValue(false);
            // Act & Assert
            await (0, _globals.expect)(authService.login("test@example.com", "wrongpassword")).rejects.toThrow("Invalid credentials");
            (0, _globals.expect)(mockBcrypt.compare).toHaveBeenCalledWith("wrongpassword", "hashedPassword");
        });
        (0, _globals.it)("should handle database errors gracefully", async ()=>{
            // Arrange
            mockPrisma.user.findUnique.mockRejectedValue(new Error("Database connection failed"));
            // Act & Assert
            await (0, _globals.expect)(authService.login("test@example.com", "password123")).rejects.toThrow("Database connection failed");
        });
    });
    (0, _globals.describe)("verifyToken", ()=>{
        (0, _globals.it)("should successfully verify valid token", async ()=>{
            // Arrange
            const mockDecoded = {
                userId: 1,
                email: "test@example.com"
            };
            mockJwt.verify.mockReturnValue(mockDecoded);
            // Act
            const result = await authService.verifyToken("valid-token");
            // Assert
            (0, _globals.expect)(mockJwt.verify).toHaveBeenCalledWith("valid-token", "test-secret");
            (0, _globals.expect)(result).toEqual(mockDecoded);
        });
        (0, _globals.it)("should throw error for invalid token", async ()=>{
            // Arrange
            mockJwt.verify.mockImplementation(()=>{
                throw new Error("jwt malformed");
            });
            // Act & Assert
            await (0, _globals.expect)(authService.verifyToken("invalid-token")).rejects.toThrow("Invalid token");
        });
        (0, _globals.it)("should throw error for expired token", async ()=>{
            // Arrange
            mockJwt.verify.mockImplementation(()=>{
                throw new Error("jwt expired");
            });
            // Act & Assert
            await (0, _globals.expect)(authService.verifyToken("expired-token")).rejects.toThrow("Invalid token");
        });
    });
    (0, _globals.describe)("refreshAccessToken", ()=>{
        const mockRefreshToken = {
            token: "valid-refresh-token",
            userId: 1,
            expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000),
            isRevoked: false,
            user: {
                id: 1,
                email: "test@example.com",
                name: "Test User",
                permissions: [
                    "inventory:read"
                ],
                shopId: "shop-1"
            }
        };
        (0, _globals.it)("should successfully refresh access token", async ()=>{
            // Arrange
            mockJwt.verify.mockReturnValue({
                userId: 1
            });
            mockPrisma.refreshToken.findUnique.mockResolvedValue(mockRefreshToken);
            mockJwt.sign.mockReturnValue("new-access-token");
            // Act
            const result = await authService.refreshAccessToken("valid-refresh-token");
            // Assert
            (0, _globals.expect)(mockJwt.verify).toHaveBeenCalledWith("valid-refresh-token", "test-refresh-secret");
            (0, _globals.expect)(mockPrisma.refreshToken.findUnique).toHaveBeenCalledWith({
                where: {
                    token: "valid-refresh-token"
                },
                include: {
                    user: true
                }
            });
            (0, _globals.expect)(result).toEqual({
                accessToken: "new-access-token",
                user: {
                    id: 1,
                    email: "test@example.com",
                    name: "Test User",
                    permissions: [
                        "inventory:read"
                    ],
                    shopId: "shop-1"
                }
            });
        });
        (0, _globals.it)("should throw error for revoked refresh token", async ()=>{
            // Arrange
            const revokedToken = {
                ...mockRefreshToken,
                isRevoked: true
            };
            mockJwt.verify.mockReturnValue({
                userId: 1
            });
            mockPrisma.refreshToken.findUnique.mockResolvedValue(revokedToken);
            // Act & Assert
            await (0, _globals.expect)(authService.refreshAccessToken("revoked-token")).rejects.toThrow("Invalid refresh token");
        });
        (0, _globals.it)("should throw error for expired refresh token", async ()=>{
            // Arrange
            const expiredToken = {
                ...mockRefreshToken,
                expiresAt: new Date(Date.now() - 24 * 60 * 60 * 1000)
            };
            mockJwt.verify.mockReturnValue({
                userId: 1
            });
            mockPrisma.refreshToken.findUnique.mockResolvedValue(expiredToken);
            // Act & Assert
            await (0, _globals.expect)(authService.refreshAccessToken("expired-token")).rejects.toThrow("Refresh token expired");
        });
        (0, _globals.it)("should throw error for non-existent refresh token", async ()=>{
            // Arrange
            mockJwt.verify.mockReturnValue({
                userId: 1
            });
            mockPrisma.refreshToken.findUnique.mockResolvedValue(null);
            // Act & Assert
            await (0, _globals.expect)(authService.refreshAccessToken("non-existent-token")).rejects.toThrow("Invalid refresh token");
        });
    });
    (0, _globals.describe)("logout", ()=>{
        (0, _globals.it)("should successfully logout user", async ()=>{
            // Arrange
            mockPrisma.refreshToken.deleteMany.mockResolvedValue({
                count: 1
            });
            // Act
            await authService.logout("refresh-token");
            // Assert
            (0, _globals.expect)(mockPrisma.refreshToken.deleteMany).toHaveBeenCalledWith({
                where: {
                    token: "refresh-token"
                }
            });
        });
        (0, _globals.it)("should handle logout even if token does not exist", async ()=>{
            // Arrange
            mockPrisma.refreshToken.deleteMany.mockResolvedValue({
                count: 0
            });
            // Act & Assert
            await (0, _globals.expect)(authService.logout("non-existent-token")).resolves.not.toThrow();
        });
    });
    (0, _globals.describe)("logoutAllDevices", ()=>{
        (0, _globals.it)("should successfully logout from all devices", async ()=>{
            // Arrange
            mockPrisma.refreshToken.deleteMany.mockResolvedValue({
                count: 3
            });
            // Act
            await authService.logoutAllDevices(1);
            // Assert
            (0, _globals.expect)(mockPrisma.refreshToken.deleteMany).toHaveBeenCalledWith({
                where: {
                    userId: 1
                }
            });
        });
        (0, _globals.it)("should handle logout all devices even if no tokens exist", async ()=>{
            // Arrange
            mockPrisma.refreshToken.deleteMany.mockResolvedValue({
                count: 0
            });
            // Act & Assert
            await (0, _globals.expect)(authService.logoutAllDevices(1)).resolves.not.toThrow();
        });
    });
    (0, _globals.describe)("security considerations", ()=>{
        (0, _globals.it)("should use secure JWT configuration", ()=>{
            // Arrange
            const mockUser = {
                id: 1,
                email: "test@example.com",
                permissions: [],
                shopId: "shop-1"
            };
            // Act
            authService["generateAccessToken"](mockUser);
            // Assert
            (0, _globals.expect)(mockJwt.sign).toHaveBeenCalledWith(_globals.expect.objectContaining({
                userId: 1,
                email: "test@example.com",
                permissions: [],
                shopId: "shop-1"
            }), "test-secret", {
                expiresIn: "15m"
            });
        });
        (0, _globals.it)("should not expose sensitive user data in tokens", ()=>{
            // Arrange
            const mockUser = {
                id: 1,
                email: "test@example.com",
                password: "hashedPassword",
                permissions: [],
                shopId: "shop-1"
            };
            // Act
            authService["generateAccessToken"](mockUser);
            // Assert
            const tokenPayload = mockJwt.sign.mock.calls[0][0];
            (0, _globals.expect)(tokenPayload).not.toHaveProperty("password");
        });
        (0, _globals.it)("should use different secrets for access and refresh tokens", async ()=>{
            // This test ensures we're using different secrets for different token types
            const mockUser = {
                id: 1,
                email: "test@example.com",
                permissions: [],
                shopId: "shop-1"
            };
            // Generate access token
            authService["generateAccessToken"](mockUser);
            // Generate refresh token
            await authService["generateRefreshToken"](1);
            // Assert different secrets are used
            const accessTokenCall = mockJwt.sign.mock.calls[0];
            const refreshTokenCall = mockJwt.sign.mock.calls[1];
            (0, _globals.expect)(accessTokenCall[1]).toBe("test-secret");
            (0, _globals.expect)(refreshTokenCall[1]).toBe("test-refresh-secret");
            (0, _globals.expect)(accessTokenCall[1]).not.toBe(refreshTokenCall[1]);
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vdGVzdHMvdW5pdC9hdXRoLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGplc3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XG5pbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCc7XG5cbi8vIE1vY2sgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ2JjcnlwdGpzJyk7XG5qZXN0Lm1vY2soJ2pzb253ZWJ0b2tlbicpO1xuamVzdC5tb2NrKCdAcHJpc21hL2NsaWVudCcpO1xuXG5jb25zdCBtb2NrQmNyeXB0ID0gYmNyeXB0IGFzIGplc3QuTW9ja2VkPHR5cGVvZiBiY3J5cHQ+O1xuY29uc3QgbW9ja0p3dCA9IGp3dCBhcyBqZXN0Lk1vY2tlZDx0eXBlb2Ygand0PjtcbmNvbnN0IG1vY2tQcmlzbWEgPSB7XG4gIHVzZXI6IHtcbiAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXG4gIH0sXG4gIHJlZnJlc2hUb2tlbjoge1xuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICBkZWxldGVNYW55OiBqZXN0LmZuKCksXG4gIH0sXG4gICRkaXNjb25uZWN0OiBqZXN0LmZuKCksXG59IGFzIGFueTtcblxuLy8gTW9jayB0aGUgYXV0aCBzZXJ2aWNlICh3ZSdsbCB0ZXN0IHRoZSBhY3R1YWwgaW1wbGVtZW50YXRpb24pXG5jbGFzcyBBdXRoU2VydmljZSB7XG4gIHByaXZhdGUgcHJpc21hOiBQcmlzbWFDbGllbnQ7XG4gIFxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnByaXNtYSA9IG1vY2tQcmlzbWE7XG4gIH1cblxuICBhc3luYyBsb2dpbihlbWFpbDogc3RyaW5nLCBwYXNzd29yZDogc3RyaW5nKSB7XG4gICAgLy8gRmluZCB1c2VyIGJ5IGVtYWlsXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMucHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBlbWFpbCB9LFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIGlkOiB0cnVlLFxuICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgcGFzc3dvcmQ6IHRydWUsXG4gICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgIHBlcm1pc3Npb25zOiB0cnVlLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgc2hvcElkOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmICghdXNlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGNyZWRlbnRpYWxzJyk7XG4gICAgfVxuXG4gICAgaWYgKCF1c2VyLmlzQWN0aXZlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FjY291bnQgaXMgZGVhY3RpdmF0ZWQnKTtcbiAgICB9XG5cbiAgICAvLyBWZXJpZnkgcGFzc3dvcmRcbiAgICBjb25zdCBpc1ZhbGlkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZCk7XG4gICAgaWYgKCFpc1ZhbGlkUGFzc3dvcmQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBjcmVkZW50aWFscycpO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIHRva2Vuc1xuICAgIGNvbnN0IGFjY2Vzc1Rva2VuID0gdGhpcy5nZW5lcmF0ZUFjY2Vzc1Rva2VuKHVzZXIpO1xuICAgIGNvbnN0IHJlZnJlc2hUb2tlbiA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlci5pZCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIG5hbWU6IHVzZXIubmFtZSxcbiAgICAgICAgcGVybWlzc2lvbnM6IHVzZXIucGVybWlzc2lvbnMsXG4gICAgICAgIHNob3BJZDogdXNlci5zaG9wSWQsXG4gICAgICB9LFxuICAgICAgYWNjZXNzVG9rZW4sXG4gICAgICByZWZyZXNoVG9rZW4sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVBY2Nlc3NUb2tlbih1c2VyOiBhbnkpIHtcbiAgICByZXR1cm4gand0LnNpZ24oXG4gICAgICB7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIHBlcm1pc3Npb25zOiB1c2VyLnBlcm1pc3Npb25zLFxuICAgICAgICBzaG9wSWQ6IHVzZXIuc2hvcElkLFxuICAgICAgfSxcbiAgICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3Rlc3Qtc2VjcmV0JyxcbiAgICAgIHsgZXhwaXJlc0luOiAnMTVtJyB9XG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVSZWZyZXNoVG9rZW4odXNlcklkOiBudW1iZXIpIHtcbiAgICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKFxuICAgICAgeyB1c2VySWQgfSxcbiAgICAgIHByb2Nlc3MuZW52LkpXVF9SRUZSRVNIX1NFQ1JFVCB8fCAndGVzdC1yZWZyZXNoLXNlY3JldCcsXG4gICAgICB7IGV4cGlyZXNJbjogJzdkJyB9XG4gICAgKTtcblxuICAgIC8vIFN0b3JlIHJlZnJlc2ggdG9rZW4gaW4gZGF0YWJhc2VcbiAgICBhd2FpdCB0aGlzLnByaXNtYS5yZWZyZXNoVG9rZW4uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB0b2tlbixcbiAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyA3IGRheXNcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdG9rZW47XG4gIH1cblxuICBhc3luYyB2ZXJpZnlUb2tlbih0b2tlbjogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd0ZXN0LXNlY3JldCcpO1xuICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0b2tlbicpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlZnJlc2hBY2Nlc3NUb2tlbihyZWZyZXNoVG9rZW46IHN0cmluZykge1xuICAgIC8vIFZlcmlmeSByZWZyZXNoIHRva2VuXG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkoXG4gICAgICByZWZyZXNoVG9rZW4sXG4gICAgICBwcm9jZXNzLmVudi5KV1RfUkVGUkVTSF9TRUNSRVQgfHwgJ3Rlc3QtcmVmcmVzaC1zZWNyZXQnXG4gICAgKSBhcyBhbnk7XG5cbiAgICAvLyBDaGVjayBpZiByZWZyZXNoIHRva2VuIGV4aXN0cyBpbiBkYXRhYmFzZVxuICAgIGNvbnN0IHN0b3JlZFRva2VuID0gYXdhaXQgdGhpcy5wcmlzbWEucmVmcmVzaFRva2VuLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgdG9rZW46IHJlZnJlc2hUb2tlbiB9LFxuICAgICAgaW5jbHVkZTogeyB1c2VyOiB0cnVlIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoIXN0b3JlZFRva2VuIHx8IHN0b3JlZFRva2VuLmlzUmV2b2tlZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJlZnJlc2ggdG9rZW4nKTtcbiAgICB9XG5cbiAgICBpZiAobmV3IERhdGUoKSA+IHN0b3JlZFRva2VuLmV4cGlyZXNBdCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWZyZXNoIHRva2VuIGV4cGlyZWQnKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSBuZXcgYWNjZXNzIHRva2VuXG4gICAgY29uc3QgbmV3QWNjZXNzVG9rZW4gPSB0aGlzLmdlbmVyYXRlQWNjZXNzVG9rZW4oc3RvcmVkVG9rZW4udXNlcik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgYWNjZXNzVG9rZW46IG5ld0FjY2Vzc1Rva2VuLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogc3RvcmVkVG9rZW4udXNlci5pZCxcbiAgICAgICAgZW1haWw6IHN0b3JlZFRva2VuLnVzZXIuZW1haWwsXG4gICAgICAgIG5hbWU6IHN0b3JlZFRva2VuLnVzZXIubmFtZSxcbiAgICAgICAgcGVybWlzc2lvbnM6IHN0b3JlZFRva2VuLnVzZXIucGVybWlzc2lvbnMsXG4gICAgICAgIHNob3BJZDogc3RvcmVkVG9rZW4udXNlci5zaG9wSWQsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBhc3luYyBsb2dvdXQocmVmcmVzaFRva2VuOiBzdHJpbmcpIHtcbiAgICAvLyBSZXZva2UgcmVmcmVzaCB0b2tlblxuICAgIGF3YWl0IHRoaXMucHJpc21hLnJlZnJlc2hUb2tlbi5kZWxldGVNYW55KHtcbiAgICAgIHdoZXJlOiB7IHRva2VuOiByZWZyZXNoVG9rZW4gfSxcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGxvZ291dEFsbERldmljZXModXNlcklkOiBudW1iZXIpIHtcbiAgICAvLyBSZXZva2UgYWxsIHJlZnJlc2ggdG9rZW5zIGZvciB1c2VyXG4gICAgYXdhaXQgdGhpcy5wcmlzbWEucmVmcmVzaFRva2VuLmRlbGV0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgfSk7XG4gIH1cbn1cblxuZGVzY3JpYmUoJ0F1dGhTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGF1dGhTZXJ2aWNlID0gbmV3IEF1dGhTZXJ2aWNlKCk7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgXG4gICAgLy8gU2V0IHVwIGVudmlyb25tZW50IHZhcmlhYmxlc1xuICAgIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgPSAndGVzdC1zZWNyZXQnO1xuICAgIHByb2Nlc3MuZW52LkpXVF9SRUZSRVNIX1NFQ1JFVCA9ICd0ZXN0LXJlZnJlc2gtc2VjcmV0JztcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0QWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvZ2luJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tVc2VyID0ge1xuICAgICAgaWQ6IDEsXG4gICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRQYXNzd29yZCcsXG4gICAgICBuYW1lOiAnVGVzdCBVc2VyJyxcbiAgICAgIHBlcm1pc3Npb25zOiBbJ2ludmVudG9yeTpyZWFkJywgJ3NhbGVzOmNyZWF0ZSddLFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICBzaG9wSWQ6ICdzaG9wLTEnLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBsb2dpbiB3aXRoIHZhbGlkIGNyZWRlbnRpYWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgbW9ja1ByaXNtYS51c2VyLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xuICAgICAgbW9ja0JjcnlwdC5jb21wYXJlLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUgYXMgbmV2ZXIpO1xuICAgICAgbW9ja0p3dC5zaWduLm1vY2tSZXR1cm5WYWx1ZSgnbW9jay1hY2Nlc3MtdG9rZW4nIGFzIG5ldmVyKTtcbiAgICAgIG1vY2tQcmlzbWEucmVmcmVzaFRva2VuLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHRva2VuOiAnbW9jay1yZWZyZXNoLXRva2VuJyB9KTtcblxuICAgICAgLy8gQWN0XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdXRoU2VydmljZS5sb2dpbigndGVzdEBleGFtcGxlLmNvbScsICdwYXNzd29yZDEyMycpO1xuXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICAgIHBhc3N3b3JkOiB0cnVlLFxuICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgcGVybWlzc2lvbnM6IHRydWUsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgc2hvcElkOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QobW9ja0JjcnlwdC5jb21wYXJlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgncGFzc3dvcmQxMjMnLCAnaGFzaGVkUGFzc3dvcmQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoe1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBuYW1lOiAnVGVzdCBVc2VyJyxcbiAgICAgICAgICBwZXJtaXNzaW9uczogWydpbnZlbnRvcnk6cmVhZCcsICdzYWxlczpjcmVhdGUnXSxcbiAgICAgICAgICBzaG9wSWQ6ICdzaG9wLTEnLFxuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NUb2tlbjogJ21vY2stYWNjZXNzLXRva2VuJyxcbiAgICAgICAgcmVmcmVzaFRva2VuOiAnbW9jay1hY2Nlc3MtdG9rZW4nLCAvLyBUaGlzIHdvdWxkIGJlIHRoZSByZWZyZXNoIHRva2VuIGluIHJlYWwgaW1wbGVtZW50YXRpb25cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3Igbm9uLWV4aXN0ZW50IHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXV0aFNlcnZpY2UubG9naW4oJ25vbmV4aXN0ZW50QGV4YW1wbGUuY29tJywgJ3Bhc3N3b3JkMTIzJykpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0ludmFsaWQgY3JlZGVudGlhbHMnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tCY3J5cHQuY29tcGFyZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIGluYWN0aXZlIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBpbmFjdGl2ZVVzZXIgPSB7IC4uLm1vY2tVc2VyLCBpc0FjdGl2ZTogZmFsc2UgfTtcbiAgICAgIG1vY2tQcmlzbWEudXNlci5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKGluYWN0aXZlVXNlcik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGF1dGhTZXJ2aWNlLmxvZ2luKCd0ZXN0QGV4YW1wbGUuY29tJywgJ3Bhc3N3b3JkMTIzJykpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0FjY291bnQgaXMgZGVhY3RpdmF0ZWQnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tCY3J5cHQuY29tcGFyZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIGludmFsaWQgcGFzc3dvcmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG4gICAgICBtb2NrQmNyeXB0LmNvbXBhcmUubW9ja1Jlc29sdmVkVmFsdWUoZmFsc2UgYXMgbmV2ZXIpO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChhdXRoU2VydmljZS5sb2dpbigndGVzdEBleGFtcGxlLmNvbScsICd3cm9uZ3Bhc3N3b3JkJykpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0ludmFsaWQgY3JlZGVudGlhbHMnKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tCY3J5cHQuY29tcGFyZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3dyb25ncGFzc3dvcmQnLCAnaGFzaGVkUGFzc3dvcmQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgbW9ja1ByaXNtYS51c2VyLmZpbmRVbmlxdWUubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEYXRhYmFzZSBjb25uZWN0aW9uIGZhaWxlZCcpKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXV0aFNlcnZpY2UubG9naW4oJ3Rlc3RAZXhhbXBsZS5jb20nLCAncGFzc3dvcmQxMjMnKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZlcmlmeVRva2VuJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IHZlcmlmeSB2YWxpZCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIGNvbnN0IG1vY2tEZWNvZGVkID0geyB1c2VySWQ6IDEsIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScgfTtcbiAgICAgIG1vY2tKd3QudmVyaWZ5Lm1vY2tSZXR1cm5WYWx1ZShtb2NrRGVjb2RlZCBhcyBuZXZlcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4oJ3ZhbGlkLXRva2VuJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tKd3QudmVyaWZ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndmFsaWQtdG9rZW4nLCAndGVzdC1zZWNyZXQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0RlY29kZWQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgaW52YWxpZCB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIG1vY2tKd3QudmVyaWZ5Lm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignand0IG1hbGZvcm1lZCcpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGF1dGhTZXJ2aWNlLnZlcmlmeVRva2VuKCdpbnZhbGlkLXRva2VuJykpXG4gICAgICAgIC5yZWplY3RzLnRvVGhyb3coJ0ludmFsaWQgdG9rZW4nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIGV4cGlyZWQgdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBtb2NrSnd0LnZlcmlmeS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2p3dCBleHBpcmVkJyk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXV0aFNlcnZpY2UudmVyaWZ5VG9rZW4oJ2V4cGlyZWQtdG9rZW4nKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCB0b2tlbicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVmcmVzaEFjY2Vzc1Rva2VuJywgKCkgPT4ge1xuICAgIGNvbnN0IG1vY2tSZWZyZXNoVG9rZW4gPSB7XG4gICAgICB0b2tlbjogJ3ZhbGlkLXJlZnJlc2gtdG9rZW4nLFxuICAgICAgdXNlcklkOiAxLFxuICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMjQgKiA2MCAqIDYwICogMTAwMCksIC8vIDEgZGF5IGZyb20gbm93XG4gICAgICBpc1Jldm9rZWQ6IGZhbHNlLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogMSxcbiAgICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcicsXG4gICAgICAgIHBlcm1pc3Npb25zOiBbJ2ludmVudG9yeTpyZWFkJ10sXG4gICAgICAgIHNob3BJZDogJ3Nob3AtMScsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSByZWZyZXNoIGFjY2VzcyB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIG1vY2tKd3QudmVyaWZ5Lm1vY2tSZXR1cm5WYWx1ZSh7IHVzZXJJZDogMSB9IGFzIG5ldmVyKTtcbiAgICAgIG1vY2tQcmlzbWEucmVmcmVzaFRva2VuLmZpbmRVbmlxdWUubW9ja1Jlc29sdmVkVmFsdWUobW9ja1JlZnJlc2hUb2tlbik7XG4gICAgICBtb2NrSnd0LnNpZ24ubW9ja1JldHVyblZhbHVlKCduZXctYWNjZXNzLXRva2VuJyBhcyBuZXZlcik7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXV0aFNlcnZpY2UucmVmcmVzaEFjY2Vzc1Rva2VuKCd2YWxpZC1yZWZyZXNoLXRva2VuJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tKd3QudmVyaWZ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndmFsaWQtcmVmcmVzaC10b2tlbicsICd0ZXN0LXJlZnJlc2gtc2VjcmV0Jyk7XG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5yZWZyZXNoVG9rZW4uZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB0b2tlbjogJ3ZhbGlkLXJlZnJlc2gtdG9rZW4nIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgdXNlcjogdHJ1ZSB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHtcbiAgICAgICAgYWNjZXNzVG9rZW46ICduZXctYWNjZXNzLXRva2VuJyxcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgICAgbmFtZTogJ1Rlc3QgVXNlcicsXG4gICAgICAgICAgcGVybWlzc2lvbnM6IFsnaW52ZW50b3J5OnJlYWQnXSxcbiAgICAgICAgICBzaG9wSWQ6ICdzaG9wLTEnLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciByZXZva2VkIHJlZnJlc2ggdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCByZXZva2VkVG9rZW4gPSB7IC4uLm1vY2tSZWZyZXNoVG9rZW4sIGlzUmV2b2tlZDogdHJ1ZSB9O1xuICAgICAgbW9ja0p3dC52ZXJpZnkubW9ja1JldHVyblZhbHVlKHsgdXNlcklkOiAxIH0gYXMgbmV2ZXIpO1xuICAgICAgbW9ja1ByaXNtYS5yZWZyZXNoVG9rZW4uZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShyZXZva2VkVG9rZW4pO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChhdXRoU2VydmljZS5yZWZyZXNoQWNjZXNzVG9rZW4oJ3Jldm9rZWQtdG9rZW4nKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCByZWZyZXNoIHRva2VuJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIGZvciBleHBpcmVkIHJlZnJlc2ggdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBleHBpcmVkVG9rZW4gPSB7XG4gICAgICAgIC4uLm1vY2tSZWZyZXNoVG9rZW4sXG4gICAgICAgIGV4cGlyZXNBdDogbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAxIGRheSBhZ29cbiAgICAgIH07XG4gICAgICBtb2NrSnd0LnZlcmlmeS5tb2NrUmV0dXJuVmFsdWUoeyB1c2VySWQ6IDEgfSBhcyBuZXZlcik7XG4gICAgICBtb2NrUHJpc21hLnJlZnJlc2hUb2tlbi5maW5kVW5pcXVlLm1vY2tSZXNvbHZlZFZhbHVlKGV4cGlyZWRUb2tlbik7XG5cbiAgICAgIC8vIEFjdCAmIEFzc2VydFxuICAgICAgYXdhaXQgZXhwZWN0KGF1dGhTZXJ2aWNlLnJlZnJlc2hBY2Nlc3NUb2tlbignZXhwaXJlZC10b2tlbicpKVxuICAgICAgICAucmVqZWN0cy50b1Rocm93KCdSZWZyZXNoIHRva2VuIGV4cGlyZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3IgZm9yIG5vbi1leGlzdGVudCByZWZyZXNoIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgbW9ja0p3dC52ZXJpZnkubW9ja1JldHVyblZhbHVlKHsgdXNlcklkOiAxIH0gYXMgbmV2ZXIpO1xuICAgICAgbW9ja1ByaXNtYS5yZWZyZXNoVG9rZW4uZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXV0aFNlcnZpY2UucmVmcmVzaEFjY2Vzc1Rva2VuKCdub24tZXhpc3RlbnQtdG9rZW4nKSlcbiAgICAgICAgLnJlamVjdHMudG9UaHJvdygnSW52YWxpZCByZWZyZXNoIHRva2VuJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdsb2dvdXQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgbG9nb3V0IHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBtb2NrUHJpc21hLnJlZnJlc2hUb2tlbi5kZWxldGVNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKHsgY291bnQ6IDEgfSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgYXV0aFNlcnZpY2UubG9nb3V0KCdyZWZyZXNoLXRva2VuJyk7XG5cbiAgICAgIC8vIEFzc2VydFxuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEucmVmcmVzaFRva2VuLmRlbGV0ZU1hbnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgdG9rZW46ICdyZWZyZXNoLXRva2VuJyB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsb2dvdXQgZXZlbiBpZiB0b2tlbiBkb2VzIG5vdCBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFycmFuZ2VcbiAgICAgIG1vY2tQcmlzbWEucmVmcmVzaFRva2VuLmRlbGV0ZU1hbnkubW9ja1Jlc29sdmVkVmFsdWUoeyBjb3VudDogMCB9KTtcblxuICAgICAgLy8gQWN0ICYgQXNzZXJ0XG4gICAgICBhd2FpdCBleHBlY3QoYXV0aFNlcnZpY2UubG9nb3V0KCdub24tZXhpc3RlbnQtdG9rZW4nKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2xvZ291dEFsbERldmljZXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgbG9nb3V0IGZyb20gYWxsIGRldmljZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBtb2NrUHJpc21hLnJlZnJlc2hUb2tlbi5kZWxldGVNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKHsgY291bnQ6IDMgfSk7XG5cbiAgICAgIC8vIEFjdFxuICAgICAgYXdhaXQgYXV0aFNlcnZpY2UubG9nb3V0QWxsRGV2aWNlcygxKTtcblxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5yZWZyZXNoVG9rZW4uZGVsZXRlTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQ6IDEgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbG9nb3V0IGFsbCBkZXZpY2VzIGV2ZW4gaWYgbm8gdG9rZW5zIGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgbW9ja1ByaXNtYS5yZWZyZXNoVG9rZW4uZGVsZXRlTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGNvdW50OiAwIH0pO1xuXG4gICAgICAvLyBBY3QgJiBBc3NlcnRcbiAgICAgIGF3YWl0IGV4cGVjdChhdXRoU2VydmljZS5sb2dvdXRBbGxEZXZpY2VzKDEpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2VjdXJpdHkgY29uc2lkZXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1c2Ugc2VjdXJlIEpXVCBjb25maWd1cmF0aW9uJywgKCkgPT4ge1xuICAgICAgLy8gQXJyYW5nZVxuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiAxLCBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLCBwZXJtaXNzaW9uczogW10sIHNob3BJZDogJ3Nob3AtMScgfTtcbiAgICAgIFxuICAgICAgLy8gQWN0XG4gICAgICBhdXRoU2VydmljZVsnZ2VuZXJhdGVBY2Nlc3NUb2tlbiddKG1vY2tVc2VyKTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0XG4gICAgICBleHBlY3QobW9ja0p3dC5zaWduKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICAgIHBlcm1pc3Npb25zOiBbXSxcbiAgICAgICAgICBzaG9wSWQ6ICdzaG9wLTEnLFxuICAgICAgICB9KSxcbiAgICAgICAgJ3Rlc3Qtc2VjcmV0JyxcbiAgICAgICAgeyBleHBpcmVzSW46ICcxNW0nIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBleHBvc2Ugc2Vuc2l0aXZlIHVzZXIgZGF0YSBpbiB0b2tlbnMnLCAoKSA9PiB7XG4gICAgICAvLyBBcnJhbmdlXG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkUGFzc3dvcmQnLFxuICAgICAgICBwZXJtaXNzaW9uczogW10sXG4gICAgICAgIHNob3BJZDogJ3Nob3AtMScsXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBBY3RcbiAgICAgIGF1dGhTZXJ2aWNlWydnZW5lcmF0ZUFjY2Vzc1Rva2VuJ10obW9ja1VzZXIpO1xuICAgICAgXG4gICAgICAvLyBBc3NlcnRcbiAgICAgIGNvbnN0IHRva2VuUGF5bG9hZCA9IChtb2NrSnd0LnNpZ24gYXMgamVzdC5Nb2NrKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KHRva2VuUGF5bG9hZCkubm90LnRvSGF2ZVByb3BlcnR5KCdwYXNzd29yZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1c2UgZGlmZmVyZW50IHNlY3JldHMgZm9yIGFjY2VzcyBhbmQgcmVmcmVzaCB0b2tlbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHRlc3QgZW5zdXJlcyB3ZSdyZSB1c2luZyBkaWZmZXJlbnQgc2VjcmV0cyBmb3IgZGlmZmVyZW50IHRva2VuIHR5cGVzXG4gICAgICBjb25zdCBtb2NrVXNlciA9IHsgaWQ6IDEsIGVtYWlsOiAndGVzdEBleGFtcGxlLmNvbScsIHBlcm1pc3Npb25zOiBbXSwgc2hvcElkOiAnc2hvcC0xJyB9O1xuICAgICAgXG4gICAgICAvLyBHZW5lcmF0ZSBhY2Nlc3MgdG9rZW5cbiAgICAgIGF1dGhTZXJ2aWNlWydnZW5lcmF0ZUFjY2Vzc1Rva2VuJ10obW9ja1VzZXIpO1xuICAgICAgXG4gICAgICAvLyBHZW5lcmF0ZSByZWZyZXNoIHRva2VuXG4gICAgICBhd2FpdCBhdXRoU2VydmljZVsnZ2VuZXJhdGVSZWZyZXNoVG9rZW4nXSgxKTtcbiAgICAgIFxuICAgICAgLy8gQXNzZXJ0IGRpZmZlcmVudCBzZWNyZXRzIGFyZSB1c2VkXG4gICAgICBjb25zdCBhY2Nlc3NUb2tlbkNhbGwgPSAobW9ja0p3dC5zaWduIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1swXTtcbiAgICAgIGNvbnN0IHJlZnJlc2hUb2tlbkNhbGwgPSAobW9ja0p3dC5zaWduIGFzIGplc3QuTW9jaykubW9jay5jYWxsc1sxXTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGFjY2Vzc1Rva2VuQ2FsbFsxXSkudG9CZSgndGVzdC1zZWNyZXQnKTtcbiAgICAgIGV4cGVjdChyZWZyZXNoVG9rZW5DYWxsWzFdKS50b0JlKCd0ZXN0LXJlZnJlc2gtc2VjcmV0Jyk7XG4gICAgICBleHBlY3QoYWNjZXNzVG9rZW5DYWxsWzFdKS5ub3QudG9CZShyZWZyZXNoVG9rZW5DYWxsWzFdKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJtb2NrQmNyeXB0IiwiYmNyeXB0IiwibW9ja0p3dCIsImp3dCIsIm1vY2tQcmlzbWEiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsImZuIiwiY3JlYXRlIiwidXBkYXRlIiwicmVmcmVzaFRva2VuIiwiZGVsZXRlIiwiZGVsZXRlTWFueSIsIiRkaXNjb25uZWN0IiwiQXV0aFNlcnZpY2UiLCJjb25zdHJ1Y3RvciIsInByaXNtYSIsImxvZ2luIiwiZW1haWwiLCJwYXNzd29yZCIsIndoZXJlIiwic2VsZWN0IiwiaWQiLCJuYW1lIiwicGVybWlzc2lvbnMiLCJpc0FjdGl2ZSIsInNob3BJZCIsIkVycm9yIiwiaXNWYWxpZFBhc3N3b3JkIiwiY29tcGFyZSIsImFjY2Vzc1Rva2VuIiwiZ2VuZXJhdGVBY2Nlc3NUb2tlbiIsImdlbmVyYXRlUmVmcmVzaFRva2VuIiwic2lnbiIsInVzZXJJZCIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiZXhwaXJlc0luIiwidG9rZW4iLCJKV1RfUkVGUkVTSF9TRUNSRVQiLCJkYXRhIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsInZlcmlmeVRva2VuIiwiZGVjb2RlZCIsInZlcmlmeSIsImVycm9yIiwicmVmcmVzaEFjY2Vzc1Rva2VuIiwic3RvcmVkVG9rZW4iLCJpbmNsdWRlIiwiaXNSZXZva2VkIiwibmV3QWNjZXNzVG9rZW4iLCJsb2dvdXQiLCJsb2dvdXRBbGxEZXZpY2VzIiwiZGVzY3JpYmUiLCJhdXRoU2VydmljZSIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwiYWZ0ZXJFYWNoIiwicmVzZXRBbGxNb2NrcyIsIm1vY2tVc2VyIiwiaXQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsIm1vY2tSZXR1cm5WYWx1ZSIsInJlc3VsdCIsImV4cGVjdCIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwidG9FcXVhbCIsInJlamVjdHMiLCJ0b1Rocm93Iiwibm90IiwidG9IYXZlQmVlbkNhbGxlZCIsImluYWN0aXZlVXNlciIsIm1vY2tSZWplY3RlZFZhbHVlIiwibW9ja0RlY29kZWQiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJtb2NrUmVmcmVzaFRva2VuIiwicmV2b2tlZFRva2VuIiwiZXhwaXJlZFRva2VuIiwiY291bnQiLCJyZXNvbHZlcyIsIm9iamVjdENvbnRhaW5pbmciLCJ0b2tlblBheWxvYWQiLCJjYWxscyIsInRvSGF2ZVByb3BlcnR5IiwiYWNjZXNzVG9rZW5DYWxsIiwicmVmcmVzaFRva2VuQ2FsbCIsInRvQmUiXSwibWFwcGluZ3MiOiI7Ozs7eUJBQWtFO2lFQUMvQztxRUFDSDs7Ozs7O0FBR2hCLG9CQUFvQjtBQUNwQkEsYUFBSSxDQUFDQyxJQUFJLENBQUM7QUFDVkQsYUFBSSxDQUFDQyxJQUFJLENBQUM7QUFDVkQsYUFBSSxDQUFDQyxJQUFJLENBQUM7QUFFVixNQUFNQyxhQUFhQyxpQkFBTTtBQUN6QixNQUFNQyxVQUFVQyxxQkFBRztBQUNuQixNQUFNQyxhQUFhO0lBQ2pCQyxNQUFNO1FBQ0pDLFlBQVlSLGFBQUksQ0FBQ1MsRUFBRTtRQUNuQkMsUUFBUVYsYUFBSSxDQUFDUyxFQUFFO1FBQ2ZFLFFBQVFYLGFBQUksQ0FBQ1MsRUFBRTtJQUNqQjtJQUNBRyxjQUFjO1FBQ1pGLFFBQVFWLGFBQUksQ0FBQ1MsRUFBRTtRQUNmRCxZQUFZUixhQUFJLENBQUNTLEVBQUU7UUFDbkJJLFFBQVFiLGFBQUksQ0FBQ1MsRUFBRTtRQUNmSyxZQUFZZCxhQUFJLENBQUNTLEVBQUU7SUFDckI7SUFDQU0sYUFBYWYsYUFBSSxDQUFDUyxFQUFFO0FBQ3RCO0FBRUEsK0RBQStEO0FBQy9ELE1BQU1PO0lBR0pDLGFBQWM7UUFDWixJQUFJLENBQUNDLE1BQU0sR0FBR1o7SUFDaEI7SUFFQSxNQUFNYSxNQUFNQyxLQUFhLEVBQUVDLFFBQWdCLEVBQUU7UUFDM0MscUJBQXFCO1FBQ3JCLE1BQU1kLE9BQU8sTUFBTSxJQUFJLENBQUNXLE1BQU0sQ0FBQ1gsSUFBSSxDQUFDQyxV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