3ed5f56ea38aabf685edf91ae4dee9be
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
const _globals = require("@jest/globals");
const _auditService = require("../../src/services/auditService");
// Mock Prisma
const mockPrisma = {
    auditLog: {
        create: _globals.jest.fn(),
        findMany: _globals.jest.fn(),
        findFirst: _globals.jest.fn(),
        update: _globals.jest.fn(),
        delete: _globals.jest.fn(),
        count: _globals.jest.fn()
    },
    user: {
        findUnique: _globals.jest.fn()
    }
};
_globals.jest.mock("@/lib/prisma", ()=>({
        prisma: mockPrisma
    }));
(0, _globals.describe)("AuditService", ()=>{
    let auditService;
    (0, _globals.beforeEach)(()=>{
        auditService = _auditService.AuditService.getInstance();
        _globals.jest.clearAllMocks();
    });
    (0, _globals.afterEach)(()=>{
        _globals.jest.resetAllMocks();
    });
    (0, _globals.describe)("getInstance", ()=>{
        (0, _globals.it)("should return a singleton instance", ()=>{
            const instance1 = _auditService.AuditService.getInstance();
            const instance2 = _auditService.AuditService.getInstance();
            (0, _globals.expect)(instance1).toBe(instance2);
        });
    });
    (0, _globals.describe)("logAction", ()=>{
        (0, _globals.it)("should successfully log an audit entry", async ()=>{
            const entry = {
                userId: 1,
                action: "CREATE",
                entity: "Product",
                entityId: 123,
                details: {
                    name: "Test Product"
                }
            };
            mockPrisma.auditLog.create.mockResolvedValue({
                id: 1,
                ...entry
            });
            await auditService.logAction(entry);
            (0, _globals.expect)(mockPrisma.auditLog.create).toHaveBeenCalledWith({
                data: {
                    userId: 1,
                    action: "CREATE",
                    entity: "Product",
                    entityId: 123,
                    details: {
                        name: "Test Product",
                        originalData: undefined,
                        isDeleted: false,
                        deletedAt: undefined,
                        deletedBy: undefined,
                        canRecover: false,
                        recoveredAt: undefined,
                        recoveredBy: undefined
                    }
                }
            });
        });
        (0, _globals.it)("should handle errors gracefully without throwing", async ()=>{
            const entry = {
                userId: 1,
                action: "CREATE",
                entity: "Product",
                entityId: 123
            };
            mockPrisma.auditLog.create.mockRejectedValue(new Error("Database error"));
            const consoleSpy = _globals.jest.spyOn(console, "error").mockImplementation();
            await (0, _globals.expect)(auditService.logAction(entry)).resolves.not.toThrow();
            (0, _globals.expect)(consoleSpy).toHaveBeenCalledWith("Failed to log audit entry:", _globals.expect.any(Error));
            consoleSpy.mockRestore();
        });
        (0, _globals.it)("should log soft delete with all required fields", async ()=>{
            const entry = {
                userId: 1,
                action: "DELETE",
                entity: "Product",
                entityId: 123,
                originalData: {
                    name: "Test Product",
                    price: 100
                },
                isDeleted: true,
                deletedAt: new Date(),
                deletedBy: 1,
                canRecover: true
            };
            mockPrisma.auditLog.create.mockResolvedValue({
                id: 1,
                ...entry
            });
            await auditService.logAction(entry);
            (0, _globals.expect)(mockPrisma.auditLog.create).toHaveBeenCalledWith({
                data: {
                    userId: 1,
                    action: "DELETE",
                    entity: "Product",
                    entityId: 123,
                    details: _globals.expect.objectContaining({
                        originalData: {
                            name: "Test Product",
                            price: 100
                        },
                        isDeleted: true,
                        deletedBy: 1,
                        canRecover: true
                    })
                }
            });
        });
    });
    (0, _globals.describe)("softDelete", ()=>{
        (0, _globals.it)("should log a soft delete action", async ()=>{
            const originalData = {
                name: "Test Product",
                price: 100
            };
            mockPrisma.auditLog.create.mockResolvedValue({
                id: 1
            });
            await auditService.softDelete("Product", 123, originalData, 1, true);
            (0, _globals.expect)(mockPrisma.auditLog.create).toHaveBeenCalledWith({
                data: {
                    userId: 1,
                    action: "DELETE",
                    entity: "Product",
                    entityId: 123,
                    details: _globals.expect.objectContaining({
                        originalData,
                        isDeleted: true,
                        deletedBy: 1,
                        canRecover: true,
                        deletedAt: _globals.expect.any(Date)
                    })
                }
            });
        });
        (0, _globals.it)("should default canRecover to true", async ()=>{
            const originalData = {
                name: "Test Product"
            };
            mockPrisma.auditLog.create.mockResolvedValue({
                id: 1
            });
            await auditService.softDelete("Product", 123, originalData, 1);
            (0, _globals.expect)(mockPrisma.auditLog.create).toHaveBeenCalledWith({
                data: _globals.expect.objectContaining({
                    details: _globals.expect.objectContaining({
                        canRecover: true
                    })
                })
            });
        });
    });
    (0, _globals.describe)("getDeletedEntityIds", ()=>{
        (0, _globals.it)("should return array of deleted entity IDs", async ()=>{
            const mockAuditLogs = [
                {
                    entityId: 1,
                    details: {
                        isDeleted: true
                    }
                },
                {
                    entityId: 2,
                    details: {
                        isDeleted: true
                    }
                },
                {
                    entityId: 3,
                    details: {
                        isDeleted: true
                    }
                }
            ];
            mockPrisma.auditLog.findMany.mockResolvedValue(mockAuditLogs);
            const result = await auditService.getDeletedEntityIds("Product");
            (0, _globals.expect)(result).toEqual([
                1,
                2,
                3
            ]);
            (0, _globals.expect)(mockPrisma.auditLog.findMany).toHaveBeenCalledWith({
                where: {
                    entity: "Product",
                    action: "DELETE",
                    details: {
                        path: [
                            "isDeleted"
                        ],
                        equals: true
                    }
                },
                select: {
                    entityId: true
                }
            });
        });
        (0, _globals.it)("should return empty array when no deleted entities found", async ()=>{
            mockPrisma.auditLog.findMany.mockResolvedValue([]);
            const result = await auditService.getDeletedEntityIds("Product");
            (0, _globals.expect)(result).toEqual([]);
        });
        (0, _globals.it)("should handle database errors", async ()=>{
            mockPrisma.auditLog.findMany.mockRejectedValue(new Error("Database error"));
            const consoleSpy = _globals.jest.spyOn(console, "error").mockImplementation();
            const result = await auditService.getDeletedEntityIds("Product");
            (0, _globals.expect)(result).toEqual([]);
            (0, _globals.expect)(consoleSpy).toHaveBeenCalledWith("Error fetching deleted entity IDs:", _globals.expect.any(Error));
            consoleSpy.mockRestore();
        });
    });
    (0, _globals.describe)("getRecycleBinItems", ()=>{
        (0, _globals.it)("should return paginated recycle bin items with user information", async ()=>{
            const mockAuditLogs = [
                {
                    id: 1,
                    entity: "Product",
                    entityId: 123,
                    details: {
                        originalData: {
                            name: "Test Product"
                        },
                        deletedAt: new Date("2023-01-01"),
                        deletedBy: 1,
                        canRecover: true
                    }
                }
            ];
            const mockUser = {
                id: 1,
                name: "Test User",
                email: "test@example.com"
            };
            mockPrisma.auditLog.findMany.mockResolvedValue(mockAuditLogs);
            mockPrisma.auditLog.count.mockResolvedValue(1);
            mockPrisma.user.findUnique.mockResolvedValue(mockUser);
            const result = await auditService.getRecycleBinItems(1, 10);
            (0, _globals.expect)(result.items).toHaveLength(1);
            (0, _globals.expect)(result.total).toBe(1);
            (0, _globals.expect)(result.items[0]).toEqual({
                id: 1,
                entity: "Product",
                entityId: 123,
                originalData: {
                    name: "Test Product"
                },
                deletedAt: new Date("2023-01-01"),
                deletedBy: 1,
                deletedByUser: mockUser,
                canRecover: true
            });
        });
        (0, _globals.it)("should handle pagination correctly", async ()=>{
            mockPrisma.auditLog.findMany.mockResolvedValue([]);
            mockPrisma.auditLog.count.mockResolvedValue(0);
            await auditService.getRecycleBinItems(2, 5);
            (0, _globals.expect)(mockPrisma.auditLog.findMany).toHaveBeenCalledWith({
                where: {
                    action: "DELETE",
                    details: {
                        path: [
                            "isDeleted"
                        ],
                        equals: true
                    }
                },
                orderBy: {
                    createdAt: "desc"
                },
                skip: 5,
                take: 5
            });
        });
        (0, _globals.it)("should handle missing user information gracefully", async ()=>{
            const mockAuditLogs = [
                {
                    id: 1,
                    entity: "Product",
                    entityId: 123,
                    details: {
                        originalData: {
                            name: "Test Product"
                        },
                        deletedAt: new Date("2023-01-01"),
                        deletedBy: 999,
                        canRecover: true
                    }
                }
            ];
            mockPrisma.auditLog.findMany.mockResolvedValue(mockAuditLogs);
            mockPrisma.auditLog.count.mockResolvedValue(1);
            mockPrisma.user.findUnique.mockResolvedValue(null);
            const result = await auditService.getRecycleBinItems(1, 10);
            (0, _globals.expect)(result.items[0].deletedByUser).toBeUndefined();
        });
    });
    (0, _globals.describe)("recoverEntity", ()=>{
        (0, _globals.it)("should log recovery action for an entity", async ()=>{
            mockPrisma.auditLog.create.mockResolvedValue({
                id: 1
            });
            await auditService.recoverEntity("Product", 123, 1);
            (0, _globals.expect)(mockPrisma.auditLog.create).toHaveBeenCalledWith({
                data: {
                    userId: 1,
                    action: "RECOVER",
                    entity: "Product",
                    entityId: 123,
                    details: _globals.expect.objectContaining({
                        recoveredAt: _globals.expect.any(Date),
                        recoveredBy: 1
                    })
                }
            });
        });
    });
    (0, _globals.describe)("getAuditHistory", ()=>{
        (0, _globals.it)("should return audit history for an entity", async ()=>{
            const mockAuditLogs = [
                {
                    id: 1,
                    action: "CREATE",
                    userId: 1,
                    createdAt: new Date("2023-01-01"),
                    details: {
                        name: "Test Product"
                    }
                },
                {
                    id: 2,
                    action: "UPDATE",
                    userId: 1,
                    createdAt: new Date("2023-01-02"),
                    details: {
                        name: "Updated Product"
                    }
                }
            ];
            mockPrisma.auditLog.findMany.mockResolvedValue(mockAuditLogs);
            const result = await auditService.getAuditHistory("Product", 123);
            (0, _globals.expect)(result).toEqual(mockAuditLogs);
            (0, _globals.expect)(mockPrisma.auditLog.findMany).toHaveBeenCalledWith({
                where: {
                    entity: "Product",
                    entityId: 123
                },
                orderBy: {
                    createdAt: "desc"
                },
                include: {
                    user: {
                        select: {
                            id: true,
                            name: true,
                            email: true
                        }
                    }
                }
            });
        });
        (0, _globals.it)("should handle database errors", async ()=>{
            mockPrisma.auditLog.findMany.mockRejectedValue(new Error("Database error"));
            const consoleSpy = _globals.jest.spyOn(console, "error").mockImplementation();
            const result = await auditService.getAuditHistory("Product", 123);
            (0, _globals.expect)(result).toEqual([]);
            (0, _globals.expect)(consoleSpy).toHaveBeenCalledWith("Error fetching audit history:", _globals.expect.any(Error));
            consoleSpy.mockRestore();
        });
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zYWNoaW4vRG9jdW1lbnRzL21kLXNwb3J0cy0vdGVzdHMvdW5pdC9hdWRpdFNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoLCBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBBdWRpdFNlcnZpY2UsIEF1ZGl0TG9nRW50cnksIFJlY3ljbGVCaW5JdGVtIH0gZnJvbSAnQC9zZXJ2aWNlcy9hdWRpdFNlcnZpY2UnO1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG4vLyBNb2NrIFByaXNtYVxuY29uc3QgbW9ja1ByaXNtYSA9IHtcbiAgYXVkaXRMb2c6IHtcbiAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgIGZpbmRGaXJzdDogamVzdC5mbigpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgIGRlbGV0ZTogamVzdC5mbigpLFxuICAgIGNvdW50OiBqZXN0LmZuKCksXG4gIH0sXG4gIHVzZXI6IHtcbiAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gIH0sXG59O1xuXG5qZXN0Lm1vY2soJ0AvbGliL3ByaXNtYScsICgpID0+ICh7XG4gIHByaXNtYTogbW9ja1ByaXNtYSxcbn0pKTtcblxuZGVzY3JpYmUoJ0F1ZGl0U2VydmljZScsICgpID0+IHtcbiAgbGV0IGF1ZGl0U2VydmljZTogQXVkaXRTZXJ2aWNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGF1ZGl0U2VydmljZSA9IEF1ZGl0U2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzZXRBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0SW5zdGFuY2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYSBzaW5nbGV0b24gaW5zdGFuY2UnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbnN0YW5jZTEgPSBBdWRpdFNlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcbiAgICAgIGNvbnN0IGluc3RhbmNlMiA9IEF1ZGl0U2VydmljZS5nZXRJbnN0YW5jZSgpO1xuICAgICAgZXhwZWN0KGluc3RhbmNlMSkudG9CZShpbnN0YW5jZTIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbG9nQWN0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGxvZyBhbiBhdWRpdCBlbnRyeScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVudHJ5OiBBdWRpdExvZ0VudHJ5ID0ge1xuICAgICAgICB1c2VySWQ6IDEsXG4gICAgICAgIGFjdGlvbjogJ0NSRUFURScsXG4gICAgICAgIGVudGl0eTogJ1Byb2R1Y3QnLFxuICAgICAgICBlbnRpdHlJZDogMTIzLFxuICAgICAgICBkZXRhaWxzOiB7IG5hbWU6ICdUZXN0IFByb2R1Y3QnIH0sXG4gICAgICB9O1xuXG4gICAgICBtb2NrUHJpc21hLmF1ZGl0TG9nLmNyZWF0ZS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAxLCAuLi5lbnRyeSB9KTtcblxuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLmxvZ0FjdGlvbihlbnRyeSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmF1ZGl0TG9nLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcklkOiAxLFxuICAgICAgICAgIGFjdGlvbjogJ0NSRUFURScsXG4gICAgICAgICAgZW50aXR5OiAnUHJvZHVjdCcsXG4gICAgICAgICAgZW50aXR5SWQ6IDEyMyxcbiAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICBuYW1lOiAnVGVzdCBQcm9kdWN0JyxcbiAgICAgICAgICAgIG9yaWdpbmFsRGF0YTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgaXNEZWxldGVkOiBmYWxzZSxcbiAgICAgICAgICAgIGRlbGV0ZWRBdDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGVsZXRlZEJ5OiB1bmRlZmluZWQsXG4gICAgICAgICAgICBjYW5SZWNvdmVyOiBmYWxzZSxcbiAgICAgICAgICAgIHJlY292ZXJlZEF0OiB1bmRlZmluZWQsXG4gICAgICAgICAgICByZWNvdmVyZWRCeTogdW5kZWZpbmVkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVycm9ycyBncmFjZWZ1bGx5IHdpdGhvdXQgdGhyb3dpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbnRyeTogQXVkaXRMb2dFbnRyeSA9IHtcbiAgICAgICAgdXNlcklkOiAxLFxuICAgICAgICBhY3Rpb246ICdDUkVBVEUnLFxuICAgICAgICBlbnRpdHk6ICdQcm9kdWN0JyxcbiAgICAgICAgZW50aXR5SWQ6IDEyMyxcbiAgICAgIH07XG5cbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuY3JlYXRlLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSk7XG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGF1ZGl0U2VydmljZS5sb2dBY3Rpb24oZW50cnkpKS5yZXNvbHZlcy5ub3QudG9UaHJvdygpO1xuICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdGYWlsZWQgdG8gbG9nIGF1ZGl0IGVudHJ5OicsIGV4cGVjdC5hbnkoRXJyb3IpKTtcblxuICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgc29mdCBkZWxldGUgd2l0aCBhbGwgcmVxdWlyZWQgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZW50cnk6IEF1ZGl0TG9nRW50cnkgPSB7XG4gICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgYWN0aW9uOiAnREVMRVRFJyxcbiAgICAgICAgZW50aXR5OiAnUHJvZHVjdCcsXG4gICAgICAgIGVudGl0eUlkOiAxMjMsXG4gICAgICAgIG9yaWdpbmFsRGF0YTogeyBuYW1lOiAnVGVzdCBQcm9kdWN0JywgcHJpY2U6IDEwMCB9LFxuICAgICAgICBpc0RlbGV0ZWQ6IHRydWUsXG4gICAgICAgIGRlbGV0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgZGVsZXRlZEJ5OiAxLFxuICAgICAgICBjYW5SZWNvdmVyOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgbW9ja1ByaXNtYS5hdWRpdExvZy5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogMSwgLi4uZW50cnkgfSk7XG5cbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5sb2dBY3Rpb24oZW50cnkpO1xuXG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5hdWRpdExvZy5jcmVhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgICBhY3Rpb246ICdERUxFVEUnLFxuICAgICAgICAgIGVudGl0eTogJ1Byb2R1Y3QnLFxuICAgICAgICAgIGVudGl0eUlkOiAxMjMsXG4gICAgICAgICAgZGV0YWlsczogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgb3JpZ2luYWxEYXRhOiB7IG5hbWU6ICdUZXN0IFByb2R1Y3QnLCBwcmljZTogMTAwIH0sXG4gICAgICAgICAgICBpc0RlbGV0ZWQ6IHRydWUsXG4gICAgICAgICAgICBkZWxldGVkQnk6IDEsXG4gICAgICAgICAgICBjYW5SZWNvdmVyOiB0cnVlLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzb2Z0RGVsZXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbG9nIGEgc29mdCBkZWxldGUgYWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxEYXRhID0geyBuYW1lOiAnVGVzdCBQcm9kdWN0JywgcHJpY2U6IDEwMCB9O1xuICAgICAgbW9ja1ByaXNtYS5hdWRpdExvZy5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogMSB9KTtcblxuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLnNvZnREZWxldGUoJ1Byb2R1Y3QnLCAxMjMsIG9yaWdpbmFsRGF0YSwgMSwgdHJ1ZSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmF1ZGl0TG9nLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXNlcklkOiAxLFxuICAgICAgICAgIGFjdGlvbjogJ0RFTEVURScsXG4gICAgICAgICAgZW50aXR5OiAnUHJvZHVjdCcsXG4gICAgICAgICAgZW50aXR5SWQ6IDEyMyxcbiAgICAgICAgICBkZXRhaWxzOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBvcmlnaW5hbERhdGEsXG4gICAgICAgICAgICBpc0RlbGV0ZWQ6IHRydWUsXG4gICAgICAgICAgICBkZWxldGVkQnk6IDEsXG4gICAgICAgICAgICBjYW5SZWNvdmVyOiB0cnVlLFxuICAgICAgICAgICAgZGVsZXRlZEF0OiBleHBlY3QuYW55KERhdGUpLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlZmF1bHQgY2FuUmVjb3ZlciB0byB0cnVlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3JpZ2luYWxEYXRhID0geyBuYW1lOiAnVGVzdCBQcm9kdWN0JyB9O1xuICAgICAgbW9ja1ByaXNtYS5hdWRpdExvZy5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoeyBpZDogMSB9KTtcblxuICAgICAgYXdhaXQgYXVkaXRTZXJ2aWNlLnNvZnREZWxldGUoJ1Byb2R1Y3QnLCAxMjMsIG9yaWdpbmFsRGF0YSwgMSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmF1ZGl0TG9nLmNyZWF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBkYXRhOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgZGV0YWlsczogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgY2FuUmVjb3ZlcjogdHJ1ZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldERlbGV0ZWRFbnRpdHlJZHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYXJyYXkgb2YgZGVsZXRlZCBlbnRpdHkgSURzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0F1ZGl0TG9ncyA9IFtcbiAgICAgICAgeyBlbnRpdHlJZDogMSwgZGV0YWlsczogeyBpc0RlbGV0ZWQ6IHRydWUgfSB9LFxuICAgICAgICB7IGVudGl0eUlkOiAyLCBkZXRhaWxzOiB7IGlzRGVsZXRlZDogdHJ1ZSB9IH0sXG4gICAgICAgIHsgZW50aXR5SWQ6IDMsIGRldGFpbHM6IHsgaXNEZWxldGVkOiB0cnVlIH0gfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuZmluZE1hbnkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0F1ZGl0TG9ncyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1ZGl0U2VydmljZS5nZXREZWxldGVkRW50aXR5SWRzKCdQcm9kdWN0Jyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoWzEsIDIsIDNdKTtcbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmF1ZGl0TG9nLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgZW50aXR5OiAnUHJvZHVjdCcsXG4gICAgICAgICAgYWN0aW9uOiAnREVMRVRFJyxcbiAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICBwYXRoOiBbJ2lzRGVsZXRlZCddLFxuICAgICAgICAgICAgZXF1YWxzOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGVudGl0eUlkOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBlbXB0eSBhcnJheSB3aGVuIG5vIGRlbGV0ZWQgZW50aXRpZXMgZm91bmQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLmF1ZGl0TG9nLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXVkaXRTZXJ2aWNlLmdldERlbGV0ZWRFbnRpdHlJZHMoJ1Byb2R1Y3QnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLmF1ZGl0TG9nLmZpbmRNYW55Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignRGF0YWJhc2UgZXJyb3InKSk7XG4gICAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXVkaXRTZXJ2aWNlLmdldERlbGV0ZWRFbnRpdHlJZHMoJ1Byb2R1Y3QnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0Vycm9yIGZldGNoaW5nIGRlbGV0ZWQgZW50aXR5IElEczonLCBleHBlY3QuYW55KEVycm9yKSk7XG5cbiAgICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFJlY3ljbGVCaW5JdGVtcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBwYWdpbmF0ZWQgcmVjeWNsZSBiaW4gaXRlbXMgd2l0aCB1c2VyIGluZm9ybWF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0F1ZGl0TG9ncyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIGVudGl0eTogJ1Byb2R1Y3QnLFxuICAgICAgICAgIGVudGl0eUlkOiAxMjMsXG4gICAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgICAgb3JpZ2luYWxEYXRhOiB7IG5hbWU6ICdUZXN0IFByb2R1Y3QnIH0sXG4gICAgICAgICAgICBkZWxldGVkQXQ6IG5ldyBEYXRlKCcyMDIzLTAxLTAxJyksXG4gICAgICAgICAgICBkZWxldGVkQnk6IDEsXG4gICAgICAgICAgICBjYW5SZWNvdmVyOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcbiAgICAgICAgaWQ6IDEsXG4gICAgICAgIG5hbWU6ICdUZXN0IFVzZXInLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgfTtcblxuICAgICAgbW9ja1ByaXNtYS5hdWRpdExvZy5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQXVkaXRMb2dzKTtcbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMSk7XG4gICAgICBtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrVXNlcik7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1ZGl0U2VydmljZS5nZXRSZWN5Y2xlQmluSXRlbXMoMSwgMTApO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lml0ZW1zKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvdGFsKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5pdGVtc1swXSkudG9FcXVhbCh7XG4gICAgICAgIGlkOiAxLFxuICAgICAgICBlbnRpdHk6ICdQcm9kdWN0JyxcbiAgICAgICAgZW50aXR5SWQ6IDEyMyxcbiAgICAgICAgb3JpZ2luYWxEYXRhOiB7IG5hbWU6ICdUZXN0IFByb2R1Y3QnIH0sXG4gICAgICAgIGRlbGV0ZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDEnKSxcbiAgICAgICAgZGVsZXRlZEJ5OiAxLFxuICAgICAgICBkZWxldGVkQnlVc2VyOiBtb2NrVXNlcixcbiAgICAgICAgY2FuUmVjb3ZlcjogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGFnaW5hdGlvbiBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrUHJpc21hLmF1ZGl0TG9nLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFtdKTtcbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMCk7XG5cbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5nZXRSZWN5Y2xlQmluSXRlbXMoMiwgNSk7XG5cbiAgICAgIGV4cGVjdChtb2NrUHJpc21hLmF1ZGl0TG9nLmZpbmRNYW55KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgYWN0aW9uOiAnREVMRVRFJyxcbiAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICBwYXRoOiBbJ2lzRGVsZXRlZCddLFxuICAgICAgICAgICAgZXF1YWxzOiB0cnVlLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJyxcbiAgICAgICAgfSxcbiAgICAgICAgc2tpcDogNSwgLy8gKHBhZ2UgLSAxKSAqIGxpbWl0ID0gKDIgLSAxKSAqIDVcbiAgICAgICAgdGFrZTogNSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWlzc2luZyB1c2VyIGluZm9ybWF0aW9uIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQXVkaXRMb2dzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgZW50aXR5OiAnUHJvZHVjdCcsXG4gICAgICAgICAgZW50aXR5SWQ6IDEyMyxcbiAgICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgICBvcmlnaW5hbERhdGE6IHsgbmFtZTogJ1Rlc3QgUHJvZHVjdCcgfSxcbiAgICAgICAgICAgIGRlbGV0ZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDEnKSxcbiAgICAgICAgICAgIGRlbGV0ZWRCeTogOTk5LCAvLyBOb24tZXhpc3RlbnQgdXNlclxuICAgICAgICAgICAgY2FuUmVjb3ZlcjogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1ByaXNtYS5hdWRpdExvZy5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQXVkaXRMb2dzKTtcbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuY291bnQubW9ja1Jlc29sdmVkVmFsdWUoMSk7XG4gICAgICBtb2NrUHJpc21hLnVzZXIuZmluZFVuaXF1ZS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXVkaXRTZXJ2aWNlLmdldFJlY3ljbGVCaW5JdGVtcygxLCAxMCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXRlbXNbMF0uZGVsZXRlZEJ5VXNlcikudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVjb3ZlckVudGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyByZWNvdmVyeSBhY3Rpb24gZm9yIGFuIGVudGl0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKHsgaWQ6IDEgfSk7XG5cbiAgICAgIGF3YWl0IGF1ZGl0U2VydmljZS5yZWNvdmVyRW50aXR5KCdQcm9kdWN0JywgMTIzLCAxKTtcblxuICAgICAgZXhwZWN0KG1vY2tQcmlzbWEuYXVkaXRMb2cuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1c2VySWQ6IDEsXG4gICAgICAgICAgYWN0aW9uOiAnUkVDT1ZFUicsXG4gICAgICAgICAgZW50aXR5OiAnUHJvZHVjdCcsXG4gICAgICAgICAgZW50aXR5SWQ6IDEyMyxcbiAgICAgICAgICBkZXRhaWxzOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICByZWNvdmVyZWRBdDogZXhwZWN0LmFueShEYXRlKSxcbiAgICAgICAgICAgIHJlY292ZXJlZEJ5OiAxLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRBdWRpdEhpc3RvcnknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gYXVkaXQgaGlzdG9yeSBmb3IgYW4gZW50aXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0F1ZGl0TG9ncyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAxLFxuICAgICAgICAgIGFjdGlvbjogJ0NSRUFURScsXG4gICAgICAgICAgdXNlcklkOiAxLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoJzIwMjMtMDEtMDEnKSxcbiAgICAgICAgICBkZXRhaWxzOiB7IG5hbWU6ICdUZXN0IFByb2R1Y3QnIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogMixcbiAgICAgICAgICBhY3Rpb246ICdVUERBVEUnLFxuICAgICAgICAgIHVzZXJJZDogMSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCcyMDIzLTAxLTAyJyksXG4gICAgICAgICAgZGV0YWlsczogeyBuYW1lOiAnVXBkYXRlZCBQcm9kdWN0JyB9LFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgbW9ja1ByaXNtYS5hdWRpdExvZy5maW5kTWFueS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQXVkaXRMb2dzKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXVkaXRTZXJ2aWNlLmdldEF1ZGl0SGlzdG9yeSgnUHJvZHVjdCcsIDEyMyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja0F1ZGl0TG9ncyk7XG4gICAgICBleHBlY3QobW9ja1ByaXNtYS5hdWRpdExvZy5maW5kTWFueSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIGVudGl0eTogJ1Byb2R1Y3QnLFxuICAgICAgICAgIGVudGl0eUlkOiAxMjMsXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJyxcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tQcmlzbWEuYXVkaXRMb2cuZmluZE1hbnkubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdEYXRhYmFzZSBlcnJvcicpKTtcbiAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBhdWRpdFNlcnZpY2UuZ2V0QXVkaXRIaXN0b3J5KCdQcm9kdWN0JywgMTIzKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChbXSk7XG4gICAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0Vycm9yIGZldGNoaW5nIGF1ZGl0IGhpc3Rvcnk6JywgZXhwZWN0LmFueShFcnJvcikpO1xuXG4gICAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sIm5hbWVzIjpbIm1vY2tQcmlzbWEiLCJhdWRpdExvZyIsImNyZWF0ZSIsImplc3QiLCJmbiIsImZpbmRNYW55IiwiZmluZEZpcnN0IiwidXBkYXRlIiwiZGVsZXRlIiwiY291bnQiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsIm1vY2siLCJwcmlzbWEiLCJkZXNjcmliZSIsImF1ZGl0U2VydmljZSIsImJlZm9yZUVhY2giLCJBdWRpdFNlcnZpY2UiLCJnZXRJbnN0YW5jZSIsImNsZWFyQWxsTW9ja3MiLCJhZnRlckVhY2giLCJyZXNldEFsbE1vY2tzIiwiaXQiLCJpbnN0YW5jZTEiLCJpbnN0YW5jZTIiLCJleHBlY3QiLCJ0b0JlIiwiZW50cnkiLCJ1c2VySWQiLCJhY3Rpb24iLCJlbnRpdHkiLCJlbnRpdHlJZCIsImRldGFpbHMiLCJuYW1lIiwibW9ja1Jlc29sdmVkVmFsdWUiLCJpZCIsImxvZ0FjdGlvbiIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwiZGF0YSIsIm9yaWdpbmFsRGF0YSIsInVuZGVmaW5lZCIsImlzRGVsZXRlZCIsImRlbGV0ZWRBdCIsImRlbGV0ZWRCeSIsImNhblJlY292ZXIiLCJyZWNvdmVyZWRBdCIsInJlY292ZXJlZEJ5IiwibW9ja1JlamVjdGVkVmFsdWUiLCJFcnJvciIsImNvbnNvbGVTcHkiLCJzcHlPbiIsImNvbnNvbGUiLCJtb2NrSW1wbGVtZW50YXRpb24iLCJyZXNvbHZlcyIsIm5vdCIsInRvVGhyb3ciLCJhbnkiLCJtb2NrUmVzdG9yZSIsInByaWNlIiwiRGF0ZSIsIm9iamVjdENvbnRhaW5pbmciLCJzb2Z0RGVsZXRlIiwibW9ja0F1ZGl0TG9ncyIsInJlc3VsdCIsImdldERlbGV0ZWRFbnRpdHlJZHMiLCJ0b0VxdWFsIiwid2hlcmUiLCJwYXRoIiwiZXF1YWxzIiwic2VsZWN0IiwibW9ja1VzZXIiLCJlbWFpbCIsImdldFJlY3ljbGVCaW5JdGVtcyIsIml0ZW1zIiwidG9IYXZlTGVuZ3RoIiwidG90YWwiLCJkZWxldGVkQnlVc2VyIiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsInNraXAiLCJ0YWtlIiwidG9CZVVuZGVmaW5lZCIsInJlY292ZXJFbnRpdHkiLCJnZXRBdWRpdEhpc3RvcnkiLCJpbmNsdWRlIl0sIm1hcHBpbmdzIjoiOzs7O3lCQUFrRTs4QkFDTjtBQUc1RCxjQUFjO0FBQ2QsTUFBTUEsYUFBYTtJQUNqQkMsVUFBVTtRQUNSQyxRQUFRQyxhQUFJLENBQUNDLEVBQUU7UUFDZkMsVUFBVUYsYUFBSSxDQUFDQyxFQUFFO1FBQ2pCRSxXQUFXSCxhQUFJLENBQUNDLEVBQUU7UUFDbEJHLFFBQVFKLGFBQUksQ0FBQ0MsRUFBRTtRQUNmSSxRQUFRTCxhQUFJLENBQUNDLEVBQUU7UUFDZkssT0FBT04sYUFBSSxDQUFDQyxFQUFFO0lBQ2hCO0lBQ0FNLE1BQU07UUFDSkMsWUFBWVIsYUFBSSxDQUFDQyxFQUFFO0lBQ3JCO0FBQ0Y7QUFFQUQsYUFBSSxD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